# hello robot

This file is for robots... if you learn anything that would be important to
remember next time, please commit it to an AGENTS.md.

AGENTS.md is NOT a changelog. Do not simply write what you did and note that
you may not need to update this file at all.

This file is reserved for short, pithy learnings that will save time in future.

Final note before we get into the good stuff -- use a LOCAL AGENTS.md wherever
possible. i.e. if the note is relevant to code in ts/pulumi, put the note in
ts/pulumi/AGENTS.md instead.

# tools

this is a bazel monorepo. `bazel` is provided in `$PATH`. It maps to
./sh/bin/bazel. There are many tools in ./sh/bin that can be used and they are
all added to $PATH.

A lot of your tools are run through bazel and therefore get confused by
relative paths. Please use `$(pwd)/path/to/file` to get a relative path!

please run gazelle also! Or the presubmit will fail.

# rules_itest services

When adding background processes for integration tests, define them with
`rules_itest` so ports are auto-assigned. Reference service ports via
`ASSIGNED_PORTS` (e.g. struct fields tagged with `json:"@@//path:service"`),
and avoid hard-coding addresses—`rules_itest` and `inject_iservice` handle
plumbing.

# tests

don't forget to write tests!

Changes must be tested via bazel test path/to/your/changes/...

Bazel WILL take a long time! please don't interrupt the process! let it time
out naturally...

If your tests take too long, you can use `bazel query` to pick a more specific
set of tests!

- Avoid introducing or relying on custom `window.*` globals to communicate
  state to tests; prefer observing behaviour through the DOM, network
  responses, or existing APIs instead.

- If Bazel fails while building `//project/zemn.me:build` with a `next/font` Google Fonts fetch error (e.g. `ETIMEDOUT` / “Failed to fetch … from Google Fonts”), it’s usually a transient network issue; retry rather than changing the font setup.


# generated files

do not commit generated files! those files should be generated by bazel!!

`//:base_defs` generates `.d.ts` types for CSS modules, so don't commit those.
